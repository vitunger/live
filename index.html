<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>vit:bikes Partnerportal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Open Sans', sans-serif;
        }
        
        /* vit:bikes Corporate Colors */
        :root {
            --vit-orange: #EF7D00;
            --vit-gray: #626062;
            --vit-black: #000000;
            --vit-white: #FFFFFF;
        }
        
        .bg-vit-orange { background-color: var(--vit-orange); }
        .bg-vit-gray { background-color: var(--vit-gray); }
        .text-vit-orange { color: var(--vit-orange); }
        .text-vit-gray { color: var(--vit-gray); }
        .border-vit-orange { border-color: var(--vit-orange); }
        .hover\:bg-vit-orange:hover { background-color: var(--vit-orange); }
        
        /* Corporate Font Styles */
        .h1-headline {
            font-weight: 700;
            font-size: 26px;
            line-height: 32px;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            color: var(--vit-black);
        }
        
        .h2-headline {
            font-weight: 400;
            font-size: 12px;
            line-height: 18px;
            text-transform: uppercase;
            position: relative;
            padding-bottom: 8px;
            display: inline-block;
        }
        
        .h2-headline::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: -3mm;
            width: 15.5mm;
            height: 0.5pt;
            background-color: var(--vit-orange);
        }
        
        /* Gradient Backgrounds */
        .vit-gradient {
            background: linear-gradient(135deg, #2a2a2a 0%, #1a1a1a 100%);
        }
        
        /* Subtiler vit-Hintergrund f√ºr Main Content */
        .vit-background {
            position: relative;
        }
        
        .vit-background::before {
            content: '';
            position: fixed;
            top: 0;
            left: 256px; /* Sidebar width */
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
            z-index: -1;
        }
        
        /* Card Styles */
        .vit-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative;
            overflow: hidden;
        }
        
        .vit-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(239, 125, 0, 0.2);
        }
        
        /* vit-Logo Watermark auf Cards */
        .vit-card-watermark::before {
            content: 'vit';
            position: absolute;
            bottom: -20px;
            right: -20px;
            font-size: 120px;
            font-weight: 900;
            color: rgba(239, 125, 0, 0.03);
            pointer-events: none;
            font-style: italic;
        }
        
        /* Sidebar */
        .sidebar {
            background: linear-gradient(180deg, #2a2a2a 0%, #1a1a1a 100%);
        }
        
        .sidebar-item {
            transition: all 0.2s;
        }
        
        .sidebar-item:hover {
            background-color: rgba(239, 125, 0, 0.1);
            border-left: 3px solid var(--vit-orange);
        }
        
        .sidebar-item.active {
            background-color: rgba(239, 125, 0, 0.15);
            border-left: 3px solid var(--vit-orange);
        }
        
        /* Status Badges */
        .status-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .status-new { 
            background-color: rgba(239, 125, 0, 0.15); 
            color: var(--vit-orange);
            border: 1px solid var(--vit-orange);
        }
        .status-inprogress { 
            background-color: var(--vit-orange); 
            color: white; 
        }
        .status-done { 
            background-color: var(--vit-gray); 
            color: white; 
        }
        
        /* Chat Styles */
        .chat-message {
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 8px;
        }
        
        .chat-message.sent {
            background-color: var(--vit-orange);
            color: white;
            margin-left: 20%;
        }
        
        .chat-message.received {
            background-color: #F3F4F6;
            margin-right: 20%;
        }
        
        /* Forum Styles */
        .forum-post {
            border-left: 3px solid var(--vit-orange);
            padding-left: 15px;
        }
        
        /* Corporate Bullets - Orangene Kreise */
        .vit-list {
            list-style: none;
            padding-left: 0;
        }
        
        .vit-list li {
            position: relative;
            padding-left: 20px;
            margin-bottom: 8px;
        }
        
        .vit-list li::before {
            content: '';
            position: absolute;
            left: 0;
            top: 7px;
            width: 8px;
            height: 8px;
            background-color: var(--vit-orange);
            border-radius: 50%;
        }
        
        /* Hide class for view switching - MUST override Tailwind */
        /* Premium Feature Locks */
        .premium-feature {
            position: relative;
        }
        
        .premium-feature.locked::after {
            content: 'üîí Nur f√ºr vit:bikes Partner';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: var(--vit-gray);
            border-radius: 8px;
            backdrop-filter: blur(2px);
        }
        
        .premium-badge {
            background: linear-gradient(135deg, #EF7D00 0%, #FF9500 100%);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .locked-menu-item {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .locked-menu-item::after {
            content: 'üîí';
            margin-left: auto;
            font-size: 12px;
        }

        /* === MOBILE RESPONSIVE === */
        #sidebarOverlay {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 40;
        }
        #sidebarOverlay.active { display: block; }

        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                top: 0; left: 0; bottom: 0;
                z-index: 50;
                transform: translateX(-100%);
                transition: transform 0.3s ease;
                width: 280px !important;
            }
            .sidebar.mobile-open {
                transform: translateX(0);
            }
            .topnav-desktop { display: none !important; }
            .topnav-mobile { display: flex !important; }
            .main-content-area {
                margin-left: 0 !important;
                padding: 16px !important;
            }
        }
        @media (min-width: 769px) {
            .topnav-mobile { display: none !important; }
            .topnav-desktop { display: flex !important; }
            #sidebarOverlay { display: none !important; }
        }

        /* Tab navigation scroll on mobile */
        nav.-mb-px {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
        }
        nav.-mb-px::-webkit-scrollbar { display: none; }

        /* Headline responsive */
        @media (max-width: 768px) {
            .h1-headline { font-size: 1.25rem !important; }
        }
    </style>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
</head>
<body class="bg-gray-50">

    <!-- LOGIN SCREEN -->
    <div id="loginScreen" class="min-h-screen flex items-center justify-center vit-background" style="display:flex;">
        <div class="w-full max-w-md">
            <div class="text-center mb-8">
                <div class="inline-block mb-6">
                    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQQAAABGCAYAAAAq7+rZAAABCGlDQ1BJQ0MgUHJvZmlsZQAAeJxjYGA8wQAELAYMDLl5JUVB7k4KEZFRCuwPGBiBEAwSk4sLGHADoKpv1yBqL+viUYcLcKakFicD6Q9ArFIEtBxopAiQLZIOYWuA2EkQtg2IXV5SUAJkB4DYRSFBzkB2CpCtkY7ETkJiJxcUgdT3ANk2uTmlyQh3M/Ck5oUGA2kOIJZhKGYIYnBncAL5H6IkfxEDg8VXBgbmCQixpJkMDNtbGRgkbiHEVBYwMPC3MDBsO48QQ4RJQWJRIliIBYiZ0tIYGD4tZ2DgjWRgEL7AwMAVDQsIHG5TALvNnSEfCNMZchhSgSKeDHkMyQx6QJYRgwGDIYMZAKbWPz9HbOBQAAA+V0lEQVR42u19d3wc1bX/99w7M1ukVbeMsTGYjkwJGAh5KbIJNXSbFb05weQFCIGQnrDatJc8Elp+gcQPCOaBk2jpGDDwAha9iW4RwBBsZMtWb6stc+89vz9mRl7bkrUGkwDR+XwGCXl25s7sPd97zveUSy9cUHLXfttkj+vLaE0ESSBjyBYvrwulDl442MBNkNQAA4CxlYUTEJSEOe+zk3c476D0ZZWOmVcRyseIDABDH/S6hqErI0K+2hF6dP7VdYe/EG8xlIIO7ndjvOTUg3cyC6vtbEQzEwg0zvU46oA7hpz+G14t3funS3vaDECNCVBjI/hX88pnHL+9fmBa2fAuyhgQQPiIxRihK0uEfPQfzrKD/yd9MDMREQwmZEI+hIhFK0JnvtEdfrkySpIBTWBhkdJzdsjEm79R8itqgOYE5EcFBlccW73/9+r7n9i3dvic2pLhMiJNAH9ghWIGOxLozFj8/Jrwj1rQ4qYAJBIQAHD4PuU7HDhN3zC9JFeiDI0LBgAgAG1LKf7e4/w6ubSnzTRBEsCNM0FE4EOmqmt3n5zZ1TXG/DPAgAGOWAZrh6T7xJropQBxquGjv++E/BsAwu+W9gz8sSXS8E5/eKDUJqEYRhsjBzNaHTRFfe/W06suoCTUHxfA3ooTmgDgtAOryg7fKX3PjIrs1N5ho1xFviHywYwRAmBApsSR8u/d9g1fS/U+zU2QDSnoxpkgSsJ8e3+VnDnJDfdlWZEY3woxBqY0RPLv3fabh11ffTUnIKgBhuOQ1AC9+OSyhr0m5Q4fSGslsPWBc4wXqMMhKVu7Qtdcdl9XS/CME9N5Qj40IDxaD+uax7reXvqGfVJf3uaI5WmkYpJK5/XhO6Svui5eduh5C+E2xbfShG/yrIOvfSZ7WV2tmtI3DFcIWKAP55VoJo7ZoJWDVs8NrTU/4QRE43JwUxxSNED/8YSa/fbbxj01nWEjqLhnsQQ4YyS9tDZ8KbAyi1Z/Ja4Dz5o1JXrg1OwvJSnW7FkgHzkWMEzUgXy3x1pz87OVP+cEBBomXIUJ2UqAMKcZihOwLrh3YGlzW/ibUtrSArQgppzLVGbnxSE7uHecf1DlXg0p6A8LCk1xSMRhrjm6evfdq/WFmazSAKyt8TAENtKS4s1OK7moeeVazAQlkzDxuGdzHDB1+OrqqGvlmRk0vltiGDoWJvl6p/3g6Yv7lnATJKWg2Qe0/9pv8NKdqvVOQzkYQR89IDAAAWJBNrV2R36w6JWVfZgJoo+A35mQf0+RAJBshnlhAexDb8w98/npsW3rttEHZHOshITMKTJTS014eiW+3Dq4y02XL+vMAxDNzR9sEjY1QtCeML88lBftXJPffSgP3hrKZBi6LAzxVpfzxueuq/sax9uJktA+KarvPrOs4XPTc99O5zzydNzrARwWQE/eyd3xdsm8R9/KdNYBoi4Omn0+WD1VPuPInfO3OkJZypAg+idwBwxdESb5amf42fo/Dn4zeLaJaTwhW81CCH7ZfyEUN0Eeuegz5z++0nmiIkqWVkIJguwd1nrPybldrzp05S1EHpmGD0Cejfjdp8WO2nmS+cpghnWxpvu4pj0JZFyHHnkv/EOgxR0xGpaDT997ckldjXu5YMWGixs3MXQkLMXb3aFrfnRPT6v5awEXQeCjdnL/e1rMLcm4zP8UMDDChCWZ3pyFp1Y6lxCBU6mJCTwhHxEgAODG5WDmZv2z/4vNe6MzvKIiBEtp1kSQvUOsPjM5f9z9Z5dcRw3QLyzYYjOfUAfG5MklddXqmqhUrAwVrUiGwcxQox2GkYuFIZd32ksuuKvv7o1N+7MOSl8yoyo/fSjPeQLMWNcZuZ5BvjQEsarXbvvzG9v9LPDTA0C7+eTYZ3eflD9hMGPyBDAzF47FfHClH3tsjmUoEnLsl9ZGf3n+3b1PmRMniMQJ2fqygVInkzAzWyEffnddx21/n3z82Xuap2sj2ZK0IgPB1kDaVQfPoK+nTq14ff+Ffb9/NAFrThKqmBs9moCkJFTTqelL994mv+PAsFFCFAcqhsGltiTbYmvEXaYCx1rCau931EPvhC9lThMa1xOJ/xOvmbX/NkM/lZZBZYRCG3x2M9iV1Tae7Sj5/rXNrUO/r/XCjFwHPuOAbasP2LavqbKCJWeEJMHrx0GA0QKDOYMtJkgZpixEQlgQAAHMWP+ghHVDdvbp9vCvDvmf3p9yEwW5IRMyIR8dIABAQwraU/R1y3etip186A7mvpDIq7wh0oA0bl7N2YGu+sNJtX+fk+z4G8e91XhzN0kkIGYDJvGVSdscNL3vW3lXGwNIUSQYlDiC3uq2O3tzaIYxqpBEI4KOOSRf7Qw/edmD3W/+pNGzCprikAwAxuzZ1mf9+bV2NoJ4s7ckAgsCT4pavc932o+e8r/dd/j5Ejrh50187yhnWvcwPffU2/Jx1iQCxRcEMkYyQLvuOzU7y1VsUCQ3wkwmYlvirX75St8wL1caQhAbgFARoZ6ebOide94seeDyR9e86ScgTVgGE/KRyJhrJSdgURLqobMrLpqz/dBVw1mlDMEyBqYkDLEmHe69/a3aWd+5d9U/muKbN18D8qv5/NJFX5qaObN3WBfFHRhDpixE9M5A+I2z/lJ12DNtbas3v8iuZ9yb4pDxOhAVacGMQeIR0ZaRp0/+Z+TRg6ZmZw9keVzykgBoJl0ZJvliZ+j+WVcfeBzQrDbLwUy4CRPyz7QQRiZrEuqFBbD3X9h39dNfj+1x0Dbp83p9Mz+dhZ4ey1cePaPz3jt32+1zp9z25mChMhZKYLr/4ivlc+qqsmeks0YXk8DDAGzJPKxt0bwycuEzbW2r37oQoV2+CIXlowKZoaRnRjNAH0ZxOAEr1QoeYyWmDTI3Z4LRDgvfhHvP/NJz/mNarigwCKwfxwK1Ddj5W54tvYioWb12GZyZM6ELn3GZdxhKToDBhPyLLITCyU/Jerz0jRcf+cyk4S92D2stJSQbqMpSaT3bHnngoOuGjuME2J+wPIp1YFq+GX5mv9r8gb1Z1oK4GGXRlVGSz7WVpD577VBDYLEUocyCkjCLT6s8av9p+c8NZI0BGTGmxx0Y9UZwqQO8Oxjt/8ofu35LIC7GNGCAkACdv6wueskB77w5vSw/JZ1npiLcBWaoioi0Hny37OdH3ND7k2KfcUIm5J9uIQRzthEwzM38zS/uPO+i/dY8v31ZZvv+HBtLkNWX1u5nt8kc+cBZ0asoOXy+Z1HA3dhVuOes6Bl71eYO7M+ZolwFZnDEBq0ZsIYeX21/mxnU2Dg+iZbw1fukmZXb7b9NJrVLdT6CPIoLkBoGSiy0v5n/NUBsio3xN0FQA3Tz11f+ZKcqd9ve4eJCqYZhykIQb/daK3/7vPMrTkBgwgKYkH+xjDtxm5vBM1shv7O0Z6g8VNKyczXOqggbzmtBAKRyWe1cjc8euGP56jk3ZF/44wLYS1pgGKAUQMNyesUpew7dU2mraN4AxcTsGTCxkJQvrI0mT1vcf99swDqnCGVZ1gRBF8Bcday8+oCpuQP6Bzmb1YysYrO5I+OyCllkWtfYKz577R5x5namPcfnDjgBgfPBFc9X7fGlGblFAoqMQRFJSgQBYYRlyQfeLr3oike6Xpg9G3JG80TkYEL+tVIUCx5EHn72WN/jz7Q5p2ktpS1YgwGXSWpl9EGTs3+4OV5+8HkL4b51IUK4Gk5DCvrbB3b/YPdKt3YwR4YYYjw73DBMzBGytUu+99+P1P6WExBzigCDpjikOAn6qqPLDthnSv6M4ZzRLDhMBGu8QwrIjJF2a0fk20CLiwYIFJMO7CcpfX5H9Zsppa6dVygqSckwdFkE8qV1zlNnN/X8lZsg50xYBxPySQEEAJiT9GoeTr5t4C93rwhdFbWFBcAlEA0rUIXMiS9Nz6e+dVD5frv+Djm6CLmfHlGz7x7V6ptDGW2IWbABoAmG/TA7b0RjMEES2GWJVzoilyxdsSLnFxONq5zxOMCcEJ/fUf92UkTJnC7OU2ADXRYh2doZur/hL733BUlN437OT1L6U0P58XWTMl8ZzBhVDJHIABzJ6Ehb5tH3wt8iQs7POJyoR5iQjz2HsKGhm4T2iK+hS6acUbrTwTvkjuka1soSbA3kyEyJuFXfOJAfPHKX2EIDI3euHDy3wnZDwy5YCvZZOga01/GACSBmkJ8IbUC6MkKyZY3z0Km39t9ZbK7+CFcx/6p5e9eoLw5koSX8PIRxuIqQDXQO2dkn3w2NJDUV8yq8H3XO57Z755dh4fKgF6IshoVUJSFhvdRhX/fDJd3Pb0ly14RMyMfGQhiZzkloZuDE/609o2VNaHl1iCylSQuCGMgYnhbN1xwyI/PDw2fkvje1JF81nAdLIuKC4kJiwGuK5BMGBjAG7AhDawft/GMrSy9h9uoQilhxCcvBx+5WHdutMnuFoLwxhoqoZSQA0BFHyFfXOtddfH/PG8saIYPQ5TgAJCgFfcfZq769a6XeYyAHU2yYMeKQeKfH6bv15dJGTkAsS07wBhPyyQUEEMCpBog+erd/4bM48e0+p7vMEsJoGItAwy64L61V77BWwy5YkG8ZsA8ABdOf/L8RA6ShSxwh3umxrrjk3nXLkfLCh+MOyK9X+PaczLd2rdLTB3PMJMz4IT8DEw0J8VaX1fH/nqJfcAJidhF+fCIBgTjMqfvX7rjfNup7ea0NQKLIl20sIcXrneHEH55e17EMEElMAMKEfIIBAfBIxsu+BGvh60N/v/+d6Ik9eUdFJLHRYMlERGQRyCKAjClIyw+KJHm9deApJ5moTeKtTnvtja9N+2WxTT8C5fzZMZNn7Fqpv59xtSn2mUgwC1jixY6yH97198HuYvsKBNWOZ38m88vty9zyjAsjiumtYGBiYZKt65zlxy/a6Trm4sjSCZmQjz0gAECy2WurdvGD3cue7pTnQljSImgzsup77QoJBGbAMPnAELRM9HXIAwYGWeLVLuf7Nz715uCWKufh2w/+eptYLppVzKJIlr88RPLVDuv5U27pvLFYriLIulzYEDto1jbZeDqrNYjH5WEYgCXBQ65ES4d9EdDi+j0QJ4jECfl0AAIAnLcQLidgzb11cNGylfY1pY5tkfEIMmYGDIGMp6HEDGbCBhYDEwyTrghDvtFlPR6/deDmoolEn+W/6fiyw3avUvHBLIpLegLgCEJXzkHzu9FvE6jovgJe56W4PHAburIqrETeFBnJYOhYWMg3e52mc/7a/7dHE7AmSpcn5FMHCMD6yMNRf01f9Hy7dX9FWFhGQcF4azwzvI7qxivpJR8I2BAMg20BdGds3bqu5CKiopWTEAeAWfa+27tXlDoudLGeuCFdEhby5Q578SX3dT1uimxQGgDVX0554Jy62sxBvTloWSyRaIHWDdmDT7WHvsMMWjbBG0zIpxUQMBJ5YLrkmWknv9QZfrc8JCylYEYaKPsxRmLyrQZAMABNOuZI2doduuHU27teCroSFaGcghqgU6evuGDPGjVzIFN8MVHUAb3fb/Xf917Vpcygxi2IZMRn7Vg+a6r7U9aKyRTT8YAgQDrsCPFqh7jqW6neVcsaIZMTkYUJ+RQDwkjk4ak33xy85XU5d3U61FPqEGlNxrMOuAAYvF+1gYlaJFb1W513v1P6o6KJREBgOfiS+ik1+07O/DjvusYw1kcyNv+w2raEeKvXarzqwVXtxSrnMq+5izl/v3U/2rlKTUm7bEhwcZEMR8i3u0Pv/eClil8Vm3U5IRPyiQYEwIs8cBzyyuf6Xnnk/dDJg65NIQHWLBgswIbAI8AAEIOlkKK1K3LZFc3tXcuWQRRFJDZ5+yscsePAr3cq01VDeTAYAsZzQ5hHv0iwv8LrHc6Kry+ccl2xyskJiNmN0L84Ypu63Se53xzOGkNFvDcGIASzhqTn2qM/amlpH8bMCSJxQv5NAAEAKAX9wgLY8+/tefjx1aFvOZaUNhvNxncXWIANYLTQMUeIN7rtV45cvPf1HIec01w8y584pOqgPWvUOems0ZIhvXwG9gohDMDBUaB6lgBntU2vrCv51gqsyKWKTIkO6hWO3GXgvyaXuqG8YVNUgRZDl4VJvtYhnzh9cffiiQ7JE/JvBwgAsL8feTjxjr6rH2+P/DEWkZZhozhYullAEmMgb9NTbaHvAM0qtX5R3azEm8CMhJg9PfP7bSKKctrXzIJPCgOQ9gABPjBoDR2LCLm8077/jL903VfsTkdBJKPp9ElH7FadP9ZvfDJ+mJEJIQl0DFv62feci4iAiQ7JE/JvCQiAH3logjx08aHnv7DOaa6MSsswFBjQhlW5I+TrXfZt//lAz8NbpJwEc9PxV5964BS9X39WawGWI0URG3EIQRakMeCwBNYOWNmn3g8XnRKNIKJYV+fsOWnwSkcaGFPch4ihoiEpX1xn3Xzhkv4XiyVLJ2RCPpWAgJGW7imTeGpy/PXO8JrqsLSYkS+32Vo56GQeeidaNMsPv4X73nvvXXLglPwvLK1YG7FBfcRYwCAMdNSS8vWO0DUX39P9ZrH1Co8mvKrHO/Zb9d3da9TuQzlTVCRDMzjiQLzTY/fdvbzs+5yAaGyY4A0m5JMh1kd14aCl+9IVKzo/O6XmmJij75wSwfQeZbvNbeEf/eLptSv3aYBMbkGY8c74u4ndK9X0niw0CZaeF0Ign6UkFG4czTAMU+II+W6v8/7CV6xfFtuVKOETiYkHqqbtPzV9aU4pw4CgopALxpJCvtguf/aHp9d1XHcxZBIT1sGE/HtbCAC8yEMiAZF8vOvF/3yict9l7c5Rf3qnbM+zl3RdmUhAFGNGB/UKicMn77DvZH1BOu8VEwkjIFh4NcyMTSMMLCCYmCDpjR7xvVRLb/8yFBfJmA0IIvCX98v9YrsKtzzrwhSbEl0WJvF6l/Vqw62XXuVzEBM5BxPyiRH6Z9wkkYAojPcHjVCL8j18dv6xM0ru+MLU/Am9Ga2FoPW9DoSX/Who/QYuXv0E6YooyVe7nKf2vXb4Cxz3SpbHu19THPKkFPTlR1d+4ax9hx8PU14rZjnei2LP3NIsbHn3iuicM27tXzZee/oJmZB/Kwuh0H1ggJrikIktAIMmn+W/8Zjqg/es1if0Z7RmFpINMGIO+PkHZAjEAmQEYAgWGXQOW/zCmtjFBHCRJD8F9QqH7JC7vDqk4JriXhIzdGlEyNe7nNvOuLV/WbFk6YRMyL8FhzCKKcLYQgWJ+6C1f2328lKpMJAXXlJAkNzkxxy9v/nOABkwky6LSPni+9aic+9a91yxOQCPJiCpAequ05eeuUeNe1DfsLdTtEFwrzFdBQ7boNWDVvrJf9iXMqPYzktbVTgxOnaNBcCJBETjFpz/Yb7+eDy+ydjq6uo4mUxu1XvF4/FRid9UKqWLGdMY5064DP9qCXYpujde+p+HT3evHcgWbONOI74BgjohEh5CGAZHbeaOYWfg6idozyuOz7Q3+lbKOCY/IQH66sPVJT/67FDr1Ji77VDeQAiIkd5oYvSto5mhK6KWfOjd0E8Pvz6dmGiLNiETFsLW5BwAgTrwJbOm1OxaMfhzV7FhCEFgsM8VeMULXl8FAoGN8TGCjSNt+WpP6GdXvtK/+tjjYSWLUM5lCcg5SahHv5r//o7lalrvMCspYMFgg9YNFOQt+39jA1MSJvF2j/WP3zxX+t+cSP9L9ldgZrrn3G3qyjBo5/2/OQDe7i/BglTnaxgl0nHrWdW7b1+iwn15F7Z//gA75r6X+95Y2LJ+f40PueDwMcccM7m2tvZAYwyztzkl27ZNSqm2G2+88aXgvK3xHhoaGr5UUVFR7rousx+XJiLV3t7+yNKlS3PBvY444oiympqaesvyVICIWAhBruv233zzzY9NAMLHSBqbQNQAfe+89OW7xFRVd5Y0EQvmAAB89fRzkxkMkIDRMOVhFq91WW+e9+foHzjeL6nIegU0Qv/0yao9dq1IX5rJac3kpUQT+b0d4GVAkl/JHTSGJQIbluLvndZ3Hn51XRo/hqR/YnlzMMSzj/9M+WW7DT4xOZKrGPbhr8QBplfqNiAxA0iOKKjw6832qszctWtVfrf+HEMAcCygPU2405q6K7D67Y3J4C2V+vp62dzcrCKRyCG1tbW35HI5EBGMMYhGoxgYGLgdwImJREImk0n1YQGRiDgWiy2sqanZLZvNgoggpUQ2m0UsFttm6dKl64IxxWKxHSdNmnSPlBLMDGZGKBTC0NDQmwB235ogNQEIH0Ka4pBogLn6CzWz9q0ePnswp7XgICGICvKOyOMOyIw48pLAGWWJdwasC9rRPpzyNqIptl7BPPm13G+3LXGd7gy0FN42r54hwus5BPazIIm8LtFRyJfanWXHLkrf/q+oV2j0J+665V2lvIsJ2aTZITAR2AZEzEYOaOWNQAQAIURah0hxWMCAQQ6BbGhow1vVlRRCuK7raq21hvedKNd1LSJKb3UfmGjQv5cBQMYYEkIMSrlJE26tlNIBGAAwrusKIhr8d3YZxMdtQHGfgDxoev4324QZORUQhh5pKAx7vRQQkIsCxMLz40OQrb323Sc29f9fsV2JgnqFxfHKI/asVkf2ZVgLkNwARvyGLoV/YwaHCOhI2/qJtuglRPwvrVfIuMpSGlIzSDNIG5BhkMtEATu7CRkKgmaQMt5njAF9FKaNb7rL4GBmCUASkfiI5vTIPQp+3/DZjRl1TB9Hnfi3BYSASLzpKzWn1FXp2b15owWE9Kokhd9lyQMCYq8JgjAAG+KQIGpLO7lH28sv3YKuRCP7K+wzKXt5CSnWmoj91vDMXqFSITAEnaBg2JSEIN/qsa+76J7im7t8ZF8kEQOs2EDBqxtRbKAIUEiN7W8EVhAjeN5P/Jw2zEFp2wa/T8gnDBAITTDzd9st9pmq/K8taGazcbZwUEJNXjUje24eMetSW4pXupzf//ChthVIFef7BvUK95/6/vm7las9B3JGC0AIv7uTpyDs36twdSGOWCTe6bF6/vaqSHwc6hWUYeFYIhoNC6vcEXaZI5xwWFhay5qxLAT2szzJ+PtkBPtlfLIlatu2sDyRtm0LACWu69KEun+COISmOAQR9B3Hd+wzI6a2G8yDBRkxemSUAJZeCwQYU+4Y8Vaf3Xb9c/yzLem8NLsR+heP107eo3LgJ/m8MsxCCgS8gcdYeFmQ3t+CHd4F2FiWJV9bF25MPjPQ03jJ2PUKiTFyAxobPT9/SwAzkdj0ZTQCSCZB5ZPEuhfXhn/Q1itDWSUgCByWoB7X6kVdXbBnFhoTEI2NQGPjZUDPr9aTMryeRiuxQf64RSLh3yc5Ujq2VV2JeDwue3p6ZDweH/Xafq7CuP2wiLzwkxDiLKVUzHW9IIkfRdCVlZW9AFBbW7tVniEej8uOjo5RQaa2tpZTqZQpgr+iRCJBra2t44JVETkbI9caa1ybk9mzZ5tkMmk+NoCwvM57ea90hXr2qdaY5OQ4qwmbqyHwnUDWcOTyLvn9u1f296G1OJa/sckjEh88afjKHUpMZVdGaClG6ImR3g1MAZXpf7sMHQuTfL1DvnbCXw6/lhMpsbl6hbEslWRyfYSgWP1JJjc9N+n/XNLSPrykBb8aYxQjMIokOJn0/nbKRaFRQaw3rXN/SG64rU7yo/naXT8JaPyU8qYmGY/HTaD4Y8nChQtfGE+xtgaQEdEHdg8TiYSYOXMmNTQ0aB/sPjQ4pVKpD3Wt5ubmj5eFkEzCeLn/a1tnVlUljtteJ12jFW9mjIahK8JSvtRtPTXvnoHFAQdRhDUiRQP0dUdVHbjPpPQpA1nWAkJ6JKUZiSqsz4pcnwRlETCUs7G8p+QCQkqnWiHH8lHPqkd4OxHbflJF2Qib7ljE0hmm1b1S0f2da4vlOY7YuSp29N5OpZSWyiuP2HAs4urIMFxVOnza4lX9lx8zefuaKDgLIOwfHXlLXXTn6tUAOFFfXjF1WmmpI4nfbnedvOqNsab14Vv2mt/uUGHtcPUJU5XlMAkjjHSG6bm3geuf62nbWu6hz+5PbmhoOMC2bem67gbfmxCCpZRERL233HLLqoaGhnzh5N+MctRFo9EyrTUXEJq6pKTk5YULF37o3IpEIiGIyMybN+8wAKVe4MQTKSWUUqa8vNx0d3c/ft999/Vio/BlPB6XyWRSA8DRRx8dra6unm6MKXVdNyA6NxHbtuE/w2sbP0MikRD+9eT8+fP3UEptOzAwUFr0F0HEjuNQOp1+f8mSJc9/rMKOQV9GSvX89G8N5bvM3han9wwrRUTWaHyYIxhdOYuf6rAu2YJ6BcQBNAD4/JT8r6tDGn3ZoLbZT3ICef51gAN+abUxpMuiJJ9b6/z19Kaux8YKM3pZEeDhzmnR4+r7HpsR6yzLqpG9bWFL5sFJltvdX/Gl//dk3yubi/cHpd+XfM699sBp6fhQzuSJR96HDoWE/VwXTgOOuPfw7R9/YUo4H815lV4ckRDdSvzjxbO232/RopXZY/bSF+1a1v39gaxRc6oRKpHaTrsE4Q0XWhMqQ4ou3K/zIQI0KGgFB7ln1H7k+udw1NYIrRKRzOfzEEIcOWXKlCM3yxAaoy688ML3lFJLVq1a9ZtUKrV6NFAI8hDKysoWV1VV7RPkPAgh4LpuTgixPYB1y5YtEx+UZEwkElYymVRnn332BbW1tb9TSgXP430ZWiMajaKnp+eFTCZziK+svLHynnnmmXvHYrGLpJSHMvNUIYQY531BKeXm8/ntAbQHzxqAy/z5808rLS39ARHNlFKipqamyJ2HvTGXlJSgra3tQQBHfPxCLCkYZogvN1Wc+0S7fKkiIizNrDdWOQPWsZCQr3eKWy9+uOdZsyWdl1LQfzmh6sydY3r2QI60IJKeY8DeTPH7Pwb7SXh9ID2ffNWgM3z/6pLvb665CwFsErBSrW090FhSXaLCJVY+XObkw+WhfDgs3NBOFarsiBnuPJ8HEGMEAUg0QJ/6hfLKXapyR5aKvBOzVWlZKB8udfLhydF8yWDWpJ99u2fpETuvKCuROloRcsMxOx+J2floeSgfLpNuZAf/etWOFrFQPlxq5aPVobxtiSC5i0doBAGD8lDeLgt54y2189GYo8I1EcWjWVqJeliFR1N8/CYyo8c6Rj+klJbjODuXl5d/a+edd37xzDPPPDKVSumxahZ8U579nwYAW5aVs237Q5nmvvKps846a1ZFRcVvXddVWmultdZKKa2UykspeXBw8K2BgYHDUqlUf8Hzkf95s2DBgu9UVVU9X1paOt+yrO2k9GirzRzGfw85y7J4Yzfh3HPPvbimpuYWx3FmAoBSyvhjKkqYOaeUUkKI9MctyjCiTI2NgKCV2euWh498u99aWe6Q0GY9qhsWXCqZ3hmQ/betdL5bLMvPfueleN2k0s9U5f5LaMNGeztTezaA8JvBFsTiQJ6aMJmIlKJt0Plp8sF1740XyUi1+pzIGvv6riGLwcR5JTivBbtGsusyT4uaEwHYaITGKOzpsoS3pf3J092jp5SaqoEcKWWI81qw1sIlYWH1oP3nZDOGapxseVaRyGliVwujjNB5LVgZMQKSrpJGuzDKCJVVwmj2cjyCPA9vyz0gp4TJucLklDDKCKVdmKza1HdvSEEnm6EKjy0JvbInIyFCFIQJ/WQhYmZ2XdcMDw+7lmXVVlVVLTnzzDMPS6VSOpFIiM24JMF+gcHvH4ozqKur40MOOaS8tLT0r5ZlOUop4bvckplJCGFprQf6+/vnLl68uDcAAADU1NQkfOW9rqqq6r8B2JlMxtfHETHMrDc+ABT+HhCAMpVK6a997WszS0pKrnBdV+fzee0DYvBOZDFHQU4Ifaw4hNH5hI510yKVp5y7J56aGnXNkAu2CEQw2rIs67Ue++cLW7raTymFlUTx9QpL52V/skvM3bY3S0oIWJ7yk99siUayEr26CYYxZMocI1p7Qqt++GjF1ZzoF+M1PmlIQTODiHqf+ez08Mu7V4h9+3JshLcJtBzKgbcppT2uP7Z8T6L+l0brnTDbB5XpFeYUGxqaQQIeqyYIVvewUC+ti9wApKlfCS28ZAIaqfxkJmYQ3vNniNCWdCAclx1bADlFUOytClyASFHL33OCCNqwkA7gSGMXjq0esA4/ovKwGEyJ6wdhbKF12kh+sjP64JKW9uGhoaHNKqKUkizLkqOFQ7XWMMbogskqXNfVtm2L8vLyppNOOmmvxsbGNgBia1dMbhoRapTJZFItWLDg+tLS0p0ymYwSQgS6w0IIQ0TWwMDAGTfffPPywLXwV3LR0NCgzz333Mbq6uqvZzIZl5kt3w1mAMayLCmlHNPMJyLk8/lyITzHdrfddqPm5mZYlnVpKBRCJpPhQrfacRwZuDPjiTHGEkLAGO/7/VgCQqBQj9bDmtPc+/T2FTWnnLIz/zkqlclpzleFRej1HvnGvLunXMOJXrFF9QqPVe9WV5m7aCgHw2AJAwQeHI1sG0EjVBCTgCDFLltieXfo0uaVK7PYDJG4UUxQAlDtafvm3SvNvhLKABB+joOujRprn1oVB/BSvG5DC8HvG6F/dujkGdVO38HpPLEAhL9O6zKHxPIe+6kLl3S9SAB0Pm88E8jfFQvBhrtAT8Qzl98bDKdDhLWDWVaGyS4PqUkx2wgPFDxIcFlgZb/sBHvvlAm6LEvyvX5nAMiPjK99ypSKI2f03Tuz2hXDrgeitmB0DNto6za7AXhrxx0z1NIyumXgFxL1pNPplUREzCMpUSSlJCnlzpFIpCSXy3mJ4kQB96Ci0Wh5RUXFVUQ0b6wS5kJw4Q+RbRUo9znnnHN+RUXFiZlMRhGRVXBNHQqFrO7u7ktvuOGGexcsWGAnk0m30Kz/2te+dnBZWVkik8koHwyIvdWCHMeRmUymi5nfANDnX5c3IlhhjMkxc9aPpKhZs2bZUsrZfnhVBJ+zLIt6e3t/FQqFbjfGkG3bm52nruvCsiwYY/o+1oAAAHOaobxS4q6/VIerZhw2Db8sC+vQyrSTe3KddQGhNZ8qVjlbvTDj06flfz21RId6MkIFLdWNCcqaeST/IHAXGKzLo5Z8bl3osZPv7EltEanmA9Wdy63bd4q5/1UbQcjVFJCLQrmMcseciFkLEmhcqApje42ASALmwCnpk7eN6lB/BkoQLL8fFJSW9HZ/6AbAC2Bk/OF7KdbBBrsAGcLvlu6rgBX48g1TrgCs302Bze3IiFcXvNsyOWx2HcyzYSKyBVNnxuaL/q/20IfeLlsB5AQQ8t9tvwb6EeR4hGxbl1m6x2hVyX67KgZIGDKO3HASGmOgtUbAyDOztm3byufzSxYuXHjWaK/upJNO2q6iouIHkUjkP5VSQQ0EAFjpdFo7jnPCqaeeOmvx4sUtPp9gNr6XDyIwxiCfz49KqBWChtYahStrIW9QWlp6RTab1VprGazkxhgVjUat7u7uG2644Ybf+uARRAGorq6O4/G4Y1nW/zPGsFKKAvATQjAz6/7+/u93dHQsuuuuu7qLjXIkk0mz/fbbb8fM27quC2YmZtaO48h0Ov3I9ddf/4MPqnMfa0AAgDlJKM+c7vmv3325ctletbTLfSutZy9/qvtNBoi2gEi85cjYkbuXm+P6c0ZvELngwgwhjz/wvnSGIwlr05Z5fg19i7Bl+ysQwB6A9L5/9l6xpTvG3ON6XGh4QCSG8mQmRXmXxdNv/yIRHtnAbWiERjIhtg3/+jSjAcMkBPz9KW3IlQNy3Y1Plt7L3ENBghMHz8IYCSNuuDq25gHk1/rWjyPCrtd8ijZg93aYpIfw9qtporFTmcsBKENSayGVB3IQYFJqU7s3ULRA2ZgZSikYYwQz08KFC60FCxaojczk9wF8Y/78+YOxWOy7uVxuBBSYmSORCIXD4a8CaKmrqxu5Z3AfpdQIIIxmIeTzeSilRsCAmYOVOFA8am1txVFHHVXpOE4TACeXyxnyBMYYHQ6HrZ6ensdvvPHGrzc1NcmGhgZdoLgymUyq+fPnx0Oh0B7Dw8NaCCGDlZyIRG9v7/xbb711UaDo4yUopVIpHZwTCoVqmNlxXZcDrsVxHGitn1ywYIE9ZcoU2draOm6Yta6ujltbWylIfPrYA8KIP56AoGTv0wCeLjCpi6tXqAMDdc7uVe9fExEGA4po9BbKfhEVBWnLRpeGST62Ri666G/9L32gkJsPIG91yz/VVVvHE9T6dgoGpiKkxYzy/KkAHonHvfObvD0o9O0Nv993comZOZQ3LCCEl6YNHZGW9f6QTN23alVvqgEOAluePTdhlDSGDf7HmCAjakPlJb+SU+W1BYBOZIjUhtbXhpqloUixEhrs4yeBYaS7KcGrlNpgRS5Yxbm+vp7PO+883ngl9PmBH82fP/+IUCi0t+u6hogEM4tsNgtmPrS+vt5KJpOqsbGRAgshuFchIEgpx7UQCkGrvb1dplIp94wzzlgYDod3DFwF/x7GcRw5NDT0j/fff/9EZtb+/QufwfjXPkcpxcYYNsaAmY3jOGJwcPDZW2+9ddHFF18caWtr0wBMXV3d2PzXsmWjjp9Hckg4ALl9brrpJhcYv59FPB6Xra2tVBjC/UQAAuC19WqKQ07qAC2bDVNsnf6j9ZCUhLpz7roL965WO/flWIvx9lfwVlkTtQW90y+7/rKi5rucGPhA9QqUgiYCfvxK+UP7Tsq07VxB04ZcNoJYGIYcdg2qQu4x8R13LBcN7/YDoIBP2LZk+JwaR6M3A01kLMOATZBr0mRaVlv/AwDLOwqa17Ln/oz8Jeg9GV8PTB4JFsyo9dvfiWALLAOIvGcs1G2yy0WBghtDYGtSJGzgKJ+7EEBWSwyRbW08cQtdho0BYnRiOWl8UFDZbPY3tm3fbLzlWwAQvgswo7y8fCcAb6ZSKeHdSo/qMmQymU18540BocBCoIULF7qnnHLKN0pKSk4cGhoaAQNmZiklcrnc0ODg4HEPP/xwR0NDwwZ5EYFZf+yxx25rjPlcNpuloOLSjyYIrfViALjyyiszWzKfgkzLdDrdFgqFMlLKsM+/WJlMhqWUR5922mnfaGtruxmAWr169Qbfn+M4nM/nacWKFblgzMF4P1GAEFgKAIDmIgkhQMxeBv2NAydtU1eRuSyvjPFyhooLNllSype7ShpvefXdjv/d7YPvr2Aug0XJldm16dI/11Xzd5A3hr1xUNZlPbWUa0/cu+vw1Lto+uMCWCIJ99C9J5dUO/3zMi6B2RszM+nSMMu3BuRj332k71VOQDQWAKPPHKx3ARgYpfK3YLknMIuRHbmZvX1zx3GDPIXSOrtqSP7W1XY0p8ECgCRQT87WEcvtBIDKdyM8FiBs/P9jgQIA6uvre1hKmZZSlhhj2I86aCmljEaj0wG8uXz5cioEmo0BYayknMIVVggBpZQEwCeccMIBoVDo6mw2q40x0rc02E+dFv39/afecccdr9XX11upVEpttJoLAMa27T2klNHAsvHvI3K5HFzXPWbevHnTPM5QmM0uT0Tkum5+3bp1v04mk4M+WbnmtNNOW2bb9pG5XC4gOomIKBQK/X677bb7iTHGnTp1KkYD9YMOOqgLwMuu696UTCYf979a/kQBwhaHi+LefHj8FP3TnWO6rCdDPjE3HhRAl4UgWrutV+L3dP7B5yA+cGirwQ8fPtvh3LRbtb4kZhmpzUi7eI4I5l3K1UkAmhZMAZ0H4Pzd0odtW8JTci40+f0ZJBg5I7AmHf49MIxly7BB1h2x1316ZLMavyv15sqfiQkjGQZjbZ29aSIRWtrbhw+9FZdu7sQ3S0t5NA4hYM6DAqTNYSkAuv/++ztPPvnk94UQuyulAkAAEcF13cqNCczROITRQnoBIBRaCFrrXH19fWk4HF7MzJavzMH9jJRS9vX1/ejOO++8tzC8OEaEYwffPTIFOT9Ca41IJHKIEOKQYuaPECKwcK4FMBgUL6XT6Z8Q0eFEREqpEdBxXddYlrVN0A1qtDAmEU0XQuwnpZx/4okn3njbbbctSCQSn15AaIpDihT0lV+u/dwusexXB3MckHnjihSMQeXQY2us7wLQRXdeGpMMCjiQntav7FDavG2le3BPjrUASwZkOg8qC4sjvnHApG3Q2LkOSWDbGJ8RERoZw97uMswm4kCuGrTarli7172MZqJm6EQBSWCYvZzDEVbR/8+GLsMGyLdBEwTmLXrMRxOwZm/s63pEsC680Ae1EDbUXT1cuPL78X8MDg5W+z7/mBYCMwdVj5uQikHWcEGUIVNVVfVHx3F2zmazhWnz2rZtOTg4+Pidd975y3g87hREFMYadM1Yz6mUKrZPAwshSCmVdl3XAEBzc7P2rYSWY4455oKKiopr/Wuq4HmNMWoMkBIF4GSIiGKx2Py5c+emk8nkNz+13WHidV6tzv61+Wuqwq7IaxSV3W2YdVmI5Mtd4p6LHu15iLfWZiszPcVtz4gbc5CedeBNWMpr6GmlHD1ihjqOCPhV/dRpkxxz2JALgEh4bB+ZkCXRmZG3Njc3Z5EYDaQosDELjs3aop7bUHg+gNwWRIBoo8PvNs0br8TGmE2OLcgPkMwc2eg6pLVGaWlpGwBMmTIlKGYa9V7pdHrUHIXCc/zrEzP/zQ/nFf67zOfzOhQK7X/UUUedlkql8vX19ZvloowxarSxFD5/sYfWmjaOOMTjcXnvvfde19PTc7bWutO2bcuyLMv/6Yx2CCEs/96CmS1jjEin08pxnAuPPfbYL30qAeHReliUhLn9xJqGWdX5/QdyRgsxfpo2MzhkEa0asjJLVzuXMIMa67ZSD4AGGAJw11tySVu/7A5LIdkIJhYAC1hgTIuq0wHwZ6elT5hWwiWuIk0QxEbCJiHXDlrq0faSRX6ewiarC/mNXchvK+cdYyNCcA4KfxpC6OPzVQoAfPDBB9cQ0XbGGNB621/4Sty9NW9IRGV33XXXjcPDw78LhUIWM6sCBRfMHCktLb3xyCOP/Hxzc7Maq6YCAKSUa4IU7E3i/ZYlHMexbNu2HMfZ3GHbtm0JIcr8Zi8bgEIikRD33Xffop6enj0zmczZxphLcrnct13X/bbrut/O5/OX5vP5S4eHh38wNDS00HXd1/3rcMEqQkIItizrkk+dy8AAYRn06ftMLtmjdPg3DONzLcWZplFbWE+00+W/earznctTkMmt1FK9ICeh/6w9YrftVGbOy7isAbbAJNI55pqwOejkfau3nRzKHU/GeAlGnluvSi2SKwathy/7v7VvcByjdpMeqUsoiDKwxmY4BOF5CUGreT/SYPjjsV9HfX29aG5uNuXl5V9yHKfUL5GWBURbJpvN/qMwzPeh5w8z+6z7t+bNm7dnJBKZ49cJSCIirbWxLMuJxWJ3fvnLXz4olUq9u3H1ZdCExRjztlKKsWHNkLYsS+ZyuZuEEA/7/7bZOeZzAdq27Z6Nw7/JZNL49+8AsKgYa2vevHnXhkKhBQUJX0JrTUT0hU8fh+B3Xrp3rtu4S4Wa2juM8cOM8KJvpQ7kG71y5WXP7PprTrSIrb1Ra5DU9GZfyQ27lQ2dZyMrjBEggJSGqXZc6+QdnGvLbDUrm2cE3aYFmHLaor/3hP4EgJZ1jKGw7DWgFUHbeL9OYUwOwRgI5pHzhd9DsixkuQxQYxGW2OzZ43MI42GlX/OwUep2goLYuxDiOxu5F0ZKKZRSbzz44INrAVBjYyMnk1uljQsnk0nDzDR79uxTa2pqXnAcZ2pA2hGR0Fpr27YnVVVV3VVfX/8fTU1NaQoy2byVO8iabNVar7Usa4rWOiD9WEoJY8yrt99+++KtM69SGgCN58LU1taKVCqVHxgY+ElFRcXpQoiIH7Ikn1St/lQBQpD/n/jCNnV7VA5dnMkaU2xnX0FgDSle7ra+39LeMlx0vcKWeA0jBU+7vfTyWS2v7lEh9h7IGSO8MYqca/D5ydnjBBnkzIiOmxIb8u1+ueaK5637iMBzmkdfUUzgF/sByKBx6mihQwYhzxYxj2QRkathJoW02KViYDsC3n3rQjizX/XuNVrux5xmqGJDwJuJWPDRRx+tW1paeKOQIwMwxx9/fCIcDh9QYB2MEG1a63sA8KxZs2xg6+6UNXv2bNnc3Lz2iCOOONG27WYppTTGBDVgMp/Pq1AotFd1dXWKiL4Sj8dFQds09lft4blz5y61LOucIIfCz0GAEGIegCvPOuus8HvvvYfa2lpThOK7GwHtBiDa3Nw8njVr6uvrrZ6enqGysrIhKWXUD+Oud2U+TYDQ6Of/z54yPG9GqabuLIwErPGWKmbWFWGSLZ1i2Zn39f6l2M5LH3CQEmhWa4bLb6qrsK4gVkFOQtCPwDD7u1R5CQLGklJ0ZK0bW9rbhzkBi8bYicojoPzcgoIgwsbWgTYgIuaMa7IEwDD5dqvgMsvwrFp9eWXljofu+rt3+9fPtg2vccTOO4e+ukf3j6vDbmlOgwFB5ZbO9mlH/emV0DWpFWs7x6t2ZGZZV1fnLFmyxKqrqxt5prKyMlleXj69tLT0AsdxLtioloGJSOTz+Uwmk1kEAEcfffRW/66am5t1fX29tXTp0meOPvro88vLy//HGOMCsH2uwcrlcqqkpOSIuXPn/r9UKnV+fX291dzcvMF3k8lkrrVt+5yCgibhuq4JhUKfP/bYY3+0aNGiX3xIQN2i85ubm82xxx67l2VZVcaYIKTKvjvU8+lyGfx4f9ewXGtYC0Faj1cKzwBsSVibsUzzutC3CYP4KLdXCBKJXlxr/2X3MvWzaodK8pqYaGSnSrE+C5hgCSPXDFn5x9c6Y5KJBe6h55IW5iGANnUZ/CpMS3KrIPoMgQy86KbszxHvXaUPeOKY7he73apFXWnRJmwh3xqwnv/uw2teDuot+rLZkr1q9I93q9RwFUCkYQlGx7CLeyrELQA6d8xkqGX0gVp+DsJxdXV1bwUdgAqIPWLmbUOhkOXn6ssCEFGhUMgeGhpa+OCDD74XdA0KUpe3MiioWbNm2UuWLLn++OOP3zcWi32jMBQZgEI0Gv3GMcccs+ree+/99axZs+yWlhY3iAKkUqkXjj/++P+NxWJnBJ8lIqGUMiUlJT+fO3fu3kqp24jo7eHh4U2AXgjBfkTFaK3fKgScQw45pHzSpEn24OD4e8sopchxHNsYc6DjOFcKISzfDQqSvIRS6plPFSBQCoYTENvdUHLLpBif/aXJ5j86M9CSxk7XM4AudUg+uda68XuPdL34Ue++lASMd4+u9sO2q3hgeqk5MZ8xGvAn2YZgpWO2lK398pFkc+eKscjELZVl/s/3eq2n96nk08DuSAKnIFA6b8yMsvyOu0hKZhUhFhV4cm3kxwBe3rHSMyYsIRiGO4cyXJnxaxlsYhrMGWOzGNd8933WEiFEyajfizHYyE0AMyvbtu1sNvuPnp6exsKU249KWlpalK/Y35w7d25dJBKZvdG4pOu6KhaL/eorX/nKP+6///6mwFJIpVImkUiIJ5544mLLsr7oOM4OrusGgCK01iYSiTQwc4NSKuidOFrkA1rrjJRyRwBrAxIzGo3+GcDnI5GI5s2kpBYkZ0nLskp8gChspsLMTLlc7g+ftrAjNyaB1avbMle9HD329V5rVWWIpdmkBduI6WxitsGKftl7x8vOD/9Z+yss+73H6bf243/TiiDGaCUswRjWhPcGrGuxmWDBlsqcpMdl3PRq2eK3B8R7FWFh6YJiGCKIdJ5Nf9YopXRW510VotzwpjONLb+E3AJgEcFiwNJm9E2yNz6YmZVSZrTDJ7uEf55hZte2bcsY05PP5+c2Nzf3bcZsDlKMCw9sbkwF529yjl8/YAYHB0/K5XJrpFcpFcwpMsYIY4yOxWI3HX744Z8rCEdya2sr/e1vf+seGBg40XXdQdu2LWZ2/c5Q5Lqu9l0iFkJglIOFEJBSjgZ8NVLKMiKqlFKWjXUIIYKfJcH7DVKxAeTD4bCVyWTuWrJkyb2fujyEJGD+eiLkXX9f0337ivBxbRlnqDIEaRjKcBBlIzYGJiwNhAzJF3vCl97wj451aAUl/wm7/MxphiYC//zNmgffH6KVUZtJAC4BmgBNBE2AW2KB3k/Ld65YssNSZtDmEqSkIJZgRQQtvOsYArQY/Xk41QBx36pVvUvejc5fOWTna8NsS2+3FkMM4+9yTcwQfrfSTZTc2zLHu5cIxj7K/YIc+yB0VyhiDCk8x7ZtEQ6HbaXUu9ls9rC777775YIWZZvyw+vvNfL7GCvniBSMbROd8EN74uGHH+5Ip9MNWmsjhJDB6iuEEMYYKaWMlJWV3X344YfvEOQIBK7DQw891DIwMDBbKfX3SCRiW5YlEPTnWx+WHLO34hhrhjbeltquKVIKnhdSSgqHw87Q0FDL2rVrv5pIJMSnMjGpIQXdFIdMPtX58pKV9nFrMs7qirCwIhbIEoyINFQWJjHMDh54z/npqfd03dj0URKJoyikuQzWihUrcqsG6LaQbQkQ2ZYkaUmSliBJRLZjW2J12v5TC1pc3+8fmz1wbFeziEiSUkqyhCTLkiSzRpaOZlo0pKATCYjvPbbu0UVvhf7jtb7I/6WN41pCCmkJYUkhLCkkBDmShGzvp8mFn+8HkDVWqSW9BkdCCEtKIaUQlrUpcaOMMVlmHjbGZIs9mDlrjBlwXfeV4eHhH61Zs2b/u+66q2WcVuzBZ4eZOWOMyQLIFDYoDXxzZs4X3GvY/5kbK7RXX19vPfDAA08ODw+fT0TDAEaeB0DOdd20ZVmVJSUlqcMOO6yqsbGRAVAACg8++OCLbW1tB6bT6aRSagUzmwD7hBBjHUIIQczsjLoOeBewRZFSCAjGmLaBgYHfrFixov6ZZ57pSSaTn95ahgAUGlLdj7w+a8p/nLmL+71JkexheU07OpLX9eXFy8+0yWsuau5eyn648p9symgAeGJV+Ld92m0VxnBhQpAgsGFBb3ZH7wJ6MNb4kr6Z2z9k+p5bbZ21ImTsPHn5SI4ADenwINBkRrKONlj5PM6Fkl0tP3sCh1531NR9plp9M4e1CAGAYRAxTMQR4qXu0MsAcO8UbxxVM2YMPtex/Ow3+0w0b8ASXrf6tJa6x8g1AJDyG3Rks9kHAewNgDdOwR0T4KRkx3HQ09Pj3n///auCsRfsQ7Dxah8kA53EzCEArJSiUCgEfxXtKQzNua77diaT2cdxnPW9ACwL2WxWYYyt4Jubm5V//z/MnTv3oVAoJHO59fjh9zc04XA4bIzR/pgoABT/s4MAGmfNmvXfU6dOrQuHw7GAU9ksP0akg2cI8hyIaIExplJrzVLKLSJVM5lMfmBgYHmB60UA+P8DLVWJAvl5vmIAAAAASUVORK5CYII=" width="260" height="70" alt="vit:bikes" style="display:block;">
                </div>
                <h1 class="text-2xl font-bold text-gray-800">Partner Portal</h1>
                <p class="text-sm text-gray-500 mt-1">Melden Sie sich mit Ihren Zugangsdaten an</p>
            </div>
            <div class="vit-card p-8">
                <form onsubmit="handleLogin(event); return false;" class="space-y-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">E-Mail</label>
                        <input type="email" id="loginEmail" value="max@vitbikes-grafrath.de" class="w-full px-4 py-3 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500" placeholder="name@standort.de" required>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">Passwort</label>
                        <input type="password" id="loginPassword" class="w-full px-4 py-3 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                    </div>
                    <div id="loginError" style="display:none" class="bg-red-50 border border-red-200 text-red-600 text-sm rounded-lg p-3 mb-2"></div>
                    </div>
                    <div class="flex items-center justify-between">
                        <label class="flex items-center text-sm text-gray-600"><input type="checkbox" checked class="mr-2 rounded"> Angemeldet bleiben</label>
                        <a href="#" onclick="alert('Passwort-Reset per E-Mail (Demo)')" class="text-sm text-vit-orange hover:underline">Passwort vergessen?</a>
                    </div>
                    <button type="submit" class="w-full py-3 bg-vit-orange text-white rounded-lg font-semibold text-sm hover:opacity-90 transition">Anmelden</button>
                </form>
                <!-- Registration Link -->
                <div class="mt-5 pt-4 border-t border-gray-100 text-center">
                    <p class="text-sm text-gray-500 mb-3">Noch kein Konto?</p>
                    <button onclick="showRegistration()" class="w-full py-2.5 bg-gray-100 text-gray-700 rounded-lg font-semibold text-sm hover:bg-gray-200 transition">Registrieren</button>
                </div>
                
            </div>
            <p class="text-center text-xs text-gray-400 mt-6">&copy; 2026 vit:bikes GmbH ¬∑ Partner Portal v6.0</p>
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" style="display: none;">
        <!-- Top Navigation -->
        <nav class="bg-white shadow-md">
            <div class="flex justify-between items-center px-4 md:px-6 py-3 md:py-4">
                <!-- Left: Hamburger (mobile) + Logo + Location -->
                <div class="flex items-center space-x-3">
                    <!-- Hamburger Menu Button (mobile only) -->
                    <button onclick="toggleMobileSidebar()" class="topnav-mobile p-2 rounded-lg hover:bg-gray-100" style="display:none;">
                        <svg class="w-6 h-6 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                        </svg>
                    </button>
                    <div class="flex items-center space-x-2">
                        <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIwAAAAmCAYAAAAWR3O2AAABCGlDQ1BJQ0MgUHJvZmlsZQAAeJxjYGA8wQAELAYMDLl5JUVB7k4KEZFRCuwPGBiBEAwSk4sLGHADoKpv1yBqL+viUYcLcKakFicD6Q9ArFIEtBxopAiQLZIOYWuA2EkQtg2IXV5SUAJkB4DYRSFBzkB2CpCtkY7ETkJiJxcUgdT3ANk2uTmlyQh3M/Ck5oUGA2kOIJZhKGYIYnBncAL5H6IkfxEDg8VXBgbmCQixpJkMDNtbGRgkbiHEVBYwMPC3MDBsO48QQ4RJQWJRIliIBYiZ0tIYGD4tZ2DgjWRgEL7AwMAVDQsIHG5TALvNnSEfCNMZchhSgSKeDHkMyQx6QJYRgwGDIYMZAKbWPz9HbOBQAAAdSElEQVR42u1ceZhUxbX/naq79TI9MwzbAIILagLuxF2DGmNQMSLQE+OKG+AWd1/2njZ5Ji9uMfiMGcFIcMu0srjEGGNg9BkxChIDgyAKAwgywMz03n3vrTrvj+6GHkDUPDV530d9X33dc/tW3Zp7fnXO7yz30sob7cf3q3fPLSjSm7Lma2Of2++UZc3tCk3QBDB20zgGgWZw4sLavY8dkp9ZY6rjAC0Apl2drxk6bIE+zBqrnn6//oirWzdnbzkpOODao/zX+oe8YXmfIQgEAMxQEQdyfcp8/aFn9/9q87J2L3FR/V4nDsksjNjeQNcHqHzuJ2maoeqDQi7ZaP3q8GmF67gVkpqgsKd9qiYeXBWe3JE033QMLYbVesc/OWb1A9QEhRjkx4wltIOIouIrA/NPDKn1TmRW9FFgAQBBYJCkjVnzB9ckNmeIwBccor87tI+/d8FnJaoAIAjI+wJrUtb34+3tLhH40H7Znw6MeI1FH/rTgIUZOmiCOtOic/GHdT9lBiEKvUf8/wRg7nh6a/rljvC4LVmz01Naf6nBveS1q4I/ojh8jsH4qIHzY5CUgFpy9bNX7NPHO6onyx4RxO52eMSBXJcULx19Xz7BAP3psvCXh9V5V2ULWgHbAaoZfiQAuS5ltI5+IPsXAPjLlPDxgyPqwlQOiuhjwbxjU7YhxAcZ6weXJT7cvKAZkmj32nNP+wjAzI/BmJTo+uC1DuvcbNHgfFH5h/Rzb3v5yvA4isOfvwvQxGIQJwF62rhBDY0RL17wWFcLvLKrwdAAdElg4FTBUCs2mbcQAAJ4eH3xjjpHGZ6GFiUBagAqYEJ0Z2XuvZ7grcwlTbJvpHhXwFCaAS12o1vKKFDluTQDqi5M5upuY/ER0255iKOQJ8fh7xH9PwmYk8uaZNxj2fkrupypBqQB7ftfri889tQFdYeeHIffGu0NhuaRIIpDn7DXltv616j+BQ+6WrtoBgctEpYhhCGEIJAM2sJYnzZazpiVe0vHIF6eEvr23vV8Zs4V5EhhWlIIWwphCiENKcX6tP2TsQ/1dBCB/3pV6Jph9froTJGEKYSptPhIsAiAwxZJQ5SuLYWUG3usxcs3Rb7NHGeM2KNZ/i+NqgisQXH47dcG7vxSn8JNRcXc7ZnvP/f+gKOmPLm+60c/hojHoStE949X1I84tjG1WJIyfAZReS6toSMOiTU95vw1PebPwL4vmDQJpmfX1r1x53Gb8hSHnj6+bthhjW7Dhh4PwiiNlT7YNAHHMPUJ03NLYrHSNZ+eVHvE4GAxnC6wzHnkDa7FD0YOLIxJF3qbJwK0EFK8lzRv6UziDctkEbRlz1HTznwbSCgG6OOI/J72SQEDEGKQFCf//eut5/aqcc8AMdZlrL/se/ex3+DWNkYTNFohqAnqnRutFw9s8E7tzrMSZaExgy0DXPCM3Jz3ag+8/ImtG3Z10ecvrTnw0MEq3JH0vLA0yav84AEFw5TH/TK5mLBryT57Vb+BJzR0LTeEqvXUdk+p5AWRfHezNfuAe4oTdvwnf1wG3x6Rf0aAqXCTZgC/XDIsMnHfDW/2Dfj72gbRsi6j5eD73Clrb0Bg2D3Iv3xl4KyjBhWfzrs7kVVVHyT5j0329w+5t/CzldfCXvJhiS/sWw8xqhFqxlsNA08fkVo+IKQirip5QwDgayAUAFZtNt96em2/428csb5IZQGX12VQHO67N5nPDW/wzujOYTtQATYJXFCGu2B1aOSEccmORX+GeL8bOjoCTHEw9miWzx4wANAahWxKQLVGQwePHuouDJu+ZZnSWLrZvuHwB7K/BGJi7c23Lx8Q8vfPeMxSlrgLM3TIAm3KGu9PXzj4oOaTOlzEwRUTUIl7LL3BmjGyv3tpTxbeNnPCgBTQDIG/rXWOPvXh3OLKOqrHvnxVZMxRA7PPFz2luAqozPDrgsJY9IH986/8d/57e2IsnyPp3fFAUwJqfgxGUyL7jzc22pMUG0bRU97QiHvP368K3PXud34+d4DjH5DNMwuG0ApgXfJ6QJI+SJs3xds6Chi5nS+0RiFFE1Tb5NojhoT1pEweCgSjfH2hAR12yFifMmae+nBuMbduBwsAwjLw5FGjzGHh3F2SFOsdvLGACbkhJdY90xn+T45BoGmP6fnCAAMAFc9p7GOZxNIPzVhASFNq3zu4oXjj3hHvrEwRTCABDZAGtA8VsSDX9YgXjrk/P2/HHR6NlpAzLJK7O2L7wisBrMI92DEhNmVkclGH8SOOQTQv224+uBWC4tCXHPPOtUNr9Yh0EZp6u/BsSkkdKft78cTmTDVQ97QvCDAAUAncHTczd9vKreasWkuY3RkUUnkoAMRMAAuwJrYE0JMzvPZN1s0EIJGokmYZPG9eE4gOqVOjk4Xt3KNCfQImifVJ66cXzsltxEhQvIq7YBm4NTqw396R4o8KvtbVa9YMVetAdiTFq8fdn3mMo3tM0b8MMACAOBS3Qt7w0uArVvcYb9RZ5LAikCawLpkirUmHLSE3puV9Zz2SXfqXGIxt3KNsTm76+oDQwJB/h9Kaq3mTZugaC6Kj21j5wxcGTeMYBFWZk0q8Z+Sgnp8OrFF1eQ+8LdcEwBBAxpX6g4x5HYE4sUee/1rAEMBYBn5h1arii2uDEz/MGJ1BCak90qQJrKBDArQxJT/823rnNo5BnNRctcPL5uS8A3tuHRzxh+VcqOoAnyCwhqD1WfOGP65aVcRIbPOmK7znhcuDhw2u9S5L57lXcBAMv8YRckNGzjzx17lFujfv2dP+JRqmZJq0jkJOebZ77dJuc3zeM3yLiLUPhiY2hRAbk+YPLpmX7FkAiEqOhmMQiELPGF+7715BdXMmx5oVSeZqc0JyTY/xxxPuz/3ho3jP8Drv7oitpM/gat5jGxCbsyL5PxtqfsgMquY9e9q/EDAAQAkojsH4xmOZV9u7zKm2ISQxFWsk0fvdxuJRD93y8E45mpEgIvCoAYU7+wV00PXAxEzwAe2DDYC689J9Nxm+kRm0S95zdficobXq5NQOvIcAFbCEWJcyfnb5E1s3ILEnKPdvBZgKCX5zMswTH8nMeHuLdW+fsHBcLUVHKnAdIa4TO8RyqAnqTxfWjd43os7pybMikNxWYaOgakwSH/TI+8bO6Fq+oLkq5lLhPYcMCA0IF+5i1qy5N+8JWZBru+Wqn7/R91c78p497fNtxqc5+Sst8DkGQfHM9UsvDa3tceWmrz/e/T/MIKIqc1KKG4t9wz+/O0AaSZ8gqGRTmEmHTIhNablx+abgbRwrCsS3j10QK2mqxd9J3jikVu3Tk4MvaPs6BYEZQqxLGzclFq7P40ZIYA9g/mWR3k86iLcHzqi6tmR+DMbJcfgLLw5eNmqANz1V1IoEJIjLLBqqNiDkok7niqNbMtOruUssBtHcDJ57bv2Q4/fLLA9ZXsD1Qb3yRQHI97qtF4bf6Y75v0R0q2t9qATY7dyrrHkT7eBPQaQpFottM5vxePwTl1DEYjGjalxlLf/0fP92gNl2w9vBVHVDywlMammvrxnbN9teZ+vGvAITQZBgMKAiDsu1GWPxfvedfRRHE6AENHZIH6y4zp51QF/3gq48Kymr8kUC2tNSL+oMHPa1BzLL0Vxyu/fs+39Tk7Qjp9npYDmT/ebFxVhjiAZtzZMvBAxoBjNBCEbelXgvad0IJCqJS67mPQsurTm2MZg7P5VjJRiSt/n3UKEAGcs6jf8+9TeZdv4aJMU/tXYhADz30oaakX2yV9jCN3K+wJqkM33MjFQXALxxdeikvft4R2kAq7daK465PzNvRy26g3YQ8XhcX3TRRftFIpErtNZg5nT//v3viMfj7g4Keae1jBkzxh46dOitlmWFtNZQSk37zW9+80H1fACyUspfTJs2rbib+f69AbMLjSOoCerpsQ1fGhrIXpPKaV0iumW3hqHqTZIreownTpuVadvJjS7NQoND9r1BQ1OqSCBiQJfzRRaJD5Ny82sf2HGOFcU/U5Mbi4HicXA2TwP7Bf27ah0feU9ASZ4DoAsAIpY3sW+ddzUAbMnIPwGYhwQEsGtwtre3l2p5pDwgEon8BzMjl8sVN2/efC8A9+PW5Pu+Y1nW98PhsKO1Ri6Xmw3gA8uyhlfmy2azfqFQ+BWA4v9bDfNRO/iAhuIv6i0yuwtCSQGBEtllRxB15im3rMv+LnOe0NwrXySpCeqNy0MX7VOjj0zmK4VR23LdbEuSH6asH16RSHUNj8E4meAzQM2x7Wb1o1zrqvMEM/j+c7RBlYJQ3QtQQvdQVmXZ1wxozalYDALdEIzdP0VBRG4+n/e5FGjaHAqFKBaLifb2dhoxYgSXecguyyyYWRARiLYzBCFEr/ls295pXDQa7VUJmUgk9I7zMzM1NzfvRD12sRaKxWJU2QC7aolEQn8mgGmNlszDC9HawxpD3lk9BdaCykG6kpLQYRvy3c3GnRNn93RwYrs5qbjR947pExkUSN/ueZqhBEFoaAIAUhGHZEe38ffDf33mDI4lRMUcEsCIf7x6rjpPx+PAtHFO5+qu3H1hk4SrpepIh3qANOJx6HOv0xoahtCAUCUQxj+BF8bMRERG+bv8xS9+kSUivSshJxKJbSS7vr4+D+DaYrEY0FpDa722rHlQmY+IDGbelQDV7tbT3NxM5TXwx5BuEY/HdRlEn7+GiSagmUGzTnM2bKnx1wwOYu9kEVoKiJIbTaIjJTqe7on8F8eyvcoPKm70okn5Hw5yMHhrQfhCsgEtSnWfxCh6Ah1p8wYgodC+PYA36/xg435hRxQVqCsPTHi0a8MOLjYB4PvPrK0/Yl8ZyiTBfojFCiPYOXXO0FsPGeBRzvPokbffzr5yZW29b8iQ9jJ9WFUUG4X/fFGfwQPrWLZv9PJNiczmbSAvt6ZdC8ucMmXKYRdeeGEeAAKBACul/CVLlnQkEgmvIqCy0L2xY8fONk1TAEA+n0+WQcK78cYoHo/r888//0giEsVikcPhsCWEaJ8xY0ZXNBqVRKQA8NSpU/trrfsUi0VorUkIwcFgkFzX7ZoxY8amylpGjx7tDB8+/IBsNhvYJVAMA93d3Ss/E8AQwNwMcdGLmzqfGls7ITiYXw2b2sz7YCKwFCTWpY3vxp/dmGsOQFJZqOX6YDWvvd/wYTWpq1OF0tMHrEt+tAarPiGSK7vlkyc9lJ1fMV2V+uMDw3zlIX1Tt6QKXAz0E9ZLkwIXnPJwfg6iEJSA4lIRL52yT+H5wSF1qA6Cky6tXrXWako0rV0YlsopaOLLTq7tP0QWL2kM+vFUno2sWzI+/QPu1xscb1mdDWkNkH8A8K2dXPnWVo2yKSEi+L6viaivbduv27ZdbWL4xBNPXHPkkUf+PB6PPzR69Gijra3NHzNmTM3QoUNXOo5Tr7WG53lHAniTiHYZVJ08ebKMx+Pe1KlTf1RTU3NboVCA4zjI5XLvJZPJ4yoa7Pzzzx/S0NBwpxDiNK112LbtCsh927YNKeWvANwUj8f11KlTT3Qc5yFm3i8UClG1aaw0KSWEEFHxmZGXODRHISc8m1y8ZKt5EUhIg9iNWBBrUvTKV1tTT3C09CzTdsZY8j4OCGfv7GMg6GrBxIKgAa3BJhFtzcrcB6nAzcwl01UJ+AJAOmM8mnVhmkJHwqYKDA765xHAiJbNJIFfvDR42MCQf7SvlBVxdMBXYl7iH7WbLOKwLZVhCzb9DYIdUhE7rMMBgx1fEZQmhAwt+wdUrR3WYcfQDQCAZaBrTxjY7ztH9x/wnaP7D4geu5ezCz6DYDBoVHogEDCIyBRC7F9XVzdjypQp17S1tflVYPIrHEZKuVuz0NLS4l166aVfC4VCt/m+75mmqTzP6yoUCmMeeeSRzhEjRvCUKVP27tev36vBYPBbRFTvOI4ZCoWMUChkOI7jhMNhQwhRUwZgrWmaj9u2PZyIyLIsGIaxyw5AfKakt5Jzongy8cq3Ij8+YRBu25onrE4Z1xOA6vRBBTzzm2pPHRIsnr2tmJwAkACDVY1FxpLN5j1fe6yng8dt5z1UfnqB4ukV717jLBhWw6ckc6xrLT6lNTqkDzWt7+LJMAGowY46L2IAPQWorozkTUmn5fTGrON6YF8QfB/cr8G112fst5jVE0XXP6RfUI1gBjoz5vqcopf7ZIRcn6bFgIe7XxsSueqwzkU1pq6XgvitTufcxEL8Qei8UXaBSSmVS6VSj2mt/TII+kspz2FmXSgU2HGcuydNmvTCww8//K5t26LMXVAeX23atnXf9yUAuuSSS/qGQqFZutRYCCFzudy3Z8yYsWry5MnmggUL+KCDDnrcNM2huVzOBSBd150DYBURMTMrrbVQSr1eBvfxlmUNLhQKipm7s9nsNVLKzRXzVV6HNgwDUspln7WXVCm8EhRP/eTN8yLvdXvoOn1OcjEDRNVllwBGjRplDg0vv9skoMACxACIwWAdMiE7kmLDiyudnXgPACwABAP8t4yYtXeYvqYVu/0cqj+grutMALPQCHXtmOF2SHQ05YrgGkOYa1LilWNnJtf8drzxJWgwaRLQpAwhI4fdn5oHYN7SK+yf7BXWIxhAd8F49fDpufOrr+vm0lxn6Ei97YcNkgiBTQDwiwqu61YA0/PAAw9cUT3u8ssvb7Jt+wmllOc4jmUYxhQAN+fzeeF5HoioF2AKhQJs2wYzQ2tNZS+JDcOYJYRozOfzBcdxnO7u7usffvjhP1188cVOS0tL4bLLLvuWaZrHpNNpT0opi8VidPr06XM+Sl5a6709z9MAZD6fX/Dggw/+/ot0q7ebJwYRpR6rkMRql3R+DJLi8Bd++90rh4b54O7qbDQTwMSSINYlze/+x1+3pm8dvJ33VNpJcSgC+J7V5rxBQa+r1qI61hpBQ58PYBbFoV+ftOGkfg4PzXvsWSTNLQWjhVGkh3wW4PKMDLAP5hgERoJW/BmOLh83CRa3QgKQSECVAF+LQqFARQCeEMiVt0BR+bBctyJgMXny5NrGxsbsxo0bqWxKWi+++OILHccZm81mWSl1cllgynVdqmiSCn/wfR/FYrGiYeQDDzzQc8EFF9xsmuY3UqlUMRgMOt3d3b+eOXPmvbFYzGhvb/cAQCl1Xj6fZ621mc/n/z5z5sw5Y8aMsXeUUT6fp7a2tkKhUOiRUgrP8xQzn3DBBRec4nne+oqGKfdNjz76aCoWi4nPBTAlVQeePxrG5v690wcxlB6znTluUMOQUE+s4HOvsktmqFobcnVS/vWrv0/P2on3VBPtVkhqSvactn9g9qCQf3mywKpG6NHzorX7nJ1Irq631CQLBA/C2JShDbNXOPOORZbvL5JiTaj0CsgBoP0KwVACDIZmMDVBcWvJ3ALA4sa1qSN7QidulNKwTBOrk7WrgQyKBV9ZxVJcTSkF13X9cv6HRo8eLWOxmFi5cuUfpJRjPc8jpVTj5MmTzYULF/p9+/bdZnqEKN2KYrEIy7JKWV2lUk1NTROI6PZ0Ou0JIayenp5n169f/51oNCrLHpcum58vMzMppbTWevi55567suxxVTassm1bZrPZ3wG4PZ1Ov6CU2mjbdqPv+wOJ6CXDMNxymEADYCnllqampvvj8fjPPjfAAMDJbTunD5pbQdQEtfiC9E8Hhbjvlnwp6rKNjQsg7RG/l7JvImSxu7LLSg3N5qzx0OCQulyz1v0D7OwbccdMHjVqesj4x5npotYRW4h1WfnYHX/dmgYAJYjB2PawUrG3jq76vstrqgSyb28/kiqZKq3Z87xtgjdNc6dA2cSJE7NSSvi+D9/3xYoVKyQAVEwSM0MptU3DeJ5XAaCntb4agFksFouWZVE6nX66ra3Nnzx5sgmU7vMxxxxjua4bqsxpGEbItu39d+RFpmlCKbUPAMydO3frWWedFdVa/15KObgMWqtMxqGUgud5QxzHuX38+PHFzxUwH5U+eKGp/qC9QsXLk0XuVbLJDL/WIWNpl/jdGXO6Fn5cNrqp5DoTUfr11ZOdt/sHcIjWQFDizPMPfLdrYIBqegpSdeeFvzYZ+C2Qr1qMAOlS723UDUD7AEr5Ly4VovfyM5dGYVkDS8fuLB6hW1oWeTuSVGaWlUhsOp2WZaGOqATgiGhrW1tb4aijjopUj91RuOXPoO/7UwuFwp8Nwxjiuq4fDAannX322e+0tLS8UnHRFy5cWJg4cWI3Mw8qu/hdvu//A+j1IJ9SSklmXlL2ksyWlpZXTzvttEP69OkzipnJ930qa6mBUsobpJQjXdeFEOLWLxQwADB69GhjaHDRPXW2NsrcpfICIbYlxIc5Si1LOt9jzlJz8ydIsjVDAvCTBXPW0JB7R6qgdIAwekgAB+eLWkUMyNUZmn9Goqu9Er9BuVaCyr23giEqHWNILmXDJfXWNQclqnNEi3e5Nx599NFU1d/q7LPPrhNCXKiUUmXOsKS8i43dRWLLoAnMnTt35bhx475lGMYr5fNtx3GePOuss4555plnVkejUSuRSLjMvEgIMYKZhe/7HU8++eRJH+eml0HTBeDFHX8fN27cCtM0/+r7vhJCDDC+UO0Sh5434e8HDQ6pUyvpg+qbGrTIWNYjfnbe01s3NDbDiH+C13I0lw3H8qTx+wGOd5sjhWMThUO2Duc9UoYgbM6ZLUAey9rL2swFmAm63FGo8oIUFwmkMy64r6W++vyEuhOnvln7RigU0u3t7e4NxwwJNO2b/GGNUEHLEGrx5tDD5z63aSkpVa2qrGg0eorWuiCEEFrrOiL6gWEYg3zfLwohbAAPlSOoH5/aIPLHjRvXMHfu3NfGjRt3fTgcnlYsFoumafYPBALzvvnNbx7f2dmZB0DMPIOZL9Jau4ZhHDphwoSrt2zZ8pvquM+uQPNRv0kpD6rElrTW+S9Ow8RLnsivXhdrNmblW/tF+PCtBfiSYCiGilgs16Tk6gc2NPySY5leVXi7nbYcMKRE97oVk0Iv9q3B2J4iXFeDHEnGxozcOHtL4BlCCu1VGWdm0syCwaLXdXK++BtBCKXZtQUaDq13X1pyxtYNa3PJBw9tx3/uX+PVNAbUd4fVsABpvJ8rvAZgqZRMRKSUUhpAvRDipQqBNQwDzAzP87xgMGhns9nZTz311EsA4LquKmfCVXVKoPxZWZsKhUKVlMJ948ePPzwUCl1aKBRylmUdrJR6tK2t7Ztlovry+PHjf1tTU3NJoVBQhmHc169fv6snTJjQVZnLNE3pum5i9uzZ944dO/ZLwWDwTi6psh1DvAEiOsH3fc+2bTOfzz8vvii8EMDNAK77Y1fqlU7jnM68XN/gwADAIQPSY0mrM9a1M9s6Cmj/dE8vLugs1fNtKtJvDUkibMEOGLDCQRIZJX5314ubsjoGY1n53TDSYAqZZNSYJAMGbCFYVIKJv3v3gOeXd8tn+gTIsiRQa2uzrlYNC1veUAAIl1y6gqsYvmJQ6aVJ0JpN0zSlaZqmZVlCSolKJyIIIWCappnL5Z4lootjsZgoEwoCUFceK5nZKLvbZtWxOtd1KR6P62g0Kt95550r8/n8wkAgEFRKIRKJnDVhwoRHTj/9dCsajcpcLndlNpt9XJYaAoHAl8Ph8PHhcPj4UCj01ZqamuMNwzisfJ3GYDB4ZjAYHFv+rO6nlP4dyywUCss8z7v+C+Uw8Th06SH7no6nzqkbe2QD3S+FPqLgo/O9HuP2rye6nyubrk9VGHVyW6nE8qq/B/4cOiL7eFhSWDG0zBGtSdszgDQ1A7q5GRyPA1qK5LqMmNMl2SgwqWTeSQNpYAT4wcQir2XRiIlLLv7g2oj0jst5oFqXREdSLgaA96RXGFmQc/M+aoQgZPK8HgBYYpXneXcppZh5+3v+KhpDCKFc131j9uzZT1UyAgAQDoeLAP7Ldd1w2TvaUOYuq4vF4t3l8dlgMFisqsFx999//297nne11pozmQybphk0TXNQIpFYU67DOW/ChAlPSim/7vu+WUW2tVJKMPNLZcCszefz03eMMlelLYTWek1nZ+ev29ratvwv6K+zJV8FcMkAAAAASUVORK5CYII=" width="140" height="38" alt="vit:bikes" class="hidden md:block">
                        <div class="w-8 h-8 bg-vit-orange rounded flex items-center justify-center md:hidden">
                            <span class="text-white font-bold text-lg">V</span>
                        </div>
                    </div>
                    <span class="text-gray-400 topnav-desktop">|</span>
                    <div class="topnav-desktop">
                        <div class="flex items-center space-x-3">
                            <span class="text-sm font-semibold text-gray-700" id="locationDisplay">Standort</span>
                            <span id="premiumBadge" class="hidden"></span>
                        </div>
                        <span class="text-xs text-gray-500" id="userRoleDisplay">Partnerportal</span>
                    </div>
                    <!-- Mobile: compact location -->
                    <div class="topnav-mobile" style="display:none;">
                        <div>
                            <span class="text-xs font-semibold text-gray-700" id="locationDisplayMobile">Standort</span>
                        </div>
                    </div>
                </div>
                
                <div class="flex items-center space-x-4 md:space-x-6">
                    <!-- Language Switcher -->
                    <div class="flex items-center space-x-1">
                        <button onclick="switchLang('de')" class="lang-flag text-lg hover:scale-125 transition-transform" title="Deutsch" data-lang="de">üá©üá™</button>
                        <button onclick="switchLang('en')" class="lang-flag text-lg hover:scale-125 transition-transform opacity-40" title="English" data-lang="en">üá¨üáß</button>
                        <button onclick="switchLang('nl')" class="lang-flag text-lg hover:scale-125 transition-transform opacity-40" title="Nederlands" data-lang="nl">üá≥üá±</button>
                    </div>

                    <button onclick="showView('notifications'); return false;" class="relative">
                        <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/>
                        </svg>
                        <span class="absolute -top-1 -right-1 bg-vit-orange text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">3</span>
                    </button>
                    
                    <div class="flex items-center space-x-3 topnav-desktop">
                        <img src="https://ui-avatars.com/api/?name=Demo+User&background=EF7D00&color=fff" class="w-10 h-10 rounded-full">
                        <div>
                            <div class="text-sm font-semibold text-gray-800" data-user-name>Demo User</div>
                            <div class="text-xs text-gray-500" id="userRoleText">Rolle</div>
                        </div>
                    </div>
                    
                    <button onclick="handleLogout()" class="text-gray-600 hover:text-vit-orange topnav-desktop">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
                        </svg>
                    </button>
                </div>
            </div>
        </nav>

        <div class="flex" style="height: calc(100vh - 3.5rem); overflow: hidden;">
            <!-- Sidebar Overlay (mobile) -->
            <div id="sidebarOverlay" onclick="toggleMobileSidebar()"></div>
            <!-- Sidebar -->
            <aside id="sidebarNav" class="sidebar w-64 text-white overflow-y-auto flex-shrink-0">
                <div class="p-4 pt-5">
                        <!-- HQ/Standort Toggle (nur f√ºr Inhaber sichtbar) -->
                        <div id="hqToggleSection" class="mb-4 hidden">
                            <div class="bg-white/10 rounded-lg p-1 flex space-x-1">
                                <button id="btnModeStandort" onclick="switchViewMode('partner')" class="flex-1 py-2 px-3 rounded-md text-xs font-bold transition bg-white text-gray-800">üìç Standort</button>
                                <button id="btnModeHQ" onclick="switchViewMode('hq')" class="flex-1 py-2 px-3 rounded-md text-xs font-bold transition text-white/60 hover:text-white">üè¢ HQ</button>
                            </div>
                        </div>

                        <!-- Partner-level quick access (hidden in HQ mode) -->
                        <div id="partnerQuickNav">
                        <!-- Startseite -->
                        <button onclick="showView('home')" data-module="startseite" class="sidebar-item flex items-center space-x-3 p-3 rounded w-full text-left">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>
                            <span data-i18n="nav_home">Startseite</span>
                        </button>

                        <!-- Kalender -->
                        <button onclick="showView('kalender')" data-module="kalender" class="sidebar-item flex items-center space-x-3 p-3 rounded w-full text-left">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
                            <span data-i18n="nav_calendar">Kalender</span>
                        </button>

                        <!-- Aufgaben -->
                        <button onclick="showView('todo')" data-module="aufgaben" class="sidebar-item flex items-center space-x-3 p-3 rounded w-full text-left">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/></svg>
                            <span data-i18n="nav_todo">Aufgaben</span>
                            <span class="ml-auto bg-red-500 text-white text-[10px] rounded-full px-1.5 py-0.5 font-bold" id="todoSidebarBadge">5</span>
                        </button>

                        <!-- Kommunikation -->
                        <button onclick="showView('kommunikation')" data-module="kommunikation" class="sidebar-item flex items-center space-x-3 p-3 rounded w-full text-left">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/></svg>
                            <span data-i18n="nav_communication">Kommunikation</span>
                        </button>

                        <hr class="border-gray-600 my-3">
                        </div>

                        <!-- Dashboards - nur f√ºr INHABER (jetzt in Allgemein integriert) -->
                        <div id="ownerDashboards" class="hidden">
                            <button onclick="showView('dashboards')" data-module="dashboards" class="sidebar-item flex items-center space-x-3 p-3 rounded w-full text-left">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>
                                <span data-i18n="nav_dashboards">Dashboards</span>
                            </button>
                        </div>

                        <!-- Fachbereiche - nur Partner-Modus -->
                        <div id="commonTools">
                            <!-- Allgemein -->
                            <button onclick="showView('allgemein')" data-module="allgemein" class="sidebar-item flex items-center space-x-3 p-3 rounded w-full text-left">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg>
                                <span data-i18n="nav_general">Allgemein</span>
                            </button>

                            <!-- Verkauf -->
                            <button onclick="showView('verkauf')" data-module="verkauf" class="sidebar-item flex items-center space-x-3 p-3 rounded w-full text-left">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/></svg>
                                <span data-i18n="nav_sales">Verkauf</span>
                            </button>

                            <!-- Einkauf -->
                            <button onclick="showView('einkauf')" data-module="einkauf" class="sidebar-item flex items-center space-x-3 p-3 rounded w-full text-left">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"/></svg>
                                <span data-i18n="nav_purchasing">Einkauf</span>
                            </button>

                            <!-- Marketing -->
                            <button onclick="showView('marketing')" data-module="marketing" class="sidebar-item flex items-center space-x-3 p-3 rounded w-full text-left">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.832c4.1 0 7.625-1.234 9.168-3v14c-1.543-1.766-5.067-3-9.168-3H7a3.988 3.988 0 01-1.564-.317z"/></svg>
                                <span data-i18n="nav_marketing">Marketing</span>
                            </button>

                            <!-- Controlling -->
                            <button onclick="showView('controlling')" data-module="controlling" class="sidebar-item flex items-center space-x-3 p-3 rounded w-full text-left">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>
                                <span data-i18n="nav_controlling">Controlling</span>
                            </button>
                        </div>

                        <!-- Tools - alle Standort-Rollen -->
                        <div id="partnerToolsNav">
                        <hr class="border-gray-600 my-3">
                        <p class="text-[10px] font-semibold text-gray-500 uppercase tracking-wider px-3 mb-1">Tools</p>

                        <button onclick="showView('wissen')" data-module="wissen" class="sidebar-item flex items-center space-x-3 p-3 rounded w-full text-left">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/></svg>
                            <span>Wissen</span>
                        </button>
                        <button onclick="showView('support')" data-module="support" class="sidebar-item flex items-center space-x-3 p-3 rounded w-full text-left">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 5.636l-3.536 3.536m0 5.656l3.536 3.536M9.172 9.172L5.636 5.636m3.536 9.192l-3.536 3.536M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-5 0a4 4 0 11-8 0 4 4 0 018 0z"/></svg>
                            <span>Support</span>
                        </button>
                        <button onclick="showView('ideenboard')" data-module="ideenboard" class="sidebar-item flex items-center space-x-3 p-3 rounded w-full text-left">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/></svg>
                            <span>Ideenboard</span>
                        </button>
                        <button onclick="showView('shop')" data-module="shop" class="sidebar-item flex items-center space-x-3 p-3 rounded w-full text-left">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/></svg>
                            <span>Werbemittel-Shop</span>
                        </button>
                        <button onclick="showView('aktenschrank')" data-module="aktenschrank" class="sidebar-item flex items-center space-x-3 p-3 rounded w-full text-left">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"/></svg>
                            <span>Aktenschrank</span>
                        </button>
                        </div>

                        <div id="onboardingNavSection">
                        <hr class="border-gray-600 my-3">
                        <button onclick="showView('onboarding')" data-module="onboarding" class="sidebar-item flex items-center space-x-3 p-3 rounded w-full text-left">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"/></svg>
                            <span data-i18n="nav_onboarding">Onboarding</span>
                        </button>
                        </div>

                        <!-- Mitarbeiter - nur Gesch√§ftsleitung -->
                        <div id="mitarbeiterNavSection">
                        <button onclick="showView('mitarbeiter')" data-module="mitarbeiter" class="sidebar-item flex items-center space-x-3 p-3 rounded w-full text-left">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"/></svg>
                            <span>Mitarbeiter</span>
                        </button>
                        </div>

                        <!-- HQ-specific items (hidden by default) -->
                        <div id="hqMenu" class="space-y-2 hidden">
                            <!-- HQ Top-Level -->
                            <button onclick="showView('hqCockpit')" class="sidebar-item flex items-center space-x-3 p-3 rounded w-full text-left">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                                <span data-i18n="nav_hq_cockpit">Netzwerk-Cockpit</span>
                            </button>

                            <button onclick="showView('hqKommando')" class="sidebar-item flex items-center space-x-3 p-3 rounded w-full text-left">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.066 2.573c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.573 1.066c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.066-2.573c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                </svg>
                                <span data-i18n="nav_hq_command">Kommandozentrale</span>
                            </button>

                            <button onclick="showView('hqAktionen')" class="sidebar-item flex items-center space-x-3 p-3 rounded w-full text-left">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                                </svg>
                                <span data-i18n="nav_hq_actions">Handlungsbedarf</span>
                            </button>

                            <hr class="border-gray-600 my-3">

                            <button onclick="showView('kalender')" data-module="kalender" class="sidebar-item flex items-center space-x-3 p-3 rounded w-full text-left">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
                                <span data-i18n="nav_calendar">Kalender</span>
                            </button>
                            <button onclick="showView('todo')" data-module="aufgaben" class="sidebar-item flex items-center space-x-3 p-3 rounded w-full text-left">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/></svg>
                                <span data-i18n="nav_todo">Aufgaben</span>
                            </button>
                            <button onclick="showView('kommunikation')" data-module="kommunikation" class="sidebar-item flex items-center space-x-3 p-3 rounded w-full text-left">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/></svg>
                                <span data-i18n="nav_communication">Kommunikation</span>
                            </button>

                            <hr class="border-gray-600 my-4">
                            <div class="mb-2">
                                <span class="text-xs text-gray-400 uppercase font-semibold px-3" data-i18n="nav_hq_control">HQ Steuerung</span>
                            </div>

                            <button onclick="showView('hqStandorte')" class="sidebar-item flex items-center space-x-3 p-3 rounded w-full text-left">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                                </svg>
                                <span data-i18n="nav_hq_locations">Standorte</span>
                            </button>

                            <button onclick="showView('hqFinanzen')" class="sidebar-item flex items-center space-x-3 p-3 rounded w-full text-left">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                                <span data-i18n="nav_hq_finance">Finanzen</span>
                            </button>

                            <button onclick="showView('hqMarketing')" class="sidebar-item flex items-center space-x-3 p-3 rounded w-full text-left">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.832c4.1 0 7.625-1.234 9.168-3v14c-1.543-1.766-5.067-3-9.168-3H7a3.988 3.988 0 01-1.564-.317z"/>
                                </svg>
                                <span data-i18n="nav_marketing">Marketing</span>
                            </button>

                            <button onclick="showView('hqEinkauf')" class="sidebar-item flex items-center space-x-3 p-3 rounded w-full text-left">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 100 4 2 2 0 000-4z"/>
                                </svg>
                                <span data-i18n="nav_purchasing">Einkauf</span>
                            </button>

                            <button onclick="showView('hqVerkauf')" class="sidebar-item flex items-center space-x-3 p-3 rounded w-full text-left">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/>
                                </svg>
                                <span data-i18n="nav_sales">Verkauf</span>
                            </button>

                            <button onclick="showView('hqAuswertung')" class="sidebar-item flex items-center space-x-3 p-3 rounded w-full text-left">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                </svg>
                                <span data-i18n="nav_hq_analytics">Nutzung Portal</span>
                            </button>

                            <hr class="border-gray-600 my-3">

                            <button onclick="showView('hqWissen')" class="sidebar-item flex items-center space-x-3 p-3 rounded w-full text-left">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/></svg>
                                <span data-i18n="nav_knowledge">Wissen</span>
                            </button>

                            <button onclick="showView('hqSupport')" class="sidebar-item flex items-center space-x-3 p-3 rounded w-full text-left">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 5.636l-3.536 3.536m0 5.656l3.536 3.536M9.172 9.172L5.636 5.636m3.536 9.192l-3.536 3.536M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-5 0a4 4 0 11-8 0 4 4 0 018 0z"/></svg>
                                <span data-i18n="nav_support">Support</span>
                            </button>

                            <button onclick="showView('hqIdeen')" class="sidebar-item flex items-center space-x-3 p-3 rounded w-full text-left">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/></svg>
                                <span data-i18n="nav_ideaboard">Ideenboard</span>
                            </button>

                            <button onclick="showView('hqShop')" class="sidebar-item flex items-center space-x-3 p-3 rounded w-full text-left">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/></svg>
                                <span data-i18n="nav_shop">Werbemittel-Shop</span>
                            </button>

                            <hr class="border-gray-600 my-3">

                            <button onclick="showView('hqEinstellungen')" class="sidebar-item flex items-center space-x-3 p-3 rounded w-full text-left">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.066 2.573c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.573 1.066c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.066-2.573c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                                <span>Einstellungen</span>
                            </button>
                        </div>
                    </nav>
                </div>
            </aside>

            <!-- Main Content Area -->
            <main class="main-content-area flex-1 overflow-y-auto p-4 md:p-8 vit-background" style="min-height: 0;">
                <!-- Startseite View (f√ºr ALLE) -->
                <div id="homeView" class="view" style="display: block;">
                    <!-- Header mit Willkommen + Dashboard anpassen -->
                    <div class="flex items-center justify-between mb-6">
                        <div>
                            <h1 class="h1-headline text-gray-800"><span data-i18n="welcome">Willkommen zur√ºck, Max!</span> üëã</h1>
                            <p class="text-gray-600">Heute ist Freitag, 14. Februar 2026</p>
                        </div>
                        <button onclick="toggleDashboardEdit()" class="flex items-center space-x-2 px-4 py-2 border-2 border-gray-300 rounded-lg hover:border-vit-orange hover:text-vit-orange transition-colors">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                            </svg>
                            <span class="font-semibold" id="dashboardEditButton">Dashboard anpassen</span>
                        </button>
                    </div>

                    <!-- FESTER BEREICH (immer sichtbar) -->
                    <div class="mb-8">
                        <!-- Schnellzugriff Aktionen -->
                        <div class="grid grid-cols-4 gap-4 mb-6">
                            <button onclick="showView('verkauf')" class="vit-card p-4 hover:shadow-lg transition-shadow text-center">
                                <div class="bg-vit-orange p-3 rounded-lg inline-block mb-2">
                                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"/>
                                    </svg>
                                </div>
                                <p class="font-semibold text-gray-800">Neuer Lead</p>
                            </button>
                            
                            <button onclick="showView('verkauf'); showVerkaufTab('pipeline')" class="vit-card p-4 hover:shadow-lg transition-shadow text-center">
                                <div class="bg-blue-500 p-3 rounded-lg inline-block mb-2">
                                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                    </svg>
                                </div>
                                <p class="font-semibold text-gray-800">Angebot erstellen</p>
                            </button>
                            
                            <button onclick="showView('support')" class="vit-card p-4 hover:shadow-lg transition-shadow text-center">
                                <div class="bg-green-500 p-3 rounded-lg inline-block mb-2">
                                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 5.636l-3.536 3.536m0 5.656l3.536 3.536M9.172 9.172L5.636 5.636m3.536 9.192l-3.536 3.536M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-5 0a4 4 0 11-8 0 4 4 0 018 0z"/>
                                    </svg>
                                </div>
                                <p class="font-semibold text-gray-800">Support anfragen</p>
                            </button>
                            
                            <button onclick="showView('wissen')" class="vit-card p-4 hover:shadow-lg transition-shadow text-center">
                                <div class="bg-purple-500 p-3 rounded-lg inline-block mb-2">
                                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                                    </svg>
                                </div>
                                <p class="font-semibold text-gray-800">Wissen</p>
                            </button>
                        </div>

                        <!-- Kern-Metrik: Umsatz -->
                        <div class="vit-card p-6">
                            <h2 class="h2-headline text-gray-800 mb-4">UMSATZ VS. PLAN</h2>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div>
                                    <p class="text-sm text-gray-500 mb-1">Heute</p>
                                    <p class="text-3xl font-bold text-gray-800">4.250‚Ç¨</p>
                                    <div class="flex items-center space-x-2 mt-2">
                                        <div class="flex-1 bg-gray-200 rounded-full h-2">
                                            <div class="bg-green-500 h-2 rounded-full" style="width: 85%"></div>
                                        </div>
                                        <span class="text-xs text-green-600 font-semibold">85%</span>
                                    </div>
                                    <p class="text-xs text-gray-500 mt-1">Plan: 5.000‚Ç¨</p>
                                </div>

                                <div>
                                    <p class="text-sm text-gray-500 mb-1">Diese Woche</p>
                                    <p class="text-3xl font-bold text-gray-800">28.400‚Ç¨</p>
                                    <div class="flex items-center space-x-2 mt-2">
                                        <div class="flex-1 bg-gray-200 rounded-full h-2">
                                            <div class="bg-vit-orange h-2 rounded-full" style="width: 94%"></div>
                                        </div>
                                        <span class="text-xs text-vit-orange font-semibold">94%</span>
                                    </div>
                                    <p class="text-xs text-gray-500 mt-1">Plan: 30.000‚Ç¨</p>
                                </div>

                                <div>
                                    <p class="text-sm text-gray-500 mb-1">Dieser Monat</p>
                                    <p class="text-3xl font-bold text-gray-800">127.500‚Ç¨</p>
                                    <div class="flex items-center space-x-2 mt-2">
                                        <div class="flex-1 bg-gray-200 rounded-full h-2">
                                            <div class="bg-green-500 h-2 rounded-full" style="width: 106%"></div>
                                        </div>
                                        <span class="text-xs text-green-600 font-semibold">106%</span>
                                    </div>
                                    <p class="text-xs text-gray-500 mt-1">Plan: 120.000‚Ç¨ ‚úì</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- WIDGET-BEREICH (anpassbar) -->
                    <div class="mb-4">
                        <h2 class="text-lg font-semibold text-gray-800 mb-4">Meine Widgets</h2>
                    </div>

                    <div id="widgetContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Widget 1: Verkaufs-Pipeline -->
                        <div class="dashboard-widget vit-card p-6" data-widget="pipeline">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="font-semibold text-gray-800">üìà Meine Pipeline</h3>
                                <button class="widget-remove hidden text-gray-400 hover:text-red-500">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                    </svg>
                                </button>
                            </div>
                            <div class="space-y-3">
                                <div class="flex items-center justify-between">
                                    <span class="text-sm text-gray-600">Offene Leads</span>
                                    <span class="font-bold text-blue-600">23</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-sm text-gray-600">Heute Termine</span>
                                    <span class="font-bold text-purple-600">8</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-sm text-gray-600">Angebote offen</span>
                                    <span class="font-bold text-orange-600">5</span>
                                </div>
                            </div>
                            <button onclick="showView('verkauf')" class="mt-4 w-full text-sm text-vit-orange hover:text-orange-600 font-semibold">
                                ‚Üí Zur Pipeline
                            </button>
                        </div>

                        <!-- Widget 2: Verkaufserfolg KW -->
                        <div class="dashboard-widget vit-card p-6" data-widget="success">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="font-semibold text-gray-800">üí∞ Verkaufserfolg KW 7</h3>
                                <button class="widget-remove hidden text-gray-400 hover:text-red-500">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                    </svg>
                                </button>
                            </div>
                            <div class="mb-3">
                                <div class="flex items-center justify-between mb-1">
                                    <span class="text-sm text-gray-600">Verkaufsquote</span>
                                    <span class="text-2xl font-bold text-green-600">42%</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2">
                                    <div class="bg-green-500 h-2 rounded-full" style="width: 42%"></div>
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-2 text-sm">
                                <div>
                                    <p class="text-gray-500">Verk√§ufe</p>
                                    <p class="font-bold text-gray-800">5</p>
                                </div>
                                <div>
                                    <p class="text-gray-500">Beratungen</p>
                                    <p class="font-bold text-gray-800">12</p>
                                </div>
                            </div>
                        </div>

                        <!-- Widget 3: Termine Heute -->
                        <div class="dashboard-widget vit-card p-6" data-widget="termine">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="font-semibold text-gray-800">üìÖ Termine Heute</h3>
                                <button class="widget-remove hidden text-gray-400 hover:text-red-500">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                    </svg>
                                </button>
                            </div>
                            <div class="space-y-3">
                                <div class="p-3 bg-blue-50 rounded-lg">
                                    <p class="text-sm font-semibold text-gray-800">10:00 - Familie Schmidt</p>
                                    <p class="text-xs text-gray-600">E-Bike Beratung</p>
                                </div>
                                <div class="p-3 bg-purple-50 rounded-lg">
                                    <p class="text-sm font-semibold text-gray-800">14:30 - Herr M√ºller</p>
                                    <p class="text-xs text-gray-600">Probefahrt Lastenrad</p>
                                </div>
                                <div class="p-3 bg-green-50 rounded-lg">
                                    <p class="text-sm font-semibold text-gray-800">16:00 - Frau Weber</p>
                                    <p class="text-xs text-gray-600">Abholung</p>
                                </div>
                            </div>
                        </div>

                        <!-- Widget 4: Offene Aufgaben -->
                        <div class="dashboard-widget vit-card p-6" data-widget="aufgaben">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="font-semibold text-gray-800">‚úÖ Offene Aufgaben</h3>
                                <button class="widget-remove hidden text-gray-400 hover:text-red-500">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                    </svg>
                                </button>
                            </div>
                            <div class="space-y-2">
                                <div class="flex items-center space-x-2">
                                    <input type="checkbox" class="rounded border-gray-300">
                                    <span class="text-sm text-gray-700">Google My Business optimieren</span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <input type="checkbox" class="rounded border-gray-300">
                                    <span class="text-sm text-gray-700">Angebot Herr Schmidt nachfassen</span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <input type="checkbox" class="rounded border-gray-300">
                                    <span class="text-sm text-gray-700">Onboarding-Schulung abschlie√üen</span>
                                </div>
                            </div>
                            <button onclick="showView('onboarding')" class="mt-4 w-full text-sm text-vit-orange hover:text-orange-600 font-semibold">
                                ‚Üí Alle Aufgaben
                            </button>
                        </div>

                        <!-- Widget 5: Marketing Kampagnen -->
                        <div class="dashboard-widget vit-card p-6" data-widget="marketing">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="font-semibold text-gray-800">üì¢ Aktive Kampagnen</h3>
                                <button class="widget-remove hidden text-gray-400 hover:text-red-500">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                    </svg>
                                </button>
                            </div>
                            <div class="space-y-3">
                                <div class="p-3 bg-orange-50 rounded-lg border-l-4 border-vit-orange">
                                    <p class="text-sm font-semibold text-gray-800">üöÄ Fr√ºhjahrs-Aktion</p>
                                    <p class="text-xs text-gray-600">L√§uft noch 12 Tage</p>
                                </div>
                                <div class="p-3 bg-blue-50 rounded-lg border-l-4 border-blue-500">
                                    <p class="text-sm font-semibold text-gray-800">üéØ E-Bike Wochen</p>
                                    <p class="text-xs text-gray-600">Startet in 5 Tagen</p>
                                </div>
                            </div>
                            <button onclick="showView('marketing')" class="mt-4 w-full text-sm text-vit-orange hover:text-orange-600 font-semibold">
                                ‚Üí Zu Marketing
                            </button>
                        </div>

                        <!-- Widget 6: Team Performance -->
                        <div class="dashboard-widget vit-card p-6" data-widget="team">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="font-semibold text-gray-800">üèÜ Top Verk√§ufer</h3>
                                <button class="widget-remove hidden text-gray-400 hover:text-red-500">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                    </svg>
                                </button>
                            </div>
                            <div class="space-y-3">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center space-x-2">
                                        <span class="text-2xl">ü•á</span>
                                        <span class="text-sm font-semibold text-gray-800">Sarah</span>
                                    </div>
                                    <span class="text-sm text-gray-600">12 Verk√§ufe</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center space-x-2">
                                        <span class="text-2xl">ü•à</span>
                                        <span class="text-sm font-semibold text-gray-800">Michael</span>
                                    </div>
                                    <span class="text-sm text-gray-600">10 Verk√§ufe</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center space-x-2">
                                        <span class="text-2xl">ü•â</span>
                                        <span class="text-sm font-semibold text-gray-800">Benny</span>
                                    </div>
                                    <span class="text-sm text-gray-600">8 Verk√§ufe</span>
                                </div>
                            </div>
                        </div>

                        <!-- Widget 7: Controlling -->
                        <div class="dashboard-widget vit-card p-6" data-widget="controlling">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="font-semibold text-gray-800">üìä Budget-Status</h3>
                                <button class="widget-remove hidden text-gray-400 hover:text-red-500">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                    </svg>
                                </button>
                            </div>
                            <div class="space-y-3">
                                <div>
                                    <div class="flex justify-between mb-1">
                                        <span class="text-sm text-gray-600">Marketing</span>
                                        <span class="text-sm font-semibold">75%</span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-2">
                                        <div class="bg-blue-500 h-2 rounded-full" style="width: 75%"></div>
                                    </div>
                                </div>
                                <div>
                                    <div class="flex justify-between mb-1">
                                        <span class="text-sm text-gray-600">Personal</span>
                                        <span class="text-sm font-semibold">92%</span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-2">
                                        <div class="bg-orange-500 h-2 rounded-full" style="width: 92%"></div>
                                    </div>
                                </div>
                                <div>
                                    <div class="flex justify-between mb-1">
                                        <span class="text-sm text-gray-600">Lager</span>
                                        <span class="text-sm font-semibold">58%</span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-2">
                                        <div class="bg-green-500 h-2 rounded-full" style="width: 58%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Widget 8: Support Tickets -->
                        <div class="dashboard-widget vit-card p-6" data-widget="support">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="font-semibold text-gray-800">üéØ Support Tickets</h3>
                                <button class="widget-remove hidden text-gray-400 hover:text-red-500">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                    </svg>
                                </button>
                            </div>
                            <div class="text-center py-4">
                                <p class="text-4xl font-bold text-green-600">2</p>
                                <p class="text-sm text-gray-600 mt-1">Offene Tickets</p>
                                <div class="mt-3 space-y-2">
                                    <div class="text-xs text-left p-2 bg-yellow-50 rounded">
                                        <p class="font-semibold">Kassensystem Frage</p>
                                        <p class="text-gray-600">Offen seit 2 Tagen</p>
                                    </div>
                                </div>
                            </div>
                            <button onclick="showView('support')" class="mt-2 w-full text-sm text-vit-orange hover:text-orange-600 font-semibold">
                                ‚Üí Zu Support
                            </button>
                        </div>

                        <!-- Widget 9: Wissens-Updates -->
                        <div class="dashboard-widget vit-card p-6" data-widget="wissen">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="font-semibold text-gray-800">üìö Neue Inhalte</h3>
                                <button class="widget-remove hidden text-gray-400 hover:text-red-500">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                    </svg>
                                </button>
                            </div>
                            <div class="space-y-2">
                                <div class="p-2 bg-purple-50 rounded">
                                    <p class="text-sm font-semibold text-gray-800">üéì Neue Schulung</p>
                                    <p class="text-xs text-gray-600">E-Bike Antriebstechnik 2026</p>
                                </div>
                                <div class="p-2 bg-blue-50 rounded">
                                    <p class="text-sm font-semibold text-gray-800">üìÑ Produktinfo</p>
                                    <p class="text-xs text-gray-600">Haibike 2026 Katalog</p>
                                </div>
                            </div>
                            <button onclick="showView('allgemein');showAllgemeinTab('wissen')" class="mt-4 w-full text-sm text-vit-orange hover:text-orange-600 font-semibold">
                                ‚Üí Zu Wissen
                            </button>
                        </div>

                        <!-- Widget 10: Nachrichten HQ -->
                        <div class="dashboard-widget vit-card p-6" data-widget="nachrichten">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="font-semibold text-gray-800">üì¨ Nachrichten HQ</h3>
                                <button class="widget-remove hidden text-gray-400 hover:text-red-500">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                    </svg>
                                </button>
                            </div>
                            <div class="space-y-3">
                                <div class="p-3 bg-orange-50 rounded-lg border-l-4 border-vit-orange">
                                    <p class="text-sm font-semibold text-gray-800">üöÄ Fr√ºhjahrs-Kampagne live!</p>
                                    <p class="text-xs text-gray-600">vor 2 Stunden</p>
                                </div>
                                <div class="p-3 bg-blue-50 rounded-lg border-l-4 border-blue-500">
                                    <p class="text-sm font-semibold text-gray-800">üìö Neue Schulung verf√ºgbar</p>
                                    <p class="text-xs text-gray-600">gestern</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Widget hinzuf√ºgen Panel (versteckt bis Edit-Modus) -->
                    <div id="widgetAddPanel" class="hidden mt-6 vit-card p-6">
                        <h3 class="font-semibold text-gray-800 mb-4">Widget hinzuf√ºgen</h3>
                        <div class="grid grid-cols-2 md:grid-cols-5 gap-3">
                            <button onclick="addWidget('pipeline')" class="p-3 border-2 border-gray-200 rounded-lg hover:border-vit-orange text-sm">
                                + Pipeline
                            </button>
                            <button onclick="addWidget('success')" class="p-3 border-2 border-gray-200 rounded-lg hover:border-vit-orange text-sm">
                                + Verkaufserfolg
                            </button>
                            <button onclick="addWidget('termine')" class="p-3 border-2 border-gray-200 rounded-lg hover:border-vit-orange text-sm">
                                + Termine
                            </button>
                            <button onclick="addWidget('aufgaben')" class="p-3 border-2 border-gray-200 rounded-lg hover:border-vit-orange text-sm">
                                + Aufgaben
                            </button>
                            <button onclick="addWidget('marketing')" class="p-3 border-2 border-gray-200 rounded-lg hover:border-vit-orange text-sm">
                                + Marketing
                            </button>
                            <button onclick="addWidget('team')" class="p-3 border-2 border-gray-200 rounded-lg hover:border-vit-orange text-sm">
                                + Team
                            </button>
                            <button onclick="addWidget('controlling')" class="p-3 border-2 border-gray-200 rounded-lg hover:border-vit-orange text-sm">
                                + Controlling
                            </button>
                            <button onclick="addWidget('support')" class="p-3 border-2 border-gray-200 rounded-lg hover:border-vit-orange text-sm">
                                + Support
                            </button>
                            <button onclick="addWidget('wissen')" class="p-3 border-2 border-gray-200 rounded-lg hover:border-vit-orange text-sm">
                                + Wissen
                            </button>
                            <button onclick="addWidget('nachrichten')" class="p-3 border-2 border-gray-200 rounded-lg hover:border-vit-orange text-sm">
                                + Nachrichten
                            </button>
                        </div>
                    </div>
                </div> <!-- END homeView -->

                <!-- CRM View -->
                <div id="verkaufView" class="view" style="display: none;">
                    <h1 class="h1-headline text-gray-800 mb-6" data-i18n="h_sales">VERKAUF</h1>
                    
                    <!-- Tab Navigation -->
                    <div class="mb-6 border-b border-gray-200">
                        <nav class="-mb-px flex space-x-8">
                            <button onclick="showVerkaufTab('woche')" class="vk-tab-btn whitespace-nowrap py-4 px-1 border-b-2 border-vit-orange font-semibold text-sm text-vit-orange" data-tab="woche">Wochenansicht</button>
                            <button onclick="showVerkaufTab('pipeline')" class="vk-tab-btn whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-semibold text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="pipeline">Pipeline</button>
                            <button onclick="showVerkaufTab('auswertung')" class="vk-tab-btn whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-semibold text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="auswertung">Auswertung</button>
                            <button onclick="showVerkaufTab('vkWissen')" class="vk-tab-btn whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-semibold text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="vkWissen">üìö Wissen</button>
                        </nav>
                    </div>

                    <!-- ===== TAB 1: Wochenansicht ===== -->
                    <div id="vkTabWoche" class="vk-tab-content">
                        <!-- Week Header -->
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center space-x-3">
                                <button onclick="changeWeek(-1)" class="p-2 rounded-lg border border-gray-300 hover:bg-gray-100">‚óÄ</button>
                                <h2 class="text-lg font-semibold text-gray-800" id="weekTitle">KW 7 ¬∑ 10.02. - 15.02.2026</h2>
                                <button onclick="changeWeek(1)" class="p-2 rounded-lg border border-gray-300 hover:bg-gray-100">‚ñ∂</button>
                            </div>
                            <div class="flex items-center space-x-3">
                                <div class="text-right">
                                    <p class="text-xs text-gray-500">Monatsziel</p>
                                    <p class="font-bold text-gray-800">77.734 ‚Ç¨</p>
                                </div>
                                <select id="weekSellerFilter" onchange="renderWeekView()" class="px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                    <option value="all">Alle Verkaeufer</option>
                                    <option value="Sandra">Sandra</option>
                                    <option value="Thomas">Thomas</option>
                                    <option value="Dirk">Dirk</option>
                                    <option value="Max">Max</option>
                                </select>
                            </div>
                        </div>

                        <!-- Week Summary KPIs -->
                        <div class="grid grid-cols-2 lg:grid-cols-5 gap-3 mb-6">
                            <div class="vit-card p-4 text-center"><p class="text-xs text-gray-500">Plan Termine</p><p class="text-2xl font-bold text-gray-800" id="wkPlan">25</p></div>
                            <div class="vit-card p-4 text-center"><p class="text-xs text-gray-500">Beratungen IST</p><p class="text-2xl font-bold text-blue-600" id="wkGesamt">4</p></div>
                            <div class="vit-card p-4 text-center"><p class="text-xs text-gray-500">Verkauft</p><p class="text-2xl font-bold text-green-600" id="wkVerkauft">1</p></div>
                            <div class="vit-card p-4 text-center"><p class="text-xs text-gray-500">Umsatz KW</p><p class="text-2xl font-bold text-vit-orange" id="wkUmsatz">17.056 ‚Ç¨</p></div>
                            <div class="vit-card p-4 text-center"><p class="text-xs text-gray-500">VK-Quote</p><p class="text-2xl font-bold" id="wkQuote">25%</p></div>
                        </div>

                        <!-- Seller Tables -->
                        <div id="weekSellerTables" class="space-y-6"></div>
                    </div>

                    <!-- ===== TAB 2: Pipeline ===== -->
                    <div id="vkTabPipeline" class="vk-tab-content" style="display:none;">
                        <!-- Pipeline Header -->
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center space-x-3">
                                <select id="pipelineFilter" onchange="renderPipeline()" class="px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                    <option value="all">Alle Verkaeufer</option>
                                    <option value="Sandra">Sandra</option>
                                    <option value="Dirk">Dirk</option>
                                    <option value="Thomas">Thomas</option>
                                    <option value="Max">Max</option>
                                </select>
                            </div>
                            <button onclick="showNewLeadModal()" class="px-4 py-2 bg-vit-orange text-white rounded-lg text-sm hover:opacity-90">+ Neuer Lead</button>
                        </div>

                        <!-- Kanban Board -->
                        <div class="flex space-x-4 overflow-x-auto pb-4" id="kanbanBoard">
                            <!-- Columns rendered by JS -->
                        </div>

                        <!-- New Lead Modal -->
                        <div id="newLeadModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                            <div class="bg-white rounded-xl p-6 w-full max-w-md shadow-2xl">
                                <div class="flex justify-between items-center mb-4">
                                    <h3 class="text-lg font-semibold">Neuer Lead</h3>
                                    <button onclick="document.getElementById('newLeadModal').classList.add('hidden')" class="text-gray-400 hover:text-gray-600 text-xl">&times;</button>
                                </div>
                                <div class="space-y-3">
                                    <input id="leadName" type="text" placeholder="Kundenname" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                    <select id="leadType" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                        <option>E-Bike Trekking</option><option>E-Bike City</option><option>E-Bike MTB</option>
                                        <option>E-Bike Cargo</option><option>Rennrad</option><option>MTB</option>
                                        <option>Kinder</option><option>Zubehoer</option><option>Werkstatt</option>
                                    </select>
                                    <select id="leadSeller" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                        <option>Sandra</option><option>Thomas</option><option>Dirk</option><option>Max</option>
                                    </select>
                                    <input id="leadValue" type="number" placeholder="Geschaetzter Wert (‚Ç¨)" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                    <textarea id="leadNotes" placeholder="Notizen..." class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" rows="2"></textarea>
                                    <button onclick="addNewLead()" class="w-full bg-vit-orange text-white py-2 rounded-lg font-semibold hover:opacity-90">Lead anlegen</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ===== TAB 3: Auswertung ===== -->
                    <div id="vkTabAuswertung" class="vk-tab-content" style="display:none;">
                        <!-- Year KPIs -->
                        <div class="grid grid-cols-2 lg:grid-cols-5 gap-4 mb-6">
                            <div class="vit-card p-5 text-center"><p class="text-xs text-gray-500">Jahresumsatz Plan</p><p class="text-2xl font-bold text-gray-800">1.167.689 ‚Ç¨</p></div>
                            <div class="vit-card p-5 text-center"><p class="text-xs text-gray-500">Umsatz IST (YTD)</p><p class="text-2xl font-bold text-vit-orange">74.082 ‚Ç¨</p></div>
                            <div class="vit-card p-5 text-center"><p class="text-xs text-gray-500">Verkaeufe gesamt</p><p class="text-2xl font-bold text-green-600">16</p></div>
                            <div class="vit-card p-5 text-center"><p class="text-xs text-gray-500">VK-Quote YTD</p><p class="text-2xl font-bold text-blue-600">77%</p></div>
                            <div class="vit-card p-5 text-center"><p class="text-xs text-gray-500">√ò Verkaufspreis</p><p class="text-2xl font-bold text-purple-600">4.630 ‚Ç¨</p></div>
                        </div>

                        <!-- Monthly Overview Table -->
                        <div class="vit-card p-6 mb-6">
                            <h2 class="text-lg font-semibold text-gray-800 mb-4">Monatsuebersicht 2026</h2>
                            <div class="overflow-x-auto">
                                <table class="w-full text-sm">
                                    <thead><tr class="bg-gray-50">
                                        <th class="text-left py-2.5 px-3 font-semibold text-gray-600">Monat</th>
                                        <th class="text-right py-2.5 px-3 font-semibold text-gray-600">Umsatz Plan</th>
                                        <th class="text-right py-2.5 px-3 font-semibold text-gray-600">Umsatz Ist</th>
                                        <th class="text-right py-2.5 px-3 font-semibold text-gray-600">Differenz</th>
                                        <th class="text-right py-2.5 px-3 font-semibold text-gray-600">Termine Soll</th>
                                        <th class="text-right py-2.5 px-3 font-semibold text-gray-600">Termine Ist</th>
                                        <th class="text-right py-2.5 px-3 font-semibold text-gray-600">Verkauft</th>
                                        <th class="text-right py-2.5 px-3 font-semibold text-gray-600">VK-Quote</th>
                                        <th class="text-right py-2.5 px-3 font-semibold text-gray-600">√ò Preis</th>
                                    </tr></thead>
                                    <tbody id="jahresTabelle"></tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Top Sellers -->
                        <div class="vit-card p-6">
                            <h2 class="text-lg font-semibold text-gray-800 mb-4">Verkaeufer-Ranking 2026</h2>
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                <div class="p-4 border-2 border-yellow-400 rounded-xl bg-yellow-50 text-center">
                                    <p class="text-3xl mb-1">ü•á</p>
                                    <p class="font-bold text-gray-800">Sandra</p>
                                    <p class="text-xl font-bold text-vit-orange">16.192 ‚Ç¨</p>
                                    <p class="text-xs text-gray-500">6 Verkaeufe ¬∑ Quote: 100%</p>
                                </div>
                                <div class="p-4 border-2 border-gray-300 rounded-xl bg-gray-50 text-center">
                                    <p class="text-3xl mb-1">ü•à</p>
                                    <p class="font-bold text-gray-800">Dirk</p>
                                    <p class="text-xl font-bold text-vit-orange">36.629 ‚Ç¨</p>
                                    <p class="text-xs text-gray-500">6 Verkaeufe ¬∑ Quote: 67%</p>
                                </div>
                                <div class="p-4 border-2 border-orange-300 rounded-xl bg-orange-50 text-center">
                                    <p class="text-3xl mb-1">ü•â</p>
                                    <p class="font-bold text-gray-800">Thomas</p>
                                    <p class="text-xl font-bold text-vit-orange">17.419 ‚Ç¨</p>
                                    <p class="text-xs text-gray-500">4 Verkaeufe ¬∑ Quote: 80%</p>
                                </div>
                                <div class="p-4 border border-gray-200 rounded-xl text-center">
                                    <p class="text-3xl mb-1">4</p>
                                    <p class="font-bold text-gray-800">Max</p>
                                    <p class="text-xl font-bold text-gray-500">3.813 ‚Ç¨</p>
                                    <p class="text-xs text-gray-500">0 Verkaeufe ¬∑ Werkstatt</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Wissen Tab -->
                    <div id="vkTabVkWissen" class="vk-tab-content" style="display:none;"></div>
                </div>

                <!-- MARKETING View -->
                <!-- ===== DASHBOARDS VIEW (Finanzen, Marketing PRO, Team als Tabs) ===== -->
                <div id="dashboardsView" class="view" style="display: none;">
                    <h1 class="h1-headline text-gray-800 mb-6" data-i18n="h_dashboards">DASHBOARDS</h1>

                    <!-- Tab Navigation -->
                    <div class="mb-6 border-b border-gray-200">
                        <nav class="-mb-px flex space-x-8">
                            <button onclick="showDashboardTab('finanzen')" class="dash-tab-btn whitespace-nowrap py-4 px-1 border-b-2 border-vit-orange font-semibold text-sm text-vit-orange" data-tab="finanzen">Finanzen</button>
                            <button onclick="showDashboardTab('leadreporting')" class="dash-tab-btn whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-semibold text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="leadreporting">Marketing <span class="premium-badge ml-1 text-[8px] px-1.5 py-0.5">PRO</span></button>
                            <button onclick="showDashboardTab('team')" class="dash-tab-btn whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-semibold text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="team">Team</button>
                        </nav>
                    </div>

                    <!-- Tab: Finanzen (initially visible, content injected from old financesView) -->
                    <div id="dashTabFinanzen" class="dash-tab-content"></div>

                    <!-- Tab: Lead Reporting / Marketing PRO -->
                    <div id="dashTabLeadreporting" class="dash-tab-content" style="display:none;"></div>

                    <!-- Tab: Team -->
                    <div id="dashTabTeam" class="dash-tab-content" style="display:none;"></div>
                </div>

                <div id="leadReportingView" class="view" style="display: none;">
                    <h1 class="h1-headline text-gray-800 mb-6" data-i18n="h_leadreporting">LEAD REPORTING</h1>
                    
                    <!-- Header with filters -->
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center space-x-2">
                            <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-green-100 text-green-700">‚óè Live-Daten</span>
                            <span class="text-sm text-gray-600">167 Leads in 2026</span>
                        </div>
                        <div class="flex items-center space-x-3">
                            <select class="px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-vit-orange">
                                <option>Jahr (YTD)</option>
                                <option>Q1</option>
                                <option>Q2</option>
                            </select>
                        </div>
                    </div>

                    <!-- 4 KPI Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                        <div class="vit-card p-5">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-sm text-gray-500">Jahresziel</span>
                                <span class="text-vit-orange text-xl">üéØ</span>
                            </div>
                            <div class="text-3xl font-bold text-gray-800">3,602.5</div>
                            <div class="text-xs text-gray-500 mt-1">Leads gesamt</div>
                        </div>
                        <div class="vit-card p-5">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-sm text-gray-500">Ziel YTD (2 Mon.)</span>
                                <span class="text-blue-500 text-xl">üìà</span>
                            </div>
                            <div class="text-3xl font-bold text-gray-800">422.7</div>
                            <div class="text-xs text-gray-500 mt-1">Soll bis heute</div>
                        </div>
                        <div class="vit-card p-5">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-sm text-gray-500">Ist YTD</span>
                                <span class="text-red-500 text-xl">‚ö†Ô∏è</span>
                            </div>
                            <div class="text-3xl font-bold text-gray-800">167.0</div>
                            <div class="text-xs text-gray-500 mt-1">Erreicht bis heute</div>
                        </div>
                        <div class="vit-card p-5">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-sm text-gray-500">Performance</span>
                                <span class="text-purple-500 text-xl">%</span>
                            </div>
                            <div class="text-3xl font-bold text-red-500">40%</div>
                            <div class="text-xs text-gray-500 mt-1">Zielerreichung</div>
                        </div>
                    </div>

                    <!-- Monthly Chart -->
                    <div class="vit-card p-6 mb-6">
                        <h2 class="text-lg font-semibold text-gray-800 mb-4">üìä Monatliche Uebersicht</h2>
                        <div class="flex items-center space-x-4 mb-4">
                            <div id="monthlyChart" style="width:100%; height:280px; position:relative;">
                                <div class="flex items-end justify-between h-64 px-2" id="chartBars"></div>
                                <div class="flex justify-between px-2 mt-2 text-xs text-gray-500" id="chartLabels"></div>
                            </div>
                        </div>
                        <div class="flex items-center justify-center space-x-6 text-sm text-gray-500">
                            <span class="flex items-center space-x-2"><span class="w-4 h-4 bg-gray-300 rounded inline-block"></span><span>Soll</span></span>
                            <span class="flex items-center space-x-2"><span class="w-4 h-4 bg-vit-orange rounded inline-block"></span><span>Ist</span></span>
                        </div>
                    </div>

                    <!-- Detail Table -->
                    <div class="vit-card p-6">
                        <h2 class="text-lg font-semibold text-gray-800 mb-4">üìã Detailansicht</h2>
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm">
                                <thead>
                                    <tr class="border-b border-gray-200">
                                        <th class="text-left py-3 px-2 font-semibold text-gray-600">Monat</th>
                                        <th class="text-right py-3 px-2 font-semibold text-gray-600">Soll</th>
                                        <th class="text-right py-3 px-2 font-semibold text-green-600">Termine</th>
                                        <th class="text-right py-3 px-2 font-semibold text-purple-600">‚Ç¨/Termin</th>
                                        <th class="text-right py-3 px-2 font-semibold text-blue-600">SV (x0.25)</th>
                                        <th class="text-right py-3 px-2 font-semibold text-orange-600">SV (Roh)</th>
                                        <th class="text-right py-3 px-2 font-semibold text-gray-800">Gesamt</th>
                                        <th class="text-right py-3 px-2 font-semibold text-gray-600">Differenz</th>
                                        <th class="text-right py-3 px-2 font-semibold text-gray-600">Performance</th>
                                        <th class="text-center py-3 px-2 font-semibold text-gray-600">Status</th>
                                    </tr>
                                </thead>
                                <tbody id="detailTableBody">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Marketing View (Hauptmen√º) -->
                <div id="marketingView" class="view" style="display: none;">
                    <h1 class="h1-headline text-gray-800 mb-6" data-i18n="h_marketing">MARKETING</h1>
                    
                    <!-- Tab Navigation -->
                    <div class="mb-6 border-b border-gray-200">
                        <nav class="-mb-px flex space-x-8">
                            <button onclick="showMarketingTab('kampagnen')" class="marketing-tab-btn whitespace-nowrap py-4 px-1 border-b-2 border-vit-orange font-semibold text-sm text-vit-orange" data-tab="kampagnen">
                                Kampagnen
                            </button>
                            <button onclick="showMarketingTab('social')" class="marketing-tab-btn whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-semibold text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="social">
                                Social Media
                            </button>
                            <button onclick="showMarketingTab('content')" class="marketing-tab-btn whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-semibold text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="content">
                                Content Library
                            </button>
                            <button onclick="showMarketingTab('analytics')" class="marketing-tab-btn whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-semibold text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="analytics">
                                Analytics
                            </button>
                            <button onclick="showMarketingTab('mktStrategie')" class="marketing-tab-btn whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-semibold text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="mktStrategie">
                                üìã Strategie
                            </button>
                            <button onclick="showMarketingTab('mktWissen')" class="marketing-tab-btn whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-semibold text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="mktWissen">
                                üìö Wissen
                            </button>
                        </nav>
                    </div>

                    <!-- Tab Contents -->
                    <div id="marketingTabKampagnen" class="marketing-tab-content">
                        <div class="vit-card p-6">
                            <h2 class="text-lg font-semibold text-gray-800 mb-4">Aktuelle Kampagnen</h2>
                            <div class="space-y-4">
                                <div class="flex items-center justify-between p-4 bg-green-50 rounded-lg border border-green-200">
                                    <div>
                                        <h3 class="font-semibold text-gray-800">Fruehjahrs-Aktion 2026</h3>
                                        <p class="text-sm text-gray-600">E-Bike Fruehlings-Angebote mit 15% Rabatt</p>
                                    </div>
                                    <div class="text-right">
                                        <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-green-100 text-green-700">Aktiv</span>
                                        <p class="text-xs text-gray-500 mt-1">Noch 12 Tage</p>
                                    </div>
                                </div>
                                <div class="flex items-center justify-between p-4 bg-blue-50 rounded-lg border border-blue-200">
                                    <div>
                                        <h3 class="font-semibold text-gray-800">E-Bike Wochen</h3>
                                        <p class="text-sm text-gray-600">Testtage und Probefahrt-Events</p>
                                    </div>
                                    <div class="text-right">
                                        <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-blue-100 text-blue-700">Geplant</span>
                                        <p class="text-xs text-gray-500 mt-1">Startet in 5 Tagen</p>
                                    </div>
                                </div>
                                <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg border border-gray-200">
                                    <div>
                                        <h3 class="font-semibold text-gray-800">Winter-Werkstatt-Aktion</h3>
                                        <p class="text-sm text-gray-600">Inspektion + Wintercheck zum Sonderpreis</p>
                                    </div>
                                    <div class="text-right">
                                        <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-gray-200 text-gray-600">Beendet</span>
                                        <p class="text-xs text-gray-500 mt-1">31. Jan beendet</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="marketingTabSocial" class="marketing-tab-content" style="display:none;">

                        <!-- Motivation Header -->
                        <div class="vit-card p-5 mb-6 bg-gradient-to-r from-orange-50 to-yellow-50 border border-orange-200">
                            <div class="flex items-center justify-between">
                                <div>
                                    <h2 class="text-lg font-bold text-gray-800" data-i18n="lh_title">üé¨ Local Hero ‚Äì Content Strategie</h2>
                                    <p class="text-sm text-gray-600 mt-1">Dreh ein kurzes Video, lade es hoch ‚Äì wir machen den Rest! Schnitt, Untertitel &amp; Posting √ºbernimmt das HQ.</p>
                                </div>
                                <div class="text-center">
                                    <div class="text-3xl font-bold text-vit-orange" id="smScoreNumber">4</div>
                                    <div class="text-[10px] text-gray-500 uppercase" data-i18n="lbl_videos_shot">Videos gedreht</div>
                                </div>
                            </div>
                            <!-- Progress -->
                            <div class="mt-3 flex items-center space-x-3">
                                <div class="flex-1 bg-gray-200 rounded-full h-3">
                                    <div class="bg-gradient-to-r from-vit-orange to-yellow-400 h-3 rounded-full transition-all" id="smProgressBar" style="width:8%"></div>
                                </div>
                                <span class="text-xs font-bold text-gray-600" id="smProgressText">4 / 50 Themen</span>
                            </div>
                            <div class="flex items-center space-x-4 mt-3">
                                <span class="text-xs px-2 py-1 bg-orange-100 text-orange-700 rounded-full font-semibold" data-i18n="lbl_streak">üî• Streak: 2 Wochen</span>
                                <span class="text-xs px-2 py-1 bg-green-100 text-green-700 rounded-full font-semibold" data-i18n="lbl_rank">üèÜ Rang 5 von 21</span>
                                <span class="text-xs px-2 py-1 bg-blue-100 text-blue-700 rounded-full font-semibold" data-i18n="lbl_next_badge">‚≠ê Naechstes Badge: 5 Videos</span>
                            </div>
                        </div>

                        <!-- Sub-Navigation Pills -->
                        <div class="flex space-x-2 mb-5 flex-wrap gap-y-2">
                            <button onclick="switchSmSub('kanaele')" class="sm-sub-btn px-4 py-2 rounded-full text-sm font-semibold bg-vit-orange text-white" data-smsub="kanaele" data-i18n="sm_channels">üì± Unsere Kanaele</button>
                            <button onclick="switchSmSub('themen')" class="sm-sub-btn px-4 py-2 rounded-full text-sm font-semibold bg-gray-100 text-gray-600" data-smsub="themen" data-i18n="sm_topics">üé¨ Themen-Auftraege</button>
                            <button onclick="switchSmSub('upload')" class="sm-sub-btn px-4 py-2 rounded-full text-sm font-semibold bg-gray-100 text-gray-600" data-smsub="upload" data-i18n="sm_upload">üì§ Video hochladen</button>
                            <button onclick="switchSmSub('ranking')" class="sm-sub-btn px-4 py-2 rounded-full text-sm font-semibold bg-gray-100 text-gray-600" data-smsub="ranking" data-i18n="sm_ranking">üìä Netzwerk-Ranking</button>
                            <button onclick="switchSmSub('ablauf')" class="sm-sub-btn px-4 py-2 rounded-full text-sm font-semibold bg-gray-100 text-gray-600" data-smsub="ablauf" data-i18n="sm_howto">‚ÑπÔ∏è So funktioniert's</button>
                        </div>

                        <!-- SUB: Unsere Kan√§le -->
                        <div id="smSubKanaele" class="sm-sub-content">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">

                                <!-- Instagram -->
                                <div class="vit-card p-5">
                                    <div class="flex items-center space-x-3 mb-4">
                                        <div class="w-11 h-11 rounded-full bg-gradient-to-br from-purple-500 via-pink-500 to-orange-400 flex items-center justify-center">
                                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zM12 0C8.741 0 8.333.014 7.053.072 2.695.272.273 2.69.073 7.052.014 8.333 0 8.741 0 12c0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98C8.333 23.986 8.741 24 12 24c3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98C15.668.014 15.259 0 12 0zm0 5.838a6.162 6.162 0 100 12.324 6.162 6.162 0 000-12.324zM12 16a4 4 0 110-8 4 4 0 010 8zm6.406-11.845a1.44 1.44 0 100 2.881 1.44 1.44 0 000-2.881z"/></svg>
                                        </div>
                                        <div>
                                            <h3 class="font-bold text-gray-800">Instagram</h3>
                                            <p class="text-xs text-gray-500">@vitbikes</p>
                                        </div>
                                    </div>
                                    <div class="flex space-x-4 text-center mb-4">
                                        <div class="flex-1"><p class="text-lg font-bold text-gray-800">10.2k</p><p class="text-[10px] text-gray-500" data-i18n="ch_followers">Follower</p></div>
                                        <div class="flex-1"><p class="text-lg font-bold text-gray-800">847</p><p class="text-[10px] text-gray-500" data-i18n="ch_posts">Beitraege</p></div>
                                        <div class="flex-1"><p class="text-lg font-bold text-gray-800">4.2%</p><p class="text-[10px] text-gray-500" data-i18n="ch_engagement">Engagement</p></div>
                                    </div>
                                    <div class="flex space-x-2">
                                        <a href="https://www.instagram.com/vitbikes" target="_blank" class="flex-1 py-2 bg-gradient-to-r from-purple-500 via-pink-500 to-orange-400 text-white rounded-lg text-xs font-semibold text-center hover:opacity-90 transition">Zum Kanal ‚Üí</a>
                                        <a href="https://www.instagram.com/vitbikes" target="_blank" class="py-2 px-3 border border-gray-200 rounded-lg text-xs text-gray-600 hover:bg-gray-50 transition">Folgen</a>
                                    </div>
                                </div>

                                <!-- YouTube -->
                                <div class="vit-card p-5">
                                    <div class="flex items-center space-x-3 mb-4">
                                        <div class="w-11 h-11 rounded-full bg-red-600 flex items-center justify-center">
                                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 24 24"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg>
                                        </div>
                                        <div>
                                            <h3 class="font-bold text-gray-800">YouTube</h3>
                                            <p class="text-xs text-gray-500">vit:bikes</p>
                                        </div>
                                    </div>
                                    <div class="flex space-x-4 text-center mb-4">
                                        <div class="flex-1"><p class="text-lg font-bold text-gray-800">156</p><p class="text-[10px] text-gray-500" data-i18n="ch_subscribers">Abonnenten</p></div>
                                        <div class="flex-1"><p class="text-lg font-bold text-gray-800">48</p><p class="text-[10px] text-gray-500" data-i18n="ch_videos">Videos</p></div>
                                        <div class="flex-1"><p class="text-lg font-bold text-gray-800">12.4k</p><p class="text-[10px] text-gray-500" data-i18n="ch_views">Aufrufe</p></div>
                                    </div>
                                    <div class="flex space-x-2">
                                        <a href="https://www.youtube.com/@vitbikes" target="_blank" class="flex-1 py-2 bg-red-600 text-white rounded-lg text-xs font-semibold text-center hover:bg-red-700 transition">Zum Kanal ‚Üí</a>
                                        <a href="https://www.youtube.com/@vitbikes" target="_blank" class="py-2 px-3 border border-gray-200 rounded-lg text-xs text-gray-600 hover:bg-gray-50 transition">Abonnieren</a>
                                    </div>
                                </div>

                                <!-- TikTok -->
                                <div class="vit-card p-5">
                                    <div class="flex items-center space-x-3 mb-4">
                                        <div class="w-11 h-11 rounded-full bg-black flex items-center justify-center">
                                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 24 24"><path d="M19.59 6.69a4.83 4.83 0 0 1-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 0 1-2.88 2.5 2.89 2.89 0 0 1-2.89-2.89 2.89 2.89 0 0 1 2.89-2.89c.28 0 .54.04.79.1v-3.5a6.37 6.37 0 0 0-.79-.05A6.34 6.34 0 0 0 3.15 15.2a6.34 6.34 0 0 0 6.34 6.34 6.34 6.34 0 0 0 6.34-6.34V8.73a8.19 8.19 0 0 0 4.76 1.52V6.79a4.82 4.82 0 0 1-1-.1z"/></svg>
                                        </div>
                                        <div>
                                            <h3 class="font-bold text-gray-800">TikTok</h3>
                                            <p class="text-xs text-gray-500">@vitbikes</p>
                                        </div>
                                    </div>
                                    <div class="flex space-x-4 text-center mb-4">
                                        <div class="flex-1"><p class="text-lg font-bold text-gray-800">2.8k</p><p class="text-[10px] text-gray-500" data-i18n="ch_followers">Follower</p></div>
                                        <div class="flex-1"><p class="text-lg font-bold text-gray-800">124</p><p class="text-[10px] text-gray-500" data-i18n="ch_videos">Videos</p></div>
                                        <div class="flex-1"><p class="text-lg font-bold text-gray-800">89k</p><p class="text-[10px] text-gray-500" data-i18n="ch_likes">Likes</p></div>
                                    </div>
                                    <div class="flex space-x-2">
                                        <a href="https://www.tiktok.com/@vitbikes" target="_blank" class="flex-1 py-2 bg-black text-white rounded-lg text-xs font-semibold text-center hover:opacity-90 transition">Zum Kanal ‚Üí</a>
                                        <a href="https://www.tiktok.com/@vitbikes" target="_blank" class="py-2 px-3 border border-gray-200 rounded-lg text-xs text-gray-600 hover:bg-gray-50 transition">Folgen</a>
                                    </div>
                                </div>

                            </div>
                        </div>

                        <!-- SUB 1: Themen-Auftr√§ge -->
                        <div id="smSubThemen" class="sm-sub-content" style="display:none;">
                            <div class="flex items-center justify-between mb-4">
                                <div class="flex space-x-2">
                                    <button onclick="filterSmThemen('all')" class="sm-thema-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-vit-orange text-white" data-smf="all" data-i18n="filter_all">Alle</button>
                                    <button onclick="filterSmThemen('neu')" class="sm-thema-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-gray-100 text-gray-600" data-smf="neu" data-i18n="filter_new">üÜï Neu fuer dich</button>
                                    <button onclick="filterSmThemen('done')" class="sm-thema-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-gray-100 text-gray-600" data-smf="done" data-i18n="filter_done">‚úÖ Erledigt</button>
                                </div>
                                <input type="text" id="smThemenSearch" placeholder="Thema suchen..." data-i18n-placeholder="search_topic" class="px-3 py-1.5 border border-gray-200 rounded-lg text-xs w-48" oninput="filterSmThemen(currentSmFilter)">
                            </div>
                            <div id="smThemenList" class="space-y-2"></div>
                        </div>

                        <!-- SUB 2: Upload -->
                        <div id="smSubUpload" class="sm-sub-content" style="display:none;">
                            <div class="max-w-xl mx-auto">
                                <div class="vit-card p-6">
                                    <div class="text-center mb-5">
                                        <div class="text-4xl mb-2">üì§</div>
                                        <h3 class="text-lg font-bold text-gray-800" data-i18n="upl_title">Video hochladen</h3>
                                        <p class="text-sm text-gray-500">Waehle ein Thema, lade dein Video hoch ‚Äì fertig! Wir kuemmern uns um Schnitt, Untertitel und Posting.</p>
                                    </div>

                                    <div class="space-y-4">
                                        <div>
                                            <label class="text-sm font-semibold text-gray-700 block mb-1">Content-Thema waehlen</label>
                                            <select id="smUploadThema" class="w-full px-3 py-2.5 border border-gray-300 rounded-lg text-sm">
                                                <option value="">Thema waehlen...</option>
                                            </select>
                                            <p class="text-[10px] text-gray-400 mt-1">Oder trage 0000 ein, wenn es ein eigener Vorschlag ist</p>
                                        </div>

                                        <div>
                                            <label class="text-sm font-semibold text-gray-700 block mb-1">Dein Video</label>
                                            <div class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-vit-orange transition cursor-pointer" onclick="this.querySelector('input')||this.insertAdjacentHTML('beforeend','<input type=file class=hidden onchange=handleFileUpload(this)>');var fi=this.querySelector('input');if(fi)fi.click()">
                                                <div class="text-4xl mb-2">‚òÅÔ∏è</div>
                                                <p class="text-sm text-gray-600">Video hierhin ziehen</p>
                                                <p class="text-xs text-gray-400 mt-1">oder klicken zum Auswaehlen</p>
                                                <p class="text-[10px] text-gray-300 mt-2">MP4, MOV ¬∑ Max. 2 GB</p>
                                            </div>
                                        </div>

                                        <div>
                                            <label class="text-sm font-semibold text-gray-700 block mb-1">Kurzer Kommentar <span class="font-normal text-gray-400">(optional)</span></label>
                                            <textarea class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" rows="2" placeholder="z.B. 'Haben das im Laden gedreht, Lichtsituation war schwierig'"></textarea>
                                        </div>

                                        <button class="w-full py-3 bg-vit-orange text-white rounded-lg font-bold hover:opacity-90 transition text-sm" onclick="alert('üéâ Video eingereicht! Das HQ meldet sich wenn es fertig geschnitten ist.')">
                                            üöÄ Video einreichen
                                        </button>
                                        <p class="text-[10px] text-gray-400 text-center">Das HQ schneidet euer Video, packt Untertitel drauf und postet es als Collab-Post auf eurem Profil.</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- SUB 3: Ranking -->
                        <div id="smSubRanking" class="sm-sub-content" style="display:none;">
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <div class="vit-card p-6">
                                    <h3 class="font-bold text-gray-800 mb-4" data-i18n="rank_title">üèÜ Content-Ranking ‚Äì Wer dreht am meisten?</h3>
                                    <div id="smRankingList" class="space-y-2"></div>
                                </div>
                                <div>
                                    <div class="vit-card p-6 mb-4">
                                        <h3 class="font-bold text-gray-800 mb-3" data-i18n="rank_badges">üéñÔ∏è Badges</h3>
                                        <div class="grid grid-cols-3 gap-3">
                                            <div class="text-center p-3 bg-green-50 rounded-lg border border-green-200">
                                                <div class="text-2xl">üå±</div>
                                                <p class="text-[10px] font-semibold text-gray-600 mt-1" data-i18n="badge_first">Erster Upload</p>
                                                <p class="text-[10px] text-green-600" data-i18n="badge_reached">‚úÖ Erreicht</p>
                                            </div>
                                            <div class="text-center p-3 bg-green-50 rounded-lg border border-green-200">
                                                <div class="text-2xl">üé¨</div>
                                                <p class="text-[10px] font-semibold text-gray-600 mt-1" data-i18n="badge_3">3 Videos</p>
                                                <p class="text-[10px] text-green-600" data-i18n="badge_reached">‚úÖ Erreicht</p>
                                            </div>
                                            <div class="text-center p-3 bg-orange-50 rounded-lg border border-orange-200">
                                                <div class="text-2xl">‚≠ê</div>
                                                <p class="text-[10px] font-semibold text-gray-600 mt-1" data-i18n="badge_5">5 Videos</p>
                                                <p class="text-[10px] text-orange-600" data-i18n="badge_almost">Noch 1!</p>
                                            </div>
                                            <div class="text-center p-3 bg-gray-50 rounded-lg border border-gray-200 opacity-50">
                                                <div class="text-2xl">üî•</div>
                                                <p class="text-[10px] font-semibold text-gray-600 mt-1" data-i18n="badge_10">10 Videos</p>
                                                <p class="text-[10px] text-gray-400" data-i18n="badge_locked">Gesperrt</p>
                                            </div>
                                            <div class="text-center p-3 bg-gray-50 rounded-lg border border-gray-200 opacity-50">
                                                <div class="text-2xl">üíé</div>
                                                <p class="text-[10px] font-semibold text-gray-600 mt-1" data-i18n="badge_25">25 Videos</p>
                                                <p class="text-[10px] text-gray-400" data-i18n="badge_locked">Gesperrt</p>
                                            </div>
                                            <div class="text-center p-3 bg-gray-50 rounded-lg border border-gray-200 opacity-50">
                                                <div class="text-2xl">üëë</div>
                                                <p class="text-[10px] font-semibold text-gray-600 mt-1" data-i18n="badge_50">50 Videos</p>
                                                <p class="text-[10px] text-gray-400" data-i18n="badge_locked">Gesperrt</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="vit-card p-6">
                                        <h3 class="font-bold text-gray-800 mb-3" data-i18n="rank_stats">üìä Netzwerk-Statistik</h3>
                                        <div class="grid grid-cols-2 gap-3">
                                            <div class="text-center p-3 bg-gray-50 rounded-lg"><p class="text-xl font-bold">34</p><p class="text-[10px] text-gray-500" data-i18n="rank_total_vids">Videos gesamt</p></div>
                                            <div class="text-center p-3 bg-gray-50 rounded-lg"><p class="text-xl font-bold">25</p><p class="text-[10px] text-gray-500" data-i18n="rank_topics_covered">Themen abgedeckt</p></div>
                                            <div class="text-center p-3 bg-gray-50 rounded-lg"><p class="text-xl font-bold">10</p><p class="text-[10px] text-gray-500" data-i18n="rank_active">Aktive Standorte</p></div>
                                            <div class="text-center p-3 bg-gray-50 rounded-lg"><p class="text-xl font-bold text-red-500">13</p><p class="text-[10px] text-gray-500" data-i18n="rank_no_video">Noch ohne Video</p></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- SUB 4: Ablauf -->
                        <div id="smSubAblauf" class="sm-sub-content" style="display:none;">
                            <div class="vit-card p-6 mb-6">
                                <h3 class="text-lg font-bold text-gray-800 mb-4" data-i18n="howto_title">So funktioniert Local Hero ‚Äì in 3 Schritten</h3>
                                <div class="grid grid-cols-1 md:grid-cols-5 gap-2">
                                    <div class="text-center p-4 bg-orange-50 rounded-lg">
                                        <div class="w-10 h-10 bg-vit-orange text-white rounded-full flex items-center justify-center mx-auto mb-2 font-bold">HQ</div>
                                        <p class="text-xs font-bold text-gray-700">1. Inspiration</p>
                                        <p class="text-[10px] text-gray-500">Wir stellen Thema + Beispielvideo bereit</p>
                                    </div>
                                    <div class="flex items-center justify-center"><span class="text-2xl text-gray-300">‚Üí</span></div>
                                    <div class="text-center p-4 bg-blue-50 rounded-lg">
                                        <div class="w-10 h-10 bg-blue-600 text-white rounded-full flex items-center justify-center mx-auto mb-2 font-bold">DU</div>
                                        <p class="text-xs font-bold text-gray-700">2. Drehen & Upload</p>
                                        <p class="text-[10px] text-gray-500">1-3 Min. Video mit dem Handy drehen und hier hochladen</p>
                                    </div>
                                    <div class="flex items-center justify-center"><span class="text-2xl text-gray-300">‚Üí</span></div>
                                    <div class="text-center p-4 bg-green-50 rounded-lg">
                                        <div class="w-10 h-10 bg-green-600 text-white rounded-full flex items-center justify-center mx-auto mb-2 font-bold">HQ</div>
                                        <p class="text-xs font-bold text-gray-700">3. Schnitt & Posting</p>
                                        <p class="text-[10px] text-gray-500">Wir schneiden, packen Untertitel drauf und posten als Collab</p>
                                    </div>
                                </div>
                            </div>

                            <div class="vit-card p-6 mb-6">
                                <h3 class="font-bold text-gray-800 mb-3" data-i18n="howto_tips">üí° Tipps fuer gute Videos</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="flex items-start space-x-3"><span class="text-xl">üì±</span><div><p class="text-sm font-semibold">Hochformat</p><p class="text-xs text-gray-500">9:16 Format (wie Instagram Story/Reel)</p></div></div>
                                    <div class="flex items-start space-x-3"><span class="text-xl">üîä</span><div><p class="text-sm font-semibold">Laut & deutlich sprechen</p><p class="text-xs text-gray-500">Wir packen Untertitel drauf ‚Äì aber guter Ton hilft</p></div></div>
                                    <div class="flex items-start space-x-3"><span class="text-xl">üí°</span><div><p class="text-sm font-semibold">Gutes Licht</p><p class="text-xs text-gray-500">Am besten Tageslicht oder Laden-Beleuchtung</p></div></div>
                                    <div class="flex items-start space-x-3"><span class="text-xl">‚è±Ô∏è</span><div><p class="text-sm font-semibold">Max. 1-3 Minuten</p><p class="text-xs text-gray-500">Kurz und knackig ‚Äì lieber zu kurz als zu lang</p></div></div>
                                    <div class="flex items-start space-x-3"><span class="text-xl">üéØ</span><div><p class="text-sm font-semibold">Hook-Hauptteil-Outro</p><p class="text-xs text-gray-500">Aufbau steht bei jedem Thema dabei</p></div></div>
                                    <div class="flex items-start space-x-3"><span class="text-xl">ü§∑</span><div><p class="text-sm font-semibold">Nicht perfekt sein</p><p class="text-xs text-gray-500">Authentisch > perfekt. Einfach drauflos!</p></div></div>
                                </div>
                            </div>

                            <div class="vit-card p-6">
                                <h3 class="font-bold text-gray-800 mb-3" data-i18n="howto_links">üîó Hilfreiche Links</h3>
                                <div class="space-y-2">
                                    <a href="https://fahrrad.vitbikes.de/inspiration/" target="_blank" class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg hover:bg-orange-50 transition">
                                        <span class="text-xl">üé•</span><div class="flex-1"><p class="text-sm font-semibold text-vit-orange">Beispielvideos & Inspiration</p><p class="text-[10px] text-gray-400">fahrrad.vitbikes.de/inspiration</p></div><span class="text-gray-400">‚Üí</span>
                                    </a>
                                    <a href="#" class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg hover:bg-orange-50 transition">
                                        <span class="text-xl">üìã</span><div class="flex-1"><p class="text-sm font-semibold text-vit-orange">Reel-Template (MAKE IT REEL)</p><p class="text-[10px] text-gray-400">Hook ‚Äì Hauptteil ‚Äì Outro Vorlage</p></div><span class="text-gray-400">‚Üí</span>
                                    </a>
                                </div>
                            </div>
                        </div>

                    </div>

                    <div id="marketingTabContent" class="marketing-tab-content" style="display:none;">
                        <div class="vit-card p-6">
                            <h2 class="text-lg font-semibold text-gray-800 mb-4">Content Library</h2>
                            <div class="space-y-3">
                                <div class="flex items-center space-x-4 p-3 bg-gray-50 rounded-lg">
                                    <span class="text-2xl">üñºÔ∏è</span>
                                    <div class="flex-1">
                                        <h3 class="font-semibold text-gray-800">Logo & Brand Assets</h3>
                                        <p class="text-xs text-gray-500">Logos, Farben, Schriftarten</p>
                                    </div>
                                    <button class="px-3 py-1 text-sm text-vit-orange border border-vit-orange rounded hover:bg-vit-orange hover:text-white transition">Download</button>
                                </div>
                                <div class="flex items-center space-x-4 p-3 bg-gray-50 rounded-lg">
                                    <span class="text-2xl">üìÑ</span>
                                    <div class="flex-1">
                                        <h3 class="font-semibold text-gray-800">Flyer-Vorlagen</h3>
                                        <p class="text-xs text-gray-500">Aktionsflyer, Eroeffnungsflyer</p>
                                    </div>
                                    <button class="px-3 py-1 text-sm text-vit-orange border border-vit-orange rounded hover:bg-vit-orange hover:text-white transition">Download</button>
                                </div>
                                <div class="flex items-center space-x-4 p-3 bg-gray-50 rounded-lg">
                                    <span class="text-2xl">üìã</span>
                                    <div class="flex-1">
                                        <h3 class="font-semibold text-gray-800">Social Media Templates</h3>
                                        <p class="text-xs text-gray-500">Instagram Posts, Facebook Banner</p>
                                    </div>
                                    <button class="px-3 py-1 text-sm text-vit-orange border border-vit-orange rounded hover:bg-vit-orange hover:text-white transition">Download</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="marketingTabAnalytics" class="marketing-tab-content" style="display:none;">
                        <div class="vit-card p-6">
                            <h2 class="text-lg font-semibold text-gray-800 mb-4">Marketing Analytics</h2>
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                <div class="p-4 bg-orange-50 rounded-lg text-center">
                                    <p class="text-sm text-gray-600">Website-Besucher</p>
                                    <p class="text-2xl font-bold text-vit-orange">2,458</p>
                                    <p class="text-xs text-green-600">+12% vs. Vormonat</p>
                                </div>
                                <div class="p-4 bg-blue-50 rounded-lg text-center">
                                    <p class="text-sm text-gray-600">Google-Bewertungen</p>
                                    <p class="text-2xl font-bold text-blue-600">4.7 ‚òÖ</p>
                                    <p class="text-xs text-gray-500">89 Bewertungen</p>
                                </div>
                                <div class="p-4 bg-green-50 rounded-lg text-center">
                                    <p class="text-sm text-gray-600">Conversion Rate</p>
                                    <p class="text-2xl font-bold text-green-600">3.2%</p>
                                    <p class="text-xs text-green-600">+0.4% vs. Vormonat</p>
                                </div>
                                <div class="p-4 bg-purple-50 rounded-lg text-center">
                                    <p class="text-sm text-gray-600">Kosten/Lead</p>
                                    <p class="text-2xl font-bold text-purple-600">146 ‚Ç¨</p>
                                    <p class="text-xs text-red-600">+8% vs. Vormonat</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tab: Marketing Strategie -->
                    <div id="marketingTabMktStrategie" class="marketing-tab-content" style="display:none;">
                        <div class="vit-card p-6 mb-6">
                            <div class="flex items-center justify-between mb-4">
                                <div>
                                    <h2 class="text-lg font-semibold text-gray-800">Marketing-Strategie 2026</h2>
                                    <p class="text-sm text-gray-500">Jahresgespraech vom 23.12.2025 ¬∑ Ansprechpartner vit:bikes: Michael Stenzel</p>
                                </div>
                                <span class="px-3 py-1 bg-green-100 text-green-700 rounded-full text-xs font-bold">Vereinbart &amp; Unterschrieben</span>
                            </div>
                        </div>

                        <!-- Vereinbarung 2026 -->
                        <div class="vit-card p-6 mb-6">
                            <h3 class="font-semibold text-gray-800 mb-4 flex items-center"><span class="w-8 h-8 bg-vit-orange text-white rounded-lg flex items-center justify-center text-sm mr-3">üìù</span> Vereinbarung 2026</h3>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                                <div class="p-4 bg-orange-50 rounded-lg text-center"><p class="text-xs text-gray-500">Budget / Monat</p><p class="text-2xl font-bold text-vit-orange">1.500 ‚Ç¨</p><p class="text-xs text-gray-400">flexibel anpassbar zum Monatsanfang</p></div>
                                <div class="p-4 bg-blue-50 rounded-lg text-center"><p class="text-xs text-gray-500">Mediamix</p><p class="text-lg font-bold text-blue-600">Meta + Google</p><p class="text-xs text-gray-400">+ Framen, Audio, Events (optional)</p></div>
                                <div class="p-4 bg-green-50 rounded-lg text-center"><p class="text-xs text-gray-500">Content-Unterstuetzung</p><p class="text-lg font-bold text-green-600">Ads + Organisch</p><p class="text-xs text-gray-400">durch vit:bikes Content-Team</p></div>
                            </div>
                            <p class="text-sm text-gray-600">Zusaetzlich: Lokale OOH-Werbemittel, Individuelle Ads, Influencer-Kooperationen</p>
                        </div>

                        <!-- Performance 2025 -->
                        <div class="vit-card p-6 mb-6">
                            <h3 class="font-semibold text-gray-800 mb-4 flex items-center"><span class="w-8 h-8 bg-blue-600 text-white rounded-lg flex items-center justify-center text-sm mr-3">üìä</span> Performance 2025</h3>
                            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3">
                                <div class="p-3 bg-gray-50 rounded-lg text-center"><p class="text-xs text-gray-400">Standortsuche</p><p class="text-xl font-bold text-gray-800">4.275</p><p class="text-xs text-blue-500">Meta</p></div>
                                <div class="p-3 bg-gray-50 rounded-lg text-center"><p class="text-xs text-gray-400">Terminbuchungen</p><p class="text-xl font-bold text-vit-orange">40</p><p class="text-xs text-blue-500">Meta</p></div>
                                <div class="p-3 bg-gray-50 rounded-lg text-center"><p class="text-xs text-gray-400">Store Visits</p><p class="text-xl font-bold text-green-600">108</p><p class="text-xs text-blue-500">Meta</p></div>
                                <div class="p-3 bg-gray-50 rounded-lg text-center"><p class="text-xs text-gray-400">Impressionen</p><p class="text-xl font-bold text-gray-800">1.248.800</p><p class="text-xs text-red-500">Google Ads</p></div>
                                <div class="p-3 bg-gray-50 rounded-lg text-center"><p class="text-xs text-gray-400">Klicks</p><p class="text-xl font-bold text-gray-800">8.924</p><p class="text-xs text-red-500">Google Ads</p></div>
                                <div class="p-3 bg-gray-50 rounded-lg text-center"><p class="text-xs text-gray-400">Kosten Gesamt</p><p class="text-xl font-bold text-red-600">7.184 ‚Ç¨</p><p class="text-xs text-red-500">Google Ads</p></div>
                            </div>
                        </div>

                        <!-- Grafrath vs Netzwerk Durchschnitt -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                            <div class="vit-card p-6">
                                <h3 class="font-semibold text-gray-800 mb-3">‚åÄ Grafrath</h3>
                                <table class="w-full text-sm"><tbody>
                                    <tr class="border-b"><td class="py-2 text-gray-500">Budget/Monat</td><td class="py-2 text-right font-semibold">863,86 ‚Ç¨</td></tr>
                                    <tr class="border-b"><td class="py-2 text-gray-500">CPC</td><td class="py-2 text-right font-semibold">103,50 ‚Ç¨</td></tr>
                                    <tr class="border-b"><td class="py-2 text-gray-500">CPT (Cost per Termin)</td><td class="py-2 text-right font-semibold">205,92 ‚Ç¨</td></tr>
                                    <tr class="border-b"><td class="py-2 text-gray-500">Termine / Monat</td><td class="py-2 text-right font-semibold">4,88</td></tr>
                                    <tr><td class="py-2 text-gray-500">Store Visits / Monat</td><td class="py-2 text-right font-semibold">16,38</td></tr>
                                </tbody></table>
                            </div>
                            <div class="vit-card p-6 border-l-4 border-vit-orange">
                                <h3 class="font-semibold text-vit-orange mb-3">‚åÄ vit:bikes Netzwerk</h3>
                                <table class="w-full text-sm"><tbody>
                                    <tr class="border-b"><td class="py-2 text-gray-500">Budget/Monat</td><td class="py-2 text-right font-semibold">1.436 ‚Ç¨</td></tr>
                                    <tr class="border-b"><td class="py-2 text-gray-500">CPC</td><td class="py-2 text-right font-semibold">104,32 ‚Ç¨</td></tr>
                                    <tr class="border-b"><td class="py-2 text-gray-500">CPT (Cost per Termin)</td><td class="py-2 text-right font-semibold text-green-600">163,15 ‚Ç¨ ‚úì</td></tr>
                                    <tr class="border-b"><td class="py-2 text-gray-500">Termine / Monat</td><td class="py-2 text-right font-semibold text-green-600">9 ‚úì</td></tr>
                                    <tr><td class="py-2 text-gray-500">Store Visits / Monat</td><td class="py-2 text-right font-semibold text-green-600">22 ‚úì</td></tr>
                                </tbody></table>
                            </div>
                        </div>

                        <!-- Zielerreichung -->
                        <div class="vit-card p-6 mb-6">
                            <h3 class="font-semibold text-gray-800 mb-3 flex items-center"><span class="w-8 h-8 bg-green-600 text-white rounded-lg flex items-center justify-center text-sm mr-3">üéØ</span> Zielerreichung 2025</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="p-4 rounded-lg bg-yellow-50"><p class="text-sm text-gray-600 mb-1">Terminziel-Erreichung</p><div class="flex items-center"><div class="flex-1 bg-gray-200 rounded-full h-4 mr-3"><div class="bg-yellow-500 h-4 rounded-full" style="width:56%"></div></div><span class="text-sm font-bold text-yellow-600">56%</span></div></div>
                                <div class="p-4 rounded-lg bg-green-50"><p class="text-sm text-gray-600 mb-1">Storevisit-Ziel-Erreichung</p><div class="flex items-center"><div class="flex-1 bg-gray-200 rounded-full h-4 mr-3"><div class="bg-green-500 h-4 rounded-full" style="width:100%"></div></div><span class="text-sm font-bold text-green-600">103%</span></div></div>
                            </div>
                        </div>

                        <!-- Basic Checkliste -->
                        <div class="vit-card p-6 mb-6">
                            <h3 class="font-semibold text-gray-800 mb-4 flex items-center"><span class="w-8 h-8 bg-purple-600 text-white rounded-lg flex items-center justify-center text-sm mr-3">‚úÖ</span> Basic Checkliste</h3>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                                <div class="flex items-center space-x-2 p-2 bg-green-50 rounded"><span class="text-green-600">‚úÖ</span><span class="text-sm">Aussendarstellung</span></div>
                                <div class="flex items-center space-x-2 p-2 bg-green-50 rounded"><span class="text-green-600">‚úÖ</span><span class="text-sm">Individuelle Ads (Paid)</span></div>
                                <div class="flex items-center space-x-2 p-2 bg-green-50 rounded"><span class="text-green-600">‚úÖ</span><span class="text-sm">Organische Stories</span></div>
                                <div class="flex items-center space-x-2 p-2 bg-green-50 rounded"><span class="text-green-600">‚úÖ</span><span class="text-sm">Events 2025</span></div>
                                <div class="flex items-center space-x-2 p-2 bg-green-50 rounded"><span class="text-green-600">‚úÖ</span><span class="text-sm">Google My Business</span></div>
                                <div class="flex items-center space-x-2 p-2 bg-green-50 rounded"><span class="text-green-600">‚úÖ</span><span class="text-sm">Influencer-Kooperationen</span></div>
                                <div class="flex items-center space-x-2 p-2 bg-green-50 rounded"><span class="text-green-600">‚úÖ</span><span class="text-sm">Landingpage</span></div>
                                <div class="flex items-center space-x-2 p-2 bg-green-50 rounded"><span class="text-green-600">‚úÖ</span><span class="text-sm">Etermin + Setting</span></div>
                            </div>
                        </div>

                        <!-- Skalierungspotentiale -->
                        <div class="vit-card p-6">
                            <h3 class="font-semibold text-gray-800 mb-4 flex items-center"><span class="w-8 h-8 bg-vit-orange text-white rounded-lg flex items-center justify-center text-sm mr-3">üöÄ</span> Skalierungspotentiale</h3>
                            <div class="space-y-3">
                                <div class="flex items-start space-x-3 p-3 bg-orange-50 rounded-lg border-l-4 border-vit-orange"><span class="font-bold text-vit-orange">1</span><div><p class="font-semibold text-sm">Individuelle Ads</p><p class="text-xs text-gray-500">Bessere Performance &amp; Authentizitaet durch lokalen Content</p></div></div>
                                <div class="flex items-start space-x-3 p-3 bg-gray-50 rounded-lg"><span class="font-bold text-gray-400">2</span><div><p class="font-semibold text-sm">Organische Platzierung</p><p class="text-xs text-gray-500">YouTube, Meta &amp; TikTok Kanaele nutzen</p></div></div>
                                <div class="flex items-start space-x-3 p-3 bg-gray-50 rounded-lg"><span class="font-bold text-gray-400">3</span><div><p class="font-semibold text-sm">Haendlerprofil schaerfen</p><p class="text-xs text-gray-500">Expertise, Marken, Kategorien klarer kommunizieren</p></div></div>
                                <div class="flex items-start space-x-3 p-3 bg-orange-50 rounded-lg border-l-4 border-vit-orange"><span class="font-bold text-vit-orange">4</span><div><p class="font-semibold text-sm">Lokale Events</p><p class="text-xs text-gray-500">Steigern Identitaet, staerken Kundenbindung, erreichen Neukunden</p></div></div>
                                <div class="flex items-start space-x-3 p-3 bg-gray-50 rounded-lg"><span class="font-bold text-gray-400">5</span><div><p class="font-semibold text-sm">Marketingmix ausbauen</p><p class="text-xs text-gray-500">Mediale Kommunikation erweitern</p></div></div>
                            </div>
                        </div>
                    </div>

                    <!-- Wissen Tab -->
                    <div id="marketingTabMktWissen" class="marketing-tab-content" style="display:none;"></div>
                </div>
                <div id="einkaufView" class="view" style="display: none;">
                    <h1 class="h1-headline text-gray-800 mb-6" data-i18n="h_purchasing">EINKAUF</h1>

                    <!-- Tab Navigation -->
                    <div class="mb-6 border-b border-gray-200">
                        <nav class="-mb-px flex space-x-8">
                            <button onclick="showEinkaufTab('lieferanten')" class="ek-tab-btn whitespace-nowrap py-4 px-1 border-b-2 border-vit-orange font-semibold text-sm text-vit-orange" data-tab="lieferanten">Lieferanten</button>
                            <button onclick="showEinkaufTab('auswertung')" class="ek-tab-btn whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-semibold text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="auswertung">Auswertung</button>
                            <button onclick="showEinkaufTab('ekStrategie')" class="ek-tab-btn whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-semibold text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="ekStrategie">üìã Strategie</button>
                            <button onclick="showEinkaufTab('ekWissen')" class="ek-tab-btn whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-semibold text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="ekWissen">üìö Wissen</button>
                        </nav>
                    </div>

                    <!-- ===== TAB 1: Lieferanten ===== -->
                    <div id="ekTabLieferanten" class="ek-tab-content">
                        <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 mb-4">
                            <div class="relative flex-1 max-w-md">
                                <input type="text" id="liefSearch" onkeyup="filterLieferanten()" placeholder="Lieferant oder Marke suchen..." class="w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-vit-orange">
                                <svg class="absolute left-3 top-3 w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
                            </div>
                            <div class="flex items-center space-x-2 flex-wrap gap-y-2">
                                <span class="text-xs text-gray-400 font-semibold mr-1">Typ:</span>
                                <button onclick="toggleLiefFilter('typ','all')" class="lief-typ-btn px-3 py-1.5 rounded-full text-xs font-semibold bg-vit-orange text-white" data-typ="all">Alle</button>
                                <button onclick="toggleLiefFilter('typ','fahrrad')" class="lief-typ-btn px-3 py-1.5 rounded-full text-xs font-semibold bg-gray-100 text-gray-600 hover:bg-gray-200" data-typ="fahrrad">Fahrrad</button>
                                <button onclick="toggleLiefFilter('typ','teile')" class="lief-typ-btn px-3 py-1.5 rounded-full text-xs font-semibold bg-gray-100 text-gray-600 hover:bg-gray-200" data-typ="teile">Teile / Komponenten</button>
                                <span class="text-gray-300 mx-1">|</span>
                                <span class="text-xs text-gray-400 font-semibold mr-1">Status:</span>
                                <button onclick="toggleLiefFilter('status','all')" class="lief-status-btn px-3 py-1.5 rounded-full text-xs font-semibold bg-vit-orange text-white" data-st="all">Alle</button>
                                <button onclick="toggleLiefFilter('status','aktiv')" class="lief-status-btn px-3 py-1.5 rounded-full text-xs font-semibold bg-gray-100 text-gray-600 hover:bg-gray-200" data-st="aktiv">Aktiv</button>
                                <button onclick="toggleLiefFilter('status','neu')" class="lief-status-btn px-3 py-1.5 rounded-full text-xs font-semibold bg-gray-100 text-gray-600 hover:bg-gray-200" data-st="neu">Neu</button>
                                <button onclick="toggleLiefFilter('status','inaktiv')" class="lief-status-btn px-3 py-1.5 rounded-full text-xs font-semibold bg-gray-100 text-gray-600 hover:bg-gray-200" data-st="inaktiv">Inaktiv</button>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4" id="lieferantenGrid"></div>
                    </div>

                    <!-- ===== TAB 2: Auswertung ===== -->
                    <div id="ekTabAuswertung" class="ek-tab-content" style="display:none;">
                        <!-- KPIs -->
                        <div class="grid grid-cols-2 lg:grid-cols-5 gap-4 mb-6">
                            <div class="vit-card p-5 text-center"><p class="text-xs text-gray-500">Einkaufsvolumen YTD</p><p class="text-2xl font-bold text-gray-800">33.580 ‚Ç¨</p><p class="text-xs text-gray-400">Jan 2026</p></div>
                            <div class="vit-card p-5 text-center"><p class="text-xs text-gray-500">√ò Rohertragsmarge</p><p class="text-2xl font-bold text-green-600">38.9%</p><p class="text-xs text-green-600">+1.6 Pp vs. VJ</p></div>
                            <div class="vit-card p-5 text-center"><p class="text-xs text-gray-500">Raeder auf Lager</p><p class="text-2xl font-bold text-gray-800">47</p><p class="text-xs text-gray-400">Lagerwert: 189.400 ‚Ç¨</p></div>
                            <div class="vit-card p-5 text-center"><p class="text-xs text-gray-500">Lagerumschlag</p><p class="text-2xl font-bold text-blue-600">4.2x</p><p class="text-xs text-green-600">Ziel: 4.0x</p></div>
                            <div class="vit-card p-5 text-center"><p class="text-xs text-gray-500">Offene Bestellungen</p><p class="text-2xl font-bold text-vit-orange">12</p><p class="text-xs text-gray-400">Wert: 58.200 ‚Ç¨</p></div>
                        </div>

                        <!-- Marge pro Marke -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                            <div class="vit-card p-6">
                                <h2 class="text-lg font-semibold text-gray-800 mb-4">Rohertragsmarge pro Marke</h2>
                                <div class="space-y-3" id="ekMargenList"></div>
                            </div>
                            <div class="vit-card p-6">
                                <h2 class="text-lg font-semibold text-gray-800 mb-4">Top & Flop Modelle (YTD)</h2>
                                <div class="mb-4">
                                    <h3 class="text-xs font-semibold text-green-600 uppercase tracking-wider mb-2">Top 5 ‚Äì Meistverkauft</h3>
                                    <div class="space-y-2" id="ekTopModelle"></div>
                                </div>
                                <div>
                                    <h3 class="text-xs font-semibold text-red-600 uppercase tracking-wider mb-2">Flop ‚Äì Ladenhueter (> 90 Tage auf Lager)</h3>
                                    <div class="space-y-2" id="ekFlopModelle"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Einkauf nach Kategorie -->
                        <div class="vit-card p-6">
                            <h2 class="text-lg font-semibold text-gray-800 mb-4">Einkaufsvolumen nach Kategorie (Jan 2026)</h2>
                            <div class="overflow-x-auto">
                                <table class="w-full text-sm">
                                    <thead><tr class="bg-gray-50"><th class="text-left py-2.5 px-3 font-semibold text-gray-600">Kategorie</th><th class="text-right py-2.5 px-3 font-semibold text-gray-600">Einkauf</th><th class="text-right py-2.5 px-3 font-semibold text-gray-600">Verkauf</th><th class="text-right py-2.5 px-3 font-semibold text-gray-600">Marge</th><th class="text-right py-2.5 px-3 font-semibold text-gray-600">Stueck</th><th class="text-right py-2.5 px-3 font-semibold text-gray-600">√ò EK/Stueck</th><th class="text-right py-2.5 px-3 font-semibold text-gray-600">Anteil</th></tr></thead>
                                    <tbody>
                                        <tr class="border-b"><td class="py-2.5 px-3 font-semibold">E-Bikes</td><td class="text-right py-2.5 px-3">24.821</td><td class="text-right py-2.5 px-3">47.380</td><td class="text-right py-2.5 px-3 text-green-600 font-semibold">47.6%</td><td class="text-right py-2.5 px-3">11</td><td class="text-right py-2.5 px-3">2.256</td><td class="text-right py-2.5 px-3 text-gray-500">73.9%</td></tr>
                                        <tr class="border-b"><td class="py-2.5 px-3 font-semibold">Teile &amp; Zubehoer</td><td class="text-right py-2.5 px-3">5.515</td><td class="text-right py-2.5 px-3">6.052</td><td class="text-right py-2.5 px-3 text-orange-600 font-semibold">8.9%</td><td class="text-right py-2.5 px-3">‚Äî</td><td class="text-right py-2.5 px-3">‚Äî</td><td class="text-right py-2.5 px-3 text-gray-500">16.4%</td></tr>
                                        <tr class="border-b"><td class="py-2.5 px-3 font-semibold">Werkstatt-Material</td><td class="text-right py-2.5 px-3">3.244</td><td class="text-right py-2.5 px-3">3.534</td><td class="text-right py-2.5 px-3 text-orange-600 font-semibold">8.2%</td><td class="text-right py-2.5 px-3">‚Äî</td><td class="text-right py-2.5 px-3">‚Äî</td><td class="text-right py-2.5 px-3 text-gray-500">9.7%</td></tr>
                                        <tr class="bg-gray-100 border-t-2"><td class="py-3 px-3 font-bold">GESAMT</td><td class="text-right py-3 px-3 font-bold">33.580</td><td class="text-right py-3 px-3 font-bold">54.938</td><td class="text-right py-3 px-3 text-green-600 font-bold">38.9%</td><td class="text-right py-3 px-3 font-bold">‚Äî</td><td class="text-right py-3 px-3 font-bold">‚Äî</td><td class="text-right py-3 px-3 font-bold">100%</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- ===== TAB 3: Einkauf Strategie ===== -->
                    <div id="ekTabEkStrategie" class="ek-tab-content" style="display:none;">
                        <div class="vit-card p-6 mb-6">
                            <div class="flex items-center justify-between mb-4">
                                <div>
                                    <h2 class="text-lg font-semibold text-gray-800">Einkaufsstrategie 2026</h2>
                                    <p class="text-sm text-gray-500">Erstellt am 15.09.2025 ¬∑ Ansprechpartner vit:bikes: Florian Meier</p>
                                </div>
                                <span class="px-3 py-1 bg-green-100 text-green-700 rounded-full text-xs font-bold">Vereinbart &amp; Unterschrieben</span>
                            </div>
                            <p class="text-sm text-gray-600">Unterschrieben von: Florian Meier, Sandra Engelmann, Sascha Matthies</p>
                        </div>

                        <!-- Ziele -->
                        <div class="vit-card p-6 mb-6">
                            <h3 class="font-semibold text-gray-800 mb-4 flex items-center"><span class="w-8 h-8 bg-vit-orange text-white rounded-lg flex items-center justify-center text-sm mr-3">üéØ</span> Strategische Ziele</h3>
                            <div class="space-y-2 mb-4">
                                <div class="flex items-center space-x-2 text-sm"><span class="text-green-600 font-bold">‚úì</span><span>Sortiment 2026 definieren &amp; Rohertrag optimieren</span></div>
                                <div class="flex items-center space-x-2 text-sm"><span class="text-green-600 font-bold">‚úì</span><span>Vororder 2026 sichern</span></div>
                                <div class="flex items-center space-x-2 text-sm"><span class="text-green-600 font-bold">‚úì</span><span>Verkaufsbereitschaft aller Bike-Kategorien sicherstellen</span></div>
                                <div class="flex items-center space-x-2 text-sm"><span class="text-green-600 font-bold">‚úì</span><span>Rabatte minimieren, Dreingaben statt Preisnachlaesse</span></div>
                            </div>
                        </div>

                        <!-- Status Quo -->
                        <div class="vit-card p-6 mb-6">
                            <h3 class="font-semibold text-gray-800 mb-4 flex items-center"><span class="w-8 h-8 bg-blue-600 text-white rounded-lg flex items-center justify-center text-sm mr-3">üì¶</span> Status Quo (Stand 15.09.2025)</h3>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                                <div class="p-4 bg-blue-50 rounded-lg text-center"><p class="text-xs text-gray-500">Bike-Bestand</p><p class="text-2xl font-bold text-blue-600">156</p><p class="text-xs text-gray-400">25 MTB ¬∑ 131 Trekking/City</p></div>
                                <div class="p-4 bg-green-50 rounded-lg text-center"><p class="text-xs text-gray-500">Gesamt-Umsatz (netto)</p><p class="text-2xl font-bold text-green-600">995.897 ‚Ç¨</p><p class="text-xs text-gray-400">262 Bikes, ‚åÄ 4.508 ‚Ç¨ DB</p></div>
                                <div class="p-4 bg-orange-50 rounded-lg text-center"><p class="text-xs text-gray-500">√ò Nachlass</p><p class="text-2xl font-bold text-vit-orange">8,70%</p><p class="text-xs text-red-500">Ziel: unter 5%</p></div>
                            </div>
                        </div>

                        <!-- Sortiment 2026 Marken -->
                        <div class="vit-card p-6 mb-6">
                            <h3 class="font-semibold text-gray-800 mb-4 flex items-center"><span class="w-8 h-8 bg-green-600 text-white rounded-lg flex items-center justify-center text-sm mr-3">üö≤</span> Sortiment 2026 ‚Äì Zielmarken</h3>
                            <div class="grid grid-cols-2 md:grid-cols-3 gap-3 mb-4">
                                <div class="p-3 bg-green-50 rounded-lg border border-green-200"><p class="font-semibold text-sm">Kalkhoff</p><p class="text-xs text-gray-500">VO: 80 Bikes ¬∑ Top-Volumen</p><p class="text-xs text-green-600">Rabatt durch 7er an Upway erhoet</p></div>
                                <div class="p-3 bg-green-50 rounded-lg border border-green-200"><p class="font-semibold text-sm">Haibike</p><p class="text-xs text-gray-500">Blockorder 30-50 eMTBs geplant</p><p class="text-xs text-yellow-600">‚ö† Konditionen wackeln</p></div>
                                <div class="p-3 bg-green-50 rounded-lg border border-green-200"><p class="font-semibold text-sm">Orbea</p><p class="text-xs text-gray-500">Hoechster DB1 im Sortiment</p><p class="text-xs text-green-600">Umsatz steigern!</p></div>
                                <div class="p-3 bg-green-50 rounded-lg border border-green-200"><p class="font-semibold text-sm">Simplon</p><p class="text-xs text-gray-500">VO: 10 Bikes (Gravel, MTB)</p><p class="text-xs text-green-600">Hoechster brutto-VK</p></div>
                                <div class="p-3 bg-blue-50 rounded-lg border border-blue-200"><p class="font-semibold text-sm">Velo de Ville</p><p class="text-xs text-gray-500">VO: 8 Bikes ¬∑ NEU im Sortiment</p><p class="text-xs text-blue-600">Alternative zu Kalkhoff/Haibike Trekking</p></div>
                                <div class="p-3 bg-blue-50 rounded-lg border border-blue-200"><p class="font-semibold text-sm">Steppenwolf</p><p class="text-xs text-gray-500">VO: 5 Bikes ¬∑ Lieferung ab Juli</p><p class="text-xs text-blue-600">Sportives DJI Sortiment</p></div>
                            </div>
                            <div class="p-3 bg-red-50 rounded-lg border border-red-200">
                                <p class="text-sm font-semibold text-red-700 mb-1">Abverkauf / Ausgelistet:</p>
                                <p class="text-xs text-gray-600">Stevens (letzte 3 abverkaufen) ¬∑ HNF Nicolai ¬∑ Raymon ¬∑ Husqvarna ‚Äì Lagerbereinigung 2025 fast abgeschlossen</p>
                            </div>
                        </div>

                        <!-- Haibike Blockorder Detail -->
                        <div class="vit-card p-6 mb-6">
                            <h3 class="font-semibold text-gray-800 mb-4 flex items-center"><span class="w-8 h-8 bg-red-600 text-white rounded-lg flex items-center justify-center text-sm mr-3">üìä</span> Haibike Verkaufszahlen (09/24‚Äì09/25)</h3>
                            <div class="overflow-x-auto">
                                <table class="w-full text-sm"><thead><tr class="border-b-2 border-gray-200"><th class="text-left py-2 px-2">Modell</th><th class="text-right py-2 px-2">Menge</th><th class="text-right py-2 px-2">Umsatz (netto)</th><th class="text-right py-2 px-2">‚åÄ Stueckpreis</th></tr></thead><tbody>
                                    <tr class="border-b bg-orange-50"><td class="py-1.5 px-2 font-semibold">ALLMTN 3</td><td class="py-1.5 px-2 text-right font-bold">12</td><td class="py-1.5 px-2 text-right">52.427 ‚Ç¨</td><td class="py-1.5 px-2 text-right">4.369 ‚Ç¨</td></tr>
                                    <tr class="border-b"><td class="py-1.5 px-2">ALLMTN 6</td><td class="py-1.5 px-2 text-right">2</td><td class="py-1.5 px-2 text-right">30.247 ‚Ç¨</td><td class="py-1.5 px-2 text-right">15.124 ‚Ç¨</td></tr>
                                    <tr class="border-b"><td class="py-1.5 px-2">ADVENTR 10</td><td class="py-1.5 px-2 text-right">5</td><td class="py-1.5 px-2 text-right">23.945 ‚Ç¨</td><td class="py-1.5 px-2 text-right">4.789 ‚Ç¨</td></tr>
                                    <tr class="border-b"><td class="py-1.5 px-2">ADVENTR 9</td><td class="py-1.5 px-2 text-right">3</td><td class="py-1.5 px-2 text-right">21.004 ‚Ç¨</td><td class="py-1.5 px-2 text-right">7.001 ‚Ç¨</td></tr>
                                    <tr class="border-b"><td class="py-1.5 px-2">ALLTRACK 7 29</td><td class="py-1.5 px-2 text-right">5</td><td class="py-1.5 px-2 text-right">16.803 ‚Ç¨</td><td class="py-1.5 px-2 text-right">3.361 ‚Ç¨</td></tr>
                                    <tr class="border-b"><td class="py-1.5 px-2">Weitere 10 Modelle</td><td class="py-1.5 px-2 text-right">18</td><td class="py-1.5 px-2 text-right">79.987 ‚Ç¨</td><td class="py-1.5 px-2 text-right text-gray-400">div.</td></tr>
                                    <tr class="border-t-2 border-gray-300 font-bold bg-gray-50"><td class="py-2 px-2">GESAMT</td><td class="py-2 px-2 text-right">45</td><td class="py-2 px-2 text-right">224.413 ‚Ç¨</td><td class="py-2 px-2 text-right">4.987 ‚Ç¨</td></tr>
                                </tbody></table>
                            </div>
                        </div>

                        <!-- ToDos -->
                        <div class="vit-card p-6">
                            <h3 class="font-semibold text-gray-800 mb-4 flex items-center"><span class="w-8 h-8 bg-purple-600 text-white rounded-lg flex items-center justify-center text-sm mr-3">üìå</span> Fortlaufende Massnahmen 2026</h3>
                            <div class="space-y-3">
                                <div class="flex items-start space-x-3 p-3 bg-orange-50 rounded-lg border-l-4 border-vit-orange"><div><p class="font-semibold text-sm">Orbea &amp; Simplon pushen</p><p class="text-xs text-gray-500">Bewusst in Beratung anbieten. Verkaeufermotivation: zum Anzuenden muss der Verkaeufer brennen!</p></div></div>
                                <div class="flex items-start space-x-3 p-3 bg-gray-50 rounded-lg"><div><p class="font-semibold text-sm">Rabatte minimieren</p><p class="text-xs text-gray-500">Woechentlich/monatlich auswerten. Tipp: 100 ‚Ç¨ Sqlab Sattel als Dreingabe statt 100 ‚Ç¨ Rabatt (nur 50 ‚Ç¨ netto Rohertrags-Verlust)</p></div></div>
                                <div class="flex items-start space-x-3 p-3 bg-gray-50 rounded-lg"><div><p class="font-semibold text-sm">Haibike Blockorder sichern</p><p class="text-xs text-gray-500">30-50 eMTBs (AllMtn, AllTrack, Adventr) mit Bosch, Liefertermine ab Maerz 2026, Valuta+Skonto bei Fruehlieferung</p></div></div>
                            </div>
                        </div>
                    </div>

                    <!-- Wissen Tab -->
                    <div id="ekTabEkWissen" class="ek-tab-content" style="display:none;"></div>
                </div>

                <div id="controllingView" class="view" style="display: none;">
                    <h1 class="h1-headline text-gray-800 mb-6" data-i18n="h_controlling">CONTROLLING</h1>
                    
                    <!-- Tab Navigation -->
                    <div class="mb-6 border-b border-gray-200">
                        <nav class="-mb-px flex space-x-8">
                            <button onclick="showControllingTab('bwa')" class="ctrl-tab-btn whitespace-nowrap py-4 px-1 border-b-2 border-vit-orange font-semibold text-sm text-vit-orange" data-tab="bwa">BWAs</button>
                            <button onclick="showControllingTab('benchmark')" class="ctrl-tab-btn whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-semibold text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="benchmark">Benchmarks</button>
                            <button onclick="showControllingTab('planist')" class="ctrl-tab-btn whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-semibold text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="planist">Plan / Ist</button>
                            <button onclick="showControllingTab('liquiditaet')" class="ctrl-tab-btn whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-semibold text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="liquiditaet">Liquiditaet</button>
                            <button onclick="showControllingTab('ctrlWissen')" class="ctrl-tab-btn whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-semibold text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="ctrlWissen">üìö Wissen</button>
                        </nav>
                    </div>

                    <!-- ===== TAB 1: BWAs ===== -->
                    <div id="ctrlTabBwa" class="ctrl-tab-content">
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            <!-- Left: BWA Ablage -->
                            <div class="lg:col-span-1">
                                <div class="vit-card p-6">
                                    <div class="flex items-center justify-between mb-4">
                                        <h2 class="text-lg font-semibold text-gray-800">BWA Ablage</h2>
                                        <button onclick="document.getElementById('bwaUploadArea').classList.toggle('hidden')" class="px-3 py-1.5 bg-vit-orange text-white text-sm rounded-lg hover:opacity-90">+ Upload</button>
                                    </div>
                                    <!-- Upload Area -->
                                    <div id="bwaUploadArea" class="hidden mb-4 p-4 border-2 border-dashed border-vit-orange rounded-lg bg-orange-50">
                                        <div class="text-center">
                                            <p class="text-3xl mb-2">üì§</p>
                                            <p class="text-sm text-gray-600 mb-2">PDF hier ablegen oder</p>
                                            <button onclick="alert('Upload-Simulation: BWA wurde hochgeladen!')" class="px-4 py-2 bg-vit-orange text-white text-sm rounded-lg hover:opacity-90">Datei auswaehlen</button>
                                            <div class="mt-3 flex space-x-2">
                                                <select class="flex-1 px-2 py-1.5 border border-gray-300 rounded text-sm">
                                                    <option>Januar</option><option>Februar</option><option>Maerz</option><option>April</option><option>Mai</option><option>Juni</option><option>Juli</option><option>August</option><option>September</option><option>Oktober</option><option>November</option><option>Dezember</option>
                                                </select>
                                                <select class="px-2 py-1.5 border border-gray-300 rounded text-sm">
                                                    <option>2026</option><option>2025</option><option>2024</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- 2026 -->
                                    <div class="mb-4">
                                        <button onclick="this.nextElementSibling.classList.toggle('hidden')" class="flex items-center justify-between w-full text-left p-2 bg-gray-100 rounded-lg hover:bg-gray-200">
                                            <span class="font-semibold text-gray-700">üìÅ 2026</span>
                                            <span class="text-gray-400 text-xs">2 Dateien</span>
                                        </button>
                                        <div class="mt-2 space-y-1">
                                            <button onclick="showBwaDetail('jan26')" class="bwa-file w-full flex items-center justify-between p-2.5 rounded-lg hover:bg-orange-50 text-left">
                                                <div class="flex items-center space-x-3">
                                                    <span class="text-red-500">üìÑ</span>
                                                    <div><p class="text-sm font-semibold text-gray-800">Januar 2026</p><p class="text-xs text-gray-500">Hochgeladen: 05.02.2026</p></div>
                                                </div>
                                                <span class="text-xs text-green-600">‚úì</span>
                                            </button>
                                            <button onclick="showBwaDetail('feb26')" class="bwa-file w-full flex items-center justify-between p-2.5 rounded-lg bg-orange-50 border border-vit-orange text-left">
                                                <div class="flex items-center space-x-3">
                                                    <span class="text-red-500">üìÑ</span>
                                                    <div><p class="text-sm font-semibold text-vit-orange">Januar 2026</p><p class="text-xs text-gray-500">Hochgeladen: 05.02.2026</p></div>
                                                </div>
                                                <span class="text-xs text-green-600">‚úì</span>
                                            </button>
                                            <div class="flex items-center p-2.5 text-gray-400"><span class="mr-3">üìÑ</span><p class="text-sm">Maerz 2026 <span class="text-xs">(ausstehend)</span></p></div>
                                        </div>
                                    </div>
                                    <!-- 2025 -->
                                    <div>
                                        <button onclick="this.nextElementSibling.classList.toggle('hidden')" class="flex items-center justify-between w-full text-left p-2 bg-gray-100 rounded-lg hover:bg-gray-200">
                                            <span class="font-semibold text-gray-700">üìÅ 2025</span>
                                            <span class="text-gray-400 text-xs">12 Dateien</span>
                                        </button>
                                        <div class="hidden mt-2 space-y-1">
                                            <button onclick="showBwaDetail('dez25')" class="bwa-file w-full flex items-center space-x-3 p-2.5 rounded-lg hover:bg-orange-50 text-left"><span class="text-red-500">üìÑ</span><div><p class="text-sm font-semibold text-gray-800">Dezember 2025</p><p class="text-xs text-gray-500">08.01.2026</p></div></button>
                                            <button onclick="showBwaDetail('nov25')" class="bwa-file w-full flex items-center space-x-3 p-2.5 rounded-lg hover:bg-orange-50 text-left"><span class="text-red-500">üìÑ</span><div><p class="text-sm font-semibold text-gray-800">November 2025</p><p class="text-xs text-gray-500">06.12.2025</p></div></button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Right: BWA Anzeige -->
                            <div class="lg:col-span-2">
                                <div class="vit-card p-6" id="bwaDisplay">
                                    <div class="flex items-center justify-between mb-4">
                                        <h2 class="text-lg font-semibold text-gray-800" id="bwaTitle">BWA Januar 2026</h2>
                                        <div class="flex space-x-2">
                                            <button class="px-3 py-1.5 text-sm border border-gray-300 rounded-lg hover:bg-gray-50">üì• PDF</button>
                                            <button class="px-3 py-1.5 text-sm border border-gray-300 rounded-lg hover:bg-gray-50">üñ® Drucken</button>
                                        </div>
                                    </div>
                                    <!-- KPI Summary -->
                                    <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                                        <div class="p-4 bg-green-50 rounded-lg text-center"><p class="text-xs text-gray-500">Umsatz</p><p class="text-xl font-bold text-gray-800" id="bwaUmsatz">142.800 ‚Ç¨</p><p class="text-xs text-green-600">+8% vs. VJ</p></div>
                                        <div class="p-4 bg-blue-50 rounded-lg text-center"><p class="text-xs text-gray-500">Rohertrag</p><p class="text-xl font-bold text-gray-800" id="bwaRohertrag">52.400 ‚Ç¨</p><p class="text-xs text-gray-500">Marge: 36.7%</p></div>
                                        <div class="p-4 bg-orange-50 rounded-lg text-center"><p class="text-xs text-gray-500">Gesamtkosten</p><p class="text-xl font-bold text-gray-800" id="bwaKosten">44.200 ‚Ç¨</p><p class="text-xs text-red-600">+3% vs. VJ</p></div>
                                        <div class="p-4 bg-purple-50 rounded-lg text-center"><p class="text-xs text-gray-500">EBIT</p><p class="text-xl font-bold text-green-600" id="bwaEbit">8.200 ‚Ç¨</p><p class="text-xs text-gray-500">Marge: 5.7%</p></div>
                                    </div>
                                    <!-- BWA Table -->
                                    <div class="overflow-x-auto">
                                        <table class="w-full text-sm">
                                            <thead><tr class="bg-gray-50"><th class="text-left py-2 px-3 font-semibold text-gray-600">Position</th><th class="text-right py-2 px-3 font-semibold text-gray-600">Jan 2026</th><th class="text-right py-2 px-3 font-semibold text-gray-600">Plan</th><th class="text-right py-2 px-3 font-semibold text-gray-600">Abweichung</th><th class="text-right py-2 px-3 font-semibold text-gray-600">VJ 2025</th></tr></thead>
                                            <tbody>
                                                <tr class="border-b"><td class="py-2 px-3 font-semibold">Umsatzerloese</td><td class="text-right py-2 px-3">54.938</td><td class="text-right py-2 px-3 text-gray-400">30.770</td><td class="text-right py-2 px-3 text-green-600 font-semibold">+24.168</td><td class="text-right py-2 px-3 text-gray-400">40.187</td></tr>
                                                <tr class="border-b"><td class="py-2 px-3 pl-6 text-gray-600">Fahrraeder 19%</td><td class="text-right py-2 px-3">47.380</td><td class="text-right py-2 px-3 text-gray-400">‚Äî</td><td class="text-right py-2 px-3">‚Äî</td><td class="text-right py-2 px-3 text-gray-400">‚Äî</td></tr>
                                                <tr class="border-b"><td class="py-2 px-3 pl-6 text-gray-600">Teile &amp; Zubehoer</td><td class="text-right py-2 px-3">6.052</td><td class="text-right py-2 px-3 text-gray-400">‚Äî</td><td class="text-right py-2 px-3">‚Äî</td><td class="text-right py-2 px-3 text-gray-400">‚Äî</td></tr>
                                                <tr class="border-b"><td class="py-2 px-3 pl-6 text-gray-600">Service / Reparatur</td><td class="text-right py-2 px-3">3.534</td><td class="text-right py-2 px-3 text-gray-400">‚Äî</td><td class="text-right py-2 px-3">‚Äî</td><td class="text-right py-2 px-3 text-gray-400">‚Äî</td></tr>
                                                <tr class="border-b"><td class="py-2 px-3 pl-6 text-gray-600">Skonti</td><td class="text-right py-2 px-3 text-red-600">-2.028</td><td class="text-right py-2 px-3 text-gray-400">‚Äî</td><td class="text-right py-2 px-3">‚Äî</td><td class="text-right py-2 px-3 text-gray-400">‚Äî</td></tr>
                                                <tr class="border-b bg-gray-50"><td class="py-2 px-3 font-semibold">Wareneinsatz</td><td class="text-right py-2 px-3 text-red-600">-33.580</td><td class="text-right py-2 px-3 text-gray-400">-18.645</td><td class="text-right py-2 px-3 text-red-600">-14.935</td><td class="text-right py-2 px-3 text-gray-400">-25.203</td></tr>
                                                <tr class="border-b-2 border-gray-800 bg-blue-50"><td class="py-2.5 px-3 font-bold text-blue-800">Rohertrag</td><td class="text-right py-2.5 px-3 font-bold text-blue-800">21.357</td><td class="text-right py-2.5 px-3 font-bold">12.125</td><td class="text-right py-2.5 px-3 font-bold text-green-600">+9.232</td><td class="text-right py-2.5 px-3 text-gray-500 font-semibold">14.984</td></tr>
                                                <tr class="border-b"><td class="py-2 px-3 font-semibold">Personalkosten</td><td class="text-right py-2 px-3 text-red-600">-13.485</td><td class="text-right py-2 px-3 text-gray-400">-12.202</td><td class="text-right py-2 px-3 text-red-600">-1.283</td><td class="text-right py-2 px-3 text-gray-400">-6.845</td></tr>
                                                <tr class="border-b"><td class="py-2 px-3 font-semibold">Raumkosten</td><td class="text-right py-2 px-3 text-red-600">-4.150</td><td class="text-right py-2 px-3 text-gray-400">-4.195</td><td class="text-right py-2 px-3 text-green-600">+45</td><td class="text-right py-2 px-3 text-gray-400">-4.195</td></tr>
                                                <tr class="border-b"><td class="py-2 px-3 font-semibold">Werbe-/Reisekosten</td><td class="text-right py-2 px-3 text-red-600">-2.039</td><td class="text-right py-2 px-3 text-gray-400">-635</td><td class="text-right py-2 px-3 text-red-600">-1.404</td><td class="text-right py-2 px-3 text-gray-400">-3.162</td></tr>
                                                <tr class="border-b"><td class="py-2 px-3 font-semibold">Kosten Warenabgabe</td><td class="text-right py-2 px-3 text-red-600">-1.605</td><td class="text-right py-2 px-3 text-gray-400">-615</td><td class="text-right py-2 px-3 text-red-600">-990</td><td class="text-right py-2 px-3 text-gray-400">-804</td></tr>
                                                <tr class="border-b"><td class="py-2 px-3 font-semibold">Abschreibungen</td><td class="text-right py-2 px-3 text-red-600">-1.567</td><td class="text-right py-2 px-3 text-gray-400">-1.522</td><td class="text-right py-2 px-3 text-red-600">-45</td><td class="text-right py-2 px-3 text-gray-400">-1.522</td></tr>
                                                <tr class="border-b"><td class="py-2 px-3 font-semibold">Sonstige Kosten</td><td class="text-right py-2 px-3 text-red-600">-2.496</td><td class="text-right py-2 px-3 text-gray-400">-2.473</td><td class="text-right py-2 px-3 text-red-600">-23</td><td class="text-right py-2 px-3 text-gray-400">-2.473</td></tr>
                                                <tr class="bg-gray-50 border-t-2"><td class="py-2.5 px-3 font-bold">Gesamtkosten</td><td class="text-right py-2.5 px-3 font-bold text-red-600">-25.342</td><td class="text-right py-2.5 px-3 font-bold text-gray-500">-21.067</td><td class="text-right py-2.5 px-3 font-bold text-red-600">-4.275</td><td class="text-right py-2.5 px-3 text-gray-500 font-semibold">-21.067</td></tr>
                                                <tr class="border-b"><td class="py-2 px-3 font-semibold">Betriebsergebnis</td><td class="text-right py-2 px-3 font-bold text-red-600">-3.935</td><td class="text-right py-2 px-3 text-gray-400">-6.083</td><td class="text-right py-2 px-3 text-green-600 font-semibold">+2.148</td><td class="text-right py-2 px-3 text-gray-400">-6.083</td></tr>
                                                <tr class="border-b"><td class="py-2 px-3 font-semibold">Zinsaufwand</td><td class="text-right py-2 px-3 text-red-600">-550</td><td class="text-right py-2 px-3 text-gray-400">-1.151</td><td class="text-right py-2 px-3 text-green-600">+601</td><td class="text-right py-2 px-3 text-gray-400">-1.151</td></tr>
                                                <tr class="bg-red-50 border-t-2 border-gray-800"><td class="py-3 px-3 font-bold text-red-800 text-base">Ergebnis vor Steuern</td><td class="text-right py-3 px-3 font-bold text-red-800 text-base">-4.485</td><td class="text-right py-3 px-3 font-bold text-gray-500">-7.006</td><td class="text-right py-3 px-3 font-bold text-green-600 text-base">+2.521</td><td class="text-right py-3 px-3 text-gray-500 font-semibold">-7.006</td></tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ===== TAB 2: Benchmarks ===== -->
                    <div id="ctrlTabBenchmark" class="ctrl-tab-content" style="display:none;">
                        <div class="vit-card p-6">
                            <h2 class="text-lg font-semibold text-gray-800 mb-2">Standort-Vergleich</h2>
                            <p class="text-sm text-gray-500 mb-6">Dein Standort vs. Netzwerk-Durchschnitt (Februar 2026)</p>
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                <div class="p-5 border border-gray-200 rounded-xl">
                                    <p class="text-sm text-gray-500 mb-1">Umsatz / m¬≤</p>
                                    <div class="flex items-end justify-between"><div><p class="text-2xl font-bold text-green-600">428 ‚Ç¨</p><p class="text-xs text-gray-500">Dein Standort</p></div><div class="text-right"><p class="text-lg font-semibold text-gray-400">382 ‚Ç¨</p><p class="text-xs text-gray-400">Netzwerk √∏</p></div></div>
                                    <div class="mt-3 bg-gray-200 rounded-full h-2.5"><div class="bg-green-500 h-2.5 rounded-full" style="width:85%"></div></div>
                                    <p class="text-xs text-green-600 mt-1 font-semibold">+12% ueber Durchschnitt</p>
                                </div>
                                <div class="p-5 border border-gray-200 rounded-xl">
                                    <p class="text-sm text-gray-500 mb-1">Rohertragsmarge</p>
                                    <div class="flex items-end justify-between"><div><p class="text-2xl font-bold text-green-600">36.7%</p><p class="text-xs text-gray-500">Dein Standort</p></div><div class="text-right"><p class="text-lg font-semibold text-gray-400">34.2%</p><p class="text-xs text-gray-400">Netzwerk √∏</p></div></div>
                                    <div class="mt-3 bg-gray-200 rounded-full h-2.5"><div class="bg-green-500 h-2.5 rounded-full" style="width:78%"></div></div>
                                    <p class="text-xs text-green-600 mt-1 font-semibold">+2.5 Pp ueber Durchschnitt</p>
                                </div>
                                <div class="p-5 border border-gray-200 rounded-xl">
                                    <p class="text-sm text-gray-500 mb-1">Umsatz / Mitarbeiter</p>
                                    <div class="flex items-end justify-between"><div><p class="text-2xl font-bold text-orange-500">28.560 ‚Ç¨</p><p class="text-xs text-gray-500">Dein Standort</p></div><div class="text-right"><p class="text-lg font-semibold text-gray-400">30.100 ‚Ç¨</p><p class="text-xs text-gray-400">Netzwerk √∏</p></div></div>
                                    <div class="mt-3 bg-gray-200 rounded-full h-2.5"><div class="bg-orange-400 h-2.5 rounded-full" style="width:65%"></div></div>
                                    <p class="text-xs text-orange-600 mt-1 font-semibold">-5% unter Durchschnitt</p>
                                </div>
                                <div class="p-5 border border-gray-200 rounded-xl">
                                    <p class="text-sm text-gray-500 mb-1">Personalkostenquote</p>
                                    <div class="flex items-end justify-between"><div><p class="text-2xl font-bold text-red-500">19.9%</p><p class="text-xs text-gray-500">Dein Standort</p></div><div class="text-right"><p class="text-lg font-semibold text-gray-400">18.5%</p><p class="text-xs text-gray-400">Netzwerk √∏</p></div></div>
                                    <div class="mt-3 bg-gray-200 rounded-full h-2.5"><div class="bg-red-400 h-2.5 rounded-full" style="width:72%"></div></div>
                                    <p class="text-xs text-red-600 mt-1 font-semibold">+1.4 Pp ueber Durchschnitt</p>
                                </div>
                                <div class="p-5 border border-gray-200 rounded-xl">
                                    <p class="text-sm text-gray-500 mb-1">Lagerumschlag</p>
                                    <div class="flex items-end justify-between"><div><p class="text-2xl font-bold text-green-600">4.2x</p><p class="text-xs text-gray-500">Dein Standort</p></div><div class="text-right"><p class="text-lg font-semibold text-gray-400">3.8x</p><p class="text-xs text-gray-400">Netzwerk √∏</p></div></div>
                                    <div class="mt-3 bg-gray-200 rounded-full h-2.5"><div class="bg-green-500 h-2.5 rounded-full" style="width:82%"></div></div>
                                    <p class="text-xs text-green-600 mt-1 font-semibold">+11% ueber Durchschnitt</p>
                                </div>
                                <div class="p-5 border border-gray-200 rounded-xl">
                                    <p class="text-sm text-gray-500 mb-1">Werkstatt-Auslastung</p>
                                    <div class="flex items-end justify-between"><div><p class="text-2xl font-bold text-green-600">78%</p><p class="text-xs text-gray-500">Dein Standort</p></div><div class="text-right"><p class="text-lg font-semibold text-gray-400">72%</p><p class="text-xs text-gray-400">Netzwerk √∏</p></div></div>
                                    <div class="mt-3 bg-gray-200 rounded-full h-2.5"><div class="bg-green-500 h-2.5 rounded-full" style="width:78%"></div></div>
                                    <p class="text-xs text-green-600 mt-1 font-semibold">+6 Pp ueber Durchschnitt</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ===== TAB 3: Plan / Ist ===== -->
                    <!-- ===== TAB 3: Plan / Ist ===== -->
                    <div id="ctrlTabPlanist" class="ctrl-tab-content" style="display:none;">
                        <!-- KPI Summary -->
                        <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                            <div class="vit-card p-5 text-center"><p class="text-xs text-gray-500">Umsatz Plan Jan</p><p class="text-2xl font-bold text-gray-800">30.770 ‚Ç¨</p></div>
                            <div class="vit-card p-5 text-center"><p class="text-xs text-gray-500">Umsatz Ist Jan</p><p class="text-2xl font-bold text-green-600">54.938 ‚Ç¨</p><p class="text-xs text-green-600">+79% vs. Plan</p></div>
                            <div class="vit-card p-5 text-center"><p class="text-xs text-gray-500">Ergebnis Plan</p><p class="text-2xl font-bold text-red-500">-7.006 ‚Ç¨</p></div>
                            <div class="vit-card p-5 text-center"><p class="text-xs text-gray-500">Ergebnis Ist</p><p class="text-2xl font-bold text-red-500">-4.485 ‚Ç¨</p><p class="text-xs text-green-600">+2.521 ‚Ç¨ besser</p></div>
                        </div>

                        <!-- Full BWA Plan vs Ist Table -->
                        <div class="vit-card p-6 mb-6">
                            <div class="flex items-center justify-between mb-4">
                                <h2 class="text-lg font-semibold text-gray-800">Plan / Ist BWA ‚Äì Januar 2026</h2>
                                <select class="px-3 py-1.5 border border-gray-300 rounded-lg text-sm">
                                    <option selected>Januar 2026</option>
                                    <option disabled>Februar 2026 (ausstehend)</option>
                                </select>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="w-full text-sm">
                                    <thead>
                                        <tr class="bg-gray-50">
                                            <th class="text-left py-2.5 px-3 font-semibold text-gray-600 w-1/4">Position</th>
                                            <th class="text-right py-2.5 px-3 font-semibold text-blue-600">Plan</th>
                                            <th class="text-right py-2.5 px-3 font-semibold text-vit-orange">Ist (BWA)</th>
                                            <th class="text-right py-2.5 px-3 font-semibold text-gray-600">Abweichung</th>
                                            <th class="text-right py-2.5 px-3 font-semibold text-gray-600">%</th>
                                            <th class="text-right py-2.5 px-3 font-semibold text-gray-400">VJ 2025</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Umsatz Block -->
                                        <tr class="border-b">
                                            <td class="py-2.5 px-3 font-bold text-gray-800">Umsatzerloese</td>
                                            <td class="text-right py-2.5 px-3 text-blue-600">30.770</td>
                                            <td class="text-right py-2.5 px-3 font-bold text-vit-orange">54.938</td>
                                            <td class="text-right py-2.5 px-3 text-green-600 font-semibold">+24.168</td>
                                            <td class="text-right py-2.5 px-3 text-green-600">179%</td>
                                            <td class="text-right py-2.5 px-3 text-gray-400">40.187</td>
                                        </tr>
                                        <tr class="border-b">
                                            <td class="py-2 px-3 pl-6 text-gray-500 text-xs">davon Fahrraeder 19%</td>
                                            <td class="text-right py-2 px-3 text-gray-400 text-xs">‚Äî</td>
                                            <td class="text-right py-2 px-3 text-xs">47.380</td>
                                            <td class="text-right py-2 px-3 text-xs text-gray-400">‚Äî</td>
                                            <td class="text-right py-2 px-3 text-xs text-gray-400">‚Äî</td>
                                            <td class="text-right py-2 px-3 text-gray-300 text-xs">‚Äî</td>
                                        </tr>
                                        <tr class="border-b">
                                            <td class="py-2 px-3 pl-6 text-gray-500 text-xs">davon Teile &amp; Zubehoer</td>
                                            <td class="text-right py-2 px-3 text-gray-400 text-xs">‚Äî</td>
                                            <td class="text-right py-2 px-3 text-xs">6.052</td>
                                            <td class="text-right py-2 px-3 text-xs text-gray-400">‚Äî</td>
                                            <td class="text-right py-2 px-3 text-xs text-gray-400">‚Äî</td>
                                            <td class="text-right py-2 px-3 text-gray-300 text-xs">‚Äî</td>
                                        </tr>
                                        <tr class="border-b">
                                            <td class="py-2 px-3 pl-6 text-gray-500 text-xs">davon Service / Reparatur</td>
                                            <td class="text-right py-2 px-3 text-gray-400 text-xs">‚Äî</td>
                                            <td class="text-right py-2 px-3 text-xs">3.534</td>
                                            <td class="text-right py-2 px-3 text-xs text-gray-400">‚Äî</td>
                                            <td class="text-right py-2 px-3 text-xs text-gray-400">‚Äî</td>
                                            <td class="text-right py-2 px-3 text-gray-300 text-xs">‚Äî</td>
                                        </tr>
                                        <tr class="border-b">
                                            <td class="py-2 px-3 pl-6 text-gray-500 text-xs">davon Skonti</td>
                                            <td class="text-right py-2 px-3 text-gray-400 text-xs">‚Äî</td>
                                            <td class="text-right py-2 px-3 text-xs text-red-400">-2.028</td>
                                            <td class="text-right py-2 px-3 text-xs text-gray-400">‚Äî</td>
                                            <td class="text-right py-2 px-3 text-xs text-gray-400">‚Äî</td>
                                            <td class="text-right py-2 px-3 text-gray-300 text-xs">‚Äî</td>
                                        </tr>

                                        <!-- Wareneinsatz -->
                                        <tr class="border-b bg-gray-50">
                                            <td class="py-2.5 px-3 font-bold text-gray-800">Material-/Wareneinsatz</td>
                                            <td class="text-right py-2.5 px-3 text-blue-600">-18.645</td>
                                            <td class="text-right py-2.5 px-3 font-bold text-red-600">-33.580</td>
                                            <td class="text-right py-2.5 px-3 text-red-600 font-semibold">-14.935</td>
                                            <td class="text-right py-2.5 px-3 text-red-600">180%</td>
                                            <td class="text-right py-2.5 px-3 text-gray-400">-25.203</td>
                                        </tr>

                                        <!-- Rohertrag -->
                                        <tr class="border-b-2 border-gray-800 bg-blue-50">
                                            <td class="py-3 px-3 font-bold text-blue-800 text-base">Rohertrag</td>
                                            <td class="text-right py-3 px-3 font-bold text-blue-600">12.125</td>
                                            <td class="text-right py-3 px-3 font-bold text-blue-800 text-base">21.357</td>
                                            <td class="text-right py-3 px-3 text-green-600 font-bold">+9.232</td>
                                            <td class="text-right py-3 px-3 text-green-600 font-bold">176%</td>
                                            <td class="text-right py-3 px-3 text-gray-500 font-semibold">14.984</td>
                                        </tr>
                                        <tr class="border-b">
                                            <td class="py-2 px-3 pl-6 text-gray-500 text-xs">Rohertragsmarge</td>
                                            <td class="text-right py-2 px-3 text-blue-500 text-xs">39.4%</td>
                                            <td class="text-right py-2 px-3 text-xs font-semibold">38.9%</td>
                                            <td class="text-right py-2 px-3 text-xs text-red-500">-0.5 Pp</td>
                                            <td class="text-right py-2 px-3 text-xs text-gray-400">‚Äî</td>
                                            <td class="text-right py-2 px-3 text-gray-300 text-xs">37.3%</td>
                                        </tr>

                                        <!-- So. betr. Erl√∂se -->
                                        <tr class="border-b">
                                            <td class="py-2 px-3 text-gray-600">So. betr. Erloese</td>
                                            <td class="text-right py-2 px-3 text-blue-500">0</td>
                                            <td class="text-right py-2 px-3">50</td>
                                            <td class="text-right py-2 px-3 text-green-600">+50</td>
                                            <td class="text-right py-2 px-3 text-gray-400">‚Äî</td>
                                            <td class="text-right py-2 px-3 text-gray-400">0</td>
                                        </tr>

                                        <!-- Kostenarten Header -->
                                        <tr class="bg-gray-100"><td colspan="6" class="py-2 px-3 font-semibold text-gray-500 text-xs uppercase tracking-wider">Kostenarten</td></tr>

                                        <!-- Personalkosten -->
                                        <tr class="border-b">
                                            <td class="py-2.5 px-3 font-semibold text-gray-800">Personalkosten</td>
                                            <td class="text-right py-2.5 px-3 text-blue-600">-12.202</td>
                                            <td class="text-right py-2.5 px-3 text-red-600">-13.485</td>
                                            <td class="text-right py-2.5 px-3 text-red-600 font-semibold">-1.283</td>
                                            <td class="text-right py-2.5 px-3 text-red-600">111%</td>
                                            <td class="text-right py-2.5 px-3 text-gray-400">-6.845</td>
                                        </tr>
                                        <tr class="border-b">
                                            <td class="py-2 px-3 pl-6 text-gray-500 text-xs">davon Gehaelter</td>
                                            <td class="text-right py-2 px-3 text-gray-400 text-xs">-5.474</td>
                                            <td class="text-right py-2 px-3 text-xs">-6.234</td>
                                            <td class="text-right py-2 px-3 text-xs text-red-500">-760</td>
                                            <td class="text-right py-2 px-3 text-xs text-gray-400">‚Äî</td>
                                            <td class="text-right py-2 px-3 text-gray-300 text-xs">‚Äî</td>
                                        </tr>
                                        <tr class="border-b">
                                            <td class="py-2 px-3 pl-6 text-gray-500 text-xs">davon GF-Gehalt</td>
                                            <td class="text-right py-2 px-3 text-gray-400 text-xs">-5.000</td>
                                            <td class="text-right py-2 px-3 text-xs">-5.500</td>
                                            <td class="text-right py-2 px-3 text-xs text-red-500">-500</td>
                                            <td class="text-right py-2 px-3 text-xs text-gray-400">‚Äî</td>
                                            <td class="text-right py-2 px-3 text-gray-300 text-xs">‚Äî</td>
                                        </tr>
                                        <tr class="border-b">
                                            <td class="py-2 px-3 pl-6 text-gray-500 text-xs">davon Sozialaufwand</td>
                                            <td class="text-right py-2 px-3 text-gray-400 text-xs">-1.204</td>
                                            <td class="text-right py-2 px-3 text-xs">-1.606</td>
                                            <td class="text-right py-2 px-3 text-xs text-red-500">-402</td>
                                            <td class="text-right py-2 px-3 text-xs text-gray-400">‚Äî</td>
                                            <td class="text-right py-2 px-3 text-gray-300 text-xs">‚Äî</td>
                                        </tr>

                                        <!-- Raumkosten -->
                                        <tr class="border-b">
                                            <td class="py-2.5 px-3 font-semibold text-gray-800">Raumkosten</td>
                                            <td class="text-right py-2.5 px-3 text-blue-600">-4.195</td>
                                            <td class="text-right py-2.5 px-3 text-red-600">-4.150</td>
                                            <td class="text-right py-2.5 px-3 text-green-600">+45</td>
                                            <td class="text-right py-2.5 px-3 text-green-600">99%</td>
                                            <td class="text-right py-2.5 px-3 text-gray-400">-4.195</td>
                                        </tr>

                                        <!-- Versicherungen -->
                                        <tr class="border-b">
                                            <td class="py-2.5 px-3 font-semibold text-gray-800">Versicherungen / Beitraege</td>
                                            <td class="text-right py-2.5 px-3 text-blue-600">-638</td>
                                            <td class="text-right py-2.5 px-3 text-red-600">-657</td>
                                            <td class="text-right py-2.5 px-3 text-red-600">-19</td>
                                            <td class="text-right py-2.5 px-3 text-red-600">103%</td>
                                            <td class="text-right py-2.5 px-3 text-gray-400">-340</td>
                                        </tr>

                                        <!-- Fahrzeugkosten -->
                                        <tr class="border-b">
                                            <td class="py-2.5 px-3 font-semibold text-gray-800">Fahrzeugkosten</td>
                                            <td class="text-right py-2.5 px-3 text-blue-600">-401</td>
                                            <td class="text-right py-2.5 px-3 text-red-600">-525</td>
                                            <td class="text-right py-2.5 px-3 text-red-600">-124</td>
                                            <td class="text-right py-2.5 px-3 text-red-600">131%</td>
                                            <td class="text-right py-2.5 px-3 text-gray-400">-401</td>
                                        </tr>

                                        <!-- Werbe-/Reisekosten -->
                                        <tr class="border-b">
                                            <td class="py-2.5 px-3 font-semibold text-gray-800">Werbe- / Reisekosten</td>
                                            <td class="text-right py-2.5 px-3 text-blue-600">-635</td>
                                            <td class="text-right py-2.5 px-3 text-red-600">-2.039</td>
                                            <td class="text-right py-2.5 px-3 text-red-600 font-semibold">-1.404</td>
                                            <td class="text-right py-2.5 px-3 text-red-600 font-semibold">321%</td>
                                            <td class="text-right py-2.5 px-3 text-gray-400">-3.162</td>
                                        </tr>

                                        <!-- Kosten Warenabgabe -->
                                        <tr class="border-b">
                                            <td class="py-2.5 px-3 font-semibold text-gray-800">Kosten Warenabgabe</td>
                                            <td class="text-right py-2.5 px-3 text-blue-600">-615</td>
                                            <td class="text-right py-2.5 px-3 text-red-600">-1.605</td>
                                            <td class="text-right py-2.5 px-3 text-red-600 font-semibold">-990</td>
                                            <td class="text-right py-2.5 px-3 text-red-600">261%</td>
                                            <td class="text-right py-2.5 px-3 text-gray-400">-804</td>
                                        </tr>

                                        <!-- Abschreibungen -->
                                        <tr class="border-b">
                                            <td class="py-2.5 px-3 font-semibold text-gray-800">Abschreibungen</td>
                                            <td class="text-right py-2.5 px-3 text-blue-600">-1.522</td>
                                            <td class="text-right py-2.5 px-3 text-red-600">-1.567</td>
                                            <td class="text-right py-2.5 px-3 text-red-600">-45</td>
                                            <td class="text-right py-2.5 px-3 text-red-600">103%</td>
                                            <td class="text-right py-2.5 px-3 text-gray-400">-1.522</td>
                                        </tr>

                                        <!-- Reparatur/Instandhaltung -->
                                        <tr class="border-b">
                                            <td class="py-2.5 px-3 font-semibold text-gray-800">Reparatur / Instandhaltung</td>
                                            <td class="text-right py-2.5 px-3 text-blue-600">0</td>
                                            <td class="text-right py-2.5 px-3 text-red-600">-1.254</td>
                                            <td class="text-right py-2.5 px-3 text-red-600 font-semibold">-1.254</td>
                                            <td class="text-right py-2.5 px-3 text-red-600">‚Äî</td>
                                            <td class="text-right py-2.5 px-3 text-gray-400">-1.325</td>
                                        </tr>

                                        <!-- Sonstige Kosten -->
                                        <tr class="border-b">
                                            <td class="py-2.5 px-3 font-semibold text-gray-800">Sonstige Kosten</td>
                                            <td class="text-right py-2.5 px-3 text-blue-600">-2.473</td>
                                            <td class="text-right py-2.5 px-3 text-red-600">-61</td>
                                            <td class="text-right py-2.5 px-3 text-green-600 font-semibold">+2.412</td>
                                            <td class="text-right py-2.5 px-3 text-green-600">2%</td>
                                            <td class="text-right py-2.5 px-3 text-gray-400">-2.473</td>
                                        </tr>

                                        <!-- Gesamtkosten -->
                                        <tr class="bg-gray-100 border-t-2">
                                            <td class="py-3 px-3 font-bold text-gray-800">Gesamtkosten</td>
                                            <td class="text-right py-3 px-3 font-bold text-blue-600">-21.067</td>
                                            <td class="text-right py-3 px-3 font-bold text-red-600">-25.342</td>
                                            <td class="text-right py-3 px-3 text-red-600 font-bold">-4.275</td>
                                            <td class="text-right py-3 px-3 text-red-600 font-bold">120%</td>
                                            <td class="text-right py-3 px-3 text-gray-500 font-semibold">-21.067</td>
                                        </tr>

                                        <tr><td colspan="6" class="py-1"></td></tr>

                                        <!-- Betriebsergebnis -->
                                        <tr class="border-b-2 border-gray-600 bg-yellow-50">
                                            <td class="py-3 px-3 font-bold text-gray-800 text-base">Betriebsergebnis</td>
                                            <td class="text-right py-3 px-3 font-bold text-blue-600">-6.083</td>
                                            <td class="text-right py-3 px-3 font-bold text-red-600 text-base">-3.935</td>
                                            <td class="text-right py-3 px-3 text-green-600 font-bold">+2.148</td>
                                            <td class="text-right py-3 px-3 text-green-600 font-bold">‚Äî</td>
                                            <td class="text-right py-3 px-3 text-gray-500 font-semibold">-6.083</td>
                                        </tr>

                                        <!-- Zinsen -->
                                        <tr class="border-b">
                                            <td class="py-2.5 px-3 font-semibold text-gray-800">Zinsaufwand</td>
                                            <td class="text-right py-2.5 px-3 text-blue-600">-1.151</td>
                                            <td class="text-right py-2.5 px-3 text-red-600">-550</td>
                                            <td class="text-right py-2.5 px-3 text-green-600">+601</td>
                                            <td class="text-right py-2.5 px-3 text-green-600">48%</td>
                                            <td class="text-right py-2.5 px-3 text-gray-400">-1.151</td>
                                        </tr>
                                        <tr class="border-b">
                                            <td class="py-2.5 px-3 text-gray-600">Neutraler Ertrag</td>
                                            <td class="text-right py-2.5 px-3 text-blue-600">+229</td>
                                            <td class="text-right py-2.5 px-3">0</td>
                                            <td class="text-right py-2.5 px-3 text-red-600">-229</td>
                                            <td class="text-right py-2.5 px-3 text-gray-400">‚Äî</td>
                                            <td class="text-right py-2.5 px-3 text-gray-400">+229</td>
                                        </tr>

                                        <!-- Vorsteuerergebnis -->
                                        <tr class="bg-red-50 border-t-2 border-gray-800">
                                            <td class="py-3 px-3 font-bold text-red-800 text-base">Ergebnis vor Steuern</td>
                                            <td class="text-right py-3 px-3 font-bold text-blue-700">-7.006</td>
                                            <td class="text-right py-3 px-3 font-bold text-red-800 text-base">-4.485</td>
                                            <td class="text-right py-3 px-3 text-green-600 font-bold text-base">+2.521</td>
                                            <td class="text-right py-3 px-3 text-green-600 font-bold">‚Äî</td>
                                            <td class="text-right py-3 px-3 text-gray-500 font-semibold">-7.006</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Monthly Umsatz Plan Overview -->
                        <div class="vit-card p-6">
                            <h2 class="text-lg font-semibold text-gray-800 mb-4">Umsatz-Plan 2026 (monatlich)</h2>
                            <div class="overflow-x-auto">
                                <table class="w-full text-sm">
                                    <thead><tr class="bg-gray-50"><th class="text-left py-2.5 px-3 font-semibold text-gray-600">Monat</th><th class="text-right py-2.5 px-3 font-semibold text-blue-600">Plan</th><th class="text-right py-2.5 px-3 font-semibold text-vit-orange">Ist</th><th class="text-right py-2.5 px-3 font-semibold text-gray-600">Abweichung</th><th class="text-right py-2.5 px-3 font-semibold text-gray-600">Erfuellung</th><th class="text-center py-2.5 px-3 font-semibold text-gray-600">Status</th></tr></thead>
                                    <tbody>
                                        <tr class="border-b bg-green-50 border-l-4 border-green-400"><td class="py-2.5 px-3 font-semibold">Januar</td><td class="text-right py-2.5 px-3 text-blue-600">30.770</td><td class="text-right py-2.5 px-3 font-bold text-vit-orange">54.938</td><td class="text-right py-2.5 px-3 text-green-600 font-semibold">+24.168</td><td class="text-right py-2.5 px-3 text-green-600 font-bold">179%</td><td class="text-center">üü¢</td></tr>
                                        <tr class="border-b text-gray-400"><td class="py-2.5 px-3">Februar</td><td class="text-right py-2.5 px-3">98.392</td><td class="text-right py-2.5 px-3">‚Äî</td><td class="text-right py-2.5 px-3">‚Äî</td><td class="text-right py-2.5 px-3">‚Äî</td><td class="text-center">‚è≥</td></tr>
                                        <tr class="border-b text-gray-400"><td class="py-2.5 px-3">Maerz</td><td class="text-right py-2.5 px-3">102.787</td><td class="text-right py-2.5 px-3">‚Äî</td><td class="text-right py-2.5 px-3">‚Äî</td><td class="text-right py-2.5 px-3">‚Äî</td><td class="text-center">‚è≥</td></tr>
                                        <tr class="border-b text-gray-400"><td class="py-2.5 px-3">April</td><td class="text-right py-2.5 px-3">144.138</td><td class="text-right py-2.5 px-3">‚Äî</td><td class="text-right py-2.5 px-3">‚Äî</td><td class="text-right py-2.5 px-3">‚Äî</td><td class="text-center">‚è≥</td></tr>
                                        <tr class="border-b text-gray-400"><td class="py-2.5 px-3">Mai</td><td class="text-right py-2.5 px-3">174.146</td><td class="text-right py-2.5 px-3">‚Äî</td><td class="text-right py-2.5 px-3">‚Äî</td><td class="text-right py-2.5 px-3">‚Äî</td><td class="text-center">‚è≥</td></tr>
                                        <tr class="border-b text-gray-400"><td class="py-2.5 px-3">Juni</td><td class="text-right py-2.5 px-3">136.055</td><td class="text-right py-2.5 px-3">‚Äî</td><td class="text-right py-2.5 px-3">‚Äî</td><td class="text-right py-2.5 px-3">‚Äî</td><td class="text-center">‚è≥</td></tr>
                                        <tr class="border-b text-gray-400"><td class="py-2.5 px-3">Juli</td><td class="text-right py-2.5 px-3">173.743</td><td class="text-right py-2.5 px-3">‚Äî</td><td class="text-right py-2.5 px-3">‚Äî</td><td class="text-right py-2.5 px-3">‚Äî</td><td class="text-center">‚è≥</td></tr>
                                        <tr class="border-b text-gray-400"><td class="py-2.5 px-3">August</td><td class="text-right py-2.5 px-3">57.120</td><td class="text-right py-2.5 px-3">‚Äî</td><td class="text-right py-2.5 px-3">‚Äî</td><td class="text-right py-2.5 px-3">‚Äî</td><td class="text-center">‚è≥</td></tr>
                                        <tr class="border-b text-gray-400"><td class="py-2.5 px-3">September</td><td class="text-right py-2.5 px-3">38.214</td><td class="text-right py-2.5 px-3">‚Äî</td><td class="text-right py-2.5 px-3">‚Äî</td><td class="text-right py-2.5 px-3">‚Äî</td><td class="text-center">‚è≥</td></tr>
                                        <tr class="border-b text-gray-400"><td class="py-2.5 px-3">Oktober</td><td class="text-right py-2.5 px-3">80.711</td><td class="text-right py-2.5 px-3">‚Äî</td><td class="text-right py-2.5 px-3">‚Äî</td><td class="text-right py-2.5 px-3">‚Äî</td><td class="text-center">‚è≥</td></tr>
                                        <tr class="border-b text-gray-400"><td class="py-2.5 px-3">November</td><td class="text-right py-2.5 px-3">41.252</td><td class="text-right py-2.5 px-3">‚Äî</td><td class="text-right py-2.5 px-3">‚Äî</td><td class="text-right py-2.5 px-3">‚Äî</td><td class="text-center">‚è≥</td></tr>
                                        <tr class="border-b text-gray-400"><td class="py-2.5 px-3">Dezember</td><td class="text-right py-2.5 px-3">25.110</td><td class="text-right py-2.5 px-3">‚Äî</td><td class="text-right py-2.5 px-3">‚Äî</td><td class="text-right py-2.5 px-3">‚Äî</td><td class="text-center">‚è≥</td></tr>
                                        <tr class="bg-gray-100 border-t-2"><td class="py-3 px-3 font-bold">GESAMT 2026</td><td class="text-right py-3 px-3 font-bold text-blue-600">1.102.438</td><td class="text-right py-3 px-3 font-bold text-vit-orange">54.938</td><td class="text-right py-3 px-3 font-bold text-green-600">+24.168</td><td class="text-right py-3 px-3 font-bold">5%</td><td class="text-center">üìä</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>


                    <!-- ===== TAB 4: Liquiditaet ===== -->
                    <div id="ctrlTabLiquiditaet" class="ctrl-tab-content" style="display:none;">
                        <!-- KPIs -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                            <div class="vit-card p-5"><p class="text-xs text-gray-500 mb-1">Kontostand aktuell</p><p class="text-2xl font-bold text-green-600">47.820 ‚Ç¨</p><p class="text-xs text-gray-500">Stand: 14.02.2026</p></div>
                            <div class="vit-card p-5"><p class="text-xs text-gray-500 mb-1">Offene Forderungen</p><p class="text-2xl font-bold text-blue-600">23.400 ‚Ç¨</p><p class="text-xs text-gray-500">14 Rechnungen</p></div>
                            <div class="vit-card p-5"><p class="text-xs text-gray-500 mb-1">Offene Verbindlichkeiten</p><p class="text-2xl font-bold text-red-600">38.200 ‚Ç¨</p><p class="text-xs text-gray-500">8 Rechnungen</p></div>
                            <div class="vit-card p-5"><p class="text-xs text-gray-500 mb-1">Freie Liquiditaet</p><p class="text-2xl font-bold text-gray-800">33.020 ‚Ç¨</p><p class="text-xs text-gray-500">Konto + Ford. - Verbindl.</p></div>
                        </div>
                        <!-- Cash Flow Prognose -->
                        <div class="vit-card p-6 mb-6">
                            <h2 class="text-lg font-semibold text-gray-800 mb-4">Cash-Flow Prognose (naechste 8 Wochen)</h2>
                            <div class="overflow-x-auto">
                                <table class="w-full text-sm">
                                    <thead><tr class="bg-gray-50"><th class="text-left py-2 px-3 font-semibold text-gray-600">Woche</th><th class="text-right py-2 px-3 font-semibold text-gray-600">Einnahmen</th><th class="text-right py-2 px-3 font-semibold text-gray-600">Ausgaben</th><th class="text-right py-2 px-3 font-semibold text-gray-600">Saldo</th><th class="text-right py-2 px-3 font-semibold text-gray-600">Kontostand</th></tr></thead>
                                    <tbody>
                                        <tr class="border-b bg-blue-50"><td class="py-2 px-3 font-semibold">KW 8 (aktuell)</td><td class="text-right py-2 px-3 text-green-600">+18.500</td><td class="text-right py-2 px-3 text-red-600">-12.300</td><td class="text-right py-2 px-3 font-semibold text-green-600">+6.200</td><td class="text-right py-2 px-3 font-bold">47.820</td></tr>
                                        <tr class="border-b"><td class="py-2 px-3">KW 9</td><td class="text-right py-2 px-3 text-green-600">+22.000</td><td class="text-right py-2 px-3 text-red-600">-28.400</td><td class="text-right py-2 px-3 text-red-600">-6.400</td><td class="text-right py-2 px-3 font-semibold">41.420</td></tr>
                                        <tr class="border-b"><td class="py-2 px-3">KW 10</td><td class="text-right py-2 px-3 text-green-600">+19.800</td><td class="text-right py-2 px-3 text-red-600">-15.200</td><td class="text-right py-2 px-3 text-green-600">+4.600</td><td class="text-right py-2 px-3 font-semibold">46.020</td></tr>
                                        <tr class="border-b"><td class="py-2 px-3">KW 11</td><td class="text-right py-2 px-3 text-green-600">+24.500</td><td class="text-right py-2 px-3 text-red-600">-18.900</td><td class="text-right py-2 px-3 text-green-600">+5.600</td><td class="text-right py-2 px-3 font-semibold">51.620</td></tr>
                                        <tr class="border-b"><td class="py-2 px-3">KW 12</td><td class="text-right py-2 px-3 text-green-600">+21.200</td><td class="text-right py-2 px-3 text-red-600">-34.500</td><td class="text-right py-2 px-3 text-red-600">-13.300</td><td class="text-right py-2 px-3 font-semibold text-orange-600">38.320</td></tr>
                                        <tr class="border-b"><td class="py-2 px-3">KW 13</td><td class="text-right py-2 px-3 text-green-600">+26.800</td><td class="text-right py-2 px-3 text-red-600">-16.400</td><td class="text-right py-2 px-3 text-green-600">+10.400</td><td class="text-right py-2 px-3 font-semibold">48.720</td></tr>
                                        <tr class="border-b"><td class="py-2 px-3">KW 14</td><td class="text-right py-2 px-3 text-green-600">+28.100</td><td class="text-right py-2 px-3 text-red-600">-19.800</td><td class="text-right py-2 px-3 text-green-600">+8.300</td><td class="text-right py-2 px-3 font-semibold">57.020</td></tr>
                                        <tr class="border-b"><td class="py-2 px-3">KW 15</td><td class="text-right py-2 px-3 text-green-600">+31.500</td><td class="text-right py-2 px-3 text-red-600">-22.100</td><td class="text-right py-2 px-3 text-green-600">+9.400</td><td class="text-right py-2 px-3 font-semibold text-green-600">66.420</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <!-- Alerts -->
                        <div class="vit-card p-6">
                            <h2 class="text-lg font-semibold text-gray-800 mb-4">‚ö†Ô∏è Liquiditaets-Hinweise</h2>
                            <div class="space-y-3">
                                <div class="flex items-start space-x-3 p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
                                    <span class="text-yellow-500 text-xl mt-0.5">‚ö°</span>
                                    <div><p class="font-semibold text-gray-800 text-sm">KW 9: Gehaltszahlung + Lieferantenrechnung</p><p class="text-xs text-gray-600">Erwartete Ausgaben von 28.400 ‚Ç¨ - Kontostand sinkt auf ca. 41.420 ‚Ç¨</p></div>
                                </div>
                                <div class="flex items-start space-x-3 p-3 bg-orange-50 border border-orange-200 rounded-lg">
                                    <span class="text-orange-500 text-xl mt-0.5">üìã</span>
                                    <div><p class="font-semibold text-gray-800 text-sm">KW 12: Vororder Fruehjahr faellig</p><p class="text-xs text-gray-600">Grosse Lieferantenrechnung erwartet (34.500 ‚Ç¨) - rechtzeitig Liquiditaet sichern</p></div>
                                </div>
                                <div class="flex items-start space-x-3 p-3 bg-green-50 border border-green-200 rounded-lg">
                                    <span class="text-green-500 text-xl mt-0.5">üìà</span>
                                    <div><p class="font-semibold text-gray-800 text-sm">Positiver Trend ab KW 13</p><p class="text-xs text-gray-600">Fruehjahrsgeschaeft startet - steigende Einnahmen erwartet</p></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Wissen Tab -->
                    <div id="ctrlTabCtrlWissen" class="ctrl-tab-content" style="display:none;"></div>
                </div>


                <div id="aktenschrankView" class="view" style="display: none;">
                    <h1 class="h1-headline text-gray-800 mb-6" data-i18n="h_filingcab">AKTENSCHRANK</h1>

                    <!-- Search & Upload Bar -->
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center space-x-3 flex-1">
                            <div class="relative flex-1 max-w-md">
                                <input type="text" id="aktenSearch" onkeyup="filterAkten()" placeholder="Dokument suchen..." class="w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-vit-orange">
                                <svg class="absolute left-3 top-3 w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
                            </div>
                        </div>
                        <button onclick="document.getElementById('aktenUploadModal').classList.remove('hidden')" class="px-4 py-2.5 bg-vit-orange text-white rounded-lg text-sm font-semibold hover:opacity-90">+ Dokument hochladen</button>
                    </div>

                    <!-- Folder Grid -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 mb-8" id="aktenFolders">

                        <!-- 1. Vertraege & Recht -->
                        <div class="akten-folder vit-card p-5 cursor-pointer hover:shadow-lg transition group" onclick="openAktenFolder('vertraege')">
                            <div class="flex items-start justify-between mb-3">
                                <div class="p-3 bg-blue-100 rounded-xl group-hover:bg-blue-200 transition">
                                    <svg class="w-7 h-7 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                                </div>
                                <span class="text-xs font-bold bg-blue-100 text-blue-700 rounded-full px-2 py-0.5">8</span>
                            </div>
                            <h3 class="font-bold text-gray-800 mb-1">Vertraege &amp; Recht</h3>
                            <p class="text-xs text-gray-500">Miet-, Franchise-, Arbeitsvertraege, Versicherungen</p>
                            <p class="text-xs text-gray-400 mt-2">Zuletzt: 15.01.2026</p>
                        </div>

                        <!-- 2. Finanzen & Buchhaltung -->
                        <div class="akten-folder vit-card p-5 cursor-pointer hover:shadow-lg transition group" onclick="openAktenFolder('finanzen')">
                            <div class="flex items-start justify-between mb-3">
                                <div class="p-3 bg-green-100 rounded-xl group-hover:bg-green-200 transition">
                                    <svg class="w-7 h-7 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                                </div>
                                <span class="text-xs font-bold bg-green-100 text-green-700 rounded-full px-2 py-0.5">14</span>
                            </div>
                            <h3 class="font-bold text-gray-800 mb-1">Finanzen &amp; Buchhaltung</h3>
                            <p class="text-xs text-gray-500">BWAs, Jahresabschluesse, Steuerbescheide, Rechnungen</p>
                            <p class="text-xs text-gray-400 mt-2">Zuletzt: 05.02.2026</p>
                        </div>

                        <!-- 3. Personal & HR -->
                        <div class="akten-folder vit-card p-5 cursor-pointer hover:shadow-lg transition group" onclick="openAktenFolder('personal')">
                            <div class="flex items-start justify-between mb-3">
                                <div class="p-3 bg-purple-100 rounded-xl group-hover:bg-purple-200 transition">
                                    <svg class="w-7 h-7 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                                </div>
                                <span class="text-xs font-bold bg-purple-100 text-purple-700 rounded-full px-2 py-0.5">11</span>
                            </div>
                            <h3 class="font-bold text-gray-800 mb-1">Personal &amp; HR</h3>
                            <p class="text-xs text-gray-500">Arbeitsvertraege, Lohn, Urlaub, Fortbildungen</p>
                            <p class="text-xs text-gray-400 mt-2">Zuletzt: 31.01.2026</p>
                        </div>

                        <!-- 4. Standort & Betrieb -->
                        <div class="akten-folder vit-card p-5 cursor-pointer hover:shadow-lg transition group" onclick="openAktenFolder('standort')">
                            <div class="flex items-start justify-between mb-3">
                                <div class="p-3 bg-orange-100 rounded-xl group-hover:bg-orange-200 transition">
                                    <svg class="w-7 h-7 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg>
                                </div>
                                <span class="text-xs font-bold bg-orange-100 text-orange-700 rounded-full px-2 py-0.5">6</span>
                            </div>
                            <h3 class="font-bold text-gray-800 mb-1">Standort &amp; Betrieb</h3>
                            <p class="text-xs text-gray-500">Grundrisse, Genehmigungen, Inventar, Wartung</p>
                            <p class="text-xs text-gray-400 mt-2">Zuletzt: 10.12.2025</p>
                        </div>

                        <!-- 5. Marketing & Branding -->
                        <div class="akten-folder vit-card p-5 cursor-pointer hover:shadow-lg transition group" onclick="openAktenFolder('marketing')">
                            <div class="flex items-start justify-between mb-3">
                                <div class="p-3 bg-pink-100 rounded-xl group-hover:bg-pink-200 transition">
                                    <svg class="w-7 h-7 text-pink-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 4V2a1 1 0 011-1h8a1 1 0 011 1v2m-4 12v4m-4-4v4m8-12V8a4 4 0 00-8 0v4m-2 0h12a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2z"/></svg>
                                </div>
                                <span class="text-xs font-bold bg-pink-100 text-pink-700 rounded-full px-2 py-0.5">9</span>
                            </div>
                            <h3 class="font-bold text-gray-800 mb-1">Marketing &amp; Branding</h3>
                            <p class="text-xs text-gray-500">Brand Guidelines, Vorlagen, Druckdaten, Fotos</p>
                            <p class="text-xs text-gray-400 mt-2">Zuletzt: 03.02.2026</p>
                        </div>

                        <!-- 6. Lieferanten & Einkauf -->
                        <div class="akten-folder vit-card p-5 cursor-pointer hover:shadow-lg transition group" onclick="openAktenFolder('lieferanten')">
                            <div class="flex items-start justify-between mb-3">
                                <div class="p-3 bg-cyan-100 rounded-xl group-hover:bg-cyan-200 transition">
                                    <svg class="w-7 h-7 text-cyan-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"/></svg>
                                </div>
                                <span class="text-xs font-bold bg-cyan-100 text-cyan-700 rounded-full px-2 py-0.5">7</span>
                            </div>
                            <h3 class="font-bold text-gray-800 mb-1">Lieferanten &amp; Einkauf</h3>
                            <p class="text-xs text-gray-500">Rahmenvertraege, Preislisten, Konditionen</p>
                            <p class="text-xs text-gray-400 mt-2">Zuletzt: 20.01.2026</p>
                        </div>

                        <!-- 7. Diverses -->
                        <div class="akten-folder vit-card p-5 cursor-pointer hover:shadow-lg transition group" onclick="openAktenFolder('diverses')">
                            <div class="flex items-start justify-between mb-3">
                                <div class="p-3 bg-gray-100 rounded-xl group-hover:bg-gray-200 transition">
                                    <svg class="w-7 h-7 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"/></svg>
                                </div>
                                <span class="text-xs font-bold bg-gray-200 text-gray-700 rounded-full px-2 py-0.5">3</span>
                            </div>
                            <h3 class="font-bold text-gray-800 mb-1">Diverses</h3>
                            <p class="text-xs text-gray-500">Sonstiges, Notizen, Protokolle, Temporaeres</p>
                            <p class="text-xs text-gray-400 mt-2">Zuletzt: 08.02.2026</p>
                        </div>

                    </div>

                    <!-- Folder Detail View (hidden by default) -->
                    <div id="aktenFolderDetail" class="hidden">
                        <div class="flex items-center space-x-3 mb-4">
                            <button onclick="closeAktenFolder()" class="p-2 rounded-lg border border-gray-300 hover:bg-gray-100 text-gray-600">&#9664; Zurueck</button>
                            <h2 class="text-lg font-semibold text-gray-800" id="aktenFolderTitle">Ordner</h2>
                        </div>
                        <div class="vit-card overflow-hidden">
                            <table class="w-full text-sm">
                                <thead><tr class="bg-gray-50"><th class="text-left py-2.5 px-4 font-semibold text-gray-600">Dokument</th><th class="text-left py-2.5 px-4 font-semibold text-gray-600">Typ</th><th class="text-left py-2.5 px-4 font-semibold text-gray-600">Hochgeladen</th><th class="text-left py-2.5 px-4 font-semibold text-gray-600">Groesse</th><th class="text-right py-2.5 px-4 font-semibold text-gray-600">Aktion</th></tr></thead>
                                <tbody id="aktenFileList"></tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Upload Modal -->
                    <div id="aktenUploadModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                        <div class="bg-white rounded-xl p-6 w-full max-w-md shadow-2xl">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-lg font-semibold">Dokument hochladen</h3>
                                <button onclick="document.getElementById('aktenUploadModal').classList.add('hidden')" class="text-gray-400 hover:text-gray-600 text-xl">&times;</button>
                            </div>
                            <div class="space-y-3">
                                <select class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                    <option>Vertraege &amp; Recht</option><option>Finanzen &amp; Buchhaltung</option><option>Personal &amp; HR</option>
                                    <option>Standort &amp; Betrieb</option><option>Marketing &amp; Branding</option><option>Lieferanten &amp; Einkauf</option><option>Diverses</option>
                                </select>
                                <div class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-vit-orange transition cursor-pointer">
                                    <svg class="w-10 h-10 text-gray-400 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/></svg>
                                    <p class="text-sm text-gray-500">Datei hierher ziehen oder <span class="text-vit-orange font-semibold">durchsuchen</span></p>
                                    <p class="text-xs text-gray-400 mt-1">PDF, XLSX, DOCX, JPG ‚Äì max. 25 MB</p>
                                </div>
                                <input type="text" placeholder="Beschreibung (optional)" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                <button onclick="document.getElementById('aktenUploadModal').classList.add('hidden')" class="w-full bg-vit-orange text-white py-2 rounded-lg font-semibold hover:opacity-90">Hochladen</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="supportView" class="view" style="display: none;">
                    <h1 class="h1-headline text-gray-800 mb-6" data-i18n="h_support">SUPPORT</h1>

                    <!-- Tab Navigation -->
                    <div class="mb-6 border-b border-gray-200">
                        <nav class="-mb-px flex space-x-8">
                            <button onclick="showSupportTab('tickets')" class="sup-tab-btn whitespace-nowrap py-4 px-1 border-b-2 border-vit-orange font-semibold text-sm text-vit-orange" data-tab="tickets">üé´ Tickets <span id="supTicketBadge" class="ml-1 bg-red-500 text-white text-xs rounded-full px-1.5 py-0.5">4</span></button>
                            <button onclick="showSupportTab('kontakte')" class="sup-tab-btn whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-semibold text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="kontakte">üë• Kontakte Zentrale</button>
                        </nav>
                    </div>

                    <!-- ===== TAB 1: Tickets ===== -->
                    <div id="supTabTickets" class="sup-tab-content">
                        <!-- Header -->
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex space-x-2">
                                <button onclick="filterTickets('all')" class="ticket-filter-btn px-3 py-1.5 rounded-full text-xs font-semibold bg-vit-orange text-white" data-tf="all">Alle (7)</button>
                                <button onclick="filterTickets('offen')" class="ticket-filter-btn px-3 py-1.5 rounded-full text-xs font-semibold bg-gray-100 text-gray-600" data-tf="offen">Offen (2)</button>
                                <button onclick="filterTickets('bearbeitung')" class="ticket-filter-btn px-3 py-1.5 rounded-full text-xs font-semibold bg-gray-100 text-gray-600" data-tf="bearbeitung">In Bearbeitung (2)</button>
                                <button onclick="filterTickets('geloest')" class="ticket-filter-btn px-3 py-1.5 rounded-full text-xs font-semibold bg-gray-100 text-gray-600" data-tf="geloest">Geloest (3)</button>
                            </div>
                            <button onclick="document.getElementById('ticketCreate').classList.toggle('hidden')" class="px-4 py-2 bg-vit-orange text-white rounded-lg text-sm font-semibold hover:opacity-90">+ Neues Ticket</button>
                        </div>

                        <!-- Create Ticket Form -->
                        <div id="ticketCreate" class="hidden vit-card p-5 mb-4">
                            <h3 class="font-semibold text-gray-800 mb-3">Neues Support-Ticket erstellen</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-3">
                                <select class="px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                    <option value="">Kategorie waehlen...</option>
                                    <option>IT / Systeme</option>
                                    <option>Einkauf / Lieferanten</option>
                                    <option>Marketing / Ads</option>
                                    <option>Buchhaltung / BWA</option>
                                    <option>Werkstatt / Technik</option>
                                    <option>Sonstiges</option>
                                </select>
                                <select class="px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                    <option value="">Prioritaet...</option>
                                    <option>üî¥ Hoch ‚Äì Betrieb eingeschraenkt</option>
                                    <option>üü° Mittel ‚Äì Wichtig, aber kein Stillstand</option>
                                    <option>üü¢ Niedrig ‚Äì Frage / Wunsch</option>
                                </select>
                            </div>
                            <input type="text" placeholder="Betreff..." class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm mb-3">
                            <textarea placeholder="Beschreibe dein Problem oder deine Frage moeglichst genau..." class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm mb-3" rows="4"></textarea>
                            <div class="flex items-center justify-between">
                                <span class="text-xs text-gray-400">Wird an Zoho Desk uebermittelt</span>
                                <div class="flex space-x-2">
                                    <button onclick="document.getElementById('ticketCreate').classList.add('hidden')" class="px-4 py-2 border border-gray-300 rounded-lg text-sm hover:bg-gray-50">Abbrechen</button>
                                    <button onclick="document.getElementById('ticketCreate').classList.add('hidden');alert('Ticket #GR-2026-008 erstellt! Du erhaeltst eine Bestaetigung per E-Mail.')" class="px-4 py-2 bg-vit-orange text-white rounded-lg text-sm font-semibold hover:opacity-90">Ticket erstellen</button>
                                </div>
                            </div>
                        </div>

                        <!-- Ticket List -->
                        <div id="ticketList" class="space-y-3"></div>

                        <!-- Zoho Desk Hinweis -->
                        <div class="mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg flex items-center space-x-3">
                            <span class="text-2xl">üîó</span>
                            <div>
                                <p class="text-sm font-semibold text-blue-800">Alle Tickets werden ueber Zoho Desk verwaltet</p>
                                <p class="text-xs text-blue-600">Fuer erweiterte Funktionen (Anhaenge, Chat, Historie) direkt in Zoho Desk oeffnen.</p>
                            </div>
                            <button class="ml-auto px-4 py-2 bg-blue-600 text-white rounded-lg text-xs font-semibold hover:bg-blue-700 whitespace-nowrap">Zoho Desk oeffnen ‚Üí</button>
                        </div>
                    </div>

                    <!-- ===== TAB 2: Kontakte Zentrale ===== -->
                    <div id="supTabKontakte" class="sup-tab-content" style="display:none;">
                        <div class="mb-4">
                            <p class="text-sm text-gray-500">Alle Ansprechpartner der vit:bikes Zentrale auf einen Blick. Bei dringenden Problemen bitte direkt anrufen.</p>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="kontakteGrid"></div>
                    </div>
                </div>

                <!-- ===== IDEENBOARD VIEW ===== -->
                <div id="ideenboardView" class="view" style="display: none;">
                    <h1 class="h1-headline text-gray-800 mb-6" data-i18n="h_ideaboard">IDEENBOARD</h1>
                    <p class="text-sm text-gray-500 mb-6">Hier koennt ihr Ideen, Wuensche und Verbesserungsvorschlaege einreichen ‚Äì fuer das Portal, die Warenwirtschaft, den Einkauf und alles rund um vit:bikes. Jede Idee zaehlt!</p>

                    <!-- Neue Idee Button + Filter -->
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex space-x-2">
                            <button onclick="filterIdeen('all')" class="idee-filter-btn px-3 py-1.5 rounded-full text-xs font-semibold bg-vit-orange text-white" data-if="all">Alle</button>
                            <button onclick="filterIdeen('neu')" class="idee-filter-btn px-3 py-1.5 rounded-full text-xs font-semibold bg-gray-100 text-gray-600" data-if="neu">Neu</button>
                            <button onclick="filterIdeen('diskussion')" class="idee-filter-btn px-3 py-1.5 rounded-full text-xs font-semibold bg-gray-100 text-gray-600" data-if="diskussion">In Diskussion</button>
                            <button onclick="filterIdeen('geplant')" class="idee-filter-btn px-3 py-1.5 rounded-full text-xs font-semibold bg-gray-100 text-gray-600" data-if="geplant">Geplant</button>
                            <button onclick="filterIdeen('umgesetzt')" class="idee-filter-btn px-3 py-1.5 rounded-full text-xs font-semibold bg-gray-100 text-gray-600" data-if="umgesetzt">Umgesetzt</button>
                        </div>
                        <button onclick="document.getElementById('ideeCreate').classList.toggle('hidden')" class="px-4 py-2 bg-vit-orange text-white rounded-lg text-sm font-semibold hover:opacity-90">üí° Neue Idee einreichen</button>
                    </div>

                    <!-- Neue Idee Formular -->
                    <div id="ideeCreate" class="hidden vit-card p-5 mb-6">
                        <h3 class="font-semibold text-gray-800 mb-3">üí° Neue Idee einreichen</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-3">
                            <select id="ideeKat" class="px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                <option value="">Bereich waehlen...</option>
                                <option>Portal / Funktionen</option>
                                <option>Warenwirtschaft / Kasse</option>
                                <option>Einkauf / Sortiment</option>
                                <option>Marketing / Werbung</option>
                                <option>Verkauf / Beratung</option>
                                <option>Werkstatt / Service</option>
                                <option>Kommunikation / Zusammenarbeit</option>
                                <option>Sonstiges</option>
                            </select>
                            <select id="ideeTyp" class="px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                <option value="">Typ waehlen...</option>
                                <option>üöÄ Neue Funktion</option>
                                <option>üîß Verbesserung</option>
                                <option>üêõ Problem / Bug</option>
                                <option>üí¨ Allgemeiner Vorschlag</option>
                            </select>
                        </div>
                        <input id="ideeTitel" type="text" placeholder="Titel deiner Idee..." class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm mb-3">
                        <textarea id="ideeBeschreibung" placeholder="Beschreibe deine Idee moeglichst konkret: Was genau soll verbessert werden? Warum waere das hilfreich? Wie koennte es aussehen?" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm mb-3" rows="4"></textarea>
                        <div class="flex items-center justify-between">
                            <span class="text-xs text-gray-400">Sichtbar fuer alle Partner & die Zentrale</span>
                            <div class="flex space-x-2">
                                <button onclick="document.getElementById('ideeCreate').classList.add('hidden')" class="px-4 py-2 border border-gray-300 rounded-lg text-sm hover:bg-gray-50">Abbrechen</button>
                                <button onclick="submitIdee()" class="px-4 py-2 bg-vit-orange text-white rounded-lg text-sm font-semibold hover:opacity-90">Idee einreichen</button>
                            </div>
                        </div>
                    </div>

                    <!-- Ideen-Statistik -->
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                        <div class="vit-card p-4 text-center">
                            <p class="text-2xl font-bold text-gray-800" id="ideenTotal">12</p>
                            <p class="text-xs text-gray-500">Ideen gesamt</p>
                        </div>
                        <div class="vit-card p-4 text-center">
                            <p class="text-2xl font-bold text-blue-600" id="ideenNeu">4</p>
                            <p class="text-xs text-gray-500">Neue Ideen</p>
                        </div>
                        <div class="vit-card p-4 text-center">
                            <p class="text-2xl font-bold text-yellow-600" id="ideenGeplant">3</p>
                            <p class="text-xs text-gray-500">Geplant</p>
                        </div>
                        <div class="vit-card p-4 text-center">
                            <p class="text-2xl font-bold text-green-600" id="ideenUmgesetzt">3</p>
                            <p class="text-xs text-gray-500">Umgesetzt</p>
                        </div>
                    </div>

                    <!-- Ideen Liste -->
                    <div id="ideenList" class="space-y-3"></div>
                </div>

                <div id="kommunikationView" class="view" style="display: none;">
                    <h1 class="h1-headline text-gray-800 mb-6" data-i18n="h_communication">KOMMUNIKATION</h1>

                    <!-- Tab Navigation -->
                    <div class="mb-6 border-b border-gray-200">
                        <nav class="-mb-px flex space-x-8">
                            <button onclick="showKommTab('inbox')" class="komm-tab-btn whitespace-nowrap py-4 px-1 border-b-2 border-vit-orange font-semibold text-sm text-vit-orange" data-tab="inbox">Inbox <span class="ml-1 bg-red-500 text-white text-xs rounded-full px-1.5 py-0.5">3</span></button>
                            <button onclick="showKommTab('announce')" class="komm-tab-btn whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-semibold text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="announce">Ankuendigungen</button>
                            <button onclick="showKommTab('forum')" class="komm-tab-btn whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-semibold text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="forum">Forum</button>
                            <button onclick="showKommTab('brett')" class="komm-tab-btn whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-semibold text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="brett">Schwarzes Brett</button>
                            <button onclick="showKommTab('channel')" class="komm-tab-btn whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-semibold text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="channel">Standort-Channel</button>
                            <button onclick="showKommTab('termine')" class="komm-tab-btn whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-semibold text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="termine">Termine</button>
                        </nav>
                    </div>

                    <!-- ===== TAB: Inbox ===== -->
                    <div id="kommTabInbox" class="komm-tab-content">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex space-x-2">
                                <button onclick="filterInbox('all')" class="inbox-filter-btn px-3 py-1.5 rounded-full text-xs font-semibold bg-vit-orange text-white" data-f="all">Alle</button>
                                <button onclick="filterInbox('unread')" class="inbox-filter-btn px-3 py-1.5 rounded-full text-xs font-semibold bg-gray-100 text-gray-600" data-f="unread">Ungelesen (3)</button>
                                <button onclick="filterInbox('sent')" class="inbox-filter-btn px-3 py-1.5 rounded-full text-xs font-semibold bg-gray-100 text-gray-600" data-f="sent">Gesendet</button>
                            </div>
                            <button onclick="document.getElementById('inboxCompose').classList.toggle('hidden')" class="px-4 py-2 bg-vit-orange text-white rounded-lg text-sm font-semibold hover:opacity-90">+ Neue Nachricht</button>
                        </div>

                        <!-- Compose -->
                        <div id="inboxCompose" class="hidden vit-card p-5 mb-4">
                            <select class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm mb-3"><option>An: Zentrale ‚Äì Allgemein</option><option>An: Einkauf (Lisa Berger)</option><option>An: Marketing (Jan Krause)</option><option>An: Support / IT</option><option>An: Geschaeftsfuehrung</option></select>
                            <input type="text" placeholder="Betreff..." class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm mb-3">
                            <textarea placeholder="Nachricht..." class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm mb-3" rows="4"></textarea>
                            <div class="flex justify-end space-x-2">
                                <button onclick="document.getElementById('inboxCompose').classList.add('hidden')" class="px-4 py-2 border border-gray-300 rounded-lg text-sm hover:bg-gray-50">Abbrechen</button>
                                <button onclick="sendInboxMsg()" class="px-4 py-2 bg-vit-orange text-white rounded-lg text-sm font-semibold hover:opacity-90">Senden</button>
                            </div>
                        </div>

                        <!-- Message List -->
                        <div id="inboxList" class="space-y-2"></div>
                    </div>

                    <!-- ===== TAB: Ankuendigungen ===== -->
                    <div id="kommTabAnnounce" class="komm-tab-content" style="display:none;">
                        <div id="announceList" class="space-y-4"></div>
                    </div>

                    <!-- ===== TAB 1: Forum ===== -->
                    <div id="kommTabForum" class="komm-tab-content" style="display:none;">
                        <!-- Forum Categories -->
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex space-x-2">
                                <button onclick="filterForum('all')" class="forum-cat-btn px-3 py-1.5 rounded-full text-xs font-semibold bg-vit-orange text-white" data-cat="all">Alle</button>
                                <button onclick="filterForum('allgemein')" class="forum-cat-btn px-3 py-1.5 rounded-full text-xs font-semibold bg-gray-100 text-gray-600 hover:bg-gray-200" data-cat="allgemein">Allgemein</button>
                                <button onclick="filterForum('verkauf')" class="forum-cat-btn px-3 py-1.5 rounded-full text-xs font-semibold bg-gray-100 text-gray-600 hover:bg-gray-200" data-cat="verkauf">Verkauf &amp; Beratung</button>
                                <button onclick="filterForum('werkstatt')" class="forum-cat-btn px-3 py-1.5 rounded-full text-xs font-semibold bg-gray-100 text-gray-600 hover:bg-gray-200" data-cat="werkstatt">Werkstatt</button>
                                <button onclick="filterForum('einkauf')" class="forum-cat-btn px-3 py-1.5 rounded-full text-xs font-semibold bg-gray-100 text-gray-600 hover:bg-gray-200" data-cat="einkauf">Einkauf &amp; Lager</button>
                                <button onclick="filterForum('zentrale')" class="forum-cat-btn px-3 py-1.5 rounded-full text-xs font-semibold bg-gray-100 text-gray-600 hover:bg-gray-200" data-cat="zentrale">Zentrale</button>
                            </div>
                            <button onclick="document.getElementById('forumNewPost').classList.toggle('hidden')" class="px-4 py-2 bg-vit-orange text-white rounded-lg text-sm font-semibold hover:opacity-90">+ Neuer Beitrag</button>
                        </div>

                        <!-- New Post Form (hidden) -->
                        <div id="forumNewPost" class="hidden vit-card p-5 mb-4">
                            <input type="text" placeholder="Betreff..." class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm mb-3 focus:outline-none focus:border-vit-orange">
                            <textarea placeholder="Deine Nachricht an das Netzwerk..." class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm mb-3 focus:outline-none focus:border-vit-orange" rows="3"></textarea>
                            <div class="flex items-center justify-between">
                                <select class="px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                    <option>Allgemein</option><option>Verkauf &amp; Beratung</option><option>Werkstatt</option><option>Einkauf &amp; Lager</option>
                                </select>
                                <button onclick="document.getElementById('forumNewPost').classList.add('hidden')" class="px-5 py-2 bg-vit-orange text-white rounded-lg text-sm font-semibold hover:opacity-90">Posten</button>
                            </div>
                        </div>

                        <!-- Forum Posts -->
                        <div id="forumPosts" class="space-y-3"></div>
                    </div>

                    <!-- ===== TAB 2: Standort-Channel ===== -->
                    <div id="kommTabChannel" class="komm-tab-content" style="display:none;">
                        <!-- Channel Header -->
                        <div class="vit-card p-4 mb-4 flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 bg-vit-orange rounded-lg flex items-center justify-center text-white font-bold">#</div>
                                <div>
                                    <h3 class="font-bold text-gray-800">Grafrath Team-Chat</h3>
                                    <p class="text-xs text-gray-500">Sandra, Thomas, Dirk, Max ¬∑ Nur fuer euer Team sichtbar</p>
                                </div>
                            </div>
                            <div class="flex items-center space-x-2">
                                <div class="flex -space-x-2">
                                    <div class="w-7 h-7 bg-blue-500 rounded-full border-2 border-white flex items-center justify-center text-white text-xs font-bold">S</div>
                                    <div class="w-7 h-7 bg-green-500 rounded-full border-2 border-white flex items-center justify-center text-white text-xs font-bold">T</div>
                                    <div class="w-7 h-7 bg-purple-500 rounded-full border-2 border-white flex items-center justify-center text-white text-xs font-bold">D</div>
                                    <div class="w-7 h-7 bg-orange-500 rounded-full border-2 border-white flex items-center justify-center text-white text-xs font-bold">M</div>
                                </div>
                                <span class="text-xs text-green-600 font-semibold">3 online</span>
                            </div>
                        </div>

                        <!-- Chat Messages -->
                        <div class="vit-card overflow-hidden">
                            <div id="channelMessages" class="p-4 space-y-4 max-h-[500px] overflow-y-auto" style="min-height:400px;"></div>

                            <!-- Message Input -->
                            <div class="border-t border-gray-200 p-4 flex items-center space-x-3">
                                <button class="p-2 text-gray-400 hover:text-gray-600 rounded-lg hover:bg-gray-100">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"/></svg>
                                </button>
                                <input type="text" id="channelInput" placeholder="Nachricht schreiben..." class="flex-1 px-4 py-2.5 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-vit-orange" onkeydown="if(event.key==='Enter')sendChannelMsg()">
                                <button onclick="sendChannelMsg()" class="px-4 py-2.5 bg-vit-orange text-white rounded-lg text-sm font-semibold hover:opacity-90">Senden</button>
                            </div>
                        </div>
                    </div>

                    <!-- ===== TAB: Schwarzes Brett ===== -->
                    <div id="kommTabBrett" class="komm-tab-content" style="display:none;">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex space-x-2">
                                <button onclick="filterBrett('all')" class="brett-cat-btn px-3 py-1.5 rounded-full text-xs font-semibold bg-vit-orange text-white" data-bc="all">Alle</button>
                                <button onclick="filterBrett('suche')" class="brett-cat-btn px-3 py-1.5 rounded-full text-xs font-semibold bg-gray-100 text-gray-600" data-bc="suche">Rad gesucht</button>
                                <button onclick="filterBrett('biete')" class="brett-cat-btn px-3 py-1.5 rounded-full text-xs font-semibold bg-gray-100 text-gray-600" data-bc="biete">Rad abzugeben</button>
                                <button onclick="filterBrett('frage')" class="brett-cat-btn px-3 py-1.5 rounded-full text-xs font-semibold bg-gray-100 text-gray-600" data-bc="frage">Fragen</button>
                                <button onclick="filterBrett('tipp')" class="brett-cat-btn px-3 py-1.5 rounded-full text-xs font-semibold bg-gray-100 text-gray-600" data-bc="tipp">Tipps</button>
                            </div>
                            <button onclick="document.getElementById('brettNewPost').classList.toggle('hidden')" class="px-4 py-2 bg-vit-orange text-white rounded-lg text-sm font-semibold hover:opacity-90">+ Neuer Aushang</button>
                        </div>
                        <div id="brettNewPost" class="hidden vit-card p-5 mb-4">
                            <input type="text" placeholder="Titel..." class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm mb-3">
                            <textarea placeholder="Beschreibung..." class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm mb-3" rows="3"></textarea>
                            <div class="flex items-center justify-between">
                                <select class="px-3 py-2 border border-gray-300 rounded-lg text-sm"><option>Rad gesucht</option><option>Rad abzugeben</option><option>Frage</option><option>Tipp</option></select>
                                <button onclick="document.getElementById('brettNewPost').classList.add('hidden')" class="px-5 py-2 bg-vit-orange text-white rounded-lg text-sm font-semibold hover:opacity-90">Posten</button>
                            </div>
                        </div>
                        <div id="brettPosts" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
                    </div>

                    <!-- ===== TAB: Termine ===== -->
                    <div id="kommTabTermine" class="komm-tab-content" style="display:none;">
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            <!-- Upcoming Events -->
                            <div class="lg:col-span-2 space-y-3" id="termineList"></div>
                            <!-- Mini Calendar Sidebar -->
                            <div>
                                <div class="vit-card p-5 mb-4">
                                    <h3 class="font-semibold text-gray-800 mb-3">Februar 2026</h3>
                                    <div class="grid grid-cols-7 gap-1 text-center text-xs">
                                        <span class="text-gray-400 font-semibold py-1">Mo</span><span class="text-gray-400 font-semibold py-1">Di</span><span class="text-gray-400 font-semibold py-1">Mi</span><span class="text-gray-400 font-semibold py-1">Do</span><span class="text-gray-400 font-semibold py-1">Fr</span><span class="text-gray-400 font-semibold py-1">Sa</span><span class="text-gray-400 font-semibold py-1">So</span>
                                        <span class="py-1"></span><span class="py-1"></span><span class="py-1"></span><span class="py-1"></span><span class="py-1"></span><span class="py-1"></span><span class="py-1 text-gray-300">1</span>
                                        <span class="py-1">2</span><span class="py-1">3</span><span class="py-1">4</span><span class="py-1">5</span><span class="py-1">6</span><span class="py-1">7</span><span class="py-1 text-gray-300">8</span>
                                        <span class="py-1">9</span><span class="py-1">10</span><span class="py-1">11</span><span class="py-1">12</span><span class="py-1">13</span><span class="py-1 bg-vit-orange text-white rounded-full font-bold">14</span><span class="py-1 text-gray-300">15</span>
                                        <span class="py-1">16</span><span class="py-1">17</span><span class="py-1 bg-blue-100 text-blue-700 rounded-full font-semibold">18</span><span class="py-1">19</span><span class="py-1">20</span><span class="py-1">21</span><span class="py-1 text-gray-300">22</span>
                                        <span class="py-1">23</span><span class="py-1">24</span><span class="py-1 bg-red-100 text-red-700 rounded-full font-semibold">25</span><span class="py-1">26</span><span class="py-1 bg-blue-100 text-blue-700 rounded-full font-semibold">27</span><span class="py-1 bg-green-100 text-green-700 rounded-full font-semibold">28</span><span class="py-1 text-gray-300"></span>
                                    </div>
                                    <div class="mt-3 space-y-1 text-xs">
                                        <div class="flex items-center space-x-2"><span class="w-2 h-2 bg-vit-orange rounded-full"></span><span class="text-gray-500">Heute</span></div>
                                        <div class="flex items-center space-x-2"><span class="w-2 h-2 bg-blue-500 rounded-full"></span><span class="text-gray-500">Meeting / Schulung</span></div>
                                        <div class="flex items-center space-x-2"><span class="w-2 h-2 bg-red-500 rounded-full"></span><span class="text-gray-500">Deadline</span></div>
                                        <div class="flex items-center space-x-2"><span class="w-2 h-2 bg-green-500 rounded-full"></span><span class="text-gray-500">Event</span></div>
                                    </div>
                                </div>
                                <div class="vit-card p-5">
                                    <h3 class="font-semibold text-gray-800 mb-3">Schnellzugriff</h3>
                                    <div class="space-y-2 text-sm">
                                        <a href="#" class="block text-vit-orange hover:underline">Vororder-Formular H/W 2026</a>
                                        <a href="#" class="block text-vit-orange hover:underline">Schulungskatalog 2026</a>
                                        <a href="#" class="block text-vit-orange hover:underline">Messekalender Bike-Branche</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
                <div id="forumView" class="view" style="display: none;">
                    <h1 class="h1-headline text-gray-800 mb-6" data-i18n="h_forum">FORUM</h1>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="lg:col-span-2">
                            <div class="vit-card p-6 mb-4">
                                <button class="bg-vit-orange text-white px-6 py-2 rounded-lg hover:opacity-90">+ Neues Thema erstellen</button>
                            </div>

                            <div class="space-y-4">
                                <div class="vit-card p-6 forum-post">
                                    <div class="flex items-start space-x-4">
                                        <img src="https://ui-avatars.com/api/?name=Markus+Unger&background=EF7D00&color=fff" class="w-12 h-12 rounded-full">
                                        <div class="flex-1">
                                            <div class="flex items-center justify-between mb-2">
                                                <h3 class="font-semibold text-gray-800">Neue Marketing-Kampagne f√ºr Fr√ºhjahr 2026</h3>
                                                <span class="text-xs text-gray-500">vor 2 Stunden</span>
                                            </div>
                                            <p class="text-sm text-gray-600 mb-3">
                                                Hallo zusammen! Wir haben eine neue Kampagne f√ºr das Fr√ºhjahr vorbereitet. 
                                                Alle Materialien sind jetzt im Bereich "Marketing" verf√ºgbar. W√ºrde mich √ºber 
                                                euer Feedback freuen!
                                            </p>
                                            <div class="flex items-center space-x-4 text-sm text-gray-500">
                                                <span class="flex items-center space-x-1">
                                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                                                    </svg>
                                                    <span>8 Antworten</span>
                                                </span>
                                                <span class="flex items-center space-x-1">
                                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                                                    </svg>
                                                    <span>42 Views</span>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="vit-card p-6 forum-post">
                                    <div class="flex items-start space-x-4">
                                        <img src="https://ui-avatars.com/api/?name=Stefan+Meyer&background=626062&color=fff" class="w-12 h-12 rounded-full">
                                        <div class="flex-1">
                                            <div class="flex items-center justify-between mb-2">
                                                <h3 class="font-semibold text-gray-800">Best Practice: 3D-Vermessung</h3>
                                                <span class="text-xs text-gray-500">vor 5 Stunden</span>
                                            </div>
                                            <p class="text-sm text-gray-600 mb-3">
                                                M√∂chte gerne Erfahrungen austauschen zur 3D-K√∂rpervermessung. Wie integriert 
                                                ihr das in euren Beratungsprozess? Bei uns dauert das aktuell ca. 15-20 Minuten...
                                            </p>
                                            <div class="flex items-center space-x-4 text-sm text-gray-500">
                                                <span class="flex items-center space-x-1">
                                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                                                    </svg>
                                                    <span>12 Antworten</span>
                                                </span>
                                                <span class="flex items-center space-x-1">
                                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                                                    </svg>
                                                    <span>67 Views</span>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="vit-card p-6 forum-post">
                                    <div class="flex items-start space-x-4">
                                        <img src="https://ui-avatars.com/api/?name=Julia+Fischer&background=EF7D00&color=fff" class="w-12 h-12 rounded-full">
                                        <div class="flex-1">
                                            <div class="flex items-center justify-between mb-2">
                                                <h3 class="font-semibold text-gray-800">Erfolg: Firmenkunden-Akquise</h3>
                                                <span class="text-xs text-gray-500">gestern</span>
                                            </div>
                                            <p class="text-sm text-gray-600 mb-3">
                                                Wollte mal berichten: Wir haben gerade einen Deal mit einem lokalen Unternehmen 
                                                (50 Mitarbeiter) f√ºr Bike-Leasing abgeschlossen! üéâ Kann gerne Tipps teilen...
                                            </p>
                                            <div class="flex items-center space-x-4 text-sm text-gray-500">
                                                <span class="flex items-center space-x-1">
                                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                                                    </svg>
                                                    <span>15 Antworten</span>
                                                </span>
                                                <span class="flex items-center space-x-1">
                                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                                                    </svg>
                                                    <span>89 Views</span>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div>
                            <div class="vit-card p-6 mb-4">
                                <h3 class="font-semibold text-gray-800 mb-4">Kategorien</h3>
                                <div class="space-y-2">
                                    <a href="#" class="flex items-center justify-between p-2 hover:bg-gray-50 rounded">
                                        <span class="text-sm text-gray-700">üì¢ Ank√ºndigungen</span>
                                        <span class="text-xs bg-gray-200 px-2 py-1 rounded">8</span>
                                    </a>
                                    <a href="#" class="flex items-center justify-between p-2 hover:bg-gray-50 rounded">
                                        <span class="text-sm text-gray-700">üí° Best Practices</span>
                                        <span class="text-xs bg-gray-200 px-2 py-1 rounded">23</span>
                                    </a>
                                    <a href="#" class="flex items-center justify-between p-2 hover:bg-gray-50 rounded">
                                        <span class="text-sm text-gray-700">üîß Technik & Service</span>
                                        <span class="text-xs bg-gray-200 px-2 py-1 rounded">45</span>
                                    </a>
                                    <a href="#" class="flex items-center justify-between p-2 hover:bg-gray-50 rounded">
                                        <span class="text-sm text-gray-700">üìä Marketing</span>
                                        <span class="text-xs bg-gray-200 px-2 py-1 rounded">31</span>
                                    </a>
                                    <a href="#" class="flex items-center justify-between p-2 hover:bg-gray-50 rounded">
                                        <span class="text-sm text-gray-700">‚ùì Fragen</span>
                                        <span class="text-xs bg-gray-200 px-2 py-1 rounded">67</span>
                                    </a>
                                </div>
                            </div>

                            <div class="vit-card p-6">
                                <h3 class="font-semibold text-gray-800 mb-4">Aktive Mitglieder</h3>
                                <div class="space-y-3">
                                    <div class="flex items-center space-x-2">
                                        <img src="https://ui-avatars.com/api/?name=Markus+Unger&background=EF7D00&color=fff" class="w-8 h-8 rounded-full">
                                        <div class="flex-1">
                                            <p class="text-sm font-semibold text-gray-800">Markus Unger</p>
                                            <p class="text-xs text-gray-500">HQ - Marketing</p>
                                        </div>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <img src="https://ui-avatars.com/api/?name=Stefan+Meyer&background=626062&color=fff" class="w-8 h-8 rounded-full">
                                        <div class="flex-1">
                                            <p class="text-sm font-semibold text-gray-800">Stefan Meyer</p>
                                            <p class="text-xs text-gray-500">Partner M√ºnchen</p>
                                        </div>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <img src="https://ui-avatars.com/api/?name=Julia+Fischer&background=EF7D00&color=fff" class="w-8 h-8 rounded-full">
                                        <div class="flex-1">
                                            <p class="text-sm font-semibold text-gray-800">Julia Fischer</p>
                                            <p class="text-xs text-gray-500">Partner Berlin</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Kommunikation View (Chat + Forum kombiniert) -->
                <div id="communicationView" class="view premium-feature" style="display: none;">
                    <h1 class="h1-headline text-gray-800 mb-6" data-i18n="h_communication">KOMMUNIKATION</h1>
                    
                    <!-- Tab Navigation -->
                    <div class="flex space-x-4 mb-6">
                        <button onclick="switchCommunicationTab('chat')" id="chatTab" class="px-6 py-3 bg-vit-orange text-white rounded-lg font-semibold">
                            üí¨ Chat
                        </button>
                        <button onclick="switchCommunicationTab('forum')" id="forumTab" class="px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300">
                            üó®Ô∏è Forum
                        </button>
                    </div>

                    <!-- Chat Section -->
                    <div id="chatSection">
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            <div class="vit-card p-4">
                                <h3 class="font-semibold text-gray-800 mb-4">Kontakte</h3>
                                <input type="text" placeholder="Suchen..." class="w-full px-3 py-2 border border-gray-300 rounded-lg mb-4 focus:outline-none focus:border-vit-orange">
                                
                                <div class="space-y-2">
                                    <div class="flex items-center space-x-3 p-3 hover:bg-gray-50 rounded-lg cursor-pointer bg-gray-100">
                                        <div class="relative">
                                            <img src="https://ui-avatars.com/api/?name=HQ+Team&background=EF7D00&color=fff" class="w-12 h-12 rounded-full">
                                            <div class="absolute bottom-0 right-0 w-3 h-3 bg-green-500 rounded-full border-2 border-white"></div>
                                        </div>
                                        <div class="flex-1">
                                            <p class="font-semibold text-gray-800 text-sm">HQ Team</p>
                                            <p class="text-xs text-gray-500 truncate">Neue Schulung verf√ºgbar</p>
                                        </div>
                                        <span class="bg-vit-orange text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">2</span>
                                    </div>

                                    <div class="flex items-center space-x-3 p-3 hover:bg-gray-50 rounded-lg cursor-pointer">
                                        <div class="relative">
                                            <img src="https://ui-avatars.com/api/?name=Thomas+Schmidt&background=626062&color=fff" class="w-12 h-12 rounded-full">
                                            <div class="absolute bottom-0 right-0 w-3 h-3 bg-green-500 rounded-full border-2 border-white"></div>
                                        </div>
                                        <div class="flex-1">
                                            <p class="font-semibold text-gray-800 text-sm">Thomas Schmidt</p>
                                            <p class="text-xs text-gray-500 truncate">Kunde wartet auf R√ºckruf...</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="lg:col-span-2 vit-card flex flex-col" style="height: 600px;">
                                <div class="border-b p-4 flex items-center space-x-3">
                                    <img src="https://ui-avatars.com/api/?name=HQ+Team&background=EF7D00&color=fff" class="w-10 h-10 rounded-full">
                                    <div>
                                        <p class="font-semibold text-gray-800">HQ Team</p>
                                        <p class="text-xs text-green-500">‚óè Online</p>
                                    </div>
                                </div>

                                <div class="flex-1 overflow-y-auto p-4">
                                    <div class="space-y-4">
                                        <div class="chat-message received">
                                            <p class="text-sm">Hey! Die neuen Marketing-Materialien sind online üéâ</p>
                                            <p class="text-xs text-gray-500 mt-1">10:23</p>
                                        </div>

                                        <div class="chat-message sent">
                                            <p class="text-sm">Super, danke! Schaue ich mir gleich an.</p>
                                            <p class="text-xs text-white text-opacity-80 mt-1">10:25</p>
                                        </div>

                                        <div class="chat-message received">
                                            <p class="text-sm">Die Schulung am 22.02. - habt ihr euch schon angemeldet?</p>
                                            <p class="text-xs text-gray-500 mt-1">10:30</p>
                                        </div>
                                    </div>
                                </div>

                                <div class="border-t p-4">
                                    <div class="flex space-x-2">
                                        <input type="text" placeholder="Nachricht schreiben..." class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-vit-orange">
                                        <button class="bg-vit-orange text-white px-6 py-2 rounded-lg hover:opacity-90">
                                            Senden
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Forum Section (hidden by default) -->
                    <div id="forumSection" class="view-hidden">
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            <div class="lg:col-span-2">
                                <div class="vit-card p-6 mb-4">
                                    <button class="bg-vit-orange text-white px-6 py-2 rounded-lg hover:opacity-90">+ Neues Thema</button>
                                </div>

                                <div class="space-y-4">
                                    <div class="vit-card p-6 forum-post">
                                        <div class="flex items-start space-x-4">
                                            <img src="https://ui-avatars.com/api/?name=HQ+Marketing&background=EF7D00&color=fff" class="w-12 h-12 rounded-full">
                                            <div class="flex-1">
                                                <div class="flex items-center justify-between mb-2">
                                                    <h3 class="font-semibold text-gray-800">Fr√ºhjahrs-Kampagne 2026 ist live!</h3>
                                                    <span class="text-xs text-gray-500">vor 2 Stunden</span>
                                                </div>
                                                <p class="text-sm text-gray-600 mb-3">
                                                    Die Materialien sind jetzt verf√ºgbar! W√ºrde mich √ºber euer Feedback freuen...
                                                </p>
                                                <div class="flex items-center space-x-4 text-sm text-gray-500">
                                                    <span>üí¨ 8 Antworten</span>
                                                    <span>üëÅÔ∏è 42 Views</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="vit-card p-6 forum-post">
                                        <div class="flex items-start space-x-4">
                                            <img src="https://ui-avatars.com/api/?name=Stefan+Meyer&background=626062&color=fff" class="w-12 h-12 rounded-full">
                                            <div class="flex-1">
                                                <div class="flex items-center justify-between mb-2">
                                                    <h3 class="font-semibold text-gray-800">Best Practice: 3D-Vermessung</h3>
                                                    <span class="text-xs text-gray-500">gestern</span>
                                                </div>
                                                <p class="text-sm text-gray-600 mb-3">
                                                    Wie integriert ihr die 3D-Vermessung in den Beratungsprozess?
                                                </p>
                                                <div class="flex items-center space-x-4 text-sm text-gray-500">
                                                    <span>üí¨ 12 Antworten</span>
                                                    <span>üëÅÔ∏è 67 Views</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div>
                                <div class="vit-card p-6 mb-4">
                                    <h3 class="font-semibold text-gray-800 mb-4">Kategorien</h3>
                                    <div class="space-y-2">
                                        <a href="#" class="flex items-center justify-between p-2 hover:bg-gray-50 rounded">
                                            <span class="text-sm text-gray-700">üì¢ Ank√ºndigungen</span>
                                            <span class="text-xs bg-gray-200 px-2 py-1 rounded">8</span>
                                        </a>
                                        <a href="#" class="flex items-center justify-between p-2 hover:bg-gray-50 rounded">
                                            <span class="text-sm text-gray-700">üí° Best Practices</span>
                                            <span class="text-xs bg-gray-200 px-2 py-1 rounded">23</span>
                                        </a>
                                        <a href="#" class="flex items-center justify-between p-2 hover:bg-gray-50 rounded">
                                            <span class="text-sm text-gray-700">üìä Marketing</span>
                                            <span class="text-xs bg-gray-200 px-2 py-1 rounded">31</span>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="chatView" class="view" style="display: none;">
                    <h1 class="h1-headline text-gray-800 mb-6" data-i18n="h_chat">CHAT</h1>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="vit-card p-4">
                            <h3 class="font-semibold text-gray-800 mb-4">Kontakte</h3>
                            <input type="text" placeholder="Suchen..." class="w-full px-3 py-2 border border-gray-300 rounded-lg mb-4 focus:outline-none focus:border-vit-orange">
                            
                            <div class="space-y-2">
                                <div class="flex items-center space-x-3 p-3 hover:bg-gray-50 rounded-lg cursor-pointer bg-gray-100">
                                    <div class="relative">
                                        <img src="https://ui-avatars.com/api/?name=Markus+Unger&background=EF7D00&color=fff" class="w-12 h-12 rounded-full">
                                        <div class="absolute bottom-0 right-0 w-3 h-3 bg-green-500 rounded-full border-2 border-white"></div>
                                    </div>
                                    <div class="flex-1">
                                        <p class="font-semibold text-gray-800 text-sm">Markus Unger</p>
                                        <p class="text-xs text-gray-500 truncate">Super, danke f√ºr die Info!</p>
                                    </div>
                                    <span class="bg-vit-orange text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">2</span>
                                </div>

                                <div class="flex items-center space-x-3 p-3 hover:bg-gray-50 rounded-lg cursor-pointer">
                                    <div class="relative">
                                        <img src="https://ui-avatars.com/api/?name=Stefan+Meyer&background=626062&color=fff" class="w-12 h-12 rounded-full">
                                        <div class="absolute bottom-0 right-0 w-3 h-3 bg-green-500 rounded-full border-2 border-white"></div>
                                    </div>
                                    <div class="flex-1">
                                        <p class="font-semibold text-gray-800 text-sm">Stefan Meyer</p>
                                        <p class="text-xs text-gray-500 truncate">Kannst du mir das Dokument...</p>
                                    </div>
                                </div>

                                <div class="flex items-center space-x-3 p-3 hover:bg-gray-50 rounded-lg cursor-pointer">
                                    <div class="relative">
                                        <img src="https://ui-avatars.com/api/?name=Julia+Fischer&background=EF7D00&color=fff" class="w-12 h-12 rounded-full">
                                        <div class="absolute bottom-0 right-0 w-3 h-3 bg-gray-400 rounded-full border-2 border-white"></div>
                                    </div>
                                    <div class="flex-1">
                                        <p class="font-semibold text-gray-800 text-sm">Julia Fischer</p>
                                        <p class="text-xs text-gray-500 truncate">Gerne! Schicke ich dir gleich</p>
                                    </div>
                                </div>

                                <div class="flex items-center space-x-3 p-3 hover:bg-gray-50 rounded-lg cursor-pointer">
                                    <div class="relative">
                                        <img src="https://ui-avatars.com/api/?name=Team+HQ&background=626062&color=fff" class="w-12 h-12 rounded-full">
                                        <div class="absolute bottom-0 right-0 w-3 h-3 bg-green-500 rounded-full border-2 border-white"></div>
                                    </div>
                                    <div class="flex-1">
                                        <p class="font-semibold text-gray-800 text-sm">Team HQ</p>
                                        <p class="text-xs text-gray-500 truncate">Neue Schulung n√§chste Woche</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="lg:col-span-2 vit-card flex flex-col" style="height: 600px;">
                            <div class="border-b p-4 flex items-center space-x-3">
                                <img src="https://ui-avatars.com/api/?name=Markus+Unger&background=EF7D00&color=fff" class="w-10 h-10 rounded-full">
                                <div>
                                    <p class="font-semibold text-gray-800">Markus Unger</p>
                                    <p class="text-xs text-green-500">‚óè Online</p>
                                </div>
                            </div>

                            <div class="flex-1 overflow-y-auto p-4">
                                <div class="space-y-4">
                                    <div class="chat-message received">
                                        <p class="text-sm">Hey! Hast du schon die neuen Marketing-Materialien gesehen?</p>
                                        <p class="text-xs text-gray-500 mt-1">10:23</p>
                                    </div>

                                    <div class="chat-message sent">
                                        <p class="text-sm">Ja, sehen super aus! Vor allem die neue Fr√ºhjahrs-Kampagne.</p>
                                        <p class="text-xs text-white text-opacity-80 mt-1">10:25</p>
                                    </div>

                                    <div class="chat-message received">
                                        <p class="text-sm">Freut mich! Kannst du die gleich bei euch im Laden einsetzen?</p>
                                        <p class="text-xs text-gray-500 mt-1">10:26</p>
                                    </div>

                                    <div class="chat-message sent">
                                        <p class="text-sm">Auf jeden Fall! Wir planen das ab n√§chster Woche.</p>
                                        <p class="text-xs text-white text-opacity-80 mt-1">10:28</p>
                                    </div>

                                    <div class="chat-message received">
                                        <p class="text-sm">Super, danke f√ºr die Info! üëç</p>
                                        <p class="text-xs text-gray-500 mt-1">10:30</p>
                                    </div>
                                </div>
                            </div>

                            <div class="border-t p-4">
                                <div class="flex space-x-2">
                                    <input type="text" placeholder="Nachricht schreiben..." class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-vit-orange">
                                    <button class="bg-vit-orange text-white px-6 py-2 rounded-lg hover:opacity-90">
                                        Senden
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Other views placeholders -->
                <div id="appointmentsView" class="view" style="display: none;">
                    <h1 class="h1-headline text-gray-800 mb-6" data-i18n="h_calendar">TERMINE</h1>
                    <div class="vit-card p-6">
                        <p class="text-gray-600">Terminkalender wird hier angezeigt...</p>
                    </div>
                </div>

                <div id="todosView" class="view" style="display: none;">
                    <h1 class="h1-headline text-gray-800 mb-6" data-i18n="h_todos">TODOS</h1>
                    <div class="vit-card p-6">
                        <p class="text-gray-600">Todo-Liste wird hier angezeigt...</p>
                    </div>
                </div>

                <div id="financesView" class="view" style="display: none;">
                    <h1 class="h1-headline text-gray-800 mb-6">FILIAL-PERFORMANCE COCKPIT</h1>
                    
                    <div class="flex justify-between items-center mb-6">
                        <div>
                            <p class="text-sm text-gray-500">Unternehmen / Standort: <strong>vit:bikes Grafrath</strong></p>
                            <p class="text-sm text-gray-500">Jahr: <strong>2026</strong></p>
                        </div>
                        <div class="flex space-x-2">
                            <button class="px-4 py-2 bg-vit-orange text-white rounded-lg text-sm">2026</button>
                            <button class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg text-sm hover:bg-gray-300">2026-01</button>
                        </div>
                    </div>

                    <!-- Top KPI Cards -->
                    <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                        <!-- Umsatz -->
                        <div class="vit-card p-6">
                            <p class="text-xs text-gray-500 uppercase mb-2">Umsatz</p>
                            <p class="text-3xl font-bold text-gray-800">55 Tsd ‚Ç¨</p>
                        </div>

                        <!-- Rohertrag -->
                        <div class="vit-card p-6">
                            <p class="text-xs text-gray-500 uppercase mb-2">Rohertrag</p>
                            <p class="text-3xl font-bold text-gray-800">21 Tsd ‚Ç¨</p>
                        </div>

                        <!-- Rohertrag Marge % -->
                        <div class="vit-card p-6">
                            <p class="text-xs text-gray-500 uppercase mb-2">Rohertrag Marge %</p>
                            <p class="text-3xl font-bold text-gray-800">38,88%</p>
                        </div>

                        <!-- Gesamtkosten -->
                        <div class="vit-card p-6">
                            <p class="text-xs text-gray-500 uppercase mb-2">Gesamtkosten</p>
                            <p class="text-3xl font-bold text-gray-800">25 Tsd ‚Ç¨</p>
                        </div>

                        <!-- EBIT -->
                        <div class="vit-card p-6">
                            <p class="text-xs text-gray-500 uppercase mb-2">EBIT</p>
                            <p class="text-3xl font-bold text-red-600">-4 Tsd ‚Ç¨</p>
                        </div>

                        <!-- EBIT-Marge % -->
                        <div class="vit-card p-6 bg-red-50">
                            <p class="text-xs text-gray-500 uppercase mb-2">EBIT-Marge %</p>
                            <p class="text-3xl font-bold text-red-600">-7,16%</p>
                        </div>

                        <!-- Kostenquote % -->
                        <div class="vit-card p-6">
                            <p class="text-xs text-gray-500 uppercase mb-2">Kostenquote %</p>
                            <p class="text-3xl font-bold text-gray-800">46,13%</p>
                        </div>

                        <!-- Umsatz YoY % -->
                        <div class="vit-card p-6">
                            <p class="text-xs text-gray-500 uppercase mb-2">Umsatz YoY %</p>
                            <p class="text-3xl font-bold text-green-600">78,54%</p>
                        </div>
                    </div>

                    <!-- Charts Row 1 -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                        <!-- Umsatz vs Plan -->
                        <div class="vit-card p-6">
                            <h2 class="h2-headline text-gray-800 mb-4">UMSATZ VS PLAN</h2>
                            <div class="space-y-3">
                                <div class="flex items-end space-x-4">
                                    <div class="flex-1">
                                        <div class="text-xs text-gray-500 mb-1">Januar</div>
                                        <div class="flex space-x-2">
                                            <div class="bg-vit-orange h-32 rounded-t flex items-end justify-center pb-2 text-white text-xs font-semibold" style="width: 60%">
                                                55k
                                            </div>
                                            <div class="bg-gray-300 h-24 rounded-t flex items-end justify-center pb-2 text-gray-700 text-xs font-semibold" style="width: 40%">
                                                40k
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-3 text-xs">
                                    <div class="flex items-center space-x-1">
                                        <div class="w-3 h-3 bg-vit-orange rounded"></div>
                                        <span>Umsatz</span>
                                    </div>
                                    <div class="flex items-center space-x-1">
                                        <div class="w-3 h-3 bg-gray-300 rounded"></div>
                                        <span>Plan</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Rohertrag vs Plan -->
                        <div class="vit-card p-6">
                            <h2 class="h2-headline text-gray-800 mb-4">ROHERTRAG VS. PLAN</h2>
                            <div class="space-y-3">
                                <div class="flex items-end space-x-4">
                                    <div class="flex-1">
                                        <div class="text-xs text-gray-500 mb-1">Januar</div>
                                        <div class="flex space-x-2">
                                            <div class="bg-vit-orange h-28 rounded-t flex items-end justify-center pb-2 text-white text-xs font-semibold" style="width: 60%">
                                                21k
                                            </div>
                                            <div class="bg-gray-300 h-20 rounded-t flex items-end justify-center pb-2 text-gray-700 text-xs font-semibold" style="width: 40%">
                                                18k
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-3 text-xs">
                                    <div class="flex items-center space-x-1">
                                        <div class="w-3 h-3 bg-vit-orange rounded"></div>
                                        <span>Rohertrag</span>
                                    </div>
                                    <div class="flex items-center space-x-1">
                                        <div class="w-3 h-3 bg-gray-300 rounded"></div>
                                        <span>Plan</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- EBIT vs Plan -->
                        <div class="vit-card p-6">
                            <h2 class="h2-headline text-gray-800 mb-4">EBIT VS. PLAN</h2>
                            <div class="space-y-3">
                                <div class="flex items-end justify-center space-x-4 h-32">
                                    <div class="flex flex-col items-center">
                                        <div class="bg-vit-orange w-16 h-16 rounded flex items-center justify-center text-white text-xs font-semibold">
                                            -4k
                                        </div>
                                        <div class="text-xs text-gray-500 mt-2">EBIT</div>
                                    </div>
                                    <div class="flex flex-col items-center">
                                        <div class="bg-gray-300 w-16 h-24 rounded flex items-center justify-center text-gray-700 text-xs font-semibold">
                                            -7k
                                        </div>
                                        <div class="text-xs text-gray-500 mt-2">Plan</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- YTD Metrics -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                        <div class="vit-card p-6 bg-green-50 border border-green-200">
                            <p class="text-sm text-gray-600 mb-2">Umsatz YTD vs VJ%</p>
                            <p class="text-4xl font-bold text-green-600">‚Üë 78,5%</p>
                        </div>

                        <div class="vit-card p-6 bg-red-50 border border-red-200">
                            <p class="text-sm text-gray-600 mb-2">Kosten YTD vs VJ %</p>
                            <p class="text-4xl font-bold text-red-600">‚Üë 62,0%</p>
                        </div>

                        <div class="vit-card p-6 bg-green-50 border border-green-200">
                            <p class="text-sm text-gray-600 mb-2">EBIT-Marge Œî (%-Pkt.)</p>
                            <p class="text-4xl font-bold text-green-600">4,3 pp</p>
                        </div>
                    </div>

                    <!-- Charts Row 2 -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                        <!-- Kostenstruktur Pie Chart -->
                        <div class="vit-card p-6">
                            <h2 class="h2-headline text-gray-800 mb-4">KOSTENSTRUKTUR (% DER GESAMTKOSTEN)</h2>
                            <div class="flex items-center justify-center">
                                <div class="relative w-48 h-48">
                                    <svg viewBox="0 0 100 100" class="transform -rotate-90">
                                        <!-- Personalkosten 53% -->
                                        <circle cx="50" cy="50" r="40" fill="none" stroke="#EF7D00" stroke-width="80" stroke-dasharray="167 335" stroke-dashoffset="0"></circle>
                                        <!-- Werbe-/Reisekosten 17% -->
                                        <circle cx="50" cy="50" r="40" fill="none" stroke="#F59E0B" stroke-width="80" stroke-dasharray="54 335" stroke-dashoffset="-167"></circle>
                                        <!-- Raummieten 8% -->
                                        <circle cx="50" cy="50" r="40" fill="none" stroke="#FCD34D" stroke-width="80" stroke-dasharray="25 335" stroke-dashoffset="-221"></circle>
                                        <!-- Sonstige 22% -->
                                        <circle cx="50" cy="50" r="40" fill="none" stroke="#FEF3C7" stroke-width="80" stroke-dasharray="69 335" stroke-dashoffset="-246"></circle>
                                    </svg>
                                </div>
                                <div class="ml-6 space-y-2 text-sm">
                                    <div class="flex items-center space-x-2">
                                        <div class="w-4 h-4 bg-vit-orange rounded"></div>
                                        <span>Personalkosten</span>
                                        <span class="font-semibold">53%</span>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <div class="w-4 h-4 bg-amber-500 rounded"></div>
                                        <span>Werbe-/Reisekosten</span>
                                        <span class="font-semibold">17%</span>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <div class="w-4 h-4 bg-amber-300 rounded"></div>
                                        <span>Raummieten</span>
                                        <span class="font-semibold">8%</span>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <div class="w-4 h-4 bg-amber-100 rounded"></div>
                                        <span>Sonstige</span>
                                        <span class="font-semibold">22%</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Kosten vs Plan Trend -->
                        <div class="vit-card p-6">
                            <h2 class="h2-headline text-gray-800 mb-4">KOSTEN VS PLAN - TREND</h2>
                            <div class="space-y-3">
                                <div class="flex items-center justify-between">
                                    <span class="text-sm text-gray-600">Personalkosten</span>
                                    <div class="flex items-center space-x-2">
                                        <div class="flex items-end space-x-1">
                                            <div class="bg-vit-orange w-2 h-12 rounded-t"></div>
                                            <div class="bg-gray-300 w-2 h-10 rounded-t"></div>
                                        </div>
                                        <span class="text-xs text-gray-600 w-16">25% / 32%</span>
                                    </div>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-sm text-gray-600">Raummieten</span>
                                    <div class="flex items-center space-x-2">
                                        <div class="flex items-end space-x-1">
                                            <div class="bg-vit-orange w-2 h-8 rounded-t"></div>
                                            <div class="bg-gray-300 w-2 h-10 rounded-t"></div>
                                        </div>
                                        <span class="text-xs text-gray-600 w-16">8% / 10%</span>
                                    </div>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-sm text-gray-600">Werbe-/Reisekosten</span>
                                    <div class="flex items-center space-x-2">
                                        <div class="flex items-end space-x-1">
                                            <div class="bg-vit-orange w-2 h-4 rounded-t"></div>
                                            <div class="bg-gray-300 w-2 h-6 rounded-t"></div>
                                        </div>
                                        <span class="text-xs text-gray-600 w-16">4% / 7%</span>
                                    </div>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-sm text-gray-600">Sonstige</span>
                                    <div class="flex items-center space-x-2">
                                        <div class="flex items-end space-x-1">
                                            <div class="bg-vit-orange w-2 h-10 rounded-t"></div>
                                            <div class="bg-gray-300 w-2 h-14 rounded-t"></div>
                                        </div>
                                        <span class="text-xs text-gray-600 w-16">10% / 13%</span>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-3 text-xs pt-2 border-t">
                                    <div class="flex items-center space-x-1">
                                        <div class="w-3 h-3 bg-vit-orange rounded"></div>
                                        <span>Kosten Anteil am Umsatz %</span>
                                    </div>
                                    <div class="flex items-center space-x-1">
                                        <div class="w-3 h-3 bg-gray-300 rounded"></div>
                                        <span>Kosten Anteil am Plan-Umsatz %</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Benchmarking -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                        <div class="vit-card p-6 bg-green-50 border border-green-200">
                            <h2 class="h2-headline text-gray-800 mb-4">ABWEICHUNG ROHERTRAGSMARGE ZUM STANDORT-BENCHMARK (%-PKT.)</h2>
                            <p class="text-5xl font-bold text-green-600">29,6 pp</p>
                            <p class="text-sm text-gray-600 mt-2">√úberdurchschnittliche Leistung</p>
                        </div>

                        <div class="vit-card p-6 bg-green-50 border border-green-200">
                            <h2 class="h2-headline text-gray-800 mb-4">BENCHMARK IM VERGLEICH ZUR UMSATZKLASSE</h2>
                            <p class="text-5xl font-bold text-green-600">‚Üë 107,7%</p>
                            <p class="text-sm text-gray-600 mt-2">Weit √ºber dem Durchschnitt der Umsatzklasse</p>
                        </div>
                    </div>

                    <!-- Marketing -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="vit-card p-6">
                            <h2 class="h2-headline text-gray-800 mb-4">MARKETINGKOSTEN ZU UMSATZ (%)</h2>
                            <p class="text-4xl font-bold text-gray-800">4%</p>
                        </div>

                        <div class="vit-card p-6">
                            <h2 class="h2-headline text-gray-800 mb-4">MARKETINGKOSTEN ANTEIL AN GESAMTKOSTEN (%)</h2>
                            <p class="text-4xl font-bold text-gray-800">8%</p>
                        </div>

                        <div class="vit-card p-6">
                            <h2 class="h2-headline text-gray-800 mb-4">MARKETINGKOSTEN STANDORT (‚Ç¨)</h2>
                            <p class="text-4xl font-bold text-vit-orange">2.039,00 ‚Ç¨</p>
                        </div>
                    </div>
                </div>
                <div id="teamView" class="view" style="display: none;">
                    <h1 class="h1-headline text-gray-800 mb-6">TEAM</h1>
                    
                    <!-- Team √úbersicht -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                        <div class="vit-card p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-500 text-sm">Mitarbeiter</p>
                                    <p class="text-3xl font-bold text-gray-800 mt-2">8</p>
                                </div>
                                <div class="bg-blue-100 p-3 rounded-full">
                                    <svg class="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
                                    </svg>
                                </div>
                            </div>
                            <div class="mt-4 text-xs text-gray-500">
                                5 Vollzeit, 3 Teilzeit
                            </div>
                        </div>

                        <div class="vit-card p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-500 text-sm">√ò Zufriedenheit</p>
                                    <p class="text-3xl font-bold text-gray-800 mt-2">4.6/5</p>
                                </div>
                                <div class="bg-green-100 p-3 rounded-full">
                                    <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                    </svg>
                                </div>
                            </div>
                            <div class="mt-4 text-xs text-gray-500">
                                Letzte Team-Umfrage
                            </div>
                        </div>

                        <div class="vit-card p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-500 text-sm">Krankheitstage</p>
                                    <p class="text-3xl font-bold text-gray-800 mt-2">12</p>
                                </div>
                                <div class="bg-yellow-100 p-3 rounded-full">
                                    <svg class="w-8 h-8 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                                    </svg>
                                </div>
                            </div>
                            <div class="mt-4 text-xs text-gray-500">
                                Dieses Quartal
                            </div>
                        </div>

                        <div class="vit-card p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-500 text-sm">Schulungen</p>
                                    <p class="text-3xl font-bold text-gray-800 mt-2">23</p>
                                </div>
                                <div class="bg-vit-orange bg-opacity-10 p-3 rounded-full">
                                    <svg class="w-8 h-8 text-vit-orange" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                                    </svg>
                                </div>
                            </div>
                            <div class="mt-4 text-xs text-gray-500">
                                Abgeschlossen 2026
                            </div>
                        </div>
                    </div>

                    <!-- Mitarbeiter Liste -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                        <div class="vit-card p-6">
                            <h2 class="h2-headline text-gray-800 mb-4">MITARBEITER</h2>
                            <div class="space-y-3">
                                <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                                    <div class="flex items-center space-x-4">
                                        <img src="https://ui-avatars.com/api/?name=Thomas+Schmidt&background=EF7D00&color=fff" class="w-12 h-12 rounded-full">
                                        <div>
                                            <h3 class="font-semibold text-gray-800">Thomas Schmidt</h3>
                                            <p class="text-sm text-gray-500">Verkaufsleiter</p>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <p class="text-sm font-semibold text-vit-orange">32 Verk√§ufe</p>
                                        <p class="text-xs text-gray-500">Diesen Monat</p>
                                    </div>
                                </div>

                                <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                                    <div class="flex items-center space-x-4">
                                        <img src="https://ui-avatars.com/api/?name=Sarah+Mueller&background=626062&color=fff" class="w-12 h-12 rounded-full">
                                        <div>
                                            <h3 class="font-semibold text-gray-800">Sarah M√ºller</h3>
                                            <p class="text-sm text-gray-500">Verkauf & Beratung</p>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <p class="text-sm font-semibold text-vit-orange">28 Verk√§ufe</p>
                                        <p class="text-xs text-gray-500">Diesen Monat</p>
                                    </div>
                                </div>

                                <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                                    <div class="flex items-center space-x-4">
                                        <img src="https://ui-avatars.com/api/?name=Michael+Weber&background=EF7D00&color=fff" class="w-12 h-12 rounded-full">
                                        <div>
                                            <h3 class="font-semibold text-gray-800">Michael Weber</h3>
                                            <p class="text-sm text-gray-500">Werkstattleiter</p>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <p class="text-sm font-semibold text-green-600">98% Auslastung</p>
                                        <p class="text-xs text-gray-500">Werkstatt</p>
                                    </div>
                                </div>

                                <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                                    <div class="flex items-center space-x-4">
                                        <img src="https://ui-avatars.com/api/?name=Lisa+Klein&background=626062&color=fff" class="w-12 h-12 rounded-full">
                                        <div>
                                            <h3 class="font-semibold text-gray-800">Lisa Klein</h3>
                                            <p class="text-sm text-gray-500">Zweiradmechatronikerin</p>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <p class="text-sm font-semibold text-green-600">142 Auftr√§ge</p>
                                        <p class="text-xs text-gray-500">Diesen Monat</p>
                                    </div>
                                </div>

                                <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                                    <div class="flex items-center space-x-4">
                                        <img src="https://ui-avatars.com/api/?name=Jan+Hoffmann&background=EF7D00&color=fff" class="w-12 h-12 rounded-full">
                                        <div>
                                            <h3 class="font-semibold text-gray-800">Jan Hoffmann</h3>
                                            <p class="text-sm text-gray-500">Verkauf (Teilzeit)</p>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <p class="text-sm font-semibold text-vit-orange">15 Verk√§ufe</p>
                                        <p class="text-xs text-gray-500">Diesen Monat</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Schichtplan -->
                        <div class="vit-card p-6">
                            <h2 class="h2-headline text-gray-800 mb-4">SCHICHTPLAN DIESE WOCHE</h2>
                            <div class="space-y-2">
                                <div class="border-b pb-2">
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="text-sm font-semibold text-gray-700">Montag, 10.02.</span>
                                        <span class="text-xs text-gray-500">4 Mitarbeiter</span>
                                    </div>
                                    <div class="flex flex-wrap gap-2">
                                        <span class="text-xs bg-vit-orange bg-opacity-10 text-vit-orange px-2 py-1 rounded">Thomas (9-18h)</span>
                                        <span class="text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded">Sarah (9-18h)</span>
                                        <span class="text-xs bg-green-100 text-green-700 px-2 py-1 rounded">Michael (8-17h)</span>
                                        <span class="text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded">Lisa (8-17h)</span>
                                    </div>
                                </div>

                                <div class="border-b pb-2">
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="text-sm font-semibold text-gray-700">Dienstag, 11.02.</span>
                                        <span class="text-xs text-gray-500">5 Mitarbeiter</span>
                                    </div>
                                    <div class="flex flex-wrap gap-2">
                                        <span class="text-xs bg-vit-orange bg-opacity-10 text-vit-orange px-2 py-1 rounded">Thomas (9-18h)</span>
                                        <span class="text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded">Sarah (9-18h)</span>
                                        <span class="text-xs bg-green-100 text-green-700 px-2 py-1 rounded">Michael (8-17h)</span>
                                        <span class="text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded">Lisa (8-17h)</span>
                                        <span class="text-xs bg-yellow-100 text-yellow-700 px-2 py-1 rounded">Jan (14-20h)</span>
                                    </div>
                                </div>

                                <div class="border-b pb-2">
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="text-sm font-semibold text-gray-700">Mittwoch, 12.02.</span>
                                        <span class="text-xs text-gray-500">4 Mitarbeiter</span>
                                    </div>
                                    <div class="flex flex-wrap gap-2">
                                        <span class="text-xs bg-vit-orange bg-opacity-10 text-vit-orange px-2 py-1 rounded">Thomas (9-18h)</span>
                                        <span class="text-xs bg-green-100 text-green-700 px-2 py-1 rounded">Michael (8-17h)</span>
                                        <span class="text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded">Lisa (8-17h)</span>
                                        <span class="text-xs bg-yellow-100 text-yellow-700 px-2 py-1 rounded">Jan (14-20h)</span>
                                    </div>
                                </div>

                                <div class="border-b pb-2">
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="text-sm font-semibold text-gray-700">Donnerstag, 13.02.</span>
                                        <span class="text-xs text-gray-500">5 Mitarbeiter</span>
                                    </div>
                                    <div class="flex flex-wrap gap-2">
                                        <span class="text-xs bg-vit-orange bg-opacity-10 text-vit-orange px-2 py-1 rounded">Thomas (9-18h)</span>
                                        <span class="text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded">Sarah (9-18h)</span>
                                        <span class="text-xs bg-green-100 text-green-700 px-2 py-1 rounded">Michael (8-17h)</span>
                                        <span class="text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded">Lisa (8-17h)</span>
                                        <span class="text-xs bg-yellow-100 text-yellow-700 px-2 py-1 rounded">Jan (14-20h)</span>
                                    </div>
                                </div>

                                <div class="border-b pb-2">
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="text-sm font-semibold text-vit-orange">Freitag, 14.02. (Heute)</span>
                                        <span class="text-xs text-gray-500">5 Mitarbeiter</span>
                                    </div>
                                    <div class="flex flex-wrap gap-2">
                                        <span class="text-xs bg-vit-orange text-white px-2 py-1 rounded">Thomas (9-18h)</span>
                                        <span class="text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded">Sarah (9-18h)</span>
                                        <span class="text-xs bg-green-100 text-green-700 px-2 py-1 rounded">Michael (8-17h)</span>
                                        <span class="text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded">Lisa (8-17h)</span>
                                        <span class="text-xs bg-yellow-100 text-yellow-700 px-2 py-1 rounded">Jan (14-20h)</span>
                                    </div>
                                </div>

                                <div class="pb-2">
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="text-sm font-semibold text-gray-700">Samstag, 15.02.</span>
                                        <span class="text-xs text-gray-500">4 Mitarbeiter</span>
                                    </div>
                                    <div class="flex flex-wrap gap-2">
                                        <span class="text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded">Sarah (9-16h)</span>
                                        <span class="text-xs bg-green-100 text-green-700 px-2 py-1 rounded">Michael (9-16h)</span>
                                        <span class="text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded">Lisa (9-16h)</span>
                                        <span class="text-xs bg-yellow-100 text-yellow-700 px-2 py-1 rounded">Jan (9-16h)</span>
                                    </div>
                                </div>
                            </div>

                            <button class="mt-4 w-full bg-vit-orange text-white py-2 rounded-lg hover:opacity-90 text-sm">
                                Schichtplan bearbeiten
                            </button>
                        </div>
                    </div>

                    <!-- Anstehende Schulungen -->
                    <div class="vit-card p-6">
                        <h2 class="h2-headline text-gray-800 mb-4">ANSTEHENDE SCHULUNGEN</h2>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="p-4 bg-vit-orange bg-opacity-5 border border-vit-orange rounded-lg">
                                <h4 class="font-semibold text-gray-800 mb-2">E-Bike Antriebstechnik 2026</h4>
                                <p class="text-sm text-gray-600 mb-3">Bosch & Shimano Updates</p>
                                <div class="flex items-center justify-between text-xs">
                                    <span class="text-gray-500">üìÖ 22.02.2026</span>
                                    <span class="text-gray-500">üë• 3 Teilnehmer</span>
                                </div>
                            </div>

                            <div class="p-4 bg-blue-50 border border-blue-200 rounded-lg">
                                <h4 class="font-semibold text-gray-800 mb-2">Verkaufstraining Premium</h4>
                                <p class="text-sm text-gray-600 mb-3">Hochpreisige R√§der verkaufen</p>
                                <div class="flex items-center justify-between text-xs">
                                    <span class="text-gray-500">üìÖ 05.03.2026</span>
                                    <span class="text-gray-500">üë• 4 Teilnehmer</span>
                                </div>
                            </div>

                            <div class="p-4 bg-green-50 border border-green-200 rounded-lg">
                                <h4 class="font-semibold text-gray-800 mb-2">Kundenservice Excellence</h4>
                                <p class="text-sm text-gray-600 mb-3">Kundenzufriedenheit steigern</p>
                                <div class="flex items-center justify-between text-xs">
                                    <span class="text-gray-500">üìÖ 12.03.2026</span>
                                    <span class="text-gray-500">üë• Alle</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="partnersView" class="view" style="display: none;">
                    <h1 class="h1-headline text-gray-800 mb-6">STANDORTE</h1>
                    <div class="vit-card p-6">
                        <p class="text-gray-600">Partner-√úbersicht wird hier angezeigt...</p>
                    </div>
                </div>

                <div id="analyticsView" class="view" style="display: none;">
                    <h1 class="h1-headline text-gray-800 mb-6">ANALYTICS</h1>
                    <div class="vit-card p-6">
                        <p class="text-gray-600">Analytics-Dashboard wird hier angezeigt...</p>
                    </div>
                </div>

                <div id="documentsView" class="view" style="display: none;">
                    <h1 class="h1-headline text-gray-800 mb-6">DOKUMENTE</h1>
                    <div class="vit-card p-6">
                        <p class="text-gray-600">Dokumentenverwaltung wird hier angezeigt...</p>
                    </div>
                </div>

                <div id="knowledgeView" class="view" style="display: none;">
                    <h1 class="h1-headline text-gray-800 mb-6">INFOS (WISSEN)</h1>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div class="vit-card p-6 hover:shadow-lg cursor-pointer">
                            <div class="bg-vit-orange bg-opacity-10 p-4 rounded-lg mb-4">
                                <svg class="w-12 h-12 text-vit-orange mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                </svg>
                            </div>
                            <h3 class="font-semibold text-gray-800 mb-2">Produkt-Handb√ºcher</h3>
                            <p class="text-sm text-gray-600 mb-4">Technische Dokumentation aller E-Bike Hersteller</p>
                            <span class="text-xs text-gray-500">142 Dokumente</span>
                        </div>

                        <div class="vit-card p-6 hover:shadow-lg cursor-pointer">
                            <div class="bg-blue-100 p-4 rounded-lg mb-4">
                                <svg class="w-12 h-12 text-blue-600 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                                </svg>
                            </div>
                            <h3 class="font-semibold text-gray-800 mb-2">Schulungsvideos</h3>
                            <p class="text-sm text-gray-600 mb-4">Video-Tutorials zu Verkauf, Service und Technik</p>
                            <span class="text-xs text-gray-500">67 Videos</span>
                        </div>

                        <div class="vit-card p-6 hover:shadow-lg cursor-pointer">
                            <div class="bg-green-100 p-4 rounded-lg mb-4">
                                <svg class="w-12 h-12 text-green-600 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                            </div>
                            <h3 class="font-semibold text-gray-800 mb-2">FAQ</h3>
                            <p class="text-sm text-gray-600 mb-4">H√§ufig gestellte Fragen zu allen Themen</p>
                            <span class="text-xs text-gray-500">89 Eintr√§ge</span>
                        </div>

                        <div class="vit-card p-6 hover:shadow-lg cursor-pointer">
                            <div class="bg-purple-100 p-4 rounded-lg mb-4">
                                <svg class="w-12 h-12 text-purple-600 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                </svg>
                            </div>
                            <h3 class="font-semibold text-gray-800 mb-2">Werkstatt-Guides</h3>
                            <p class="text-sm text-gray-600 mb-4">Reparatur-Anleitungen und Wartungs-Tipps</p>
                            <span class="text-xs text-gray-500">54 Guides</span>
                        </div>

                        <div class="vit-card p-6 hover:shadow-lg cursor-pointer premium-feature">
                            <div class="bg-vit-orange bg-opacity-10 p-4 rounded-lg mb-4">
                                <svg class="w-12 h-12 text-vit-orange mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                                </svg>
                            </div>
                            <h3 class="font-semibold text-gray-800 mb-2">vit:bikes Akademie</h3>
                            <p class="text-sm text-gray-600 mb-4">Exklusive Schulungen f√ºr Partner</p>
                            <span class="premium-badge text-[8px] px-2 py-1">PREMIUM</span>
                        </div>

                        <div class="vit-card p-6 hover:shadow-lg cursor-pointer">
                            <div class="bg-yellow-100 p-4 rounded-lg mb-4">
                                <svg class="w-12 h-12 text-yellow-600 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                </svg>
                            </div>
                            <h3 class="font-semibold text-gray-800 mb-2">Vorlagen & Checklisten</h3>
                            <p class="text-sm text-gray-600 mb-4">Beratungs-Checklisten, Verkaufsleitf√§den</p>
                            <span class="text-xs text-gray-500">28 Vorlagen</span>
                        </div>
                    </div>
                </div>

                <!-- ===== WISSEN (Zentrale Wissensdatenbank) ===== -->
                <div id="wissenView" class="view" style="display: none;">
                    <div class="flex items-center justify-between mb-6">
                        <div>
                            <h1 class="h1-headline text-gray-800">üìö WISSENSDATENBANK</h1>
                            <p class="text-sm text-gray-500">Alle Schulungen, Handbuecher, Best Practices und FAQs an einem Ort.</p>
                        </div>
                        <div class="flex items-center space-x-2">
                            <input type="text" id="wissenSearch" placeholder="Suchen..." oninput="filterWissenGlobal()" class="px-3 py-2 border border-gray-200 rounded-lg text-sm w-48">
                        </div>
                    </div>

                    <!-- KPIs -->
                    <div class="grid grid-cols-2 lg:grid-cols-5 gap-4 mb-6" id="wissenKpis"></div>

                    <!-- Bereich-Filter -->
                    <div class="flex flex-wrap gap-2 mb-6">
                        <button onclick="filterWissenBereich('all')" class="wissen-bereich-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-vit-orange text-white" data-wbf="all">üìö Alle Bereiche</button>
                        <button onclick="filterWissenBereich('allgemein')" class="wissen-bereich-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-gray-100 text-gray-600" data-wbf="allgemein">üè¢ Allgemein</button>
                        <button onclick="filterWissenBereich('verkauf')" class="wissen-bereich-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-gray-100 text-gray-600" data-wbf="verkauf">üí∞ Verkauf</button>
                        <button onclick="filterWissenBereich('einkauf')" class="wissen-bereich-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-gray-100 text-gray-600" data-wbf="einkauf">üõí Einkauf</button>
                        <button onclick="filterWissenBereich('marketing')" class="wissen-bereich-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-gray-100 text-gray-600" data-wbf="marketing">üì£ Marketing</button>
                        <button onclick="filterWissenBereich('controlling')" class="wissen-bereich-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-gray-100 text-gray-600" data-wbf="controlling">üìä Controlling</button>
                    </div>

                    <!-- Typ-Tabs -->
                    <div class="mb-6 border-b border-gray-200">
                        <nav class="-mb-px flex space-x-6">
                            <button onclick="switchWissenTyp('akademie')" class="wissen-typ-btn whitespace-nowrap py-3 px-1 border-b-2 border-vit-orange font-semibold text-sm text-vit-orange" data-wtt="akademie">üéì Akademie</button>
                            <button onclick="switchWissenTyp('handbuecher')" class="wissen-typ-btn whitespace-nowrap py-3 px-1 border-b-2 border-transparent font-semibold text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300" data-wtt="handbuecher">üìñ Handbuecher</button>
                            <button onclick="switchWissenTyp('bestpractices')" class="wissen-typ-btn whitespace-nowrap py-3 px-1 border-b-2 border-transparent font-semibold text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300" data-wtt="bestpractices">üí° Best Practices</button>
                            <button onclick="switchWissenTyp('faq')" class="wissen-typ-btn whitespace-nowrap py-3 px-1 border-b-2 border-transparent font-semibold text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300" data-wtt="faq">‚ùì FAQ</button>
                        </nav>
                    </div>

                    <!-- Content -->
                    <div id="wissenGlobalContent" class="space-y-3"></div>
                </div>

                <!-- ===== WERBEMITTEL-SHOP ===== -->
                <div id="shopView" class="view" style="display: none;">
                    <div class="flex items-center justify-between mb-6">
                        <div>
                            <h1 class="h1-headline text-gray-800">üõçÔ∏è WERBEMITTEL-SHOP</h1>
                            <p class="text-sm text-gray-500">Offizielle vit:bikes Werbemittel fuer deinen Standort bestellen.</p>
                        </div>
                        <button onclick="document.getElementById('shopCart').classList.toggle('hidden')" class="relative bg-vit-orange text-white px-4 py-2 rounded-lg text-sm font-semibold hover:opacity-90">
                            üõí Warenkorb <span id="shopCartCount" class="ml-1 bg-white text-vit-orange rounded-full px-1.5 text-xs font-bold">0</span>
                        </button>
                    </div>

                    <!-- Cart Overlay -->
                    <div id="shopCart" class="hidden mb-6 vit-card p-5 border-2 border-vit-orange">
                        <h3 class="font-bold text-gray-800 mb-3">üõí Dein Warenkorb</h3>
                        <div id="shopCartItems" class="space-y-2 mb-4"></div>
                        <div class="flex items-center justify-between pt-3 border-t border-gray-200">
                            <span class="font-bold text-gray-800">Gesamt: <span id="shopCartTotal">0,00</span> ‚Ç¨</span>
                            <button onclick="submitShopOrder()" class="bg-vit-orange text-white px-6 py-2 rounded-lg text-sm font-semibold hover:opacity-90">Bestellen</button>
                        </div>
                    </div>

                    <!-- Filter -->
                    <div class="flex flex-wrap gap-2 mb-6">
                        <button onclick="filterShop('all')" class="shop-filter-btn text-xs px-3 py-1.5 rounded-full font-semibold bg-vit-orange text-white" data-sf="all">Alle</button>
                        <button onclick="filterShop('print')" class="shop-filter-btn text-xs px-3 py-1.5 rounded-full font-semibold bg-gray-100 text-gray-600" data-sf="print">üñ®Ô∏è Drucksachen</button>
                        <button onclick="filterShop('textil')" class="shop-filter-btn text-xs px-3 py-1.5 rounded-full font-semibold bg-gray-100 text-gray-600" data-sf="textil">üëï Textilien</button>
                        <button onclick="filterShop('display')" class="shop-filter-btn text-xs px-3 py-1.5 rounded-full font-semibold bg-gray-100 text-gray-600" data-sf="display">üè™ Displays</button>
                        <button onclick="filterShop('digital')" class="shop-filter-btn text-xs px-3 py-1.5 rounded-full font-semibold bg-gray-100 text-gray-600" data-sf="digital">üíª Digital</button>
                        <button onclick="filterShop('give')" class="shop-filter-btn text-xs px-3 py-1.5 rounded-full font-semibold bg-gray-100 text-gray-600" data-sf="give">üéÅ Giveaways</button>
                    </div>

                    <!-- Product Grid -->
                    <div id="shopGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-5"></div>

                    <!-- Order Confirmation Modal -->
                    <div id="shopOrderModal" class="hidden fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50">
                        <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4 text-center">
                            <div class="text-5xl mb-4">‚úÖ</div>
                            <h3 class="text-xl font-bold text-gray-800 mb-2">Bestellung eingegangen!</h3>
                            <p class="text-sm text-gray-500 mb-2">Deine Bestellung wird bearbeitet und an deinen Standort geliefert.</p>
                            <p class="text-xs text-gray-400 mb-6">Bestell-Nr.: VB-<span id="shopOrderNr"></span></p>
                            <button onclick="document.getElementById('shopOrderModal').classList.add('hidden')" class="bg-vit-orange text-white px-6 py-2 rounded-lg text-sm font-semibold hover:opacity-90">OK</button>
                        </div>
                    </div>
                </div>

                <div id="onboardingView" class="view" style="display: none;">
                    <h1 class="h1-headline text-gray-800 mb-6" data-i18n="h_onboarding">ONBOARDING</h1>
                    
                    <div class="mb-6">
                        <p class="text-gray-600 mb-4">Willkommen bei vit:bikes! Hier findest du alle Aufgaben f√ºr deinen erfolgreichen Start.</p>
                    </div>

                    <!-- Asana Project Container (wird dynamisch gef√ºllt) -->
                    <div id="asanaOnboardingContent">
                        <!-- Wird via JavaScript bef√ºllt -->
                    </div>

                    <!-- Static Content als Fallback -->
                    <div id="staticOnboardingContent">
                    <!-- Asana Project wird hier angezeigt -->
                    <div class="vit-card p-6 mb-6">
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="h2-headline text-gray-800">Dein Onboarding-Plan</h2>
                            <button class="text-sm text-vit-orange hover:underline font-semibold">In Asana √∂ffnen ‚Üí</button>
                        </div>
                        
                        <p class="text-sm text-gray-600 mb-6">Arbeite dich durch diese Aufgaben, um optimal vorbereitet zu sein!</p>

                        <!-- Onboarding Fortschritt -->
                        <div class="mb-6">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-sm font-semibold text-gray-700">Gesamt-Fortschritt</span>
                                <span class="text-sm font-semibold text-vit-orange">65%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-3">
                                <div class="bg-vit-orange h-3 rounded-full" style="width: 65%"></div>
                            </div>
                        </div>

                        <!-- Section: Erste Schritte -->
                        <div class="mb-6">
                            <h3 class="font-semibold text-gray-800 mb-3 flex items-center">
                                <span class="bg-green-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs mr-2">‚úì</span>
                                Erste Schritte
                            </h3>
                            <div class="space-y-2 ml-8">
                                <div class="flex items-center space-x-3 p-3 bg-green-50 rounded-lg">
                                    <input type="checkbox" checked disabled class="w-4 h-4">
                                    <span class="text-sm text-gray-700 line-through">Portalzugang einrichten</span>
                                    <span class="ml-auto text-xs text-gray-500">‚úì Erledigt</span>
                                </div>
                                <div class="flex items-center space-x-3 p-3 bg-green-50 rounded-lg">
                                    <input type="checkbox" checked disabled class="w-4 h-4">
                                    <span class="text-sm text-gray-700 line-through">Willkommensvideo ansehen</span>
                                    <span class="ml-auto text-xs text-gray-500">‚úì Erledigt</span>
                                </div>
                                <div class="flex items-center space-x-3 p-3 bg-green-50 rounded-lg">
                                    <input type="checkbox" checked disabled class="w-4 h-4">
                                    <span class="text-sm text-gray-700 line-through">Team-Mitglieder einladen</span>
                                    <span class="ml-auto text-xs text-gray-500">‚úì Erledigt</span>
                                </div>
                            </div>
                        </div>

                        <!-- Section: Produkt-Schulung -->
                        <div class="mb-6">
                            <h3 class="font-semibold text-gray-800 mb-3 flex items-center">
                                <span class="bg-vit-orange text-white rounded-full w-6 h-6 flex items-center justify-center text-xs mr-2">2/4</span>
                                Produkt-Schulung
                            </h3>
                            <div class="space-y-2 ml-8">
                                <div class="flex items-center space-x-3 p-3 bg-green-50 rounded-lg">
                                    <input type="checkbox" checked disabled class="w-4 h-4">
                                    <span class="text-sm text-gray-700 line-through">E-Bike Grundlagen Kurs absolvieren</span>
                                    <span class="ml-auto text-xs text-gray-500">‚úì Erledigt</span>
                                </div>
                                <div class="flex items-center space-x-3 p-3 bg-green-50 rounded-lg">
                                    <input type="checkbox" checked disabled class="w-4 h-4">
                                    <span class="text-sm text-gray-700 line-through">Marken-Portfolio kennenlernen</span>
                                    <span class="ml-auto text-xs text-gray-500">‚úì Erledigt</span>
                                </div>
                                <div class="flex items-center space-x-3 p-3 bg-white border-2 border-vit-orange rounded-lg">
                                    <input type="checkbox" class="w-4 h-4">
                                    <span class="text-sm text-gray-700 font-semibold">3D-Vermessungs-System Training</span>
                                    <span class="ml-auto px-2 py-1 bg-vit-orange text-white text-xs rounded">In Arbeit</span>
                                </div>
                                <div class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg">
                                    <input type="checkbox" class="w-4 h-4">
                                    <span class="text-sm text-gray-700">Werkstatt-Prozesse verstehen</span>
                                    <span class="ml-auto text-xs text-gray-500">F√§llig: 20.02.</span>
                                </div>
                            </div>
                        </div>

                        <!-- Section: Verkaufsprozesse -->
                        <div class="mb-6">
                            <h3 class="font-semibold text-gray-800 mb-3 flex items-center">
                                <span class="bg-gray-300 text-gray-700 rounded-full w-6 h-6 flex items-center justify-center text-xs mr-2">0/5</span>
                                Verkaufsprozesse
                            </h3>
                            <div class="space-y-2 ml-8">
                                <div class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg">
                                    <input type="checkbox" class="w-4 h-4">
                                    <span class="text-sm text-gray-700">CRM-System einrichten</span>
                                    <span class="ml-auto text-xs text-gray-500">F√§llig: 18.02.</span>
                                </div>
                                <div class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg">
                                    <input type="checkbox" class="w-4 h-4">
                                    <span class="text-sm text-gray-700">Beratungsgespr√§ch-Training</span>
                                    <span class="ml-auto text-xs text-gray-500">F√§llig: 22.02.</span>
                                </div>
                                <div class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg">
                                    <input type="checkbox" class="w-4 h-4">
                                    <span class="text-sm text-gray-700">Finanzierungs- & Leasing-Optionen</span>
                                    <span class="ml-auto text-xs text-gray-500">F√§llig: 25.02.</span>
                                </div>
                                <div class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg">
                                    <input type="checkbox" class="w-4 h-4">
                                    <span class="text-sm text-gray-700">Probefahrt-Prozess durchf√ºhren</span>
                                    <span class="ml-auto text-xs text-gray-500">F√§llig: 28.02.</span>
                                </div>
                                <div class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg">
                                    <input type="checkbox" class="w-4 h-4">
                                    <span class="text-sm text-gray-700">Ersten Verkauf abschlie√üen üéØ</span>
                                    <span class="ml-auto text-xs text-gray-500">F√§llig: 03.03.</span>
                                </div>
                            </div>
                        </div>

                        <!-- Section: Marketing & Kommunikation -->
                        <div>
                            <h3 class="font-semibold text-gray-800 mb-3 flex items-center">
                                <span class="bg-gray-300 text-gray-700 rounded-full w-6 h-6 flex items-center justify-center text-xs mr-2">0/3</span>
                                Marketing & Kommunikation
                            </h3>
                            <div class="space-y-2 ml-8">
                                <div class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg">
                                    <input type="checkbox" class="w-4 h-4">
                                    <span class="text-sm text-gray-700">Social Media Guidelines durchgehen</span>
                                    <span class="ml-auto text-xs text-gray-500">F√§llig: 19.02.</span>
                                </div>
                                <div class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg">
                                    <input type="checkbox" class="w-4 h-4">
                                    <span class="text-sm text-gray-700">Ersten Social Media Post erstellen</span>
                                    <span class="ml-auto text-xs text-gray-500">F√§llig: 24.02.</span>
                                </div>
                                <div class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg">
                                    <input type="checkbox" class="w-4 h-4">
                                    <span class="text-sm text-gray-700">Marketing-Materialien herunterladen</span>
                                    <span class="ml-auto text-xs text-gray-500">F√§llig: 26.02.</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Hilfe & Support -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="vit-card p-6">
                            <h3 class="font-semibold text-gray-800 mb-4">üìû Brauchst du Hilfe?</h3>
                            <p class="text-sm text-gray-600 mb-4">Unser Onboarding-Team steht dir zur Verf√ºgung!</p>
                            <button class="w-full bg-vit-orange text-white py-2 rounded-lg hover:opacity-90">
                                Support kontaktieren
                            </button>
                        </div>

                        <div class="vit-card p-6">
                            <h3 class="font-semibold text-gray-800 mb-4">üìö Weitere Ressourcen</h3>
                            <ul class="space-y-2 text-sm">
                                <li><a href="#" class="text-vit-orange hover:underline">‚Üí Handbuch f√ºr neue Partner</a></li>
                                <li><a href="#" class="text-vit-orange hover:underline">‚Üí Video-Tutorials</a></li>
                                <li><a href="#" class="text-vit-orange hover:underline">‚Üí FAQ f√ºr Einsteiger</a></li>
                            </ul>
                        </div>
                    </div>
                    </div><!-- End staticOnboardingContent -->
                </div>

                <!-- MITARBEITER VIEW (Partner/GF) -->
                <div id="mitarbeiterView" class="view" style="display: none;">
                    <h1 class="h1-headline text-gray-800 mb-2">üë• MITARBEITER</h1>
                    <p class="text-sm text-gray-500 mb-6">Mitarbeiter Ihres Standorts verwalten und Rollen zuweisen.</p>

                    <!-- KPIs -->
                    <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                        <div class="vit-card p-4 text-center"><div class="text-2xl font-bold text-gray-800" id="pMaGesamt">0</div><div class="text-xs text-gray-500">Mitarbeiter</div></div>
                        <div class="vit-card p-4 text-center"><div class="text-2xl font-bold text-green-600" id="pMaAktiv">0</div><div class="text-xs text-gray-500">Aktiv</div></div>
                        <div class="vit-card p-4 text-center"><div class="text-2xl font-bold text-blue-600" id="pMaOnb">0</div><div class="text-xs text-gray-500">Im Onboarding</div></div>
                        <div class="vit-card p-4 text-center"><div class="text-2xl font-bold text-vit-orange" id="pMaRollen">4</div><div class="text-xs text-gray-500">Rollen verf√ºgbar</div></div>
                    </div>

                    <!-- Action Bar -->
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex space-x-2">
                            <button onclick="filterPartnerMa('all')" class="p-ma-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-vit-orange text-white" data-pmf="all">Alle</button>
                            <button onclick="filterPartnerMa('aktiv')" class="p-ma-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-gray-100 text-gray-600" data-pmf="aktiv">üü¢ Aktiv</button>
                            <button onclick="filterPartnerMa('onboarding')" class="p-ma-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-gray-100 text-gray-600" data-pmf="onboarding">üîµ Onboarding</button>
                        </div>
                        <button class="px-4 py-2 bg-vit-orange text-white rounded-lg text-sm font-semibold hover:opacity-90" onclick="openNeuerMaModal()">+ Neuer Mitarbeiter</button>
                    </div>

                    <!-- Mitarbeiter Table -->
                    <div class="vit-card overflow-hidden">
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-4 py-3 text-left font-semibold text-gray-600">Name</th>
                                        <th class="px-4 py-3 text-left font-semibold text-gray-600">E-Mail</th>
                                        <th class="px-4 py-3 text-center font-semibold text-gray-600">Rollen</th>
                                        <th class="px-4 py-3 text-center font-semibold text-gray-600">Status</th>
                                        <th class="px-4 py-3 text-center font-semibold text-gray-600">Eintritt</th>
                                        <th class="px-4 py-3 text-center font-semibold text-gray-600">Aktion</th>
                                    </tr>
                                </thead>
                                <tbody id="partnerMaBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div id="notificationsView" class="view" style="display: none;">
                    <h1 class="h1-headline text-gray-800 mb-6">BENACHRICHTIGUNGEN</h1>

                    <!-- Filter -->
                    <div class="flex space-x-2 mb-4">
                        <button onclick="filterNotif('all')" class="notif-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-vit-orange text-white" data-nf="all">Alle</button>
                        <button onclick="filterNotif('unread')" class="notif-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-gray-100 text-gray-600" data-nf="unread">Ungelesen</button>
                        <button onclick="filterNotif('system')" class="notif-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-gray-100 text-gray-600" data-nf="system">System</button>
                        <button onclick="filterNotif('hq')" class="notif-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-gray-100 text-gray-600" data-nf="hq">HQ</button>
                        <button class="ml-auto text-xs text-vit-orange font-semibold hover:underline" onclick="document.querySelectorAll('.notif-dot').forEach(function(d){d.remove();}); document.querySelector('.absolute.-top-1.-right-1').textContent='0';">Alle als gelesen markieren</button>
                    </div>

                    <div id="notifList" class="space-y-2"></div>
                </div>

                <!-- ===== KALENDER VIEW ===== -->
                <div id="kalenderView" class="view" style="display: none;">
                    <div class="flex items-center justify-between mb-6">
                        <h1 class="h1-headline text-gray-800">KALENDER</h1>
                        <div class="flex items-center space-x-3">
                            <select id="kalFilterUser" onchange="renderKalender()" class="px-3 py-2 border border-gray-200 rounded-lg text-sm">
                                <option value="all">Alle Termine (Standort)</option>
                                <option value="me">Nur meine Termine</option>
                            </select>
                            <button class="px-4 py-2 bg-vit-orange text-white rounded-lg text-sm font-semibold hover:opacity-90" onclick="document.getElementById('kalNewModal').classList.remove('hidden')">+ Neuer Termin</button>
                        </div>
                    </div>

                    <!-- Month Navigation -->
                    <div class="flex items-center justify-between mb-4">
                        <button onclick="kalNavMonth(-1)" class="p-2 hover:bg-gray-100 rounded-lg"><svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg></button>
                        <h2 class="text-lg font-bold text-gray-800" id="kalMonthTitle">Februar 2026</h2>
                        <button onclick="kalNavMonth(1)" class="p-2 hover:bg-gray-100 rounded-lg"><svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg></button>
                    </div>

                    <!-- Calendar Grid -->
                    <div class="vit-card overflow-hidden">
                        <!-- Day Headers -->
                        <div class="grid grid-cols-7 bg-gray-50 border-b border-gray-200">
                            <div class="py-2 text-center text-xs font-semibold text-gray-500">Mo</div>
                            <div class="py-2 text-center text-xs font-semibold text-gray-500">Di</div>
                            <div class="py-2 text-center text-xs font-semibold text-gray-500">Mi</div>
                            <div class="py-2 text-center text-xs font-semibold text-gray-500">Do</div>
                            <div class="py-2 text-center text-xs font-semibold text-gray-500">Fr</div>
                            <div class="py-2 text-center text-xs font-semibold text-gray-500 text-orange-400">Sa</div>
                            <div class="py-2 text-center text-xs font-semibold text-gray-500 text-orange-400">So</div>
                        </div>
                        <!-- Calendar Body -->
                        <div id="kalGrid" class="grid grid-cols-7"></div>
                    </div>

                    <!-- Upcoming list -->
                    <h3 class="font-bold text-gray-800 mt-6 mb-3">Anstehende Termine</h3>
                    <div id="kalUpcoming" class="space-y-2"></div>

                    <!-- New Termin Modal -->
                    <div id="kalNewModal" class="hidden fixed inset-0 bg-black bg-opacity-40 z-50 flex items-center justify-center">
                        <div class="bg-white rounded-2xl p-6 w-full max-w-md shadow-2xl">
                            <h3 class="font-bold text-gray-800 text-lg mb-4">Neuen Termin anlegen</h3>
                            <div class="space-y-3">
                                <input type="text" id="kalNewTitle" placeholder="Titel" class="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm">
                                <div class="grid grid-cols-2 gap-3">
                                    <input type="date" id="kalNewDate" class="px-3 py-2 border border-gray-200 rounded-lg text-sm">
                                    <input type="time" id="kalNewTime" class="px-3 py-2 border border-gray-200 rounded-lg text-sm">
                                </div>
                                <select id="kalNewType" class="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm">
                                    <option value="beratung">Beratung</option>
                                    <option value="probefahrt">Probefahrt</option>
                                    <option value="werkstatt">Werkstatt-Abholung</option>
                                    <option value="meeting">Team-Meeting</option>
                                    <option value="sonstig">Sonstiges</option>
                                </select>
                                <textarea id="kalNewNotes" placeholder="Notizen (optional)" rows="2" class="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm"></textarea>
                            </div>
                            <div class="flex space-x-3 mt-4">
                                <button onclick="addKalTermin()" class="flex-1 py-2 bg-vit-orange text-white rounded-lg text-sm font-semibold hover:opacity-90">Speichern</button>
                                <button onclick="document.getElementById('kalNewModal').classList.add('hidden')" class="flex-1 py-2 border border-gray-200 rounded-lg text-sm text-gray-600 hover:bg-gray-50">Abbrechen</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ===== TODO VIEW ===== -->
                <div id="todoView" class="view" style="display: none;">
                    <div class="flex items-center justify-between mb-6">
                        <h1 class="h1-headline text-gray-800">AUFGABEN</h1>
                        <button class="px-4 py-2 bg-vit-orange text-white rounded-lg text-sm font-semibold hover:opacity-90" onclick="document.getElementById('todoNewModal').classList.remove('hidden')">+ Neue Aufgabe</button>
                    </div>

                    <!-- KPI -->
                    <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                        <div class="vit-card p-4 text-center"><p class="text-2xl font-bold text-gray-800" id="todoKpiOffen">5</p><p class="text-xs text-gray-500">Offen</p></div>
                        <div class="vit-card p-4 text-center"><p class="text-2xl font-bold text-vit-orange" id="todoKpiHeute">2</p><p class="text-xs text-gray-500">F√§llig heute</p></div>
                        <div class="vit-card p-4 text-center"><p class="text-2xl font-bold text-red-500" id="todoKpiUeber">1</p><p class="text-xs text-gray-500">√úberf√§llig</p></div>
                        <div class="vit-card p-4 text-center"><p class="text-2xl font-bold text-green-600" id="todoKpiDone">12</p><p class="text-xs text-gray-500">Erledigt (KW)</p></div>
                    </div>

                    <!-- Filter -->
                    <div class="flex space-x-2 mb-4">
                        <button onclick="filterTodos('all')" class="todo-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-vit-orange text-white" data-tf="all">Alle offen</button>
                        <button onclick="filterTodos('heute')" class="todo-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-gray-100 text-gray-600" data-tf="heute">Heute</button>
                        <button onclick="filterTodos('ueberfaellig')" class="todo-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-gray-100 text-gray-600" data-tf="ueberfaellig">√úberf√§llig</button>
                        <button onclick="filterTodos('done')" class="todo-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-gray-100 text-gray-600" data-tf="done">‚úÖ Erledigt</button>
                    </div>

                    <div id="todoList" class="space-y-2"></div>

                    <!-- New Todo Modal -->
                    <div id="todoNewModal" class="hidden fixed inset-0 bg-black bg-opacity-40 z-50 flex items-center justify-center">
                        <div class="bg-white rounded-2xl p-6 w-full max-w-md shadow-2xl">
                            <h3 class="font-bold text-gray-800 text-lg mb-4">Neue Aufgabe</h3>
                            <div class="space-y-3">
                                <input type="text" id="todoNewTitle" placeholder="Aufgabe" class="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm">
                                <div class="grid grid-cols-2 gap-3">
                                    <input type="date" id="todoNewDate" class="px-3 py-2 border border-gray-200 rounded-lg text-sm">
                                    <select id="todoNewPrio" class="px-3 py-2 border border-gray-200 rounded-lg text-sm">
                                        <option value="normal">Normal</option>
                                        <option value="hoch">Hoch</option>
                                        <option value="niedrig">Niedrig</option>
                                    </select>
                                </div>
                                <select id="todoNewKat" class="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm">
                                    <option value="verkauf">Verkauf</option>
                                    <option value="werkstatt">Werkstatt</option>
                                    <option value="marketing">Marketing</option>
                                    <option value="admin">Administration</option>
                                    <option value="sonstig">Sonstiges</option>
                                </select>
                            </div>
                            <div class="flex space-x-3 mt-4">
                                <button onclick="addTodo()" class="flex-1 py-2 bg-vit-orange text-white rounded-lg text-sm font-semibold hover:opacity-90">Speichern</button>
                                <button onclick="document.getElementById('todoNewModal').classList.add('hidden')" class="flex-1 py-2 border border-gray-200 rounded-lg text-sm text-gray-600 hover:bg-gray-50">Abbrechen</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ===== ALLGEMEIN VIEW ===== -->
                <div id="allgemeinView" class="view" style="display: none;">
                    <h1 class="h1-headline text-gray-800 mb-6">ALLGEMEIN</h1>

                    <!-- Tab Navigation -->
                    <div class="mb-6 border-b border-gray-200">
                        <nav class="-mb-px flex space-x-8">
                            <button onclick="showAllgemeinTab('uebersicht')" class="allg-tab-btn whitespace-nowrap py-4 px-1 border-b-2 border-vit-orange font-semibold text-sm text-vit-orange" data-tab="uebersicht">Standort-Uebersicht</button>
                            <button onclick="showAllgemeinTab('strategie')" class="allg-tab-btn whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-semibold text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="strategie">üìã Strategie</button>
                            <button onclick="showAllgemeinTab('wissen')" class="allg-tab-btn whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-semibold text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="wissen">üìö Wissen</button>
                        </nav>
                    </div>

                    <!-- TAB 1: Standort-Uebersicht -->
                    <div id="allgTabUebersicht" class="allg-tab-content">
                        <div class="vit-card p-6 mb-6">
                            <div class="flex items-center space-x-4 mb-4">
                                <div class="w-14 h-14 bg-vit-orange rounded-xl flex items-center justify-center text-white font-bold text-xl">G</div>
                                <div>
                                    <h2 class="text-xl font-bold text-gray-800">vit:bikes Grafrath</h2>
                                    <p class="text-sm text-gray-500">Jesenwanger Str. 52 ¬∑ 82284 Grafrath ¬∑ Tel: 08144/5519377</p>
                                </div>
                                <span class="ml-auto px-3 py-1 bg-green-100 text-green-700 rounded-full text-xs font-bold">Aktiver Partner</span>
                            </div>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                <div class="p-3 bg-gray-50 rounded-lg"><p class="text-xs text-gray-400">Inhaber</p><p class="text-sm font-semibold">Sandra &amp; Thomas Engelmann</p></div>
                                <div class="p-3 bg-gray-50 rounded-lg"><p class="text-xs text-gray-400">Mitarbeiter</p><p class="text-sm font-semibold">4 Verkaeufer + Werkstatt</p></div>
                                <div class="p-3 bg-gray-50 rounded-lg"><p class="text-xs text-gray-400">Schwerpunkt</p><p class="text-sm font-semibold">E-Bikes, Trekking, MTB</p></div>
                                <div class="p-3 bg-gray-50 rounded-lg"><p class="text-xs text-gray-400">Google-Bewertung</p><p class="text-sm font-semibold">‚≠ê 4,9 (127 Rezensionen)</p></div>
                            </div>
                        </div>

                        <!-- Ansprechpartner vit:bikes -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                            <div class="vit-card p-5">
                                <p class="text-xs text-gray-400 mb-2">Marketing</p>
                                <p class="font-semibold">Michael Stenzel</p>
                                <p class="text-xs text-gray-500">Jahresgespraech 23.12.2025</p>
                            </div>
                            <div class="vit-card p-5">
                                <p class="text-xs text-gray-400 mb-2">Einkauf</p>
                                <p class="font-semibold">Florian Meier</p>
                                <p class="text-xs text-gray-500">Strategie vom 15.09.2025</p>
                            </div>
                            <div class="vit-card p-5">
                                <p class="text-xs text-gray-400 mb-2">Geschaeftsfuehrung vit:bikes</p>
                                <p class="font-semibold">Sascha Matthies</p>
                                <p class="text-xs text-gray-500">Mitunterzeichner Einkaufsstrategie</p>
                            </div>
                        </div>

                        <!-- Schnellzugriffe -->
                        <div class="vit-card p-6">
                            <h3 class="font-semibold text-gray-800 mb-4">Schnellzugriff</h3>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                                <button onclick="showView('marketing'); showMarketingTab('mktStrategie')" class="p-4 bg-orange-50 rounded-lg hover:bg-orange-100 transition text-center"><p class="text-2xl mb-1">üì¢</p><p class="text-xs font-semibold">Marketing-Strategie</p></button>
                                <button onclick="showView('einkauf'); showEinkaufTab('ekStrategie')" class="p-4 bg-blue-50 rounded-lg hover:bg-blue-100 transition text-center"><p class="text-2xl mb-1">üõí</p><p class="text-xs font-semibold">Einkaufsstrategie</p></button>
                                <button onclick="showView('controlling'); showControllingTab('bwa')" class="p-4 bg-green-50 rounded-lg hover:bg-green-100 transition text-center"><p class="text-2xl mb-1">üìä</p><p class="text-xs font-semibold">BWA &amp; Controlling</p></button>
                                <button onclick="showView('aktenschrank')" class="p-4 bg-purple-50 rounded-lg hover:bg-purple-100 transition text-center"><p class="text-2xl mb-1">üìÅ</p><p class="text-xs font-semibold">Aktenschrank</p></button>
                            </div>
                        </div>
                    </div>

                    <!-- TAB 2: Strategie (Gesamtueberblick) -->
                    <div id="allgTabStrategie" class="allg-tab-content" style="display:none;">
                        <div class="vit-card p-6 mb-6">
                            <div class="flex items-center justify-between mb-2">
                                <h2 class="text-lg font-semibold text-gray-800">Strategie-Ueberblick 2026 ‚Äì vit:bikes Grafrath</h2>
                                <span class="px-3 py-1 bg-green-100 text-green-700 rounded-full text-xs font-bold">Alle Strategien vereinbart</span>
                            </div>
                            <p class="text-sm text-gray-500">Zusammenfassung aller strategischen Vereinbarungen fuer den Standort Grafrath</p>
                        </div>

                        <!-- Marketing-Strategie Zusammenfassung -->
                        <div class="vit-card p-6 mb-6 border-l-4 border-vit-orange">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="font-semibold text-gray-800 flex items-center"><span class="w-8 h-8 bg-vit-orange text-white rounded-lg flex items-center justify-center text-sm mr-3">üì¢</span> Marketing-Strategie 2026</h3>
                                <button onclick="showView('marketing'); showMarketingTab('mktStrategie')" class="text-xs text-vit-orange hover:text-orange-600 font-semibold">Details anzeigen ‚Üí</button>
                            </div>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-4">
                                <div class="p-3 bg-orange-50 rounded-lg text-center"><p class="text-xs text-gray-400">Budget/Monat</p><p class="text-lg font-bold text-vit-orange">1.500 ‚Ç¨</p></div>
                                <div class="p-3 bg-blue-50 rounded-lg text-center"><p class="text-xs text-gray-400">Mediamix</p><p class="text-sm font-bold text-blue-600">Meta + Google</p></div>
                                <div class="p-3 bg-green-50 rounded-lg text-center"><p class="text-xs text-gray-400">Storevisit-Ziel</p><p class="text-lg font-bold text-green-600">103%</p></div>
                                <div class="p-3 bg-yellow-50 rounded-lg text-center"><p class="text-xs text-gray-400">Terminziel</p><p class="text-lg font-bold text-yellow-600">56%</p></div>
                            </div>
                            <div class="text-sm text-gray-600 space-y-1">
                                <p>‚úì Individuelle Ads mit besserem Performance &amp; Authentizitaet</p>
                                <p>‚úì Organische Platzierung auf YouTube, Meta &amp; TikTok</p>
                                <p>‚úì Lokale Events zur Kundenbindung &amp; Neukundengewinnung</p>
                                <p>‚úì Content-Unterstuetzung durch vit:bikes Content-Team</p>
                            </div>
                            <p class="text-xs text-gray-400 mt-3">Vereinbart am 23.12.2025 ¬∑ Unterschrieben: Michael Stenzel, Sandra &amp; Thomas Engelmann</p>
                        </div>

                        <!-- Einkaufsstrategie Zusammenfassung -->
                        <div class="vit-card p-6 mb-6 border-l-4 border-blue-500">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="font-semibold text-gray-800 flex items-center"><span class="w-8 h-8 bg-blue-600 text-white rounded-lg flex items-center justify-center text-sm mr-3">üõí</span> Einkaufsstrategie 2026</h3>
                                <button onclick="showView('einkauf'); showEinkaufTab('ekStrategie')" class="text-xs text-blue-600 hover:text-blue-700 font-semibold">Details anzeigen ‚Üí</button>
                            </div>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-4">
                                <div class="p-3 bg-blue-50 rounded-lg text-center"><p class="text-xs text-gray-400">Bike-Bestand (09/25)</p><p class="text-lg font-bold text-blue-600">156</p></div>
                                <div class="p-3 bg-green-50 rounded-lg text-center"><p class="text-xs text-gray-400">Zielmarken 2026</p><p class="text-lg font-bold text-green-600">6</p></div>
                                <div class="p-3 bg-orange-50 rounded-lg text-center"><p class="text-xs text-gray-400">Vororder Kalkhoff</p><p class="text-lg font-bold text-vit-orange">80 Bikes</p></div>
                                <div class="p-3 bg-red-50 rounded-lg text-center"><p class="text-xs text-gray-400">√ò Nachlass</p><p class="text-lg font-bold text-red-600">8,7%</p><p class="text-xs text-red-400">Ziel: unter 5%</p></div>
                            </div>
                            <div class="grid grid-cols-2 md:grid-cols-3 gap-2 mb-3">
                                <div class="p-2 bg-green-50 rounded text-xs"><span class="font-semibold">Kalkhoff</span> ‚Äì VO 80 Bikes</div>
                                <div class="p-2 bg-green-50 rounded text-xs"><span class="font-semibold">Haibike</span> ‚Äì Blockorder 30-50 eMTBs</div>
                                <div class="p-2 bg-green-50 rounded text-xs"><span class="font-semibold">Orbea</span> ‚Äì Hoechster DB1</div>
                                <div class="p-2 bg-green-50 rounded text-xs"><span class="font-semibold">Simplon</span> ‚Äì VO 10 (Gravel/MTB)</div>
                                <div class="p-2 bg-blue-50 rounded text-xs"><span class="font-semibold">Velo de Ville</span> ‚Äì NEU, 8 Bikes</div>
                                <div class="p-2 bg-blue-50 rounded text-xs"><span class="font-semibold">Steppenwolf</span> ‚Äì 5 Bikes, ab Juli</div>
                            </div>
                            <div class="text-sm text-gray-600 space-y-1">
                                <p>‚úì Sortiment auf 6 Zielmarken umstellen, Auslaufmarken abverkauft</p>
                                <p>‚úì Orbea &amp; Simplon aktiv pushen fuer hoeheren Rohertrag</p>
                                <p>‚úì Rabatte minimieren ‚Äì Dreingaben statt Preisnachlaesse (Sqlab-Tipp)</p>
                                <p>‚úì Haibike-Blockorder mit Valuta-Klausel bei Fruehlieferung</p>
                            </div>
                            <p class="text-xs text-gray-400 mt-3">Vereinbart am 15.09.2025 ¬∑ Unterschrieben: Florian Meier, Sandra Engelmann, Sascha Matthies</p>
                        </div>

                        <!-- Strategische Prioritaeten -->
                        <div class="vit-card p-6">
                            <h3 class="font-semibold text-gray-800 mb-4 flex items-center"><span class="w-8 h-8 bg-green-600 text-white rounded-lg flex items-center justify-center text-sm mr-3">üéØ</span> Strategische Prioritaeten 2026</h3>
                            <div class="space-y-3">
                                <div class="flex items-start space-x-3 p-3 bg-red-50 rounded-lg border-l-4 border-red-500">
                                    <span class="text-red-600 font-bold text-sm mt-0.5">P1</span>
                                    <div><p class="font-semibold text-sm">Rohertrag steigern</p><p class="text-xs text-gray-500">Rabatte unter 5% halten. Orbea (hoechster DB1) und Simplon (hoechster VK) aktiv verkaufen. Sqlab-Sattel statt Rabatt.</p></div>
                                </div>
                                <div class="flex items-start space-x-3 p-3 bg-orange-50 rounded-lg border-l-4 border-vit-orange">
                                    <span class="text-vit-orange font-bold text-sm mt-0.5">P2</span>
                                    <div><p class="font-semibold text-sm">Haibike eMTB-Sortiment sichern</p><p class="text-xs text-gray-500">Blockorder 30-50 AllMtn/AllTrack/Adventr mit Bosch. Konditionen wackeln ‚Äì Volumen wichtig fuer Netzwerk.</p></div>
                                </div>
                                <div class="flex items-start space-x-3 p-3 bg-blue-50 rounded-lg border-l-4 border-blue-500">
                                    <span class="text-blue-600 font-bold text-sm mt-0.5">P3</span>
                                    <div><p class="font-semibold text-sm">Marketing-Budget effizient nutzen</p><p class="text-xs text-gray-500">1.500 ‚Ç¨/Monat. CPT senken (aktuell 205 ‚Ç¨ vs. Netzwerk 163 ‚Ç¨). Terminziel von 56% auf 80%+ steigern.</p></div>
                                </div>
                                <div class="flex items-start space-x-3 p-3 bg-green-50 rounded-lg border-l-4 border-green-500">
                                    <span class="text-green-600 font-bold text-sm mt-0.5">P4</span>
                                    <div><p class="font-semibold text-sm">Neue Marken etablieren</p><p class="text-xs text-gray-500">Velo de Ville (Alternative Trekking) und Steppenwolf (sportives DJI) erfolgreich einfuehren.</p></div>
                                </div>
                                <div class="flex items-start space-x-3 p-3 bg-purple-50 rounded-lg border-l-4 border-purple-500">
                                    <span class="text-purple-600 font-bold text-sm mt-0.5">P5</span>
                                    <div><p class="font-semibold text-sm">Lokale Events &amp; Authentizitaet</p><p class="text-xs text-gray-500">Testivals, Grillvents, individuelle Ads. Benefit statt Rabatt kommunizieren. Haendlerprofil schaerfen.</p></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- TAB 3: Wissen -->
                    <div id="allgTabWissen" class="allg-tab-content" style="display:none;"></div>
                </div>

                <!-- ================================================================= -->
                <!-- ==================== HQ VIEWS ================================== -->
                <!-- ================================================================= -->

                <!-- ===== HQ NETZWERK-COCKPIT ===== -->
                <div id="hqCockpitView" class="view" style="display: none;">
                    <!-- Header -->
                    <div class="flex items-center justify-between mb-6">
                        <div>
                            <h1 class="h1-headline text-gray-800">NETZWERK-COCKPIT üëã</h1>
                            <p class="text-sm text-gray-500">Willkommen zurueck ¬∑ Heute ist Samstag, 14. Februar 2026</p>
                        </div>
                        <div class="flex items-center space-x-3">
                            <span class="text-xs text-gray-400">Stand: 14.02.2026</span>
                            <select id="hqPeriod" class="px-3 py-2 border border-gray-300 rounded-lg text-sm" onchange="renderHqCockpit()">
                                <option value="ytd">YTD 2026</option>
                                <option value="jan">Januar 2026</option>
                                <option value="feb">Februar 2026</option>
                            </select>
                        </div>
                    </div>

                    <!-- Schnellzugriffe HQ -->
                    <div class="grid grid-cols-3 md:grid-cols-6 gap-3 mb-6">
                        <button onclick="showView('hqAktionen')" class="vit-card p-3 hover:shadow-md transition text-center"><p class="text-xl mb-1">üö®</p><p class="text-[10px] font-semibold text-gray-700">Handlungsbedarf</p></button>
                        <button onclick="showView('hqKommando');setTimeout(function(){showKommandoTab('kampagnen')},50)" class="vit-card p-3 hover:shadow-md transition text-center"><p class="text-xl mb-1">üéØ</p><p class="text-[10px] font-semibold text-gray-700">Kampagnen</p></button>
                        <button onclick="showView('hqKommando');setTimeout(function(){showKommandoTab('kommunikation')},50)" class="vit-card p-3 hover:shadow-md transition text-center"><p class="text-xl mb-1">üì¢</p><p class="text-[10px] font-semibold text-gray-700">Kommunikation</p></button>
                        <button onclick="showView('hqKommando');setTimeout(function(){showKommandoTab('aufgaben')},50)" class="vit-card p-3 hover:shadow-md transition text-center"><p class="text-xl mb-1">üìã</p><p class="text-[10px] font-semibold text-gray-700">Aufgaben</p></button>
                        <button onclick="showView('hqKommando')" class="vit-card p-3 hover:shadow-md transition text-center"><p class="text-xl mb-1">‚öôÔ∏è</p><p class="text-[10px] font-semibold text-gray-700">Kommandozentrale</p></button>
                        <button onclick="showView('hqAuswertung')" class="vit-card p-3 hover:shadow-md transition text-center"><p class="text-xl mb-1">üìä</p><p class="text-[10px] font-semibold text-gray-700">Auswertung</p></button>
                    </div>

                    <!-- Netzwerk KPIs -->
                    <div class="grid grid-cols-2 lg:grid-cols-5 gap-4 mb-6" id="hqKpiCards"></div>

                    <!-- Handlungsbedarf Ticker -->
                    <div class="vit-card p-4 mb-6 border-l-4 border-red-500" id="hqAlertBox"></div>

                    <!-- 3-Column Layout -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                        <!-- LEFT 2/3: Rankings + Kampagnen + Grid -->
                        <div class="lg:col-span-2 space-y-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="vit-card p-5">
                                    <h2 class="text-sm font-bold text-gray-800 mb-3">üèÜ Top 5 Standorte</h2>
                                    <div id="hqTop5" class="space-y-2"></div>
                                </div>
                                <div class="vit-card p-5">
                                    <h2 class="text-sm font-bold text-gray-800 mb-3">‚ö†Ô∏è Bottom 5 ‚Äì Handlungsbedarf</h2>
                                    <div id="hqBottom5" class="space-y-2"></div>
                                </div>
                            </div>

                            <!-- Kampagnen Kompakt -->
                            <div class="vit-card p-5">
                                <div class="flex items-center justify-between mb-3">
                                    <h2 class="text-sm font-bold text-gray-800">üéØ Aktive Kampagnen</h2>
                                    <button onclick="showView('hqKampagnen')" class="text-xs text-vit-orange font-semibold hover:underline">Alle anzeigen ‚Üí</button>
                                </div>
                                <div id="hqHomeKampagnen" class="space-y-2"></div>
                            </div>

                            <!-- Standort-Grid -->
                            <div class="vit-card p-5">
                                <h2 class="text-sm font-bold text-gray-800 mb-3">üìä Alle Standorte ‚Äì Lead-Performance</h2>
                                <div class="flex items-center space-x-4 mb-3 text-[10px] text-gray-500">
                                    <span>üî¥ &lt; 50%</span><span>üü† 50-75%</span><span>üü¢ 75-100%</span><span>üü° ‚â• 100%</span>
                                </div>
                                <div id="hqStandortGrid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-3"></div>
                            </div>
                        </div>

                        <!-- RIGHT 1/3: Live-Feed -->
                        <div class="space-y-6">
                            <!-- Offene Aufgaben -->
                            <div class="vit-card p-5">
                                <div class="flex items-center justify-between mb-3">
                                    <h2 class="text-sm font-bold text-gray-800">üìã Offene Aufgaben</h2>
                                    <button onclick="showView('hqAufgaben')" class="text-xs text-vit-orange font-semibold hover:underline">Alle ‚Üí</button>
                                </div>
                                <div id="hqHomeAufgaben" class="space-y-2"></div>
                            </div>

                            <!-- Naechste Termine -->
                            <div class="vit-card p-5">
                                <div class="flex items-center justify-between mb-3">
                                    <h2 class="text-sm font-bold text-gray-800">üìÖ Naechste Termine</h2>
                                    <button onclick="showView('hqKalender')" class="text-xs text-vit-orange font-semibold hover:underline">Alle ‚Üí</button>
                                </div>
                                <div id="hqHomeTermine" class="space-y-2"></div>
                            </div>

                            <!-- Letzte Ankuendigungen -->
                            <div class="vit-card p-5">
                                <div class="flex items-center justify-between mb-3">
                                    <h2 class="text-sm font-bold text-gray-800">üì¢ Letzte Ankuendigungen</h2>
                                    <button onclick="showView('hqKomm')" class="text-xs text-vit-orange font-semibold hover:underline">Alle ‚Üí</button>
                                </div>
                                <div id="hqHomeAnnounce" class="space-y-2"></div>
                            </div>
                        </div>
                    </div>
                </div>


                <!-- ===== HQ STANDORTE ===== -->
                <div id="hqStandorteView" class="view" style="display: none;">
                    <div class="flex items-center justify-between mb-6">
                        <h1 class="h1-headline text-gray-800">STANDORTE</h1>
                        <div class="flex items-center space-x-3">
                            <input type="text" id="hqStandortSearch" placeholder="Standort suchen..." class="px-3 py-2 border border-gray-300 rounded-lg text-sm w-64" oninput="renderHqStandorte()">
                            <select id="hqStandortFilter" class="px-3 py-2 border border-gray-300 rounded-lg text-sm" onchange="renderHqStandorte()">
                                <option value="all">Alle</option>
                                <option value="kritisch">üî¥ Kritisch (&lt;50%)</option>
                                <option value="achtung">üü† Achtung (50-75%)</option>
                                <option value="gut">üü¢ Gut (75-100%)</option>
                                <option value="top">üü° Top (‚â•100%)</option>
                            </select>
                        </div>
                    </div>
                    <div id="hqStandorteList" class="space-y-3"></div>
                </div>

                <!-- ===== HQ FINANZEN ===== -->
                <div id="hqFinanzenView" class="view" style="display: none;">
                    <h1 class="h1-headline text-gray-800 mb-6">FINANZEN ‚Äì NETZWERK</h1>
                    <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6" id="hqFinKpis"></div>
                    <div class="vit-card p-6 mb-6">
                        <h2 class="text-lg font-semibold text-gray-800 mb-4">Umsatz & Rohertrag pro Standort</h2>
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm" id="hqFinTable"></table>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="vit-card p-6">
                            <h2 class="text-lg font-semibold text-gray-800 mb-4">‚ö†Ô∏è BWA-Auffaelligkeiten</h2>
                            <div id="hqFinAlerts" class="space-y-2"></div>
                        </div>
                        <div class="vit-card p-6">
                            <h2 class="text-lg font-semibold text-gray-800 mb-4">üìà Rohertrag-Ranking</h2>
                            <div id="hqFinRohertrag" class="space-y-2"></div>
                        </div>
                    </div>
                </div>

                <!-- ===== HQ MARKETING ===== -->
                <div id="hqMarketingView" class="view" style="display: none;">
                    <h1 class="h1-headline text-gray-800 mb-6">MARKETING ‚Äì NETZWERK</h1>
                    <div class="grid grid-cols-2 lg:grid-cols-5 gap-4 mb-6" id="hqMktKpis"></div>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                        <div class="vit-card p-6">
                            <h2 class="text-lg font-semibold text-gray-800 mb-4">üìä Lead-Performance pro Standort</h2>
                            <div id="hqMktLeads" class="space-y-2"></div>
                        </div>
                        <div class="vit-card p-6">
                            <h2 class="text-lg font-semibold text-gray-800 mb-4">üéØ Strategie-Status</h2>
                            <div id="hqMktStrategie" class="space-y-2"></div>
                        </div>
                    </div>
                    <div class="vit-card p-6">
                        <h2 class="text-lg font-semibold text-gray-800 mb-4">‚ö†Ô∏è Handlungsbedarf Marketing</h2>
                        <div id="hqMktAlerts" class="space-y-2"></div>
                    </div>
                </div>

                <!-- ===== HQ EINKAUF ===== -->
                <div id="hqEinkaufView" class="view" style="display: none;">
                    <h1 class="h1-headline text-gray-800 mb-6">EINKAUF ‚Äì NETZWERK</h1>
                    <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6" id="hqEkKpis"></div>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                        <div class="vit-card p-6">
                            <h2 class="text-lg font-semibold text-gray-800 mb-4">üì¶ Vororder-Status 2026</h2>
                            <div id="hqEkVororder" class="space-y-2"></div>
                        </div>
                        <div class="vit-card p-6">
                            <h2 class="text-lg font-semibold text-gray-800 mb-4">üìä Rohertrag pro Standort</h2>
                            <div id="hqEkRohertrag" class="space-y-2"></div>
                        </div>
                    </div>
                    <div class="vit-card p-6">
                        <h2 class="text-lg font-semibold text-gray-800 mb-4">‚ö†Ô∏è Handlungsbedarf Einkauf</h2>
                        <div id="hqEkAlerts" class="space-y-2"></div>
                    </div>
                </div>

                <!-- ===== HQ VERKAUF ===== -->
                <div id="hqVerkaufView" class="view" style="display: none;">
                    <h1 class="h1-headline text-gray-800 mb-6">VERKAUF ‚Äì NETZWERK</h1>
                    <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6" id="hqVkKpis"></div>
                    <div class="vit-card p-6 mb-6">
                        <h2 class="text-lg font-semibold text-gray-800 mb-4">üìä Verkaufsleistung pro Standort (KW 7)</h2>
                        <div class="overflow-x-auto"><table class="w-full text-sm" id="hqVkTable"></table></div>
                    </div>
                    <div class="vit-card p-6">
                        <h2 class="text-lg font-semibold text-gray-800 mb-4">‚ö†Ô∏è Handlungsbedarf Verkauf</h2>
                        <div id="hqVkAlerts" class="space-y-2"></div>
                    </div>
                </div>

                <!-- ===== HQ HANDLUNGSBEDARF ===== -->
                <div id="hqAktionenView" class="view" style="display: none;">
                    <h1 class="h1-headline text-gray-800 mb-6">HANDLUNGSBEDARF ‚Äì ALLE BEREICHE</h1>
                    <p class="text-sm text-gray-500 mb-6">Konsolidierte Uebersicht aller offenen Punkte, die Aufmerksamkeit der Zentrale erfordern. Sortiert nach Prioritaet.</p>
                    <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6" id="hqAktKpis"></div>
                    <div id="hqAktionenList" class="space-y-3"></div>
                </div>

                <!-- HQ KOMMUNIKATION -->
                <!-- HQ KAMPAGNEN -->
                <!-- HQ DOKUMENTE -->
                <!-- HQ KALENDER -->
                <!-- HQ AUFGABEN -->
                <!-- KOMMANDOZENTRALE -->
                <div id="hqKommandoView" class="view" style="display: none;">
                    <h1 class="h1-headline text-gray-800 mb-6">‚öôÔ∏è KOMMANDOZENTRALE</h1>

                    <!-- Tab Navigation -->
                    <div class="mb-6 border-b border-gray-200">
                        <nav class="-mb-px flex space-x-8">
                            <button onclick="showKommandoTab('standorte')" class="kommando-tab-btn whitespace-nowrap py-4 px-1 border-b-2 border-vit-orange font-semibold text-sm text-vit-orange" data-ktab="standorte">üè¢ Standorte</button>
                            <button onclick="showKommandoTab('mitarbeiter')" class="kommando-tab-btn whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-semibold text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300" data-ktab="mitarbeiter">üë• Mitarbeiter</button>
                            <button onclick="showKommandoTab('kommunikation')" class="kommando-tab-btn whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-semibold text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300" data-ktab="kommunikation">üì¢ Kommunikation</button>
                            <button onclick="showKommandoTab('kampagnen')" class="kommando-tab-btn whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-semibold text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300" data-ktab="kampagnen">üéØ Kampagnen</button>
                            <button onclick="showKommandoTab('dokumente')" class="kommando-tab-btn whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-semibold text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300" data-ktab="dokumente">üìÅ Dokumente</button>
                            <button onclick="showKommandoTab('kalender')" class="kommando-tab-btn whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-semibold text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300" data-ktab="kalender">üìÖ Kalender</button>
                            <button onclick="showKommandoTab('aufgaben')" class="kommando-tab-btn whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-semibold text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300" data-ktab="aufgaben">üìã Aufgaben</button>
                        </nav>
                    </div>

                    <!-- STANDORTE TAB -->
                    <div id="kommandoTabStandorte" class="kommando-tab-content">

                        <!-- KPI Cards -->
                        <div class="grid grid-cols-2 lg:grid-cols-5 gap-4 mb-6">
                            <div class="vit-card p-4 text-center"><p class="text-2xl font-bold text-gray-800" id="kzStandorteGesamt">21</p><p class="text-xs text-gray-500">Standorte gesamt</p></div>
                            <div class="vit-card p-4 text-center"><p class="text-2xl font-bold text-green-600" id="kzStandorteAktiv">18</p><p class="text-xs text-gray-500">Aktiv</p></div>
                            <div class="vit-card p-4 text-center"><p class="text-2xl font-bold text-blue-600" id="kzStandorteOnb">2</p><p class="text-xs text-gray-500">Im Onboarding</p></div>
                            <div class="vit-card p-4 text-center"><p class="text-2xl font-bold text-red-500" id="kzStandorteOff">1</p><p class="text-xs text-gray-500">Offboarding</p></div>
                            <div class="vit-card p-4 text-center"><p class="text-2xl font-bold text-vit-orange" id="kzRegionen">4</p><p class="text-xs text-gray-500">Regionen</p></div>
                        </div>

                        <!-- Action Bar -->
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex space-x-2">
                                <button onclick="filterKzStandorte('all')" class="kz-std-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-vit-orange text-white" data-kzf="all">Alle</button>
                                <button onclick="filterKzStandorte('aktiv')" class="kz-std-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-gray-100 text-gray-600" data-kzf="aktiv">üü¢ Aktiv</button>
                                <button onclick="filterKzStandorte('onboarding')" class="kz-std-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-gray-100 text-gray-600" data-kzf="onboarding">üîµ Onboarding</button>
                                <button onclick="filterKzStandorte('offboarding')" class="kz-std-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-gray-100 text-gray-600" data-kzf="offboarding">üî¥ Offboarding</button>
                            </div>
                            <button class="px-4 py-2 bg-vit-orange text-white rounded-lg text-sm font-semibold hover:opacity-90" onclick="openNeuerStandortModal()">+ Neuer Standort</button>
                        </div>

                        <!-- Standorte Table -->
                        <div class="vit-card overflow-hidden">
                            <div class="overflow-x-auto">
                                <table class="w-full text-sm">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-4 py-3 text-left font-semibold text-gray-600">Standort</th>
                                            <th class="px-4 py-3 text-left font-semibold text-gray-600">Adresse</th>
                                            <th class="px-4 py-3 text-left font-semibold text-gray-600">Typ</th>
                                            <th class="px-4 py-3 text-center font-semibold text-gray-600">Status</th>
                                            <th class="px-4 py-3 text-center font-semibold text-gray-600">Mitarbeiter</th>
                                            <th class="px-4 py-3 text-center font-semibold text-gray-600">Beitritt</th>
                                            <th class="px-4 py-3 text-center font-semibold text-gray-600">Telefon</th>
                                            <th class="px-4 py-3 text-center font-semibold text-gray-600">Aktion</th>
                                        </tr>
                                    </thead>
                                    <tbody id="kzStandorteBody"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- MITARBEITER TAB -->
                    <div id="kommandoTabMitarbeiter" class="kommando-tab-content" style="display:none;">

                        <!-- KPI Cards -->
                        <div class="grid grid-cols-2 lg:grid-cols-5 gap-4 mb-6">
                            <div class="vit-card p-4 text-center"><p class="text-2xl font-bold text-gray-800" id="kzMaGesamt">67</p><p class="text-xs text-gray-500">Mitarbeiter gesamt</p></div>
                            <div class="vit-card p-4 text-center"><p class="text-2xl font-bold text-green-600" id="kzMaAktiv">61</p><p class="text-xs text-gray-500">Aktiv</p></div>
                            <div class="vit-card p-4 text-center"><p class="text-2xl font-bold text-blue-600" id="kzMaOnb">4</p><p class="text-xs text-gray-500">Im Onboarding</p></div>
                            <div class="vit-card p-4 text-center"><p class="text-2xl font-bold text-red-500" id="kzMaOff">2</p><p class="text-xs text-gray-500">Offboarding</p></div>
                            <div class="vit-card p-4 text-center"><p class="text-2xl font-bold text-vit-orange" id="kzRollen">5</p><p class="text-xs text-gray-500">Rollen</p></div>
                        </div>

                        <!-- Action Bar -->
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex space-x-2 flex-wrap gap-y-2">
                                <button onclick="filterKzMa('all')" class="kz-ma-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-vit-orange text-white" data-kzmf="all">Alle</button>
                                <button onclick="filterKzMa('aktiv')" class="kz-ma-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-gray-100 text-gray-600" data-kzmf="aktiv">üü¢ Aktiv</button>
                                <button onclick="filterKzMa('onboarding')" class="kz-ma-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-gray-100 text-gray-600" data-kzmf="onboarding">üîµ Onboarding</button>
                                <button onclick="filterKzMa('offboarding')" class="kz-ma-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-gray-100 text-gray-600" data-kzmf="offboarding">üî¥ Offboarding</button>
                            </div>
                            <div class="flex space-x-2">
                                <select id="kzMaStandortFilter" class="px-3 py-1.5 border border-gray-200 rounded-lg text-xs" onchange="filterKzMa(currentKzMaFilter)">
                                    <option value="all">Alle Standorte</option>
                                </select>
                                <button class="px-4 py-2 bg-vit-orange text-white rounded-lg text-sm font-semibold hover:opacity-90" onclick="openNeuerMaModal()">+ Neuer Mitarbeiter</button>
                            </div>
                        </div>

                        <!-- Mitarbeiter Table -->
                        <div class="vit-card overflow-hidden">
                            <div class="overflow-x-auto">
                                <table class="w-full text-sm">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-4 py-3 text-left font-semibold text-gray-600">Name</th>
                                            <th class="px-4 py-3 text-left font-semibold text-gray-600">Standort</th>
                                            <th class="px-4 py-3 text-center font-semibold text-gray-600">Rolle</th>
                                            <th class="px-4 py-3 text-center font-semibold text-gray-600">Status</th>
                                            <th class="px-4 py-3 text-center font-semibold text-gray-600">Eintritt</th>
                                            <th class="px-4 py-3 text-center font-semibold text-gray-600">Onboarding</th>
                                            <th class="px-4 py-3 text-center font-semibold text-gray-600">Aktion</th>
                                        </tr>
                                    </thead>
                                    <tbody id="kzMaBody"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- KOMMUNIKATION TAB -->
                    <div id="kommandoTabKommunikation" class="kommando-tab-content" style="display:none;">
                        <!-- Sub-tabs -->
                        <div class="border-b border-gray-100 mb-4">
                            <nav class="flex space-x-4">
                                <button onclick="showHqKommTab('announce')" class="hqkomm-tab-btn text-xs py-2 px-2 border-b-2 border-vit-orange font-semibold text-vit-orange" data-hkt="announce">üì¢ Ankuendigungen</button>
                                <button onclick="showHqKommTab('rundmail')" class="hqkomm-tab-btn text-xs py-2 px-2 border-b-2 border-transparent font-semibold text-gray-500 hover:text-gray-700" data-hkt="rundmail">‚úâÔ∏è Rundmail</button>
                                <button onclick="showHqKommTab('forum')" class="hqkomm-tab-btn text-xs py-2 px-2 border-b-2 border-transparent font-semibold text-gray-500 hover:text-gray-700" data-hkt="forum">üí¨ Netzwerk-Forum</button>
                            </nav>
                        </div>
                        <div id="hqKommContent"></div>
                    </div>

                    <!-- KAMPAGNEN TAB -->
                    <div id="kommandoTabKampagnen" class="kommando-tab-content" style="display:none;">
                        <div class="flex items-center justify-between mb-4">
                            <p class="text-sm text-gray-500">Kampagnen erstellen, steuern und Umsetzung ueber alle Standorte tracken.</p>
                            <button onclick="document.getElementById('hqKampModal').classList.remove('hidden')" class="px-4 py-2 bg-vit-orange text-white rounded-lg text-sm font-semibold hover:opacity-90">+ Neue Kampagne</button>
                        </div>
                        <div class="grid grid-cols-2 lg:grid-cols-5 gap-4 mb-6" id="hqKampKpis"></div>
                        <div id="hqKampList" class="space-y-4"></div>
                        <!-- Modal -->
                        <div id="hqKampModal" class="hidden fixed inset-0 bg-black bg-opacity-40 z-50 flex items-center justify-center">
                            <div class="bg-white rounded-2xl p-6 w-full max-w-lg shadow-2xl">
                                <h3 class="font-bold text-lg mb-4">Neue Kampagne erstellen</h3>
                                <div class="space-y-3">
                                    <input type="text" id="hqKampName" placeholder="Kampagnen-Name" class="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm">
                                    <div class="grid grid-cols-2 gap-3">
                                        <input type="date" id="hqKampStart" class="px-3 py-2 border border-gray-200 rounded-lg text-sm">
                                        <input type="date" id="hqKampEnd" class="px-3 py-2 border border-gray-200 rounded-lg text-sm">
                                    </div>
                                    <select id="hqKampType" class="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm">
                                        <option value="saisonal">Saisonkampagne</option><option value="produkt">Produktkampagne</option><option value="event">Event/Aktionstag</option><option value="social">Social Media Push</option>
                                    </select>
                                    <textarea id="hqKampDesc" rows="2" placeholder="Beschreibung / Ziel" class="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm"></textarea>
                                </div>
                                <div class="flex space-x-3 mt-4">
                                    <button onclick="addHqKampagne()" class="flex-1 py-2 bg-vit-orange text-white rounded-lg text-sm font-semibold hover:opacity-90">Erstellen</button>
                                    <button onclick="document.getElementById('hqKampModal').classList.add('hidden')" class="flex-1 py-2 border border-gray-200 rounded-lg text-sm text-gray-600 hover:bg-gray-50">Abbrechen</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- DOKUMENTE TAB -->
                    <div id="kommandoTabDokumente" class="kommando-tab-content" style="display:none;">
                        <div class="flex items-center justify-between mb-4">
                            <p class="text-sm text-gray-500">Netzwerk-weite Dokumente: Richtlinien, Vorlagen, Schulungen, Vertraege.</p>
                            <button class="px-4 py-2 bg-vit-orange text-white rounded-lg text-sm font-semibold hover:opacity-90" onclick="alert('Dokument hochladen (Demo)')">+ Dokument hochladen</button>
                        </div>
                        <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-4" id="hqDokKpis"></div>
                        <div class="flex space-x-2 mb-4">
                            <button onclick="filterHqDok('all')" class="hqdok-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-vit-orange text-white" data-hdf="all">Alle</button>
                            <button onclick="filterHqDok('richtlinie')" class="hqdok-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-gray-100 text-gray-600" data-hdf="richtlinie">üìã Richtlinien</button>
                            <button onclick="filterHqDok('vorlage')" class="hqdok-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-gray-100 text-gray-600" data-hdf="vorlage">üìÑ Vorlagen</button>
                            <button onclick="filterHqDok('schulung')" class="hqdok-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-gray-100 text-gray-600" data-hdf="schulung">üéì Schulungen</button>
                            <button onclick="filterHqDok('vertrag')" class="hqdok-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-gray-100 text-gray-600" data-hdf="vertrag">üìë Vertraege</button>
                        </div>
                        <div id="hqDokList" class="space-y-2"></div>
                    </div>

                    <!-- KALENDER TAB -->
                    <div id="kommandoTabKalender" class="kommando-tab-content" style="display:none;">
                        <div class="flex items-center justify-between mb-4">
                            <p class="text-sm text-gray-500">Netzwerk-Termine: Schulungen, Events, Deadlines und Meetings fuer alle Standorte.</p>
                            <button onclick="document.getElementById('hqKalModal').classList.remove('hidden')" class="px-4 py-2 bg-vit-orange text-white rounded-lg text-sm font-semibold hover:opacity-90">+ Netzwerk-Termin</button>
                        </div>
                        <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-4" id="hqKalKpis"></div>
                        <div class="flex space-x-2 mb-4">
                            <button onclick="filterHqKal('all')" class="hqkal-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-vit-orange text-white" data-hkf="all">Alle</button>
                            <button onclick="filterHqKal('schulung')" class="hqkal-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-gray-100 text-gray-600" data-hkf="schulung">üéì Schulungen</button>
                            <button onclick="filterHqKal('event')" class="hqkal-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-gray-100 text-gray-600" data-hkf="event">üé™ Events</button>
                            <button onclick="filterHqKal('deadline')" class="hqkal-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-gray-100 text-gray-600" data-hkf="deadline">‚è∞ Deadlines</button>
                            <button onclick="filterHqKal('meeting')" class="hqkal-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-gray-100 text-gray-600" data-hkf="meeting">ü§ù Meetings</button>
                        </div>
                        <div id="hqKalList" class="space-y-2"></div>
                        <!-- Modal -->
                        <div id="hqKalModal" class="hidden fixed inset-0 bg-black bg-opacity-40 z-50 flex items-center justify-center">
                            <div class="bg-white rounded-2xl p-6 w-full max-w-md shadow-2xl">
                                <h3 class="font-bold text-lg mb-4">Netzwerk-Termin anlegen</h3>
                                <div class="space-y-3">
                                    <input type="text" id="hqKalTitle" placeholder="Titel" class="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm">
                                    <div class="grid grid-cols-2 gap-3"><input type="date" id="hqKalDate" class="px-3 py-2 border border-gray-200 rounded-lg text-sm"><input type="time" id="hqKalTime" class="px-3 py-2 border border-gray-200 rounded-lg text-sm"></div>
                                    <select id="hqKalType" class="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm"><option value="schulung">üéì Schulung</option><option value="event">üé™ Event</option><option value="deadline">‚è∞ Deadline</option><option value="meeting">ü§ù Meeting</option></select>
                                    <select id="hqKalTarget" class="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm"><option value="alle">Alle Standorte</option><option value="region_sued">Region Sued</option><option value="region_nord">Region Nord</option><option value="region_west">Region West</option><option value="region_ost">Region Ost</option></select>
                                </div>
                                <div class="flex space-x-3 mt-4">
                                    <button onclick="addHqKalTermin()" class="flex-1 py-2 bg-vit-orange text-white rounded-lg text-sm font-semibold hover:opacity-90">Speichern</button>
                                    <button onclick="document.getElementById('hqKalModal').classList.add('hidden')" class="flex-1 py-2 border border-gray-200 rounded-lg text-sm text-gray-600 hover:bg-gray-50">Abbrechen</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- AUFGABEN TAB -->
                    <div id="kommandoTabAufgaben" class="kommando-tab-content" style="display:none;">
                        <div class="flex items-center justify-between mb-4">
                            <p class="text-sm text-gray-500">Aufgaben an Standorte verteilen und Umsetzung tracken.</p>
                            <button onclick="document.getElementById('hqTaskModal').classList.remove('hidden')" class="px-4 py-2 bg-vit-orange text-white rounded-lg text-sm font-semibold hover:opacity-90">+ Aufgabe verteilen</button>
                        </div>
                        <div class="grid grid-cols-2 lg:grid-cols-5 gap-4 mb-4" id="hqTaskKpis"></div>
                        <div class="flex space-x-2 mb-4">
                            <button onclick="filterHqTasks('all')" class="hqtask-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-vit-orange text-white" data-htf="all">Alle</button>
                            <button onclick="filterHqTasks('offen')" class="hqtask-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-gray-100 text-gray-600" data-htf="offen">üî¥ Offen</button>
                            <button onclick="filterHqTasks('inprogress')" class="hqtask-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-gray-100 text-gray-600" data-htf="inprogress">üîµ In Arbeit</button>
                            <button onclick="filterHqTasks('done')" class="hqtask-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-gray-100 text-gray-600" data-htf="done">‚úÖ Erledigt</button>
                        </div>
                        <div id="hqTaskList" class="space-y-2"></div>
                        <!-- Modal -->
                        <div id="hqTaskModal" class="hidden fixed inset-0 bg-black bg-opacity-40 z-50 flex items-center justify-center">
                            <div class="bg-white rounded-2xl p-6 w-full max-w-lg shadow-2xl">
                                <h3 class="font-bold text-lg mb-4">Aufgabe an Standort(e) verteilen</h3>
                                <div class="space-y-3">
                                    <input type="text" id="hqTaskTitle" placeholder="Aufgabentitel" class="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm">
                                    <input type="date" id="hqTaskDeadline" class="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm">
                                    <select id="hqTaskPrio" class="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm"><option value="hoch">üî¥ Hoch</option><option value="mittel" selected>üü° Mittel</option><option value="niedrig">üü¢ Niedrig</option></select>
                                    <select id="hqTaskTarget" class="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm"><option value="alle">Alle Standorte (21)</option><option value="region_sued">Region Sued (8)</option><option value="region_nord">Region Nord (5)</option><option value="region_west">Region West (5)</option><option value="region_ost">Region Ost (3)</option></select>
                                    <textarea id="hqTaskDesc" rows="2" placeholder="Beschreibung" class="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm"></textarea>
                                </div>
                                <div class="flex space-x-3 mt-4">
                                    <button onclick="addHqTask()" class="flex-1 py-2 bg-vit-orange text-white rounded-lg text-sm font-semibold hover:opacity-90">Verteilen</button>
                                    <button onclick="document.getElementById('hqTaskModal').classList.add('hidden')" class="flex-1 py-2 border border-gray-200 rounded-lg text-sm text-gray-600 hover:bg-gray-50">Abbrechen</button>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

                <!-- HQ AUSWERTUNG: Portal-Nutzung -->
                <div id="hqAuswertungView" class="view" style="display: none;">
                    <h1 class="h1-headline text-gray-800 mb-2">üìä AUSWERTUNG ‚Äì PORTAL-NUTZUNG</h1>
                    <p class="text-sm text-gray-500 mb-6">Wie aktiv nutzen die Standorte das vit:bikes Partner-Portal?</p>
                    <div class="grid grid-cols-2 lg:grid-cols-5 gap-4 mb-6" id="hqAuswKpis"></div>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                        <div class="vit-card p-5">
                            <h2 class="text-sm font-bold text-gray-800 mb-3">üèÜ Aktivste Standorte</h2>
                            <div id="hqAuswTop" class="space-y-2"></div>
                        </div>
                        <div class="vit-card p-5">
                            <h2 class="text-sm font-bold text-gray-800 mb-3">‚ö†Ô∏è Geringste Nutzung</h2>
                            <div id="hqAuswBottom" class="space-y-2"></div>
                        </div>
                    </div>
                    <div class="vit-card p-5 mb-6">
                        <h2 class="text-sm font-bold text-gray-800 mb-3">üìã Modul-Nutzung im Netzwerk</h2>
                        <div id="hqAuswModules" class="space-y-2"></div>
                    </div>
                    <div class="vit-card p-5">
                        <h2 class="text-sm font-bold text-gray-800 mb-3">üìà Alle Standorte ‚Äì Nutzungs-Score</h2>
                        <div id="hqAuswAll" class="space-y-1"></div>
                    </div>
                </div>

                <!-- ===== HQ WISSEN-VERWALTUNG ===== -->
                <div id="hqWissenView" class="view" style="display: none;">
                    <h1 class="h1-headline text-gray-800 mb-2">üìö WISSEN ‚Äì VERWALTUNG</h1>
                    <p class="text-sm text-gray-500 mb-6">Wissensinhalte fuer alle Partner bereitstellen und verwalten.</p>
                    <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                        <div class="vit-card p-4 text-center"><div class="text-2xl font-bold text-vit-orange">24</div><div class="text-xs text-gray-500">Akademie-Kurse</div></div>
                        <div class="vit-card p-4 text-center"><div class="text-2xl font-bold text-blue-600">18</div><div class="text-xs text-gray-500">Handbuecher</div></div>
                        <div class="vit-card p-4 text-center"><div class="text-2xl font-bold text-green-600">12</div><div class="text-xs text-gray-500">Best Practices</div></div>
                        <div class="vit-card p-4 text-center"><div class="text-2xl font-bold text-purple-600">45</div><div class="text-xs text-gray-500">FAQ-Eintraege</div></div>
                    </div>
                    <!-- Neuen Inhalt anlegen -->
                    <div class="vit-card p-6 mb-6">
                        <h2 class="text-lg font-semibold text-gray-800 mb-4">‚ûï Neuen Wissensinhalt erstellen</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Titel</label>
                                <input type="text" id="hqWissenTitel" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="z.B. Leitfaden E-Bike Beratung">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Kategorie</label>
                                <select id="hqWissenKat" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                    <option value="akademie">üéì Akademie-Kurs</option>
                                    <option value="handbuch">üìñ Handbuch</option>
                                    <option value="bestpractice">‚≠ê Best Practice</option>
                                    <option value="faq">‚ùì FAQ</option>
                                </select>
                            </div>
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Bereich</label>
                            <select id="hqWissenBereich" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                <option value="verkauf">Verkauf</option>
                                <option value="werkstatt">Werkstatt</option>
                                <option value="marketing">Marketing</option>
                                <option value="betrieb">Betrieb &amp; Organisation</option>
                                <option value="personal">Personal</option>
                            </select>
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Inhalt / Beschreibung</label>
                            <textarea id="hqWissenInhalt" rows="4" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="Inhalt des Wissensartikels..."></textarea>
                        </div>
                        <button onclick="addHqWissen()" class="px-4 py-2 bg-vit-orange text-white rounded-lg text-sm font-semibold hover:bg-orange-600">üìö Veroeffentlichen</button>
                    </div>
                    <!-- Bestehende Inhalte -->
                    <div class="vit-card p-6">
                        <h2 class="text-lg font-semibold text-gray-800 mb-4">üìã Bestehende Inhalte</h2>
                        <div id="hqWissenList" class="space-y-2"></div>
                    </div>
                </div>

                <!-- ===== HQ SUPPORT-√úBERSICHT ===== -->
                <div id="hqSupportView" class="view" style="display: none;">
                    <h1 class="h1-headline text-gray-800 mb-2">üé´ SUPPORT ‚Äì UEBERSICHT</h1>
                    <p class="text-sm text-gray-500 mb-6">Alle Support-Anfragen der Partner im Blick.</p>
                    <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                        <div class="vit-card p-4 text-center"><div class="text-2xl font-bold text-red-500">7</div><div class="text-xs text-gray-500">Offene Tickets</div></div>
                        <div class="vit-card p-4 text-center"><div class="text-2xl font-bold text-yellow-500">3</div><div class="text-xs text-gray-500">In Bearbeitung</div></div>
                        <div class="vit-card p-4 text-center"><div class="text-2xl font-bold text-green-600">48</div><div class="text-xs text-gray-500">Geloest (Monat)</div></div>
                        <div class="vit-card p-4 text-center"><div class="text-2xl font-bold text-blue-600">4.2h</div><div class="text-xs text-gray-500">‚åÄ Reaktionszeit</div></div>
                    </div>
                    <div class="vit-card p-6 mb-6">
                        <h2 class="text-lg font-semibold text-gray-800 mb-4">üî¥ Offene Support-Tickets</h2>
                        <div id="hqSupportTickets" class="space-y-3"></div>
                    </div>
                    <div class="vit-card p-6">
                        <h2 class="text-lg font-semibold text-gray-800 mb-4">üìä Tickets nach Standort</h2>
                        <div id="hqSupportStats" class="space-y-2"></div>
                    </div>
                </div>

                <!-- ===== HQ IDEENBOARD-√úBERSICHT ===== -->
                <div id="hqIdeenView" class="view" style="display: none;">
                    <h1 class="h1-headline text-gray-800 mb-2">üí° IDEENBOARD ‚Äì NETZWERK</h1>
                    <p class="text-sm text-gray-500 mb-6">Alle Ideen und Vorschlaege der Partner einsehen und bewerten.</p>
                    <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                        <div class="vit-card p-4 text-center"><div class="text-2xl font-bold text-vit-orange">23</div><div class="text-xs text-gray-500">Eingereichte Ideen</div></div>
                        <div class="vit-card p-4 text-center"><div class="text-2xl font-bold text-yellow-500">8</div><div class="text-xs text-gray-500">In Pruefung</div></div>
                        <div class="vit-card p-4 text-center"><div class="text-2xl font-bold text-green-600">12</div><div class="text-xs text-gray-500">Umgesetzt</div></div>
                        <div class="vit-card p-4 text-center"><div class="text-2xl font-bold text-red-400">3</div><div class="text-xs text-gray-500">Abgelehnt</div></div>
                    </div>
                    <div class="vit-card p-6">
                        <h2 class="text-lg font-semibold text-gray-800 mb-4">üìã Eingereichte Ideen aller Partner</h2>
                        <div id="hqIdeenList" class="space-y-3"></div>
                    </div>
                </div>

                <!-- ===== HQ SHOP-VERWALTUNG ===== -->
                <div id="hqShopView" class="view" style="display: none;">
                    <h1 class="h1-headline text-gray-800 mb-2">üõçÔ∏è WERBEMITTEL-SHOP ‚Äì VERWALTUNG</h1>
                    <p class="text-sm text-gray-500 mb-6">Sortiment, Preise und Bestellungen verwalten.</p>
                    <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                        <div class="vit-card p-4 text-center"><div class="text-2xl font-bold text-vit-orange">20</div><div class="text-xs text-gray-500">Produkte aktiv</div></div>
                        <div class="vit-card p-4 text-center"><div class="text-2xl font-bold text-green-600">34</div><div class="text-xs text-gray-500">Bestellungen (Monat)</div></div>
                        <div class="vit-card p-4 text-center"><div class="text-2xl font-bold text-blue-600">‚Ç¨ 4.280</div><div class="text-xs text-gray-500">Umsatz (Monat)</div></div>
                        <div class="vit-card p-4 text-center"><div class="text-2xl font-bold text-purple-600">‚Ç¨ 126</div><div class="text-xs text-gray-500">‚åÄ Bestellwert</div></div>
                    </div>
                    <!-- Neues Produkt -->
                    <div class="vit-card p-6 mb-6">
                        <h2 class="text-lg font-semibold text-gray-800 mb-4">‚ûï Neues Produkt anlegen</h2>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Produktname</label>
                                <input type="text" id="hqShopName" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="z.B. Regenjacke">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Kategorie</label>
                                <select id="hqShopKat" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                    <option value="print">üñ®Ô∏è Print</option>
                                    <option value="textil">üëï Textilien</option>
                                    <option value="display">ü™ß Displays</option>
                                    <option value="digital">üíª Digital</option>
                                    <option value="give">üéÅ Giveaways</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Preis (‚Ç¨)</label>
                                <input type="number" id="hqShopPreis" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="0.00" step="0.01">
                            </div>
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Beschreibung</label>
                            <input type="text" id="hqShopDesc" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="Kurze Produktbeschreibung">
                        </div>
                        <button onclick="addHqShopProduct()" class="px-4 py-2 bg-vit-orange text-white rounded-lg text-sm font-semibold hover:bg-orange-600">üõçÔ∏è Produkt anlegen</button>
                    </div>
                    <!-- Bestellungen -->
                    <div class="vit-card p-6 mb-6">
                        <h2 class="text-lg font-semibold text-gray-800 mb-4">üì¶ Letzte Bestellungen</h2>
                        <div id="hqShopOrders" class="space-y-2"></div>
                    </div>
                    <!-- Produkte -->
                    <div class="vit-card p-6">
                        <h2 class="text-lg font-semibold text-gray-800 mb-4">üìã Alle Produkte</h2>
                        <div id="hqShopProducts" class="space-y-2"></div>
                    </div>
                </div>

                <!-- HQ EINSTELLUNGEN VIEW -->
                <div id="hqEinstellungenView" class="view" style="display: none;">
                    <h1 class="h1-headline text-gray-800 mb-2">‚öôÔ∏è EINSTELLUNGEN</h1>
                    <p class="text-sm text-gray-500 mb-6">Modul-Verwaltung und Rollen-Rechte f√ºr das gesamte Netzwerk.</p>

                    <!-- Tab-Navigation -->
                    <div class="flex space-x-1 mb-6 border-b border-gray-200">
                        <button onclick="showSettingsTab('modulstatus')" class="settings-tab px-4 py-2.5 text-sm font-semibold border-b-2 border-vit-orange text-vit-orange" data-tab="modulstatus">üîß Modul-Status</button>
                        <button onclick="showSettingsTab('rechte')" class="settings-tab px-4 py-2.5 text-sm font-semibold border-b-2 border-transparent text-gray-500 hover:text-gray-700" data-tab="rechte">üîê Rollen & Rechte</button>
                    </div>

                    <!-- TAB 1: Modul-Status -->
                    <div id="settingsTabModulstatus" class="settings-tab-content">
                        <div class="grid grid-cols-3 gap-4 mb-6">
                            <div class="vit-card p-4 text-center border-l-4 border-green-500"><div class="text-2xl font-bold text-green-600" id="countAktiv">0</div><div class="text-xs text-gray-500">Aktive Module</div></div>
                            <div class="vit-card p-4 text-center border-l-4 border-yellow-500"><div class="text-2xl font-bold text-yellow-600" id="countWip">0</div><div class="text-xs text-gray-500">In Bearbeitung</div></div>
                            <div class="vit-card p-4 text-center border-l-4 border-gray-400"><div class="text-2xl font-bold text-gray-400" id="countDeaktiviert">0</div><div class="text-xs text-gray-500">Deaktiviert</div></div>
                        </div>
                        <div class="vit-card overflow-hidden mb-6">
                            <div class="p-4 border-b bg-gray-50 flex items-center justify-between">
                                <h2 class="font-bold text-gray-800">Modul-Verwaltung</h2>
                                <div class="flex items-center space-x-4 text-xs text-gray-500">
                                    <span class="flex items-center space-x-1"><span class="w-2.5 h-2.5 rounded-full bg-green-500 inline-block"></span><span>Aktiv</span></span>
                                    <span class="flex items-center space-x-1"><span class="w-2.5 h-2.5 rounded-full bg-yellow-500 inline-block"></span><span>In Bearbeitung</span></span>
                                    <span class="flex items-center space-x-1"><span class="w-2.5 h-2.5 rounded-full bg-gray-300 inline-block"></span><span>Deaktiviert</span></span>
                                </div>
                            </div>
                            <div id="modulStatusList" class="divide-y divide-gray-100"></div>
                        </div>
                        <div class="vit-card p-5">
                            <h3 class="font-bold text-gray-800 mb-2">‚ÑπÔ∏è So funktioniert es</h3>
                            <div class="space-y-1.5 text-xs text-gray-600">
                                <p><span class="font-bold text-green-600">Aktiv:</span> Das Modul ist f√ºr alle Nutzer sichtbar und nutzbar (sofern ihre Rolle es erlaubt).</p>
                                <p><span class="font-bold text-yellow-600">In Bearbeitung:</span> Das Modul erscheint ausgegraut in der Sidebar mit einem ‚ÄûBALD"-Badge. Nutzer k√∂nnen es nicht √∂ffnen.</p>
                                <p><span class="font-bold text-gray-500">Deaktiviert:</span> Das Modul ist komplett unsichtbar ‚Äì kein Men√ºpunkt, kein Zugang.</p>
                            </div>
                        </div>
                    </div>

                    <!-- TAB 2: Rollen & Rechte (bestehend) -->
                    <div id="settingsTabRechte" class="settings-tab-content" style="display:none;">

                    <!-- Rollen-√úbersicht -->
                    <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                        <div class="vit-card p-4 text-center border-l-4 border-orange-500"><div class="text-2xl font-bold text-vit-orange">4</div><div class="text-xs text-gray-500">Standort-Rollen</div></div>
                        <div class="vit-card p-4 text-center border-l-4 border-blue-500"><div class="text-2xl font-bold text-blue-600">12</div><div class="text-xs text-gray-500">Standort-Module</div></div>
                        <div class="vit-card p-4 text-center border-l-4 border-green-500"><div class="text-2xl font-bold text-green-600" id="settingsMaCount">26</div><div class="text-xs text-gray-500">Mitarbeiter gesamt</div></div>
                        <div class="vit-card p-4 text-center border-l-4 border-purple-500"><div class="text-2xl font-bold text-purple-600">‚úì</div><div class="text-xs text-gray-500">Multi-Rollen aktiv</div></div>
                    </div>

                    <!-- Rechte-Matrix -->
                    <div class="vit-card overflow-hidden mb-6">
                        <div class="p-4 border-b bg-gray-50 flex items-center justify-between">
                            <h2 class="font-bold text-gray-800">Rechte-Matrix: Module √ó Rollen</h2>
                            <span class="text-xs text-gray-400">Klicken zum Aktivieren/Deaktivieren</span>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm" id="rechteMatrixTable">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-4 py-3 text-left font-semibold text-gray-600 min-w-[180px]">Modul</th>
                                        <th class="px-4 py-3 text-center font-semibold text-orange-600 min-w-[100px]">Gesch√§ftsleitung</th>
                                        <th class="px-4 py-3 text-center font-semibold text-blue-600 min-w-[100px]">Verkauf</th>
                                        <th class="px-4 py-3 text-center font-semibold text-gray-600 min-w-[100px]">Werkstatt</th>
                                        <th class="px-4 py-3 text-center font-semibold text-purple-600 min-w-[100px]">Buchhaltung</th>
                                    </tr>
                                </thead>
                                <tbody id="rechteMatrixBody"></tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Rollen-Beschreibungen -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                        <div class="vit-card p-5">
                            <h3 class="font-bold text-gray-800 mb-3">üìã Rollen-Beschreibungen</h3>
                            <div class="space-y-3">
                                <div class="flex items-start space-x-3"><span class="px-2 py-1 rounded-full text-[10px] font-semibold bg-vit-orange text-white mt-0.5">Gesch√§ftsleitung</span><p class="text-xs text-gray-600">Vollzugriff auf alle Standort-Module inkl. Dashboards, Shop, Onboarding und Controlling.</p></div>
                                <div class="flex items-start space-x-3"><span class="px-2 py-1 rounded-full text-[10px] font-semibold bg-blue-100 text-blue-700 mt-0.5">Verkauf</span><p class="text-xs text-gray-600">Zugang zu Verkauf, Marketing und allgemeinen Tools. Fokus auf Kundenberatung und Vertrieb.</p></div>
                                <div class="flex items-start space-x-3"><span class="px-2 py-1 rounded-full text-[10px] font-semibold bg-gray-200 text-gray-700 mt-0.5">Werkstatt</span><p class="text-xs text-gray-600">Zugang zu Einkauf und allgemeinen Tools. Fokus auf Werkstatt, Teile und Service.</p></div>
                                <div class="flex items-start space-x-3"><span class="px-2 py-1 rounded-full text-[10px] font-semibold bg-purple-100 text-purple-700 mt-0.5">Buchhaltung</span><p class="text-xs text-gray-600">Zugang zu Allgemein, Verkauf, Einkauf, Controlling und Aktenschrank. Finanz- und Dokumentenfokus.</p></div>
                            </div>
                        </div>
                        <div class="vit-card p-5">
                            <h3 class="font-bold text-gray-800 mb-3">‚ÑπÔ∏è Hinweise</h3>
                            <div class="space-y-2 text-xs text-gray-600">
                                <p>‚Ä¢ <strong>Kalender, Aufgaben & Kommunikation</strong> sind f√ºr alle Rollen verf√ºgbar (nicht deaktivierbar).</p>
                                <p>‚Ä¢ <strong>Mehrfach-Rollen:</strong> Ein Mitarbeiter kann mehrere Rollen gleichzeitig haben ‚Äì die Rechte werden addiert.</p>
                                <p>‚Ä¢ <strong>Rollenzuweisung:</strong> Rollen pro Mitarbeiter vergeben Sie unter Kommandozentrale ‚Üí Mitarbeiter.</p>
                                <p>‚Ä¢ √Ñnderungen an der Rechte-Matrix werden sofort f√ºr alle betroffenen Nutzer wirksam.</p>
                            </div>
                        </div>
                    </div>
                    </div><!-- /settingsTabRechte -->
                </div>
    </div>

    <script>
        // ============================================
        // SUPABASE CLIENT
        // ============================================
        var SUPABASE_URL = 'https://lwwagbkxeofahhwebkab.supabase.co';
        var SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx3d2FnYmt4ZW9mYWhod2Via2FiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEwMTM3NDAsImV4cCI6MjA4NjU4OTc0MH0.YBKO7grysp8RHzGWA6xSGpTVi0wG2PmeEWJHI25f7ks';
        var sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        var sbUser = null; // Supabase auth user
        var sbProfile = null; // users table row
        var sbRollen = []; // role names array
        var sbStandort = null; // standorte row
        var sbModulStatus = {}; // {modul_key: 'aktiv'|'in_bearbeitung'|'deaktiviert'}

        // Modul-Status aus Supabase laden und auf Sidebar anwenden
        async function loadModulStatus() {
            try {
                var resp = await sb.from('modul_status').select('modul_key, status').order('reihenfolge');
                if(resp.error) throw resp.error;
                sbModulStatus = {};
                (resp.data||[]).forEach(function(m) { sbModulStatus[m.modul_key] = m.status; });
                applyModulStatus();
            } catch(err) { console.error('ModulStatus:', err); }
        }

        function applyModulStatus() {
            // Alle Sidebar-Buttons mit data-module durchgehen
            document.querySelectorAll('[data-module]').forEach(function(btn) {
                var key = btn.getAttribute('data-module');
                var status = sbModulStatus[key] || 'aktiv';
                var parentSection = btn.closest('div[id]');

                if(status === 'deaktiviert') {
                    // Komplett verstecken
                    btn.style.display = 'none';
                } else if(status === 'in_bearbeitung') {
                    // Sichtbar aber ausgegraut
                    btn.style.display = '';
                    btn.style.opacity = '0.4';
                    btn.style.pointerEvents = 'none';
                    btn.style.cursor = 'not-allowed';
                    // Badge hinzuf√ºgen wenn nicht schon vorhanden
                    if(!btn.querySelector('.modul-wip-badge')) {
                        var badge = document.createElement('span');
                        badge.className = 'modul-wip-badge ml-auto text-[9px] bg-yellow-500 text-white rounded px-1 py-0.5 font-bold';
                        badge.textContent = 'BALD';
                        btn.appendChild(badge);
                    }
                } else {
                    // Aktiv - normal anzeigen
                    btn.style.display = '';
                    btn.style.opacity = '';
                    btn.style.pointerEvents = '';
                    btn.style.cursor = '';
                    var oldBadge = btn.querySelector('.modul-wip-badge');
                    if(oldBadge) oldBadge.remove();
                }
            });
        }

        // Current user state
        var currentRole = 'inhaber';
        var currentLocation = 'vitbikes-muenchen';
        var isPremium = true;

        // Location data
        var locations = {
            'vitbikes-muenchen': { name: 'vit:bikes M√ºnchen Sendling', premium: true },
            'vitbikes-berlin': { name: 'vit:bikes Berlin Mitte', premium: true },
            'vitbikes-hamburg': { name: 'vit:bikes Hamburg Altona', premium: true },
            'radhaus-koeln': { name: 'Radhaus K√∂ln', premium: false },
            'bikeshop-dresden': { name: 'BikeShop Dresden', premium: false }
        };

        // Update location info in login screen
        function updateLocationInfo() {
            const select = document.getElementById('locationSelect');
            const selectedOption = select.options[select.selectedIndex];
            const isPremiumLocation = selectedOption.dataset.premium === 'true';
            const badge = document.getElementById('locationBadge');
            
            if (isPremiumLocation) {
                badge.innerHTML = '<span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-gradient-to-r from-vit-orange to-yellow-500 text-white"><svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg> vit:bikes Partner - Alle Features</span>';
            } else {
                badge.innerHTML = '<span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-gray-200 text-gray-700">üì¶ Basis-Version - Upgrade verf√ºgbar</span>';
            }
        }

        // Initialize location info on page load (only if login screen exists)
        if(document.getElementById('locationSelect')) { updateLocationInfo(); }
        
        // Auto-init: show home view and set defaults
        try { updateUIForRole(); updatePremiumFeatures(); } catch(e) { console.warn('Init:', e); }

        // Handle Login - Role & Location from email
        // === RECHTEMANAGEMENT ===
        // Rollen: inhaber, verkauf, werkstatt, buchhaltung (Standort-Ebene) + hq (HQ-Ebene)
        // Jeder Mitarbeiter kann MEHRERE Rollen haben
        var userAccounts = {
            'max@vitbikes-grafrath.de': {roles:['inhaber'],location:'grafrath',name:'Max Mustermann'},
            'sandra@vitbikes-grafrath.de': {roles:['inhaber','buchhaltung'],location:'grafrath',name:'Sandra Engelmann'},
            'verkauf@vitbikes-grafrath.de': {roles:['verkauf'],location:'grafrath',name:'Tom Berater'},
            'werkstatt@vitbikes-grafrath.de': {roles:['werkstatt'],location:'grafrath',name:'Felix Schrauber'},
            'anna@vitbikes-grafrath.de': {roles:['verkauf','werkstatt'],location:'grafrath',name:'Anna Allround'},
            'buchhaltung@vitbikes-grafrath.de': {roles:['buchhaltung'],location:'grafrath',name:'Petra Zahlen'},
            'hq@vitbikes.de': {roles:['hq'],location:'hq',name:'Lisa Zentrale'},
            'admin@vitbikes.de': {roles:['hq'],location:'hq',name:'Michael Stenzel'}
        };

        // Welche Rollen Zugriff auf welche Module haben
        var rolePermissions = {
            // View-Name: [erlaubte Rollen] ‚Äî 'alle' = jede Standort-Rolle
            'home':           ['alle'],
            'kalender':       ['alle'],
            'todo':           ['alle'],
            'kommunikation':  ['alle'],
            'dashboards':     ['inhaber'],
            'allgemein':      ['inhaber','buchhaltung'],
            'verkauf':        ['inhaber','verkauf','buchhaltung'],
            'einkauf':        ['inhaber','werkstatt','buchhaltung'],
            'marketing':      ['inhaber','verkauf'],
            'controlling':    ['inhaber','buchhaltung'],
            'wissen':         ['alle'],
            'support':        ['alle'],
            'aktenschrank':   ['inhaber','buchhaltung'],
            'ideenboard':     ['alle'],
            'shop':           ['inhaber'],
            'onboarding':     ['inhaber'],
            'mitarbeiter':    ['inhaber']
        };

        // Pr√ºft ob der aktuelle User Zugriff auf eine View hat
        function hasAccess(viewName) {
            if(currentRole === 'hq') return viewName.indexOf('hq')===0 || viewName==='kalender' || viewName==='todo' || viewName==='kommunikation';
            var perms = rolePermissions[viewName];
            if(!perms) return true;
            if(perms.indexOf('alle') >= 0) return true;
            for(var i=0; i<currentRoles.length; i++) {
                if(perms.indexOf(currentRoles[i]) >= 0) return true;
            }
            return false;
        }

        // Pr√ºft ob User eine bestimmte Rolle hat
        function hasRole(role) {
            return currentRoles.indexOf(role) >= 0;
        }

        // Aktuelle Rollen (Array)
        var currentRoles = ['inhaber'];

        function quickLogin(email) {
            document.getElementById('loginEmail').value = email;
            document.getElementById('loginPassword').value = '';
            document.getElementById('loginPassword').focus();
        }

        // === REGISTRATION ===
        function showRegistration() {
            var loginForm = document.querySelector('#loginScreen form');
            var regLink = loginForm.parentElement.querySelector('.border-t');
            
            var html = '<div id="regOverlay" onclick="hideRegistration()" style="position:fixed;inset:0;background:rgba(0,0,0,0.5);z-index:9999;display:flex;align-items:center;justify-content:center;">';
            html += '<div onclick="event.stopPropagation()" style="background:white;border-radius:16px;padding:28px;width:440px;max-width:90vw;box-shadow:0 25px 50px rgba(0,0,0,0.25);">';
            html += '<div class="flex items-center justify-between mb-5"><h3 class="text-lg font-bold text-gray-800">Registrieren</h3><button onclick="hideRegistration()" class="text-gray-400 hover:text-gray-600 text-xl">\u2715</button></div>';
            html += '<p class="text-sm text-gray-500 mb-4">Nach der Registrierung muss dein Account vom HQ freigeschaltet werden.</p>';
            html += '<div class="space-y-3 mb-5">';
            html += '<div><label class="block text-xs font-semibold text-gray-600 mb-1">Vor- und Nachname *</label><input id="regName" type="text" class="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500" placeholder="Max Mustermann"></div>';
            html += '<div><label class="block text-xs font-semibold text-gray-600 mb-1">E-Mail *</label><input id="regEmail" type="email" class="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500" placeholder="name@vitbikes-standort.de"></div>';
            html += '<div><label class="block text-xs font-semibold text-gray-600 mb-1">Passwort * (min. 6 Zeichen)</label><input id="regPassword" type="password" class="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500" placeholder="\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022"></div>';
            html += '<div><label class="block text-xs font-semibold text-gray-600 mb-1">Standort *</label><select id="regStandort" class="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500"><option value="">Wird geladen...</option></select></div>';
            html += '</div>';
            html += '<div id="regError" style="display:none" class="bg-red-50 border border-red-200 text-red-600 text-sm rounded-lg p-3 mb-3"></div>';
            html += '<div id="regSuccess" style="display:none" class="bg-green-50 border border-green-200 text-green-700 text-sm rounded-lg p-3 mb-3"></div>';
            html += '<button id="regSubmitBtn" onclick="submitRegistration()" class="w-full py-2.5 bg-vit-orange text-white rounded-lg font-semibold text-sm hover:opacity-90 transition">Registrieren</button>';
            html += '<button onclick="hideRegistration()" class="w-full py-2.5 mt-2 bg-gray-100 text-gray-600 rounded-lg font-semibold text-sm hover:bg-gray-200">Zur√ºck zum Login</button>';
            html += '</div></div>';
            
            var c = document.createElement('div');
            c.id = 'regContainer';
            c.innerHTML = html;
            document.body.appendChild(c);
            
            // Load standorte into dropdown
            setTimeout(async function(){
                try {
                    var stdResp = await sb.from('standorte').select('id,name').order('name');
                    var sel = document.getElementById('regStandort');
                    if(sel && stdResp.data) {
                        sel.innerHTML = '<option value="">‚Äî Standort w√§hlen ‚Äî</option>';
                        stdResp.data.forEach(function(s){ sel.innerHTML += '<option value="'+s.id+'">'+s.name+'</option>'; });
                    }
                } catch(e){ console.error(e); }
            }, 100);
        }

        function hideRegistration() {
            var c = document.getElementById('regContainer');
            if(c) c.remove();
        }

        async function submitRegistration() {
            var name = (document.getElementById('regName')||{}).value||'';
            var email = (document.getElementById('regEmail')||{}).value||'';
            var pw = (document.getElementById('regPassword')||{}).value||'';
            var standortId = (document.getElementById('regStandort')||{}).value||'';
            var errEl = document.getElementById('regError');
            var sucEl = document.getElementById('regSuccess');
            var btn = document.getElementById('regSubmitBtn');
            
            if(errEl) errEl.style.display = 'none';
            if(sucEl) sucEl.style.display = 'none';
            
            if(!name.trim() || !email.trim() || !pw) {
                if(errEl) { errEl.textContent = 'Bitte alle Pflichtfelder ausf√ºllen.'; errEl.style.display = 'block'; }
                return;
            }
            if(pw.length < 6) {
                if(errEl) { errEl.textContent = 'Passwort muss mindestens 6 Zeichen haben.'; errEl.style.display = 'block'; }
                return;
            }
            if(!standortId) {
                if(errEl) { errEl.textContent = 'Bitte einen Standort w√§hlen.'; errEl.style.display = 'block'; }
                return;
            }
            
            if(btn) { btn.disabled = true; btn.textContent = 'Wird registriert...'; }
            
            try {
                // 1. Auth-User erstellen
                var authResp = await sb.auth.signUp({ email: email.trim().toLowerCase(), password: pw });
                if(authResp.error) throw authResp.error;
                var newUserId = authResp.data.user.id;
                
                // 2. Users-Tabelle: Status = onboarding (wartet auf Freigabe)
                var userResp = await sb.from('users').insert({
                    id: newUserId,
                    email: email.trim().toLowerCase(),
                    name: name.trim(),
                    standort_id: standortId,
                    status: 'onboarding'
                });
                if(userResp.error) throw userResp.error;
                
                // 3. Sofort ausloggen (signUp loggt automatisch ein)
                await sb.auth.signOut();
                
                if(sucEl) {
                    sucEl.innerHTML = '\u2705 <strong>Registrierung erfolgreich!</strong><br>Dein Account wartet auf Freigabe durch das HQ. Du wirst per E-Mail benachrichtigt.';
                    sucEl.style.display = 'block';
                }
                if(btn) { btn.style.display = 'none'; }
            } catch(err) {
                // Auch ausloggen falls teilweise erfolgreich
                try { await sb.auth.signOut(); } catch(e){}
                if(errEl) { errEl.textContent = 'Fehler: ' + (err.message||err); errEl.style.display = 'block'; }
                if(btn) { btn.disabled = false; btn.textContent = 'Registrieren'; }
            }
        }

        async function handleLogin(event) {
            if(event) event.preventDefault();
            var email = (document.getElementById('loginEmail')||{}).value||'';
            var pw = (document.getElementById('loginPassword')||{}).value||'';
            if(!email || !pw) { alert('Bitte E-Mail und Passwort eingeben.'); return; }

            var loginBtn = document.querySelector('#loginScreen form button');
            if(loginBtn) { loginBtn.disabled = true; loginBtn.textContent = 'Anmelden...'; }
            var errEl = document.getElementById('loginError');
            if(errEl) errEl.style.display = 'none';

            try {
                var resp = await sb.auth.signInWithPassword({ email: email, password: pw });
                if(resp.error) throw resp.error;
                sbUser = resp.data.user;
                
                // Status-Check: Ist der User freigeschaltet?
                var profileResp = await sb.from('users').select('status').eq('id', sbUser.id).single();
                if(profileResp.data && profileResp.data.status === 'onboarding') {
                    await sb.auth.signOut();
                    throw { message: 'Dein Account wartet noch auf Freigabe durch das HQ. Bitte hab etwas Geduld.' };
                }
                if(profileResp.data && profileResp.data.status === 'offboarding') {
                    await sb.auth.signOut();
                    throw { message: 'Dein Account wurde deaktiviert. Bitte wende dich an das HQ.' };
                }
                
                await loadUserProfile(sbUser.id);
                await loadModulStatus();
                enterApp();
                await loadPipelineFromSupabase();
            } catch(err) {
                if(errEl) { errEl.textContent = err.message || 'Login fehlgeschlagen'; errEl.style.display = 'block'; }
                else alert('Login fehlgeschlagen: ' + (err.message||err));
            } finally {
                if(loginBtn) { loginBtn.disabled = false; loginBtn.textContent = 'Anmelden'; }
            }
        }

        async function loadUserProfile(userId) {
            var resp1 = await sb.from('users').select('*, standorte(*)').eq('id', userId).single();
            sbProfile = resp1.data;
            sbStandort = sbProfile ? sbProfile.standorte : null;
            var resp2 = await sb.from('user_rollen').select('rollen(name, label)').eq('user_id', userId);
            sbRollen = (resp2.data || []).map(function(ur) { return ur.rollen; });
            var roleNames = sbRollen.map(function(r) { return r.name; });
            currentRoles = roleNames.length > 0 ? roleNames : ['inhaber'];
            currentRole = (currentRoles.indexOf('hq') >= 0 || currentRoles.indexOf('hq_admin') >= 0 || currentRoles.indexOf('inhaber') >= 0) ? currentRoles[0] : currentRoles[0];
            currentLocation = sbStandort ? sbStandort.slug : 'grafrath';
            isPremium = sbStandort ? sbStandort.is_premium : false;
        }

        function enterApp() {
            var userName = sbProfile ? sbProfile.name : 'Benutzer';
            var nameEl = document.querySelector('[data-user-name]');
            if(nameEl) nameEl.textContent = userName;
            var avatarEl = document.querySelector('.topnav-desktop img.rounded-full');
            if(avatarEl) avatarEl.src = 'https://ui-avatars.com/api/?name='+encodeURIComponent(userName)+'&background=EF7D00&color=fff';
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            try { updateUIForRole(); updatePremiumFeatures(); } catch(e) { console.warn(e); }
            if(currentRole === 'hq') { switchViewMode('hq'); } else { showView('home'); }
        }

        async function loadPipelineFromSupabase() {
            try {
                var resp = await sb.from('leads').select('*').order('created_at', { ascending: false });
                if(resp.error) throw resp.error;
                var stageMap = { 'neu':'lead','kontaktiert':'termin','angebot':'angebot','verhandlung':'beratung','gewonnen':'verkauft','verloren':'verloren' };
                verkaufData.pipeline = (resp.data||[]).map(function(l,i) {
                    var d = new Date(l.created_at);
                    return {
                        id: i+1, sb_id: l.id,
                        name: (l.vorname||'')+' '+(l.nachname||''),
                        type: l.interesse||'E-Bike',
                        seller: sbProfile ? sbProfile.name.split(' ')[0] : 'Team',
                        value: parseFloat(l.geschaetzter_wert)||0,
                        stage: stageMap[l.status]||'lead',
                        status_raw: l.status,
                        date: d.getDate().toString().padStart(2,'0')+'.'+(d.getMonth()+1).toString().padStart(2,'0')+'.'
                    };
                });
                if(document.getElementById('vkTabPipeline') && document.getElementById('vkTabPipeline').style.display !== 'none') renderPipeline();
            } catch(err) { console.error('Pipeline load error:', err); }
        }

        async function handleLogout() {
            await sb.auth.signOut();
            sbUser = null; sbProfile = null; sbRollen = []; sbStandort = null;
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('mainApp').style.display = 'none';
            document.getElementById('homeView').style.display = 'none';
        }

        async function checkSession() {
            var resp = await sb.auth.getSession();
            if(resp.data.session && resp.data.session.user) {
                sbUser = resp.data.session.user;
                try {
                    await loadUserProfile(sbUser.id);
                    await loadModulStatus();
                    enterApp();
                } catch(e) { console.warn('Auto-login failed:', e); }
            }
        }


        // Update UI based on role
        function updateUIForRole() {
            // Rollen-Texte
            var roleLabels = {
                'inhaber': 'Gesch√§ftsleitung',
                'verkauf': 'Verkauf',
                'werkstatt': 'Werkstatt',
                'buchhaltung': 'Buchhaltung',
                'hq': 'HQ'
            };

            // Rollen-Anzeige zusammenbauen
            var roleDisplay = currentRoles.map(function(r){ return roleLabels[r]||r; }).join(', ');

            // Location name
            var locationName = 'Standort';
            if (currentLocation && locations[currentLocation]) {
                locationName = locations[currentLocation].name;
            }
            
            var userRoleText = document.getElementById('userRoleText');
            var locationDisplay = document.getElementById('locationDisplay');
            var locationDisplayMobile = document.getElementById('locationDisplayMobile');
            var userRoleDisplay = document.getElementById('userRoleDisplay');
            
            var displayLocation = isHQ ? 'üè¢ HQ ‚Äì Netzwerk' : 'üìç ' + locationName;
            if (userRoleText) userRoleText.textContent = roleDisplay;
            if (locationDisplay) locationDisplay.textContent = displayLocation;
            if (locationDisplayMobile) locationDisplayMobile.textContent = displayLocation;
            if (userRoleDisplay) userRoleDisplay.textContent = roleDisplay;

            // Premium Badge
            var premiumBadge = document.getElementById('premiumBadge');
            if (premiumBadge) {
                if (isPremium) {
                    premiumBadge.innerHTML = '<span class="premium-badge">PREMIUM</span>';
                    premiumBadge.classList.remove('view-hidden');
                } else {
                    premiumBadge.classList.add('view-hidden');
                }
            }

            var isHQ = currentRole === 'hq';
            var isInhaber = hasRole('inhaber');

            // HQ Toggle anzeigen f√ºr Inhaber
            var hqToggle = document.getElementById('hqToggleSection');
            if(hqToggle) hqToggle.classList.toggle('hidden', !isInhaber);
            var btnStandort = document.getElementById('btnModeStandort');
            var btnHQ = document.getElementById('btnModeHQ');
            if(btnStandort) btnStandort.className = 'flex-1 py-2 px-3 rounded-md text-xs font-bold transition ' + (isHQ ? 'text-white/60 hover:text-white' : 'bg-white text-gray-800');
            if(btnHQ) btnHQ.className = 'flex-1 py-2 px-3 rounded-md text-xs font-bold transition ' + (isHQ ? 'bg-white text-gray-800' : 'text-white/60 hover:text-white');

            // === SIDEBAR VISIBILITY ===
            // Partner QuickNav (Startseite, Kalender, Aufgaben, Kommunikation) - alle Standort-Rollen
            var partnerQuickNav = document.getElementById('partnerQuickNav');
            if(partnerQuickNav) partnerQuickNav.classList.toggle('hidden', isHQ);

            // Dashboards - nur Inhaber
            var ownerDashboards = document.getElementById('ownerDashboards');
            if(ownerDashboards) ownerDashboards.classList.toggle('hidden', !isInhaber || isHQ);

            // Fachbereiche Container
            var commonTools = document.getElementById('commonTools');
            if(commonTools) commonTools.classList.toggle('hidden', isHQ);

            // Einzelne Fachbereich-Buttons per Rolle steuern
            var sidebarViews = {
                'allgemein': ['inhaber','buchhaltung'],
                'verkauf': ['inhaber','verkauf','buchhaltung'],
                'einkauf': ['inhaber','werkstatt','buchhaltung'],
                'marketing': ['inhaber','verkauf'],
                'controlling': ['inhaber','buchhaltung']
            };
            Object.keys(sidebarViews).forEach(function(viewName){
                var btns = document.querySelectorAll('[onclick*=\"showView(\\\''+viewName+'\\\')\"]');
                btns.forEach(function(btn){
                    var allowed = false;
                    sidebarViews[viewName].forEach(function(r){ if(hasRole(r)) allowed=true; });
                    btn.classList.toggle('hidden', !allowed);
                });
            });

            // Tools-Bereich Einzelsteuerung
            var toolViews = {
                'wissen': ['alle'],
                'support': ['alle'],
                'aktenschrank': ['inhaber','buchhaltung'],
                'ideenboard': ['alle'],
                'shop': ['inhaber']
            };
            Object.keys(toolViews).forEach(function(viewName){
                var btns = document.querySelectorAll('[onclick*=\"showView(\\\''+viewName+'\\\')\"]');
                btns.forEach(function(btn){
                    if(isHQ) { btn.classList.add('hidden'); return; }
                    var perms = toolViews[viewName];
                    var allowed = perms.indexOf('alle')>=0;
                    if(!allowed) perms.forEach(function(r){ if(hasRole(r)) allowed=true; });
                    btn.classList.toggle('hidden', !allowed);
                });
            });

            // Onboarding - nur Inhaber
            var onboardingNav = document.getElementById('onboardingNavSection');
            if(onboardingNav) onboardingNav.classList.toggle('hidden', !isInhaber || isHQ);

            // Mitarbeiter - nur Inhaber
            var mitarbeiterNav = document.getElementById('mitarbeiterNavSection');
            if(mitarbeiterNav) mitarbeiterNav.classList.toggle('hidden', !isInhaber || isHQ);

            // Partner Tools (Wissen, Support, Ideenboard, Shop) - alle Standort-Rollen
            var partnerToolsNav = document.getElementById('partnerToolsNav');
            if(partnerToolsNav) partnerToolsNav.classList.toggle('hidden', isHQ);

            // HQ Menu
            var hqMenu = document.getElementById('hqMenu');
            if(hqMenu) hqMenu.classList.toggle('hidden', !isHQ);
        }

        // Switch between Chat and Forum in Communication view
        function switchCommunicationTab(tab) {
            const chatTab = document.getElementById('chatTab');
            const forumTab = document.getElementById('forumTab');
            const chatSection = document.getElementById('chatSection');
            const forumSection = document.getElementById('forumSection');
            
            if (tab === 'chat') {
                chatTab.classList.remove('bg-gray-200', 'text-gray-700');
                chatTab.classList.add('bg-vit-orange', 'text-white');
                forumTab.classList.remove('bg-vit-orange', 'text-white');
                forumTab.classList.add('bg-gray-200', 'text-gray-700');
                chatSection.style.display = 'block';
                forumSection.style.display = 'none';
            } else {
                forumTab.classList.remove('bg-gray-200', 'text-gray-700');
                forumTab.classList.add('bg-vit-orange', 'text-white');
                chatTab.classList.remove('bg-vit-orange', 'text-white');
                chatTab.classList.add('bg-gray-200', 'text-gray-700');
                forumSection.style.display = 'block';
                chatSection.style.display = 'none';
            }
        }

        // Update premium features visibility
        function updatePremiumFeatures() {
            const premiumMenuItems = document.querySelectorAll('.premium-menu-item');
            const premiumFeatures = document.querySelectorAll('.premium-feature');
            
            premiumMenuItems.forEach(item => {
                if (!isPremium) {
                    item.classList.add('locked-menu-item');
                    item.onclick = function(e) {
                        e.preventDefault();
                        showPremiumUpgradeModal();
                    };
                } else {
                    item.classList.remove('locked-menu-item');
                }
            });

            premiumFeatures.forEach(feature => {
                if (!isPremium) {
                    feature.classList.add('locked');
                } else {
                    feature.classList.remove('locked');
                }
            });
        }

        // Show premium upgrade modal
        function showPremiumUpgradeModal() {
            alert('üîí Premium Feature\n\nDiese Funktion ist nur f√ºr vit:bikes Franchisenehmer verf√ºgbar.\n\n‚ú® Werde vit:bikes Partner und erhalte Zugang zu:\n‚Ä¢ Marketing-Materialien vom HQ\n‚Ä¢ Best Practice Forum\n‚Ä¢ Einkaufsvorteile\n‚Ä¢ Schulungen & Support\n\nInteresse? Kontaktiere uns unter: partner@vitbikes.de');
        }

        // Show specific view
        
        // Dashboard Widget Management
        let dashboardEditMode = false;
        
        function toggleDashboardEdit() {
            dashboardEditMode = !dashboardEditMode;
            const addPanel = document.getElementById('widgetAddPanel');
            const removeButtons = document.querySelectorAll('.widget-remove');
            const editButton = document.getElementById('dashboardEditButton');
            
            if (dashboardEditMode) {
                addPanel.classList.remove('hidden');
                removeButtons.forEach(btn => btn.classList.remove('hidden'));
                editButton.textContent = 'Fertig';
            } else {
                addPanel.classList.add('hidden');
                removeButtons.forEach(btn => btn.classList.add('hidden'));
                editButton.textContent = 'Dashboard anpassen';
            }
        }
        
        function addWidget(widgetName) {
            const widget = document.querySelector(`[data-widget="${widgetName}"]`);
            if (widget) {
                widget.style.display = 'block';
                showToast(`Widget "${widgetName}" hinzugef√ºgt`);
            }
        }
        
        // Widget Remove (Event Delegation)
        document.addEventListener('click', function(e) {
            if (e.target.closest('.widget-remove')) {
                const widget = e.target.closest('.dashboard-widget');
                const widgetName = widget.getAttribute('data-widget');
                widget.style.display = 'none';
                showToast(`Widget "${widgetName}" entfernt`);
            }
        });
        
        // Tab Switching Functions
        
        function showMarketingTab(tabName) {
            // Hide all marketing tabs
            document.querySelectorAll('.marketing-tab-content').forEach(function(tab) { tab.style.display = 'none'; });
            
            // Reset all tab buttons
            document.querySelectorAll('.marketing-tab-btn').forEach(function(btn) {
                btn.className = 'marketing-tab-btn whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-semibold text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300';
            });
            
            // Show selected tab content
            var tabId = 'marketingTab' + tabName.charAt(0).toUpperCase() + tabName.slice(1);
            var tabEl = document.getElementById(tabId);
            if (tabEl) tabEl.style.display = 'block';
            
            // Highlight active tab button
            var activeBtn = document.querySelector('.marketing-tab-btn[data-tab="' + tabName + '"]');
            if (activeBtn) {
                activeBtn.className = 'marketing-tab-btn whitespace-nowrap py-4 px-1 border-b-2 border-vit-orange font-semibold text-sm text-vit-orange';
            }

            // Init Social Media themen on first open
            if(tabName==='social') { renderSmThemen(); }
        }
        
        // === VERKAUF MODULE ===
        var verkaufData = {
            sellers: [
                {
                    name: 'Sandra', plan_soll: 10, gesamt_ist: 2, verkauft: 1, umsatz_kw: 7091, umsatz_jahr: 16192, vk_jahr: 6,
                    daily: [
                        {day:'Mo',plan:0,gesamt:0,geplant:0,spontan:0,online:0,ergo:0,verkauft:0,uebergabe:0,umsatz:0},
                        {day:'Di',plan:2,gesamt:0,geplant:0,spontan:0,online:0,ergo:0,verkauft:0,uebergabe:0,umsatz:0},
                        {day:'Mi',plan:2,gesamt:0,geplant:0,spontan:0,online:0,ergo:0,verkauft:0,uebergabe:1,umsatz:5024},
                        {day:'Do',plan:2,gesamt:1,geplant:0,spontan:0,online:1,ergo:0,verkauft:1,uebergabe:0,umsatz:2067},
                        {day:'Fr',plan:2,gesamt:1,geplant:0,spontan:1,online:0,ergo:0,verkauft:0,uebergabe:0,umsatz:0},
                        {day:'Sa',plan:2,gesamt:0,geplant:0,spontan:0,online:0,ergo:0,verkauft:0,uebergabe:0,umsatz:0}
                    ]
                },
                {
                    name: 'Thomas', plan_soll: 0, gesamt_ist: 0, verkauft: 0, umsatz_kw: 0, umsatz_jahr: 17419, vk_jahr: 4,
                    daily: [
                        {day:'Mo',plan:0,gesamt:0,geplant:0,spontan:0,online:0,ergo:0,verkauft:0,uebergabe:0,umsatz:0},
                        {day:'Di',plan:0,gesamt:0,geplant:0,spontan:0,online:0,ergo:0,verkauft:0,uebergabe:0,umsatz:0},
                        {day:'Mi',plan:0,gesamt:0,geplant:0,spontan:0,online:0,ergo:0,verkauft:0,uebergabe:0,umsatz:0},
                        {day:'Do',plan:0,gesamt:0,geplant:0,spontan:0,online:0,ergo:0,verkauft:0,uebergabe:0,umsatz:0},
                        {day:'Fr',plan:0,gesamt:0,geplant:0,spontan:0,online:0,ergo:0,verkauft:0,uebergabe:0,umsatz:0},
                        {day:'Sa',plan:0,gesamt:0,geplant:0,spontan:0,online:0,ergo:0,verkauft:0,uebergabe:0,umsatz:0}
                    ]
                },
                {
                    name: 'Dirk', plan_soll: 15, gesamt_ist: 2, verkauft: 0, umsatz_kw: 8569, umsatz_jahr: 36629, vk_jahr: 6,
                    daily: [
                        {day:'Mo',plan:0,gesamt:0,geplant:0,spontan:0,online:0,ergo:0,verkauft:0,uebergabe:0,umsatz:0},
                        {day:'Di',plan:3,gesamt:0,geplant:0,spontan:0,online:0,ergo:0,verkauft:0,uebergabe:0,umsatz:253},
                        {day:'Mi',plan:3,gesamt:0,geplant:0,spontan:0,online:0,ergo:0,verkauft:0,uebergabe:0,umsatz:4801},
                        {day:'Do',plan:3,gesamt:0,geplant:0,spontan:0,online:0,ergo:0,verkauft:0,uebergabe:1,umsatz:59},
                        {day:'Fr',plan:3,gesamt:0,geplant:0,spontan:0,online:0,ergo:0,verkauft:0,uebergabe:1,umsatz:3456},
                        {day:'Sa',plan:3,gesamt:2,geplant:0,spontan:2,online:0,ergo:0,verkauft:0,uebergabe:0,umsatz:0}
                    ]
                },
                {
                    name: 'Max', plan_soll: 0, gesamt_ist: 0, verkauft: 0, umsatz_kw: 1396, umsatz_jahr: 3813, vk_jahr: 0,
                    daily: [
                        {day:'Mo',plan:0,gesamt:0,geplant:0,spontan:0,online:0,ergo:0,verkauft:0,uebergabe:0,umsatz:0},
                        {day:'Di',plan:0,gesamt:0,geplant:0,spontan:0,online:0,ergo:0,verkauft:0,uebergabe:0,umsatz:0},
                        {day:'Mi',plan:0,gesamt:0,geplant:0,spontan:0,online:0,ergo:0,verkauft:0,uebergabe:0,umsatz:737},
                        {day:'Do',plan:0,gesamt:0,geplant:0,spontan:0,online:0,ergo:0,verkauft:0,uebergabe:0,umsatz:0},
                        {day:'Fr',plan:0,gesamt:0,geplant:0,spontan:0,online:0,ergo:0,verkauft:0,uebergabe:0,umsatz:0},
                        {day:'Sa',plan:0,gesamt:0,geplant:0,spontan:0,online:0,ergo:0,verkauft:0,uebergabe:0,umsatz:659}
                    ]
                }
            ],
            jahres: [
                {monat:'Januar',plan:57025,ist:57025,termine_soll:24,termine_ist:12,verkauft:11,quote:92,avg:5184},
                {monat:'Februar',plan:77734,ist:17057,termine_soll:32,termine_ist:8,verkauft:5,quote:63,avg:3411},
                {monat:'Maerz',plan:150406,ist:0,termine_soll:62,termine_ist:0,verkauft:0,quote:0,avg:0},
                {monat:'April',plan:121269,ist:0,termine_soll:50,termine_ist:0,verkauft:0,quote:0,avg:0},
                {monat:'Mai',plan:163470,ist:0,termine_soll:68,termine_ist:0,verkauft:0,quote:0,avg:0},
                {monat:'Juni',plan:157808,ist:0,termine_soll:65,termine_ist:0,verkauft:0,quote:0,avg:0},
                {monat:'Juli',plan:138764,ist:0,termine_soll:57,termine_ist:0,verkauft:0,quote:0,avg:0},
                {monat:'August',plan:76258,ist:0,termine_soll:32,termine_ist:0,verkauft:0,quote:0,avg:0},
                {monat:'September',plan:86544,ist:0,termine_soll:36,termine_ist:0,verkauft:0,quote:0,avg:0},
                {monat:'Oktober',plan:73018,ist:0,termine_soll:30,termine_ist:0,verkauft:0,quote:0,avg:0},
                {monat:'November',plan:40796,ist:0,termine_soll:17,termine_ist:0,verkauft:0,quote:0,avg:0},
                {monat:'Dezember',plan:24597,ist:0,termine_soll:10,termine_ist:0,verkauft:0,quote:0,avg:0}
            ],
            pipeline: [
                {id:1,name:'Fam. Mueller',type:'E-Bike Trekking',seller:'Sandra',value:4500,stage:'termin',date:'17.02.'},
                {id:2,name:'Hr. Schneider',type:'E-Bike MTB',seller:'Dirk',value:5200,stage:'beratung',date:'15.02.'},
                {id:3,name:'Fr. Weber',type:'E-Bike City',seller:'Sandra',value:3200,stage:'angebot',date:'14.02.'},
                {id:4,name:'Hr. Becker',type:'Rennrad',seller:'Thomas',value:2800,stage:'angebot',date:'13.02.'},
                {id:5,name:'Fam. Schmidt',type:'E-Bike Cargo',seller:'Dirk',value:6500,stage:'lead',date:'16.02.'},
                {id:6,name:'Fr. Klein',type:'E-Bike Trekking',seller:'Sandra',value:3800,stage:'termin',date:'18.02.'},
                {id:7,name:'Hr. Wagner',type:'MTB',seller:'Thomas',value:1900,stage:'lead',date:'16.02.'},
                {id:8,name:'Fr. Hoffmann',type:'E-Bike City',seller:'Dirk',value:3400,stage:'beratung',date:'14.02.'},
                {id:9,name:'Hr. Braun',type:'E-Bike Trekking',seller:'Sandra',value:4200,stage:'verkauft',date:'12.02.'},
                {id:10,name:'Fr. Richter',type:'E-Bike MTB',seller:'Dirk',value:5800,stage:'verkauft',date:'11.02.'},
                {id:11,name:'Hr. Wolf',type:'E-Bike City',seller:'Thomas',value:2900,stage:'verkauft',date:'10.02.'},
                {id:12,name:'Fam. Koch',type:'E-Bike Trekking',seller:'Dirk',value:4100,stage:'uebergabe',date:'08.02.'},
                {id:13,name:'Hr. Neumann',type:'Rennrad',seller:'Thomas',value:3200,stage:'verloren',date:'09.02.'},
                {id:14,name:'Fr. Schwarz',type:'E-Bike City',seller:'Sandra',value:2700,stage:'verloren',date:'07.02.'}
            ]
        };

        var pipelineStages = [
            {id:'lead',label:'Lead',color:'bg-gray-100 border-gray-300'},
            {id:'termin',label:'Termin gebucht',color:'bg-blue-50 border-blue-300'},
            {id:'beratung',label:'In Beratung',color:'bg-yellow-50 border-yellow-300'},
            {id:'angebot',label:'Angebot',color:'bg-purple-50 border-purple-300'},
            {id:'verkauft',label:'Verkauft',color:'bg-green-50 border-green-300'},
            {id:'uebergabe',label:'Uebergabe',color:'bg-emerald-50 border-emerald-300'},
            {id:'verloren',label:'Nicht gekauft',color:'bg-red-50 border-red-300'}
        ];

        function renderWeekView() {
            var filter = document.getElementById('weekSellerFilter').value;
            var sellers = filter === 'all' ? verkaufData.sellers : verkaufData.sellers.filter(function(s){return s.name === filter;});
            
            // Calculate KPIs
            var totalPlan = 0, totalGesamt = 0, totalVerkauft = 0, totalUmsatz = 0;
            sellers.forEach(function(s) {
                totalPlan += s.plan_soll;
                s.daily.forEach(function(d) {
                    totalGesamt += d.gesamt;
                    totalVerkauft += d.verkauft;
                    totalUmsatz += d.umsatz;
                });
            });
            document.getElementById('wkPlan').textContent = totalPlan;
            document.getElementById('wkGesamt').textContent = totalGesamt;
            document.getElementById('wkVerkauft').textContent = totalVerkauft;
            document.getElementById('wkUmsatz').textContent = totalUmsatz.toLocaleString('de-DE') + ' \u20AC';
            var quoteVal = totalGesamt > 0 ? Math.round((totalVerkauft/totalGesamt)*100) : 0;
            var quoteEl = document.getElementById('wkQuote');
            quoteEl.textContent = quoteVal + '%';
            quoteEl.className = 'text-2xl font-bold ' + (quoteVal >= 70 ? 'text-green-600' : quoteVal >= 40 ? 'text-orange-600' : 'text-red-600');

            // Render seller tables
            var container = document.getElementById('weekSellerTables');
            var html = '';
            sellers.forEach(function(s) {
                var sUmsatz = 0, sGesamt = 0, sVerkauft = 0;
                s.daily.forEach(function(d) { sUmsatz += d.umsatz; sGesamt += d.gesamt; sVerkauft += d.verkauft; });
                var sQuote = sGesamt > 0 ? Math.round((sVerkauft/sGesamt)*100) : 0;

                html += '<div class="vit-card overflow-hidden">';
                html += '<div class="flex items-center justify-between p-4 bg-gray-50 border-b">';
                html += '<div class="flex items-center space-x-3"><div class="w-8 h-8 bg-vit-orange rounded-full flex items-center justify-center text-white font-bold text-sm">' + s.name.charAt(0) + '</div>';
                html += '<div><p class="font-semibold text-gray-800">' + s.name + '</p><p class="text-xs text-gray-500">Plan: ' + s.plan_soll + ' Termine</p></div></div>';
                html += '<div class="flex space-x-4 text-center">';
                html += '<div><p class="text-xs text-gray-500">Beratungen</p><p class="font-bold text-blue-600">' + sGesamt + '</p></div>';
                html += '<div><p class="text-xs text-gray-500">Verkauft</p><p class="font-bold text-green-600">' + sVerkauft + '</p></div>';
                html += '<div><p class="text-xs text-gray-500">Umsatz</p><p class="font-bold text-vit-orange">' + sUmsatz.toLocaleString('de-DE') + ' \u20AC</p></div>';
                html += '<div><p class="text-xs text-gray-500">Quote</p><p class="font-bold ' + (sQuote >= 70 ? 'text-green-600' : sQuote >= 40 ? 'text-orange-600' : 'text-red-600') + '">' + sQuote + '%</p></div>';
                html += '</div></div>';

                // Daily table
                html += '<div class="overflow-x-auto"><table class="w-full text-sm">';
                html += '<thead><tr class="bg-gray-50 text-xs"><th class="py-2 px-3 text-left text-gray-500">Tag</th><th class="py-2 px-3 text-center text-gray-500">Plan</th><th class="py-2 px-3 text-center text-blue-600">Geplant</th><th class="py-2 px-3 text-center text-purple-600">Spontan</th><th class="py-2 px-3 text-center text-cyan-600">Online</th><th class="py-2 px-3 text-center text-pink-600">Ergo</th><th class="py-2 px-3 text-center font-bold text-gray-700">Gesamt</th><th class="py-2 px-3 text-center text-green-600">Verkauft</th><th class="py-2 px-3 text-center text-gray-500">Uebergabe</th><th class="py-2 px-3 text-right text-vit-orange">Umsatz</th></tr></thead>';
                html += '<tbody>';
                s.daily.forEach(function(d) {
                    var total = d.geplant + d.spontan + d.online + d.ergo;
                    var hasData = d.plan > 0 || total > 0 || d.umsatz > 0;
                    html += '<tr class="border-b ' + (hasData ? '' : 'text-gray-300') + '">';
                    html += '<td class="py-2 px-3 font-semibold">' + d.day + '</td>';
                    html += '<td class="py-2 px-3 text-center">' + (d.plan || '-') + '</td>';
                    html += '<td class="py-2 px-3 text-center text-blue-600">' + (d.geplant || '-') + '</td>';
                    html += '<td class="py-2 px-3 text-center text-purple-600">' + (d.spontan || '-') + '</td>';
                    html += '<td class="py-2 px-3 text-center text-cyan-600">' + (d.online || '-') + '</td>';
                    html += '<td class="py-2 px-3 text-center text-pink-600">' + (d.ergo || '-') + '</td>';
                    html += '<td class="py-2 px-3 text-center font-bold">' + (total || '-') + '</td>';
                    html += '<td class="py-2 px-3 text-center text-green-600 font-bold">' + (d.verkauft || '-') + '</td>';
                    html += '<td class="py-2 px-3 text-center">' + (d.uebergabe || '-') + '</td>';
                    html += '<td class="py-2 px-3 text-right font-semibold ' + (d.umsatz > 0 ? 'text-vit-orange' : '') + '">' + (d.umsatz > 0 ? d.umsatz.toLocaleString('de-DE') + ' \u20AC' : '-') + '</td>';
                    html += '</tr>';
                });
                html += '</tbody></table></div></div>';
            });
            container.innerHTML = html;
        }

        function renderPipeline() {
            var filter = document.getElementById('pipelineFilter').value;
            var leads = filter === 'all' ? verkaufData.pipeline : verkaufData.pipeline.filter(function(l){return l.seller === filter;});
            var board = document.getElementById('kanbanBoard');
            var html = '';

            pipelineStages.forEach(function(stage) {
                var stageLeads = leads.filter(function(l){return l.stage === stage.id;});
                var stageValue = 0;
                stageLeads.forEach(function(l){stageValue += l.value;});

                html += '<div class="min-w-[220px] flex-shrink-0">';
                html += '<div class="mb-3 flex items-center justify-between">';
                html += '<h3 class="font-semibold text-gray-700 text-sm">' + stage.label + '</h3>';
                html += '<span class="text-xs font-bold bg-gray-200 text-gray-600 rounded-full px-2 py-0.5">' + stageLeads.length + '</span>';
                html += '</div>';
                html += '<div class="space-y-2 min-h-[100px] p-2 rounded-lg border-2 border-dashed ' + stage.color + '">';

                stageLeads.forEach(function(lead) {
                    html += '<div class="bg-white p-3 rounded-lg shadow-sm border border-gray-200 cursor-pointer hover:shadow-md transition">';
                    html += '<div class="flex items-center justify-between mb-1"><p class="font-semibold text-gray-800 text-sm">' + lead.name + '</p></div>';
                    html += '<p class="text-xs text-gray-500">' + lead.type + '</p>';
                    html += '<div class="flex items-center justify-between mt-2">';
                    html += '<span class="text-xs text-gray-400">' + lead.seller + ' ¬∑ ' + lead.date + '</span>';
                    html += '<span class="text-sm font-bold text-vit-orange">' + lead.value.toLocaleString('de-DE') + ' \u20AC</span>';
                    html += '</div>';
                    // Stage move buttons
                    var stageIdx = -1;
                    for(var si=0;si<pipelineStages.length;si++){if(pipelineStages[si].id===lead.stage)stageIdx=si;}
                    html += '<div class="flex space-x-1 mt-2">';
                    if(stageIdx > 0) html += '<button onclick="moveLead('+lead.id+',\'' + pipelineStages[stageIdx-1].id + '\')" class="flex-1 text-xs py-1 bg-gray-100 rounded hover:bg-gray-200">&#9664;</button>';
                    if(stageIdx < pipelineStages.length-1) html += '<button onclick="moveLead('+lead.id+',\'' + pipelineStages[stageIdx+1].id + '\')" class="flex-1 text-xs py-1 bg-gray-100 rounded hover:bg-gray-200">&#9654;</button>';
                    html += '</div>';
                    html += '</div>';
                });

                if(stageLeads.length > 0) {
                    html += '<div class="text-center text-xs text-gray-400 mt-2 pt-2 border-t border-gray-200">' + stageValue.toLocaleString('de-DE') + ' \u20AC</div>';
                }
                html += '</div></div>';
            });
            board.innerHTML = html;
        }

        function moveLead(id, newStage) {
            for(var i=0; i<verkaufData.pipeline.length; i++) {
                if(verkaufData.pipeline[i].id === id) {
                    verkaufData.pipeline[i].stage = newStage;
                    break;
                }
            }
            renderPipeline();
        }

        function showNewLeadModal() {
            document.getElementById('newLeadModal').classList.remove('hidden');
        }

        async function addNewLead() {
            var nameVal = document.getElementById('leadName').value || 'Neuer Kunde';
            var type = document.getElementById('leadType').value;
            var value = parseInt(document.getElementById('leadValue').value) || 3000;
            var notes = document.getElementById('leadNotes') ? document.getElementById('leadNotes').value : '';

            if(!sbUser) { alert('Nicht eingeloggt.'); return; }

            var nameParts = nameVal.trim().split(' ');
            var vorname = nameParts[0] || nameVal;
            var nachname = nameParts.slice(1).join(' ') || '';

            try {
                var resp = await sb.from('leads').insert({
                    standort_id: sbProfile.standort_id,
                    erstellt_von: sbUser.id,
                    vorname: vorname,
                    nachname: nachname,
                    interesse: type,
                    geschaetzter_wert: value,
                    notizen: notes,
                    status: 'neu',
                    quelle: 'walk_in',
                    prioritaet: 'mittel'
                });
                if(resp.error) throw resp.error;

                document.getElementById('newLeadModal').classList.add('hidden');
                document.getElementById('leadName').value = '';
                document.getElementById('leadValue').value = '';
                if(document.getElementById('leadNotes')) document.getElementById('leadNotes').value = '';
                await loadPipelineFromSupabase();
            } catch(err) {
                alert('Fehler: ' + err.message);
            }
        }

        function renderJahresTabelle() {
            var tbody = document.getElementById('jahresTabelle');
            if(!tbody) return;
            var html = '';
            var totals = {plan:0,ist:0,tSoll:0,tIst:0,vk:0};
            verkaufData.jahres.forEach(function(m, idx) {
                var diff = m.ist - m.plan;
                var isCurrent = (idx === 1);
                var isFuture = m.ist === 0 && idx > 1;
                totals.plan += m.plan; totals.ist += m.ist; totals.tSoll += m.termine_soll; totals.tIst += m.termine_ist; totals.vk += m.verkauft;
                html += '<tr class="border-b ' + (isCurrent ? 'bg-blue-50 border-l-4 border-blue-400' : '') + ' ' + (isFuture ? 'text-gray-400' : '') + '">';
                html += '<td class="py-2.5 px-3 font-semibold">' + m.monat + '</td>';
                html += '<td class="text-right py-2.5 px-3">' + m.plan.toLocaleString('de-DE') + '</td>';
                html += '<td class="text-right py-2.5 px-3">' + (m.ist > 0 ? m.ist.toLocaleString('de-DE') : '\u2014') + '</td>';
                html += '<td class="text-right py-2.5 px-3 ' + (diff > 0 ? 'text-green-600' : diff < 0 && !isFuture ? 'text-red-600' : '') + ' font-semibold">' + (m.ist > 0 ? (diff > 0 ? '+' : '') + diff.toLocaleString('de-DE') : '\u2014') + '</td>';
                html += '<td class="text-right py-2.5 px-3">' + m.termine_soll + '</td>';
                html += '<td class="text-right py-2.5 px-3">' + (m.termine_ist > 0 ? m.termine_ist : '\u2014') + '</td>';
                html += '<td class="text-right py-2.5 px-3 font-bold text-green-600">' + (m.verkauft > 0 ? m.verkauft : '\u2014') + '</td>';
                html += '<td class="text-right py-2.5 px-3 ' + (m.quote >= 70 ? 'text-green-600' : m.quote > 0 ? 'text-orange-600' : '') + '">' + (m.quote > 0 ? m.quote + '%' : '\u2014') + '</td>';
                html += '<td class="text-right py-2.5 px-3">' + (m.avg > 0 ? m.avg.toLocaleString('de-DE') + ' \u20AC' : '\u2014') + '</td>';
                html += '</tr>';
            });
            // Totals
            var totalQuote = totals.tIst > 0 ? Math.round((totals.vk/totals.tIst)*100) : 0;
            html += '<tr class="bg-gray-100 border-t-2"><td class="py-3 px-3 font-bold">GESAMT</td>';
            html += '<td class="text-right py-3 px-3 font-bold">' + totals.plan.toLocaleString('de-DE') + '</td>';
            html += '<td class="text-right py-3 px-3 font-bold">' + totals.ist.toLocaleString('de-DE') + '</td>';
            html += '<td class="text-right py-3 px-3 font-bold text-red-600">' + (totals.ist - totals.plan).toLocaleString('de-DE') + '</td>';
            html += '<td class="text-right py-3 px-3 font-bold">' + totals.tSoll + '</td>';
            html += '<td class="text-right py-3 px-3 font-bold">' + totals.tIst + '</td>';
            html += '<td class="text-right py-3 px-3 font-bold text-green-600">' + totals.vk + '</td>';
            html += '<td class="text-right py-3 px-3 font-bold">' + totalQuote + '%</td>';
            html += '<td class="text-right py-3 px-3 font-bold">' + (totals.vk > 0 ? Math.round(totals.ist/totals.vk).toLocaleString('de-DE') + ' \u20AC' : '\u2014') + '</td>';
            html += '</tr>';
            tbody.innerHTML = html;
        }

        function showVerkaufTab(tabName) {
            document.querySelectorAll('.vk-tab-content').forEach(function(t){t.style.display='none';});
            document.querySelectorAll('.vk-tab-btn').forEach(function(b){
                b.className='vk-tab-btn whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-semibold text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300';
            });
            var tabId='vkTab'+tabName.charAt(0).toUpperCase()+tabName.slice(1);
            var el=document.getElementById(tabId);
            if(el) el.style.display='block';
            var btn=document.querySelector('.vk-tab-btn[data-tab="'+tabName+'"]');
            if(btn) btn.className='vk-tab-btn whitespace-nowrap py-4 px-1 border-b-2 border-vit-orange font-semibold text-sm text-vit-orange';
            if(tabName==='woche') renderWeekView();
            if(tabName==='pipeline') renderPipeline();
            if(tabName==='auswertung') renderJahresTabelle();
        }

        function changeWeek(dir) {
            alert('KW-Wechsel: Im echten Produkt werden hier die Daten der jeweiligen Woche geladen.');
        }

        // === EINKAUF ===
        var lieferanten = [
            {name:'Kalkhoff / Derby Cycle',marken:['Kalkhoff','Rixe'],typ:'fahrrad',kontakt:'Sarah Mueller',email:'s.mueller@derbycycle.de',tel:'+49 5765 20-0',konditionen:'38% vom UVP, 3% Skonto 14 Tage',rahmenvertrag:'bis 31.12.2026',portal:'https://b2b.derbycycle.com',status:'aktiv',volumen:245000,anteil:22,logo:'bg-blue-600'},
            {name:'Winora Group / Haibike',marken:['Haibike','Winora','Sinus'],typ:'fahrrad',kontakt:'Thomas Weber',email:'t.weber@winora-group.de',tel:'+49 9725 71-0',konditionen:'36% vom UVP, 2% Skonto 10 Tage',rahmenvertrag:'bis 31.12.2026',portal:'https://b2b.winora-group.de',status:'aktiv',volumen:198000,anteil:18,logo:'bg-red-600'},
            {name:'Simplon Fahrrad GmbH',marken:['Simplon'],typ:'fahrrad',kontakt:'Markus Huber',email:'m.huber@simplon.com',tel:'+43 5574 6722-0',konditionen:'40% vom UVP, netto 30 Tage',rahmenvertrag:'bis 31.12.2026',portal:'https://dealer.simplon.com',status:'aktiv',volumen:165000,anteil:15,logo:'bg-gray-800'},
            {name:'Orbea S.Coop.',marken:['Orbea'],typ:'fahrrad',kontakt:'Carlos Garcia',email:'c.garcia@orbea.com',tel:'+34 943 882 488',konditionen:'37% vom UVP, netto 30 Tage',rahmenvertrag:'bis 31.12.2026',portal:'https://b2b.orbea.com',status:'aktiv',volumen:142000,anteil:13,logo:'bg-orange-600'},
            {name:'Stevens Vertriebs GmbH',marken:['Stevens'],typ:'fahrrad',kontakt:'Petra Schulz',email:'p.schulz@stevensbikes.de',tel:'+49 40 6896 20-0',konditionen:'35% vom UVP, 2% Skonto 14 Tage',rahmenvertrag:'bis 31.12.2026',portal:'https://dealer.stevensbikes.de',status:'aktiv',volumen:88000,anteil:8,logo:'bg-green-700'},
            {name:'Babboe B.V.',marken:['Babboe'],typ:'fahrrad',kontakt:'Jan de Vries',email:'j.devries@babboe.de',tel:'+31 78 684 56 00',konditionen:'32% vom UVP, netto 30 Tage',rahmenvertrag:'bis 31.12.2026',portal:'https://dealer.babboe.com',status:'aktiv',volumen:52000,anteil:5,logo:'bg-yellow-500'},
            {name:'Riese & Mueller (NEU)',marken:['Riese & Mueller'],typ:'fahrrad',kontakt:'Wird zugeteilt',email:'dealer@r-m.de',tel:'+49 6151 366 86-0',konditionen:'In Verhandlung',rahmenvertrag:'Ab 01.03.2026',portal:'https://b2b.r-m.de',status:'neu',volumen:0,anteil:0,logo:'bg-purple-600'},
            {name:'Shimano Europe',marken:['Shimano','Steps','Deore','XT','SLX'],typ:'teile',kontakt:'Key Account DACH',email:'dealer-dach@shimano.eu',tel:'+49 211 13 06-0',konditionen:'Staffelpreise, netto 30 Tage',rahmenvertrag:'Netzwerkvertrag',portal:'https://b2b.shimano-eu.com',status:'aktiv',volumen:67000,anteil:6,logo:'bg-gray-600'},
            {name:'Bosch eBike Systems',marken:['Bosch','PowerTube','Kiox'],typ:'teile',kontakt:'Partner Service',email:'service@bosch-ebike.de',tel:'+49 711 400 40-990',konditionen:'UVP-gebunden, Bonus 2%',rahmenvertrag:'Netzwerkvertrag',portal:'https://www.bosch-ebike.com/de/haendler',status:'aktiv',volumen:45000,anteil:4,logo:'bg-red-700'},
            {name:'SRAM Europe',marken:['SRAM','RockShox','Avid','Zipp'],typ:'teile',kontakt:'Dealer Support',email:'dealersupport@sram.com',tel:'+49 9721 6571-0',konditionen:'Staffelpreise, netto 30 Tage',rahmenvertrag:'Netzwerkvertrag',portal:'https://b2b.sram.com',status:'aktiv',volumen:28000,anteil:3,logo:'bg-black'},
            {name:'Schwalbe / Ralf Bohle',marken:['Schwalbe','Marathon','Energizer'],typ:'teile',kontakt:'Innenservice',email:'info@schwalbe.de',tel:'+49 2191 946-0',konditionen:'35% vom UVP, netto 14 Tage',rahmenvertrag:'Netzwerkvertrag',portal:'https://b2b.schwalbe.com',status:'aktiv',volumen:12000,anteil:1,logo:'bg-blue-800'},
            {name:'HNF Nicolai (Ausgelistet)',marken:['HNF Nicolai'],typ:'fahrrad',kontakt:'‚Äî',email:'‚Äî',tel:'‚Äî',konditionen:'Vertrag ausgelaufen',rahmenvertrag:'Beendet 31.12.2025',portal:'‚Äî',status:'inaktiv',volumen:21500,anteil:0,logo:'bg-gray-400'},
            {name:'Husqvarna Bicycles (Ausgelistet)',marken:['Husqvarna'],typ:'fahrrad',kontakt:'‚Äî',email:'‚Äî',tel:'‚Äî',konditionen:'Marke eingestellt',rahmenvertrag:'Beendet 2025',portal:'‚Äî',status:'inaktiv',volumen:14000,anteil:0,logo:'bg-gray-400'},
        ];

        var liefFilterTyp = 'all';
        var liefFilterStatus = 'all';

        var ekMargen = [
            {marke:'Simplon',marge:42.1,color:'bg-green-500'},
            {marke:'Orbea',marge:39.8,color:'bg-green-500'},
            {marke:'Kalkhoff',marge:38.5,color:'bg-green-500'},
            {marke:'Haibike',marge:37.2,color:'bg-green-400'},
            {marke:'Stevens',marge:35.8,color:'bg-yellow-500'},
            {marke:'Babboe',marge:33.0,color:'bg-orange-500'},
        ];

        var ekTopModelle = [
            {name:'Kalkhoff Endeavour 5.B Move+',stueck:3,umsatz:14280},
            {name:'Simplon Kagu Bosch 275',stueck:2,umsatz:9798},
            {name:'Haibike Trekking 7',stueck:2,umsatz:7990},
            {name:'Orbea Gain D30 1x',stueck:2,umsatz:7198},
            {name:'Stevens E-Triton Forma',stueck:1,umsatz:3799},
        ];

        var ekFlopModelle = [
            {name:'Babboe City Mountain',tage:128,ek:2890,grund:'Saisonware, Herbst-Rest'},
            {name:'Stevens Jazz Lite',tage:104,ek:1249,grund:'Wenig Nachfrage Trekking analog'},
            {name:'Haibike HardSeven 1',tage:96,ek:899,grund:'Auslaufmodell 2025'},
        ];

        function renderLieferanten() {
            var filtered = lieferanten.filter(function(l) {
                if(liefFilterTyp !== 'all' && l.typ !== liefFilterTyp) return false;
                if(liefFilterStatus !== 'all' && l.status !== liefFilterStatus) return false;
                return true;
            });
            var q = (document.getElementById('liefSearch').value || '').toLowerCase();
            if(q) filtered = filtered.filter(function(l){ return (l.name + ' ' + l.marken.join(' ')).toLowerCase().indexOf(q) >= 0; });

            if(filtered.length === 0) {
                document.getElementById('lieferantenGrid').innerHTML = '<div class="col-span-full vit-card p-8 text-center text-gray-400"><p class="text-lg mb-1">Keine Lieferanten gefunden</p><p class="text-sm">Filter anpassen oder Suche aendern</p></div>';
                return;
            }
            var html = '';
            filtered.forEach(function(l) {
                var opacity = l.status === 'inaktiv' ? ' opacity-60' : '';
                html += '<div class="lief-card vit-card p-5 hover:shadow-lg transition' + opacity + '">';
                html += '<div class="flex items-start justify-between mb-3">';
                html += '<div class="flex items-center space-x-3"><div class="w-10 h-10 ' + l.logo + ' rounded-lg flex items-center justify-center text-white font-bold text-xs">' + l.name.charAt(0) + '</div>';
                html += '<div><h3 class="font-bold text-gray-800">' + l.name + '</h3>';
                html += '<p class="text-xs text-gray-500">' + l.marken.join(', ') + '</p></div></div>';
                html += '<div class="flex flex-col items-end space-y-1">';
                if(l.status==='neu') html += '<span class="text-xs font-bold bg-purple-100 text-purple-700 rounded-full px-2 py-0.5">NEU</span>';
                else if(l.status==='inaktiv') html += '<span class="text-xs font-bold bg-gray-200 text-gray-500 rounded-full px-2 py-0.5">Inaktiv</span>';
                else html += '<span class="text-xs font-bold bg-green-100 text-green-700 rounded-full px-2 py-0.5">Aktiv</span>';
                html += '<span class="text-xs rounded-full px-2 py-0.5 ' + (l.typ==='fahrrad' ? 'bg-blue-50 text-blue-600' : 'bg-amber-50 text-amber-700') + '">' + (l.typ==='fahrrad' ? 'üö≤ Fahrrad' : 'üîß Teile') + '</span>';
                html += '</div></div>';
                html += '<div class="space-y-1.5 text-xs text-gray-600 mb-3">';
                html += '<div class="flex justify-between"><span class="text-gray-400">Ansprechpartner:</span><span class="font-semibold">' + l.kontakt + '</span></div>';
                html += '<div class="flex justify-between"><span class="text-gray-400">Konditionen:</span><span class="font-semibold">' + l.konditionen + '</span></div>';
                html += '<div class="flex justify-between"><span class="text-gray-400">Rahmenvertrag:</span><span>' + l.rahmenvertrag + '</span></div>';
                if(l.volumen > 0) html += '<div class="flex justify-between"><span class="text-gray-400">Volumen 2025:</span><span class="font-semibold">' + l.volumen.toLocaleString('de-DE') + ' ‚Ç¨' + (l.anteil > 0 ? ' (' + l.anteil + '%)' : '') + '</span></div>';
                html += '</div>';
                if(l.status !== 'inaktiv') {
                    html += '<div class="flex items-center space-x-2 pt-3 border-t border-gray-100">';
                    html += '<a href="mailto:' + l.email + '" class="flex-1 text-center px-2 py-1.5 text-xs font-semibold border border-gray-300 rounded-lg hover:bg-gray-50">E-Mail</a>';
                    html += '<a href="' + l.portal + '" target="_blank" class="flex-1 text-center px-2 py-1.5 text-xs font-semibold bg-vit-orange text-white rounded-lg hover:opacity-90">B2B-Portal</a>';
                    html += '</div>';
                }
                html += '</div>';
            });
            document.getElementById('lieferantenGrid').innerHTML = html;
        }

        function filterLieferanten() { renderLieferanten(); }

        function toggleLiefFilter(group, val) {
            if(group === 'typ') {
                liefFilterTyp = val;
                document.querySelectorAll('.lief-typ-btn').forEach(function(b){ b.className = 'lief-typ-btn px-3 py-1.5 rounded-full text-xs font-semibold bg-gray-100 text-gray-600 hover:bg-gray-200'; });
                var btn = document.querySelector('.lief-typ-btn[data-typ="'+val+'"]');
                if(btn) btn.className = 'lief-typ-btn px-3 py-1.5 rounded-full text-xs font-semibold bg-vit-orange text-white';
            } else {
                liefFilterStatus = val;
                document.querySelectorAll('.lief-status-btn').forEach(function(b){ b.className = 'lief-status-btn px-3 py-1.5 rounded-full text-xs font-semibold bg-gray-100 text-gray-600 hover:bg-gray-200'; });
                var btn2 = document.querySelector('.lief-status-btn[data-st="'+val+'"]');
                if(btn2) btn2.className = 'lief-status-btn px-3 py-1.5 rounded-full text-xs font-semibold bg-vit-orange text-white';
            }
            renderLieferanten();
        }

        function renderEkAuswertung() {
            // Margen
            var html = '';
            ekMargen.forEach(function(m) {
                html += '<div class="flex items-center space-x-3">';
                html += '<span class="w-20 text-sm font-semibold text-gray-700">' + m.marke + '</span>';
                html += '<div class="flex-1 bg-gray-200 rounded-full h-4"><div class="' + m.color + ' h-4 rounded-full flex items-center justify-end pr-2" style="width:' + (m.marge/50*100) + '%"><span class="text-xs text-white font-bold">' + m.marge + '%</span></div></div>';
                html += '</div>';
            });
            document.getElementById('ekMargenList').innerHTML = html;

            // Top Modelle
            html = '';
            ekTopModelle.forEach(function(m,i) {
                html += '<div class="flex items-center justify-between py-2 ' + (i<4?'border-b border-gray-100':'') + '">';
                html += '<div class="flex items-center space-x-2"><span class="text-sm font-bold text-green-600">' + (i+1) + '.</span><span class="text-sm text-gray-800">' + m.name + '</span></div>';
                html += '<div class="text-right"><span class="text-sm font-bold text-gray-800">' + m.stueck + 'x</span><span class="text-xs text-gray-400 ml-2">' + m.umsatz.toLocaleString('de-DE') + ' ‚Ç¨</span></div>';
                html += '</div>';
            });
            document.getElementById('ekTopModelle').innerHTML = html;

            // Flop Modelle
            html = '';
            ekFlopModelle.forEach(function(m,i) {
                html += '<div class="flex items-center justify-between py-2 ' + (i<2?'border-b border-gray-100':'') + '">';
                html += '<div><span class="text-sm text-gray-800">' + m.name + '</span><span class="text-xs text-red-500 ml-2">' + m.tage + ' Tage</span></div>';
                html += '<div class="text-right"><span class="text-xs text-gray-400">EK: ' + m.ek + ' ‚Ç¨</span></div>';
                html += '</div>';
            });
            document.getElementById('ekFlopModelle').innerHTML = html;
        }

        function showEinkaufTab(tabName) {
            document.querySelectorAll('.ek-tab-content').forEach(function(t){t.style.display='none';});
            document.querySelectorAll('.ek-tab-btn').forEach(function(b){
                b.className='ek-tab-btn whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-semibold text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300';
            });
            var tabMap = {lieferanten:'Lieferanten',auswertung:'Auswertung',ekStrategie:'EkStrategie',ekWissen:'EkWissen'};
            var el = document.getElementById('ekTab' + (tabMap[tabName]||''));
            if(el) el.style.display = 'block';
            var btn = document.querySelector('.ek-tab-btn[data-tab="'+tabName+'"]');
            if(btn) btn.className='ek-tab-btn whitespace-nowrap py-4 px-1 border-b-2 border-vit-orange font-semibold text-sm text-vit-orange';
            if(tabName==='lieferanten') renderLieferanten();
            if(tabName==='auswertung') renderEkAuswertung();
        }

        // Init Einkauf
        renderLieferanten();

        // === KOMMUNIKATION: Inbox, Ankuendigungen, Brett, Termine ===
        var inboxMessages = [
            {id:1,from:'Lisa Berger (Einkauf)',avatar:'LB',color:'bg-emerald-500',subject:'Kalkhoff Vororder ‚Äì Sonderkonditionen fuer Grafrath',preview:'Hallo Sandra, ich hab fuer euch nochmal 3% Extra auf die Kalkhoff Endeavour Serie rausgeholt. Bitte bis 20.02. bestaetigen...',date:'14.02.2026 09:30',unread:true,sent:false},
            {id:2,from:'Jan Krause (Marketing)',avatar:'JK',color:'bg-blue-500',subject:'Freigabe Fruehjahrs-Schaufenster',preview:'Die Schaufenster-Deko fuer Maerz muss bis 25.02. bestellt werden. Anbei die Vorlage und Bestellliste. Bitte kurz bestaetigen...',date:'13.02.2026 16:10',unread:true,sent:false},
            {id:3,from:'Support / IT',avatar:'IT',color:'bg-gray-500',subject:'Kassensystem-Update am 18.02. ab 20 Uhr',preview:'Am Dienstag wird das Kassensystem aktualisiert. Bitte alle Tagesabschluesse vor 20 Uhr machen. Downtime ca. 2 Stunden...',date:'13.02.2026 11:45',unread:true,sent:false},
            {id:4,from:'Michael Frey (GF)',avatar:'MF',color:'bg-vit-orange',subject:'Re: Personalplanung Saison 2026',preview:'Danke fuer die Rueckmeldung Sandra. Die Aushilfe ab April ist genehmigt. Bitte Stellenanzeige ueber HR abstimmen...',date:'12.02.2026 14:20',unread:false,sent:false},
            {id:5,from:'Lisa Berger (Einkauf)',avatar:'LB',color:'bg-emerald-500',subject:'Re: Orbea Lieferverzoegerung',preview:'Update: Die Orbea-Lieferung KW 8 verschiebt sich auf KW 10. Betrifft 4 Raeder fuer Grafrath. Sorry, liegt am Zoll...',date:'11.02.2026 10:05',unread:false,sent:false},
            {id:6,from:'Du an Lisa Berger',avatar:'SG',color:'bg-blue-300',subject:'Orbea Lieferverzoegerung ‚Äì 2 Kunden warten',preview:'Hallo Lisa, bei uns warten 2 Kunden auf ihren Orbea Gain. Kannst du mal nachfragen wann die genau kommen?',date:'10.02.2026 16:30',unread:false,sent:true},
            {id:7,from:'Du an Support / IT',avatar:'SG',color:'bg-blue-300',subject:'Drucker im Buero druckt nicht mehr',preview:'Seit Montag druckt der Brother im Buero nicht mehr. Fehlermeldung: Toner leer. Brauchen wir neuen Toner oder neuen Drucker?',date:'08.02.2026 09:15',unread:false,sent:true},
        ];

        var announcements = [
            {id:1,title:'Neue Marke ab Maerz: Riese & Mueller',body:'Wir freuen uns, Riese & Mueller ab Saison 2026 ins Sortiment aufzunehmen! Preislisten und Schulungstermine folgen naechste Woche. Bitte meldet euer Interesse an der Erstbestuckung bis 28.02.',date:'14.02.2026',category:'Sortiment',icon:'üö≤',important:true,readBy:8,totalPartners:21},
            {id:2,title:'Preisanpassung Shimano Ersatzteile ab 01.03.',body:'Shimano hat eine Preiserhoehung von durchschnittlich 4.5% auf Ersatzteile angekuendigt (Steps-Motoren, Schaltgruppen, Bremsbelaege). Die neuen Preislisten sind im Einkaufsbereich hinterlegt. Bitte Lagerbestaende pruefen und ggf. vorbestellen.',date:'12.02.2026',category:'Preise',icon:'üí∞',important:true,readBy:15,totalPartners:21},
            {id:3,title:'Kampagnenstart: Fruehjahrs-Aktion 2026',body:'Ab 01.03. startet unsere Fruehjahrs-Kampagne "Dein Fruehling faehrt vit:bikes". Alle Materialien (Flyer, Plakate, Social-Media-Posts, Schaufenster-Deko) sind im Marketing-Bereich zum Download bereit. Bitte bis 25.02. bestellen.',date:'10.02.2026',category:'Marketing',icon:'üì£',important:false,readBy:19,totalPartners:21},
            {id:4,title:'Schulung: Bosch Smart System am 18.02.',body:'Online-Schulung zum neuen Bosch Smart System (Diagnose, Firmware, Fehlercodes) am 18.02. um 18:00 Uhr via Teams. Anmeldung ueber den Termine-Tab. Pflicht fuer alle Werkstatt-Mitarbeiter.',date:'07.02.2026',category:'Schulung',icon:'üéì',important:false,readBy:21,totalPartners:21},
            {id:5,title:'Partner-Meeting Q1 am 28.02. in Muenchen',body:'Das Q1-Partnermeeting findet am 28.02. im Hotel & Wirtshaus Post in Muenchen statt. Agenda: Jahresrueckblick, Sortimentsstrategie 2026, Marketing-Roadmap, offene Runde. Anmeldung bis 20.02.',date:'05.02.2026',category:'Event',icon:'üìÖ',important:false,readBy:18,totalPartners:21},
            {id:6,title:'IT: Neues Portal-Feature ‚Äì Verkaufsmodul live!',body:'Ab sofort ist das neue Verkaufsmodul mit Wochenansicht, Pipeline und Auswertung im Portal verfuegbar. Es ersetzt die Excel-Erfolgstabelle. Bitte testet es und gebt Feedback ueber den Support.',date:'01.02.2026',category:'IT/Portal',icon:'üíª',important:false,readBy:21,totalPartners:21},
        ];

        var brettPosts = [
            {id:1,cat:'suche',author:'Thomas (Grafrath)',avatar:'TG',color:'bg-green-500',title:'Kalkhoff Endeavour 5.B Move+ L/Diamant gesucht',body:'Kunde braucht es dringend, bei uns erst KW 12. Standort-Transfer moeglich. Bitte melden!',date:'12.02.2026',replies:3,urgent:true},
            {id:2,cat:'biete',author:'Stefan (Karlsfeld)',avatar:'SK',color:'bg-blue-500',title:'2x Orbea Gain D30 in M/S abzugeben',body:'Vorjahresmodell, nagelneu verpackt. Wuerde Selbstkostenpreis machen. Standort-Transfer oder Abholung.',date:'13.02.2026',replies:5,urgent:false},
            {id:3,cat:'biete',author:'Julia (Muenchen Ost)',avatar:'JM',color:'bg-purple-500',title:'Shimano Steps E6100 Motor (Austausch)',body:'Haben einen neuen E6100 Motor uebrig aus Garantiefall. Originalverpackt. VB 480 EUR netto.',date:'11.02.2026',replies:2,urgent:false},
            {id:4,cat:'suche',author:'Markus (Hanau)',avatar:'MH',color:'bg-red-500',title:'Bosch PowerTube 750 horizontal gesucht',body:'Fuer Kundenrad, Bosch liefert erst KW 14. Hat jemand einen auf Lager?',date:'10.02.2026',replies:1,urgent:true},
            {id:5,cat:'frage',author:'Anna (Starnberg)',avatar:'AS',color:'bg-pink-500',title:'Erfahrung mit neuem Kassensystem-Update?',body:'Hat schon jemand das Update installiert? Letzes Mal hatten wir Probleme mit dem EC-Terminal. Will vorbereitet sein.',date:'09.02.2026',replies:7,urgent:false},
            {id:6,cat:'tipp',author:'Dirk (Grafrath)',avatar:'DG',color:'bg-cyan-500',title:'Genialer Montagestaender-Hack',body:'Wer den Feedback Sports Pro Ultra hat: mit einem 3D-gedruckten Adapter passt auch der Bosch CX Gen5 Rahmen rein. STL-Datei kann ich teilen.',date:'08.02.2026',replies:12,urgent:false},
            {id:7,cat:'suche',author:'Petra (Augsburg)',avatar:'PA',color:'bg-yellow-600',title:'Aushilfe fuer Saison gesucht ‚Äì Erfahrungen?',body:'Wir suchen eine Verkaufs-Aushilfe fuer April-August. Hat jemand Tipps wo man gute Leute findet? Indeed war bei uns bisher Fehlanzeige.',date:'07.02.2026',replies:9,urgent:false},
            {id:8,cat:'biete',author:'Thomas (Grafrath)',avatar:'TG',color:'bg-green-500',title:'Messestand-Material abzugeben',body:'Haben noch 2 Roll-ups und 1 Theke vom letzten Hausmesse-Event. Guter Zustand, gegen Abholung kostenlos.',date:'05.02.2026',replies:4,urgent:false},
        ];

        var termine = [
            {id:1,date:'14.02.2026',time:'Heute',title:'Vororder-Konditionen pruefen',desc:'Sonderkonditionen von Lisa fuer Kalkhoff bestaetigen',type:'deadline',color:'bg-red-500',past:false},
            {id:2,date:'18.02.2026',time:'Di ¬∑ 18:00 ‚Äì 19:30',title:'Online-Schulung: Bosch Smart System',desc:'Pflicht fuer Werkstatt. Diagnose, Firmware-Updates, Fehlercodes. Via Microsoft Teams.',type:'schulung',color:'bg-blue-500',past:false},
            {id:3,date:'20.02.2026',time:'Do',title:'Deadline: Kalkhoff Vororder H/W 2026',desc:'Bestellformular an Lisa Berger (Einkauf) senden.',type:'deadline',color:'bg-red-500',past:false},
            {id:4,date:'25.02.2026',time:'Mi',title:'Deadline: Fruehjahrs-Schaufenster bestellen',desc:'Deko-Material und Plakate ueber Marketing-Portal bestellen.',type:'deadline',color:'bg-red-500',past:false},
            {id:5,date:'27.02.2026',time:'Fr ¬∑ 10:00 ‚Äì 11:00',title:'Standort-Call mit Michael Frey',desc:'Monatlicher 1:1 Call mit GF. Themen: Personalplanung, Q1-Performance, Saisonvorbereitung.',type:'meeting',color:'bg-blue-500',past:false},
            {id:6,date:'28.02.2026',time:'Sa ¬∑ 10:00 ‚Äì 17:00',title:'Partner-Meeting Q1 ‚Äì Muenchen',desc:'Hotel & Wirtshaus Post, Muenchen. Jahresrueckblick, Sortiment 2026, Marketing-Roadmap. Mittagessen inklusive.',type:'event',color:'bg-green-500',past:false},
            {id:7,date:'28.02.2026',time:'Sa',title:'Deadline: Vororder komplett H/W 2026',desc:'Letzte Moeglichkeit fuer alle H/W Vororders mit Fruehbucher-Konditionen.',type:'deadline',color:'bg-red-500',past:false},
            {id:8,date:'01.03.2026',time:'So',title:'Kampagnenstart: Fruehjahrs-Aktion',desc:'Flyer, Plakate, Schaufenster muessen stehen. Social-Media-Posts starten automatisch.',type:'event',color:'bg-green-500',past:false},
            {id:9,date:'12.03.2026',time:'Do ¬∑ 18:00 ‚Äì 19:00',title:'Online-Schulung: Riese & Mueller Sortiment',desc:'Einfuehrung neue Marke. Modelle, USPs, Zielgruppen, Preise.',type:'schulung',color:'bg-blue-500',past:false},
            {id:10,date:'18.03.2026',time:'Mi ¬∑ 09:00 ‚Äì 18:00',title:'Hausmesse Grafrath',desc:'Eigene Hausmesse am Standort. Probefahrten, Fruehjahrs-Angebote, Leasing-Beratung.',type:'event',color:'bg-green-500',past:false},
        ];

        function renderInbox(filter) {
            var msgs = inboxMessages;
            if(filter==='unread') msgs = msgs.filter(function(m){return m.unread;});
            if(filter==='sent') msgs = msgs.filter(function(m){return m.sent;});
            var html = '';
            msgs.forEach(function(m) {
                html += '<div class="vit-card p-4 hover:shadow-md transition cursor-pointer ' + (m.unread ? 'border-l-4 border-vit-orange bg-orange-50' : '') + '">';
                html += '<div class="flex items-start space-x-3">';
                html += '<div class="w-10 h-10 ' + m.color + ' rounded-full flex items-center justify-center text-white font-bold text-xs flex-shrink-0">' + m.avatar + '</div>';
                html += '<div class="flex-1 min-w-0">';
                html += '<div class="flex items-center justify-between mb-0.5"><span class="font-semibold text-gray-800 text-sm">' + m.from + '</span><span class="text-xs text-gray-400 flex-shrink-0 ml-2">' + m.date + '</span></div>';
                html += '<p class="font-semibold text-gray-800 text-sm ' + (m.unread ? '' : 'font-normal') + '">' + m.subject + '</p>';
                html += '<p class="text-xs text-gray-500 truncate mt-0.5">' + m.preview + '</p>';
                html += '</div>';
                if(m.unread) html += '<span class="w-2.5 h-2.5 bg-vit-orange rounded-full flex-shrink-0 mt-2"></span>';
                html += '</div></div>';
            });
            document.getElementById('inboxList').innerHTML = html;
        }

        function filterInbox(f) {
            document.querySelectorAll('.inbox-filter-btn').forEach(function(b){b.className='inbox-filter-btn px-3 py-1.5 rounded-full text-xs font-semibold bg-gray-100 text-gray-600';});
            var btn=document.querySelector('.inbox-filter-btn[data-f="'+f+'"]');
            if(btn) btn.className='inbox-filter-btn px-3 py-1.5 rounded-full text-xs font-semibold bg-vit-orange text-white';
            renderInbox(f);
        }

        function sendInboxMsg() {
            var compose = document.getElementById('inboxCompose');
            var inputs = compose.querySelectorAll('input[type=text], textarea, select');
            var to = inputs[0] ? inputs[0].options[inputs[0].selectedIndex].text : 'Zentrale';
            var subject = inputs[1] ? inputs[1].value : '';
            var body = inputs[2] ? inputs[2].value : '';
            if(!subject && !body) { alert('Bitte Betreff oder Nachricht eingeben.'); return; }
            inboxMessages.unshift({
                id: inboxMessages.length+1,
                from: 'Du',
                subject: subject || '(Kein Betreff)',
                preview: body.substring(0,80) || '',
                date: 'Gerade',
                read: true,
                folder: 'sent',
                icon: 'üì§'
            });
            if(inputs[1]) inputs[1].value = '';
            if(inputs[2]) inputs[2].value = '';
            compose.classList.add('hidden');
            filterInbox('sent');
        }

        async function renderAnnouncements() {
            var container = document.getElementById('announceList');
            if(!container) return;
            try {
                var resp = await sb.from('ankuendigungen').select('*, users(name)').order('created_at', {ascending:false});
                if(resp.error) throw resp.error;
                var anns = resp.data || [];
                var html = '';
                var icons = {news:'üì¢',event:'üìÖ',schulung:'üéì',marketing:'üì£',sortiment:'üö≤',preise:'üí∞',it:'üíª'};
                anns.forEach(function(a) {
                    var d = new Date(a.created_at);
                    var dateStr = d.toLocaleDateString('de-DE',{day:'2-digit',month:'2-digit',year:'numeric'});
                    html += '<div class="vit-card p-5 ' + (a.wichtig ? 'border-l-4 border-vit-orange' : '') + '">';
                    html += '<div class="flex items-start space-x-4">';
                    html += '<div class="w-12 h-12 bg-gray-100 rounded-xl flex items-center justify-center text-2xl">' + (icons[a.kategorie]||'üì¢') + '</div>';
                    html += '<div class="flex-1">';
                    html += '<div class="flex items-center space-x-2 mb-1">';
                    if(a.wichtig) html += '<span class="text-xs font-bold bg-red-100 text-red-600 rounded px-2 py-0.5">Wichtig</span>';
                    html += '<span class="text-xs text-gray-400">' + dateStr + '</span></div>';
                    html += '<h3 class="font-bold text-gray-800 mb-2">' + a.titel + '</h3>';
                    html += '<p class="text-sm text-gray-600">' + a.inhalt + '</p>';
                    html += '</div></div></div>';
                });
                if(anns.length===0) html = '<div class="text-center py-8 text-gray-400">Keine Ank√ºndigungen.</div>';
                container.innerHTML = html;
            } catch(err) { console.error('Ank√ºndigungen:', err); }
        }

        async function renderBrett(cat) {
            var container = document.getElementById('brettPosts');
            if(!container) return;
            try {
                var query = sb.from('brett_eintraege').select('*, users(name)').eq('aktiv', true).order('created_at', {ascending:false});
                if(cat && cat !== 'all') query = query.eq('kategorie', cat);
                var resp = await query;
                if(resp.error) throw resp.error;
                var posts = resp.data || [];
                var html = '';
                var catColors = {suche:'bg-red-100 text-red-700 border-red-200',biete:'bg-green-100 text-green-700 border-green-200',frage:'bg-blue-100 text-blue-700 border-blue-200',tipp:'bg-yellow-100 text-yellow-700 border-yellow-200',allgemein:'bg-gray-100 text-gray-700 border-gray-200'};
                var catLabels = {suche:'üîç Gesucht',biete:'üè∑Ô∏è Biete',frage:'‚ùì Frage',tipp:'üí° Tipp',allgemein:'üìå Allgemein'};
                posts.forEach(function(p) {
                    var authorName = p.users ? p.users.name : 'Unbekannt';
                    var initials = authorName.split(' ').map(function(n){return n[0]}).join('').substring(0,2);
                    var colors = ['bg-green-500','bg-blue-500','bg-purple-500','bg-red-500','bg-pink-500','bg-cyan-500'];
                    var ci = authorName.split('').reduce(function(a,c){return a+c.charCodeAt(0)},0) % colors.length;
                    var d = new Date(p.created_at);
                    html += '<div class="vit-card p-5 hover:shadow-md transition">';
                    html += '<div class="flex items-center space-x-2 mb-2"><span class="text-xs font-bold rounded-full px-2.5 py-1 border ' + (catColors[p.kategorie]||catColors.allgemein) + '">' + (catLabels[p.kategorie]||p.kategorie) + '</span></div>';
                    html += '<h3 class="font-bold text-gray-800 mb-1">' + p.titel + '</h3>';
                    html += '<p class="text-sm text-gray-600 mb-3">' + (p.beschreibung||'') + '</p>';
                    html += '<div class="flex items-center space-x-3 text-xs text-gray-400">';
                    html += '<div class="flex items-center space-x-1"><div class="w-5 h-5 ' + colors[ci] + ' rounded-full flex items-center justify-center text-white text-[10px] font-bold">' + initials + '</div><span>' + authorName + '</span></div>';
                    html += '<span>' + d.toLocaleDateString('de-DE') + '</span></div></div>';
                });
                if(posts.length===0) html = '<div class="col-span-2 text-center py-8 text-gray-400">Keine Eintr√§ge.</div>';
                container.innerHTML = html;
            } catch(err) { console.error('Brett:', err); }
        }

        function filterBrett(cat) {
            document.querySelectorAll('.brett-cat-btn').forEach(function(b){b.className='brett-cat-btn px-3 py-1.5 rounded-full text-xs font-semibold bg-gray-100 text-gray-600';});
            var btn=document.querySelector('.brett-cat-btn[data-bc="'+cat+'"]');
            if(btn) btn.className='brett-cat-btn px-3 py-1.5 rounded-full text-xs font-semibold bg-vit-orange text-white';
            renderBrett(cat);
        }

        async function renderTermine() {
            var container = document.getElementById('termineList');
            if(!container) return;
            try {
                var resp = await sb.from('termine').select('*').gte('start_zeit', new Date().toISOString().split('T')[0]).order('start_zeit', {ascending:true}).limit(15);
                if(resp.error) throw resp.error;
                var terms = resp.data || [];
                var html = '';
                var typeLabels = {termin:'üìã',meeting:'üë•',schulung:'üéì',event:'üéâ',deadline:'‚è∞',probefahrt:'üö≤'};
                terms.forEach(function(t) {
                    var d = new Date(t.start_zeit);
                    var dateStr = d.toLocaleDateString('de-DE',{weekday:'short',day:'2-digit',month:'2-digit'});
                    var timeStr = t.ganztaegig ? 'Ganzt√§gig' : d.getHours()+':'+String(d.getMinutes()).padStart(2,'0');
                    if(t.end_zeit) { var e=new Date(t.end_zeit); timeStr += ' ‚Äì '+e.getHours()+':'+String(e.getMinutes()).padStart(2,'0'); }
                    html += '<div class="vit-card p-4 flex items-start space-x-4 hover:shadow-md transition">';
                    html += '<div class="text-center flex-shrink-0 w-14"><div class="text-2xl">' + (typeLabels[t.typ]||'üìã') + '</div><div class="text-xs font-bold text-gray-500 mt-1">' + dateStr + '</div></div>';
                    html += '<div class="flex-1"><h4 class="font-bold text-gray-800 text-sm">' + t.titel + '</h4>';
                    html += '<p class="text-xs text-gray-500 mt-0.5">' + timeStr + (t.ort ? ' ¬∑ ' + t.ort : '') + '</p>';
                    if(t.beschreibung) html += '<p class="text-xs text-gray-400 mt-1">' + t.beschreibung + '</p>';
                    html += '</div></div>';
                });
                if(terms.length===0) html = '<div class="text-center py-8 text-gray-400">Keine anstehenden Termine.</div>';
                container.innerHTML = html;
            } catch(err) { console.error('Termine:', err); }
        }

        function showKommTab(tabName) {
            document.querySelectorAll('.komm-tab-content').forEach(function(t){t.style.display='none';});
            document.querySelectorAll('.komm-tab-btn').forEach(function(b){
                b.className='komm-tab-btn whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-semibold text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300';
            });
            var tabMap = {inbox:'Inbox',announce:'Announce',forum:'Forum',brett:'Brett',channel:'Channel',termine:'Termine'};
            var el = document.getElementById('kommTab' + (tabMap[tabName]||''));
            if(el) el.style.display = 'block';
            var btn = document.querySelector('.komm-tab-btn[data-tab="'+tabName+'"]');
            if(btn) btn.className='komm-tab-btn whitespace-nowrap py-4 px-1 border-b-2 border-vit-orange font-semibold text-sm text-vit-orange';
            if(tabName==='inbox') renderInbox('all');
            if(tabName==='announce') renderAnnouncements();
            if(tabName==='forum') renderForumPosts('all');
            if(tabName==='brett') renderBrett('all');
            if(tabName==='channel') renderChannelMessages();
            if(tabName==='termine') renderTermine();
        }

        // Init default tab
        renderInbox('all');

        // === KOMMUNIKATION (Forum + Channel data) ===
        var forumPosts = [
            {id:1,cat:'zentrale',pinned:true,author:'vit:bikes Zentrale',avatar:'V',avatarColor:'bg-vit-orange',date:'14.02.2026 ¬∑ 09:00',title:'Vororder Herbst/Winter 2026 ‚Äì Deadline 28.02.',body:'Liebe Partner, bitte denkt an die Vororder-Deadline fuer H/W 2026. Die Konditionen und Bestellformulare findet ihr im Einkaufsbereich. Bei Fragen meldet euch bei eurem Ansprechpartner.',replies:8,views:142,lastReply:'vor 2 Std.'},
            {id:2,cat:'verkauf',author:'Stefan (Karlsfeld)',avatar:'SK',avatarColor:'bg-blue-500',date:'13.02.2026 ¬∑ 16:45',title:'Erfahrungen mit Simplon Kagu 2026?',body:'Hat jemand schon den neuen Simplon Kagu 2026 im Laden? Wir hatten 3 Probefahrten und die Kunden waren begeistert, aber der Preis ist schon sportlich. Wie argumentiert ihr das?',replies:12,views:89,lastReply:'vor 30 Min.'},
            {id:3,cat:'werkstatt',author:'Markus (Hanau)',avatar:'MH',avatarColor:'bg-green-600',date:'13.02.2026 ¬∑ 14:20',title:'Shimano EP6 Firmware-Update Probleme',body:'Wir haben seit dem letzten Firmware-Update Probleme mit dem EP6 Motor ‚Äì Display zeigt sporadisch Fehlercode W013. Hat das noch jemand? Shimano Support reagiert langsam.',replies:6,views:67,lastReply:'vor 1 Std.'},
            {id:4,cat:'allgemein',author:'Julia (Muenchen Ost)',avatar:'JM',avatarColor:'bg-purple-500',date:'12.02.2026 ¬∑ 11:30',title:'Wer hat Lust auf ein Partner-Stammtisch Muenchen?',body:'Wir koennten uns mal informell treffen ‚Äì Pizza, Bier und Erfahrungsaustausch. Wuerde vorschlagen Ende Maerz, wenn die Saison noch nicht voll angelaufen ist. Wer waere dabei?',replies:15,views:103,lastReply:'vor 4 Std.'},
            {id:5,cat:'einkauf',author:'Thomas (Grafrath)',avatar:'TG',avatarColor:'bg-cyan-600',date:'12.02.2026 ¬∑ 09:15',title:'Kalkhoff Endeavour lieferbar?',body:'Hat jemand gerade einen Kalkhoff Endeavour 5.B Move+ in L/Diamant auf Lager? Mein Kunde braucht ihn dringend, bei uns erst KW 12 avisiert. Wuerde Standort-Transfer machen.',replies:3,views:34,lastReply:'vor 8 Std.'},
            {id:6,cat:'zentrale',author:'vit:bikes Zentrale',avatar:'V',avatarColor:'bg-vit-orange',date:'10.02.2026 ¬∑ 10:00',title:'Neue Marketingmaterialien Fruehjahr 2026 verfuegbar',body:'Die neuen Fruehjahrs-Flyer, Plakate und Social Media Templates stehen ab sofort im Marketing-Bereich zum Download bereit. Bitte bis 01.03. im Laden aufhaengen.',replies:4,views:118,lastReply:'vor 2 Tagen'},
            {id:7,cat:'werkstatt',author:'Dirk (Grafrath)',avatar:'DG',avatarColor:'bg-red-500',date:'09.02.2026 ¬∑ 15:40',title:'Tipp: Bosch CX Gen5 Kettenblatt-Wechsel',body:'Kleiner Werkstatt-Tipp: Beim neuen Bosch CX Gen5 muss man das Spezialwerkzeug BDU3741 verwenden, sonst verkratzt man die Motorabdeckung. Hat mich eine Stunde gekostet bis ichs rausgefunden hab.',replies:9,views:76,lastReply:'vor 3 Tagen'},
            {id:8,cat:'verkauf',author:'Anna (Starnberg)',avatar:'AS',avatarColor:'bg-pink-500',date:'08.02.2026 ¬∑ 13:00',title:'Leasing-Antraege beschleunigen ‚Äì mein Workflow',body:'Ich hab mir einen Prozess gebaut, mit dem Leasing-Antraege in unter 10 Min. durch sind. Kann ich gerne teilen, wenn Interesse besteht. Funktioniert mit Jobrad und Bikeleasing.',replies:18,views:156,lastReply:'vor 4 Tagen'},
        ];

        var channelMessages = [
            {author:'Sandra',avatar:'S',color:'bg-blue-500',time:'08:15',text:'Guten Morgen zusammen! Hab heute 3 Termine ab 10 Uhr. Wer macht Kasse?'},
            {author:'Dirk',avatar:'D',color:'bg-purple-500',time:'08:22',text:'Moin! Ich mach Kasse bis Mittag, dann hab ich den Werkstatt-Rueckstau von gestern.'},
            {author:'Thomas',avatar:'T',color:'bg-green-500',time:'08:30',text:'Bin ab 9 da. Sandra, dein 10-Uhr Termin hat angerufen ‚Äì kommt 15 Min. spaeter.'},
            {author:'Sandra',avatar:'S',color:'bg-blue-500',time:'08:32',text:'Danke Thomas! Dann zieh ich den Papierkram vor.'},
            {author:'Max',avatar:'M',color:'bg-orange-500',time:'09:05',text:'Morgen! Die Shimano-Lieferung ist da, 3 Kartons. Soll ich direkt einraeumen oder erst die Werkstatt-Auftraege?'},
            {author:'Dirk',avatar:'D',color:'bg-purple-500',time:'09:08',text:'Werkstatt zuerst bitte ‚Äì der Herr Mueller will sein Rad heute abholen und da fehlen noch die Bremsbelaege.'},
            {author:'Max',avatar:'M',color:'bg-orange-500',time:'09:10',text:'Alles klar, Bremsbelaege muessten in Karton 2 sein. Mach ich sofort.'},
            {author:'Sandra',avatar:'S',color:'bg-blue-500',time:'10:45',text:'Erster Termin war super ‚Äì Fam. Mueller nimmt den Simplon Kagu! 4.899 EUR. Muss noch Leasing-Antrag machen.'},
            {author:'Thomas',avatar:'T',color:'bg-green-500',time:'10:48',text:'Nice! Welche Farbe?'},
            {author:'Sandra',avatar:'S',color:'bg-blue-500',time:'10:50',text:'Midnight Blue, Groesse M. Lieferzeit hat er gesagt ist ok, braucht es erst Ende Maerz.'},
            {author:'Dirk',avatar:'D',color:'bg-purple-500',time:'12:15',text:'Kurze Info: Der Kalkhoff Endeavour fuer Herrn Schmidt ist jetzt fertig aufgebaut. Kann ab morgen abgeholt werden. Wer ruft ihn an?'},
            {author:'Thomas',avatar:'T',color:'bg-green-500',time:'12:18',text:'Mach ich nach der Pause!'},
            {author:'Max',avatar:'M',color:'bg-orange-500',time:'13:30',text:'Shimano-Lieferung komplett eingeraeumt. Aber es fehlen 2x Deore XT Kassette 12-fach, die waren auf dem Lieferschein. Hab Reklamation per Mail geschickt.'},
            {author:'Sandra',avatar:'S',color:'bg-blue-500',time:'14:20',text:'Zweiter Termin war leider nix ‚Äì wollte nur Preise vergleichen und kauft wahrscheinlich online. Dritter kommt um 15 Uhr.'},
        ];

        async function renderForumPosts(cat) {
            var container = document.getElementById('forumPosts');
            if(!container) return;
            container.innerHTML = '<div class="text-center py-4"><span class="text-gray-400 text-sm">Beitr√§ge werden geladen...</span></div>';

            try {
                var query = sb.from('forum_beitraege').select('*, users(name)').order('gepinnt', { ascending: false }).order('created_at', { ascending: false });
                if(cat && cat !== 'all') query = query.eq('kategorie', cat);

                var resp = await query;
                if(resp.error) throw resp.error;

                var posts = resp.data || [];
                var html = '';

                if(posts.length === 0) {
                    html = '<div class="text-center py-8"><span class="text-gray-400 text-sm">Keine Beitr√§ge gefunden.</span></div>';
                }

                var catColors = {news:'bg-vit-orange text-white',frage:'bg-blue-100 text-blue-700',tipp:'bg-green-100 text-green-700',allgemein:'bg-gray-100 text-gray-700'};
                var catLabels = {news:'News',frage:'Frage',tipp:'Tipp',allgemein:'Allgemein'};

                for(var i = 0; i < posts.length; i++) {
                    var p = posts[i];
                    var authorName = p.users ? p.users.name : 'Unbekannt';
                    var initials = authorName.split(' ').map(function(n){return n[0];}).join('').substring(0,2);
                    var colors = ['bg-blue-500','bg-green-600','bg-purple-500','bg-cyan-600','bg-pink-500','bg-red-500'];
                    var colorIdx = authorName.split('').reduce(function(a,c){return a+c.charCodeAt(0);},0) % colors.length;
                    var d = new Date(p.created_at);
                    var dateStr = d.toLocaleDateString('de-DE',{day:'2-digit',month:'2-digit',year:'numeric'}) + ' ¬∑ ' + d.getHours()+':'+String(d.getMinutes()).padStart(2,'0');

                    // Kommentare z√§hlen
                    var commResp = await sb.from('forum_kommentare').select('id', { count: 'exact', head: true }).eq('beitrag_id', p.id);
                    var replyCount = commResp.count || 0;

                    html += '<div class="vit-card p-5 hover:shadow-md transition ' + (p.gepinnt ? 'border-l-4 border-vit-orange' : '') + '">';
                    html += '<div class="flex items-start space-x-4">';
                    html += '<div class="w-10 h-10 ' + (p.gepinnt ? 'bg-vit-orange' : colors[colorIdx]) + ' rounded-full flex items-center justify-center text-white font-bold text-sm flex-shrink-0">' + initials + '</div>';
                    html += '<div class="flex-1 min-w-0">';
                    html += '<div class="flex items-center space-x-2 mb-1">';
                    if(p.gepinnt) html += '<span class="text-xs font-bold bg-yellow-100 text-yellow-700 rounded px-1.5 py-0.5">üìå Angepinnt</span>';
                    html += '<span class="text-xs font-semibold rounded px-2 py-0.5 ' + (catColors[p.kategorie]||catColors.allgemein) + '">' + (catLabels[p.kategorie]||p.kategorie) + '</span>';
                    html += '</div>';
                    html += '<h3 class="font-bold text-gray-800 mb-1 hover:text-vit-orange cursor-pointer">' + p.titel + '</h3>';
                    html += '<p class="text-sm text-gray-600 mb-2 line-clamp-2">' + p.inhalt + '</p>';
                    html += '<div class="flex items-center space-x-4 text-xs text-gray-400">';
                    html += '<span class="font-semibold text-gray-600">' + authorName + '</span>';
                    html += '<span>' + dateStr + '</span>';
                    html += '<span>üí¨ ' + replyCount + ' Antworten</span>';
                    html += '</div></div></div></div>';
                }

                container.innerHTML = html;
            } catch(err) {
                console.error('Forum laden:', err);
                container.innerHTML = '<div class="text-center py-4"><span class="text-red-400 text-sm">Fehler: ' + err.message + '</span></div>';
            }
        }

        function filterForum(cat) {
            document.querySelectorAll('.forum-cat-btn').forEach(function(b){
                b.className = 'forum-cat-btn px-3 py-1.5 rounded-full text-xs font-semibold bg-gray-100 text-gray-600 hover:bg-gray-200';
            });
            var btn = document.querySelector('.forum-cat-btn[data-cat="'+cat+'"]');
            if(btn) btn.className = 'forum-cat-btn px-3 py-1.5 rounded-full text-xs font-semibold bg-vit-orange text-white';
            renderForumPosts(cat);
        }

        var sbKanalId = null; // aktiver Kanal
        var sbKanaele = []; // geladene Kan√§le
        var realtimeSubscription = null;

        async function loadKanaele() {
            try {
                var resp = await sb.from('chat_kanaele').select('*').order('created_at');
                if(resp.error) throw resp.error;
                sbKanaele = resp.data || [];
            } catch(err) { console.error('Kan√§le laden:', err); }
        }

        async function renderChannelMessages() {
            var container = document.getElementById('channelMessages');
            if(!container) return;
            container.innerHTML = '<div class="text-center py-8"><span class="text-gray-400 text-sm">Nachrichten werden geladen...</span></div>';

            try {
                // Kan√§le laden falls noch nicht geschehen
                if(sbKanaele.length === 0) await loadKanaele();

                // Ersten Standort-Kanal w√§hlen (Team-Chat)
                if(!sbKanalId && sbKanaele.length > 0) {
                    var teamKanal = sbKanaele.find(function(k) { return k.standort_id !== null; });
                    sbKanalId = teamKanal ? teamKanal.id : sbKanaele[0].id;
                }

                if(!sbKanalId) {
                    container.innerHTML = '<div class="text-center py-8"><span class="text-gray-400 text-sm">Kein Chat-Kanal verf√ºgbar.</span></div>';
                    return;
                }

                // Header aktualisieren
                var aktKanal = sbKanaele.find(function(k) { return k.id === sbKanalId; });
                var headerTitle = container.closest('.komm-tab-content').querySelector('h3.font-bold');
                if(headerTitle && aktKanal) headerTitle.textContent = aktKanal.name;

                // Kanal-Tabs rendern
                renderKanalTabs();

                // Nachrichten laden mit User-Daten
                var resp = await sb.from('chat_nachrichten')
                    .select('*, users(name)')
                    .eq('kanal_id', sbKanalId)
                    .order('created_at', { ascending: true });
                if(resp.error) throw resp.error;

                var messages = resp.data || [];
                var html = '';
                var lastDateStr = '';

                messages.forEach(function(m) {
                    var d = new Date(m.created_at);
                    var dateStr = d.toLocaleDateString('de-DE', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' });
                    if(dateStr !== lastDateStr) {
                        html += '<div class="text-center my-3"><span class="text-xs bg-gray-100 text-gray-500 px-3 py-1 rounded-full">' + dateStr + '</span></div>';
                        lastDateStr = dateStr;
                    }
                    var authorName = m.users ? m.users.name : 'Unbekannt';
                    var initials = authorName.split(' ').map(function(n){return n[0];}).join('').substring(0,2);
                    var isMe = m.user_id === (sbUser ? sbUser.id : null);
                    var colors = ['bg-blue-500','bg-green-500','bg-purple-500','bg-orange-500','bg-cyan-500','bg-pink-500','bg-red-500'];
                    var colorIdx = authorName.split('').reduce(function(a,c){return a+c.charCodeAt(0);},0) % colors.length;
                    var time = d.getHours() + ':' + String(d.getMinutes()).padStart(2, '0');

                    html += '<div class="flex items-start space-x-3">';
                    html += '<div class="w-8 h-8 ' + (isMe ? 'bg-vit-orange' : colors[colorIdx]) + ' rounded-full flex items-center justify-center text-white text-xs font-bold flex-shrink-0">' + initials + '</div>';
                    html += '<div class="flex-1"><div class="flex items-baseline space-x-2"><span class="font-semibold text-gray-800 text-sm">' + authorName + '</span><span class="text-xs text-gray-400">' + time + '</span></div>';
                    html += '<p class="text-sm text-gray-700 mt-0.5">' + m.nachricht.replace(/</g,'&lt;').replace(/>/g,'&gt;') + '</p></div></div>';
                });

                if(messages.length === 0) {
                    html = '<div class="text-center py-8"><span class="text-gray-400 text-sm">Noch keine Nachrichten. Schreib die erste! üëã</span></div>';
                }

                container.innerHTML = html;
                container.scrollTop = container.scrollHeight;

                // Realtime subscription starten
                subscribeToChannel();

            } catch(err) {
                console.error('Chat laden:', err);
                container.innerHTML = '<div class="text-center py-8"><span class="text-red-400 text-sm">Fehler beim Laden: ' + err.message + '</span></div>';
            }
        }

        function renderKanalTabs() {
            // Kanal-Wechsel Buttons √ºber dem Chat einf√ºgen
            var channelTab = document.getElementById('kommTabChannel');
            var existing = document.getElementById('kanalTabsBar');
            if(existing) existing.remove();
            if(!channelTab || sbKanaele.length <= 1) return;

            var tabsHtml = '<div id="kanalTabsBar" class="flex space-x-2 mb-3">';
            sbKanaele.forEach(function(k) {
                var active = k.id === sbKanalId;
                tabsHtml += '<button onclick="switchKanal(\'' + k.id + '\')" class="px-3 py-1.5 rounded-full text-xs font-semibold ' +
                    (active ? 'bg-vit-orange text-white' : 'bg-gray-100 text-gray-600 hover:bg-gray-200') + '">' +
                    (k.standort_id ? '# ' : 'üåê ') + k.name + '</button>';
            });
            tabsHtml += '</div>';

            var headerCard = channelTab.querySelector('.vit-card.p-4.mb-4');
            if(headerCard) headerCard.insertAdjacentHTML('afterend', tabsHtml);
        }

        async function switchKanal(kanalId) {
            sbKanalId = kanalId;
            if(realtimeSubscription) {
                sb.removeChannel(realtimeSubscription);
                realtimeSubscription = null;
            }
            await renderChannelMessages();
        }

        function subscribeToChannel() {
            if(realtimeSubscription) {
                sb.removeChannel(realtimeSubscription);
            }
            realtimeSubscription = sb.channel('chat-' + sbKanalId)
                .on('postgres_changes', {
                    event: 'INSERT',
                    schema: 'public',
                    table: 'chat_nachrichten',
                    filter: 'kanal_id=eq.' + sbKanalId
                }, async function(payload) {
                    // Neue Nachricht eingetroffen ‚Äì Autor laden
                    var msg = payload.new;
                    if(msg.user_id === (sbUser ? sbUser.id : null)) return; // eigene schon gerendert
                    var resp = await sb.from('users').select('name').eq('id', msg.user_id).single();
                    var authorName = resp.data ? resp.data.name : 'Unbekannt';
                    var initials = authorName.split(' ').map(function(n){return n[0];}).join('').substring(0,2);
                    var colors = ['bg-blue-500','bg-green-500','bg-purple-500','bg-orange-500','bg-cyan-500','bg-pink-500','bg-red-500'];
                    var colorIdx = authorName.split('').reduce(function(a,c){return a+c.charCodeAt(0);},0) % colors.length;
                    var d = new Date(msg.created_at);
                    var time = d.getHours() + ':' + String(d.getMinutes()).padStart(2,'0');

                    var container = document.getElementById('channelMessages');
                    if(!container) return;
                    var msgHtml = '<div class="flex items-start space-x-3">';
                    msgHtml += '<div class="w-8 h-8 ' + colors[colorIdx] + ' rounded-full flex items-center justify-center text-white text-xs font-bold flex-shrink-0">' + initials + '</div>';
                    msgHtml += '<div class="flex-1"><div class="flex items-baseline space-x-2"><span class="font-semibold text-gray-800 text-sm">' + authorName + '</span><span class="text-xs text-gray-400">' + time + '</span></div>';
                    msgHtml += '<p class="text-sm text-gray-700 mt-0.5">' + msg.nachricht.replace(/</g,'&lt;').replace(/>/g,'&gt;') + '</p></div></div>';
                    container.insertAdjacentHTML('beforeend', msgHtml);
                    container.scrollTop = container.scrollHeight;
                })
                .subscribe();
        }

        async function sendChannelMsg() {
            var input = document.getElementById('channelInput');
            var text = input.value.trim();
            if(!text || !sbUser || !sbKanalId) return;

            input.value = '';
            input.disabled = true;

            try {
                var resp = await sb.from('chat_nachrichten').insert({
                    kanal_id: sbKanalId,
                    user_id: sbUser.id,
                    nachricht: text
                });
                if(resp.error) throw resp.error;

                // Sofort lokal rendern (optimistic UI)
                var container = document.getElementById('channelMessages');
                var emptyMsg = container.querySelector('.text-center.py-8');
                if(emptyMsg) emptyMsg.remove();

                var d = new Date();
                var time = d.getHours() + ':' + String(d.getMinutes()).padStart(2,'0');
                var authorName = sbProfile ? sbProfile.name : 'Ich';
                var initials = authorName.split(' ').map(function(n){return n[0];}).join('').substring(0,2);

                var msgHtml = '<div class="flex items-start space-x-3">';
                msgHtml += '<div class="w-8 h-8 bg-vit-orange rounded-full flex items-center justify-center text-white text-xs font-bold flex-shrink-0">' + initials + '</div>';
                msgHtml += '<div class="flex-1"><div class="flex items-baseline space-x-2"><span class="font-semibold text-gray-800 text-sm">' + authorName + '</span><span class="text-xs text-gray-400">' + time + '</span></div>';
                msgHtml += '<p class="text-sm text-gray-700 mt-0.5">' + text.replace(/</g,'&lt;').replace(/>/g,'&gt;') + '</p></div></div>';
                container.insertAdjacentHTML('beforeend', msgHtml);
                container.scrollTop = container.scrollHeight;
            } catch(err) {
                alert('Senden fehlgeschlagen: ' + err.message);
                input.value = text;
            } finally {
                input.disabled = false;
                input.focus();
            }
        }

        // === AKTENSCHRANK ===
        var aktenFiles = {
            vertraege: [
                {name:'Franchisevertrag vit:bikes 2024',type:'PDF',date:'15.01.2026',size:'2.4 MB'},
                {name:'Mietvertrag Gewerbeflaeche Grafrath',type:'PDF',date:'01.03.2024',size:'1.8 MB'},
                {name:'Nachtrag Mietvertrag 2025',type:'PDF',date:'15.11.2025',size:'340 KB'},
                {name:'Gewerbeanmeldung',type:'PDF',date:'01.02.2024',size:'180 KB'},
                {name:'Betriebshaftpflicht Police 2026',type:'PDF',date:'10.01.2026',size:'520 KB'},
                {name:'Geschaeftsinhaltsversicherung',type:'PDF',date:'10.01.2026',size:'480 KB'},
                {name:'Arbeitsvertrag Sandra M.',type:'PDF',date:'15.04.2024',size:'290 KB'},
                {name:'Arbeitsvertrag Thomas K.',type:'PDF',date:'01.09.2024',size:'290 KB'},
            ],
            finanzen: [
                {name:'BWA Januar 2026',type:'XLSX',date:'05.02.2026',size:'145 KB'},
                {name:'BWA Dezember 2025',type:'XLSX',date:'18.01.2026',size:'142 KB'},
                {name:'Jahresabschluss 2024',type:'PDF',date:'30.06.2025',size:'3.1 MB'},
                {name:'Jahresabschluss 2023 (Gruendung)',type:'PDF',date:'28.03.2024',size:'2.8 MB'},
                {name:'Steuerbescheid GewSt 2024',type:'PDF',date:'15.09.2025',size:'420 KB'},
                {name:'Steuerbescheid KSt 2024',type:'PDF',date:'15.09.2025',size:'380 KB'},
                {name:'Planung 2026 Grafrath',type:'XLSX',date:'20.12.2025',size:'890 KB'},
                {name:'Planung 2025 Grafrath',type:'XLSX',date:'15.12.2024',size:'780 KB'},
                {name:'Kontoauszuege Jan 2026',type:'PDF',date:'02.02.2026',size:'1.2 MB'},
                {name:'Kontoauszuege Dez 2025',type:'PDF',date:'03.01.2026',size:'1.1 MB'},
                {name:'DATEV Zugangsdaten',type:'PDF',date:'01.03.2024',size:'85 KB'},
                {name:'Kassenbuch Q4 2025',type:'PDF',date:'08.01.2026',size:'560 KB'},
                {name:'Darlehensvertrag Sparkasse',type:'PDF',date:'15.02.2024',size:'1.4 MB'},
                {name:'Tilgungsplan 2024-2029',type:'XLSX',date:'15.02.2024',size:'95 KB'},
            ],
            personal: [
                {name:'Personalplanung 2026',type:'XLSX',date:'20.12.2025',size:'320 KB'},
                {name:'Lohnabrechnung Jan 2026 - Sandra',type:'PDF',date:'31.01.2026',size:'120 KB'},
                {name:'Lohnabrechnung Jan 2026 - Thomas',type:'PDF',date:'31.01.2026',size:'120 KB'},
                {name:'Lohnabrechnung Jan 2026 - Dirk',type:'PDF',date:'31.01.2026',size:'120 KB'},
                {name:'Lohnabrechnung Jan 2026 - Max',type:'PDF',date:'31.01.2026',size:'120 KB'},
                {name:'Urlaubsplanung 2026',type:'XLSX',date:'10.01.2026',size:'85 KB'},
                {name:'Dienstplan-Vorlage',type:'XLSX',date:'05.01.2026',size:'65 KB'},
                {name:'Fortbildung Haibike Zertifikat Sandra',type:'PDF',date:'20.11.2025',size:'1.8 MB'},
                {name:'Fortbildung Bosch eBike Thomas',type:'PDF',date:'15.10.2025',size:'2.1 MB'},
                {name:'Ersthelfer-Bescheinigung Dirk',type:'PDF',date:'01.06.2025',size:'340 KB'},
                {name:'Gefaehrdungsbeurteilung Werkstatt',type:'PDF',date:'15.03.2024',size:'450 KB'},
            ],
            standort: [
                {name:'Grundriss Ladenflaeche',type:'PDF',date:'01.02.2024',size:'4.2 MB'},
                {name:'Grundriss Werkstatt',type:'PDF',date:'01.02.2024',size:'3.8 MB'},
                {name:'Inventarliste Werkzeug 2025',type:'XLSX',date:'10.12.2025',size:'210 KB'},
                {name:'Wartungsprotokoll Heizung',type:'PDF',date:'15.10.2025',size:'180 KB'},
                {name:'Sicherheitsdatenblatt Reinigungsmittel',type:'PDF',date:'01.03.2024',size:'95 KB'},
                {name:'Brandschutzkonzept',type:'PDF',date:'01.02.2024',size:'1.6 MB'},
            ],
            marketing: [
                {name:'vit:bikes Brand Guidelines 2025',type:'PDF',date:'03.02.2026',size:'12.4 MB'},
                {name:'Logo-Kit (alle Formate)',type:'ZIP',date:'15.01.2025',size:'8.7 MB'},
                {name:'Flyer-Vorlage Fruehjahr 2026',type:'PDF',date:'01.02.2026',size:'5.2 MB'},
                {name:'Social Media Templates',type:'ZIP',date:'20.01.2026',size:'15.3 MB'},
                {name:'Fotos Ladengeschaeft (30 Bilder)',type:'ZIP',date:'10.03.2024',size:'45 MB'},
                {name:'Fotos Team 2025',type:'ZIP',date:'15.05.2025',size:'22 MB'},
                {name:'Google My Business Zugangsdaten',type:'PDF',date:'01.03.2024',size:'45 KB'},
                {name:'Kampagnenplan H1 2026',type:'XLSX',date:'15.01.2026',size:'180 KB'},
                {name:'Schaufenster-Gestaltung Leitfaden',type:'PDF',date:'10.11.2025',size:'3.4 MB'},
            ],
            lieferanten: [
                {name:'Rahmenvertrag Kalkhoff/Derby 2026',type:'PDF',date:'20.01.2026',size:'890 KB'},
                {name:'Rahmenvertrag Haibike/Winora 2026',type:'PDF',date:'18.01.2026',size:'760 KB'},
                {name:'Preisliste Simplon 2026',type:'PDF',date:'15.12.2025',size:'2.3 MB'},
                {name:'Preisliste Orbea 2026',type:'PDF',date:'10.12.2025',size:'4.1 MB'},
                {name:'Konditionsvereinbarung Shimano',type:'PDF',date:'01.11.2025',size:'340 KB'},
                {name:'Konditionsvereinbarung Bosch eBike',type:'PDF',date:'15.10.2025',size:'280 KB'},
                {name:'Reklamationsformular Vorlage',type:'DOCX',date:'01.03.2024',size:'85 KB'},
            ],
            diverses: [
                {name:'Protokoll Partnermeeting Nov 2025',type:'PDF',date:'08.02.2026',size:'220 KB'},
                {name:'Notizen Ladenumbau-Ideen',type:'DOCX',date:'25.01.2026',size:'95 KB'},
                {name:'Checkliste Saisonstart Fruehjahr',type:'PDF',date:'01.02.2026',size:'140 KB'},
            ]
        };

        var aktenFolderLabels = {
            vertraege:'Vertraege & Recht', finanzen:'Finanzen & Buchhaltung', personal:'Personal & HR',
            standort:'Standort & Betrieb', marketing:'Marketing & Branding', lieferanten:'Lieferanten & Einkauf', diverses:'Diverses'
        };

        function getFileIcon(type) {
            var colors = {PDF:'text-red-500',XLSX:'text-green-600',DOCX:'text-blue-600',ZIP:'text-yellow-600',JPG:'text-purple-500'};
            return '<span class="font-mono text-xs font-bold px-2 py-1 rounded '+(colors[type]||'text-gray-500')+' bg-gray-100">'+type+'</span>';
        }

        function openAktenFolder(folderId) {
            var files = aktenFiles[folderId] || [];
            document.getElementById('aktenFolderTitle').textContent = aktenFolderLabels[folderId] || folderId;
            var html = '';
            files.forEach(function(f) {
                html += '<tr class="border-b hover:bg-gray-50">';
                html += '<td class="py-3 px-4"><div class="flex items-center space-x-3">' + getFileIcon(f.type) + '<span class="font-medium text-gray-800">' + f.name + '</span></div></td>';
                html += '<td class="py-3 px-4 text-gray-500">' + f.type + '</td>';
                html += '<td class="py-3 px-4 text-gray-500">' + f.date + '</td>';
                html += '<td class="py-3 px-4 text-gray-500">' + f.size + '</td>';
                html += '<td class="py-3 px-4 text-right"><button class="text-vit-orange hover:underline text-sm font-semibold mr-3">Oeffnen</button><button class="text-gray-400 hover:text-red-500 text-sm">Loeschen</button></td>';
                html += '</tr>';
            });
            document.getElementById('aktenFileList').innerHTML = html;
            document.getElementById('aktenFolders').style.display = 'none';
            document.getElementById('aktenFolderDetail').classList.remove('hidden');
        }

        function closeAktenFolder() {
            document.getElementById('aktenFolders').style.display = '';
            document.getElementById('aktenFolderDetail').classList.add('hidden');
        }

        function filterAkten() {
            var q = document.getElementById('aktenSearch').value.toLowerCase();
            document.querySelectorAll('.akten-folder').forEach(function(f) {
                var text = f.textContent.toLowerCase();
                f.style.display = text.indexOf(q) >= 0 ? '' : 'none';
            });
        }

        // Init verkauf on page load
        renderWeekView();
        renderJahresTabelle();

        // Check for existing Supabase session
        checkSession();

        // === CONTROLLING TABS ===
        function showControllingTab(tabName) {
            document.querySelectorAll('.ctrl-tab-content').forEach(function(t) { t.style.display = 'none'; });
            document.querySelectorAll('.ctrl-tab-btn').forEach(function(b) {
                b.className = 'ctrl-tab-btn whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-semibold text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300';
            });
            var tabId = 'ctrlTab' + tabName.charAt(0).toUpperCase() + tabName.slice(1);
            var el = document.getElementById(tabId);
            if (el) el.style.display = 'block';
            var btn = document.querySelector('.ctrl-tab-btn[data-tab="' + tabName + '"]');
            if (btn) btn.className = 'ctrl-tab-btn whitespace-nowrap py-4 px-1 border-b-2 border-vit-orange font-semibold text-sm text-vit-orange';
        }

        function showBwaDetail(id) {
            // Highlight selected file
            document.querySelectorAll('.bwa-file').forEach(function(f) {
                f.classList.remove('bg-orange-50', 'border', 'border-vit-orange');
            });
            if (event && event.currentTarget) {
                event.currentTarget.classList.add('bg-orange-50', 'border', 'border-vit-orange');
            }
            // Update title
            var titles = { 'jan26': 'BWA Januar 2026', 'feb26': 'BWA Februar 2026', 'dez25': 'BWA Dezember 2025', 'nov25': 'BWA November 2025' };
            var t = document.getElementById('bwaTitle');
            if (t && titles[id]) t.textContent = titles[id];
        }

        // === LEAD REPORTING DASHBOARD ===
        var leadData = {
            standorte: [
                { name: 'Hanau', perf: 0 },
                { name: 'Hann. Muenden', perf: 16 },
                { name: 'Garching', perf: 32 },
                { name: 'Lohmar', perf: 36 },
                { name: 'Zell', perf: 38 },
                { name: 'Pfaffenhofen', perf: 46 },
                { name: 'Muenchen-Berg', perf: 52 },
                { name: 'Warendorf', perf: 68 },
                { name: 'Witten', perf: 69 },
                { name: 'Berlin-Brand.', perf: 70 },
                { name: 'Rottweil', perf: 72 },
                { name: 'Muenster', perf: 82 },
                { name: 'Reutlingen', perf: 84 },
                { name: 'Wesel', perf: 85 },
                { name: 'Teisendorf', perf: 89 },
                { name: 'Weilheim', perf: 91 },
                { name: 'Muenchen-Thal.', perf: 93 },
                { name: 'Holzkirchen', perf: 99 },
                { name: 'Grafrath', perf: 102 },
                { name: 'Hamburg', perf: 111 },
                { name: 'Karlsdorf-Neuth.', perf: 138 }
            ],
            monate: [
                { name: 'Jan', soll: 135.3, ist: 116, termin_cost: 146, sv025: 87.1, sv_roh: 348, gesamt: 203.1, diff: 67.8, perf: 150 },
                { name: 'Feb', soll: 287.4, ist: 51, termin_cost: 856, sv025: 17.0, sv_roh: 68, gesamt: 68.0, diff: -219.3, perf: 24 },
                { name: 'Maerz', soll: 363.4 },
                { name: 'Apr', soll: 397.3 },
                { name: 'Mai', soll: 432.9 },
                { name: 'Jun', soll: 397.3 },
                { name: 'Jul', soll: 396.2 },
                { name: 'Aug', soll: 359.7 },
                { name: 'Sep', soll: 324.0 },
                { name: 'Okt', soll: 218.8 },
                { name: 'Nov', soll: 182.0 },
                { name: 'Dez', soll: 108.2 }
            ]
        };

        function getPerformanceColor(perf) {
            if (perf >= 100) return 'bg-yellow-400';
            if (perf >= 75) return 'bg-green-500';
            if (perf >= 50) return 'bg-orange-500';
            return 'bg-red-500';
        }

        function getPerformanceDot(perf) {
            if (perf >= 100) return '#FBBF24';
            if (perf >= 75) return '#22C55E';
            if (perf >= 50) return '#F97316';
            return '#EF4444';
        }

        function renderLeadDashboard() {
            // Chart Bars
            var chartBars = document.getElementById('chartBars');
            var chartLabels = document.getElementById('chartLabels');
            if (!chartBars) return;
            var maxVal = 600;
            var barsHtml = '';
            var labelsHtml = '';
            leadData.monate.forEach(function(m) {
                var sollH = (m.soll / maxVal) * 100;
                var istH = m.ist ? (m.ist / maxVal) * 100 : 0;
                barsHtml += '<div class="flex-1 flex items-end justify-center space-x-1">' +
                    '<div class="w-5 bg-gray-300 rounded-t" style="height:' + sollH + '%;"></div>';
                if (m.ist) {
                    barsHtml += '<div class="w-5 bg-vit-orange rounded-t" style="height:' + istH + '%;"></div>';
                }
                barsHtml += '</div>';
                labelsHtml += '<span class="flex-1 text-center">' + m.name + '</span>';
            });
            chartBars.innerHTML = barsHtml;
            chartLabels.innerHTML = labelsHtml;

            // Detail Table
            var tbody = document.getElementById('detailTableBody');
            if (!tbody) return;
            var rowsHtml = '';
            leadData.monate.forEach(function(m, i) {
                var isCurrent = (i === 1);
                var rowClass = isCurrent ? 'bg-blue-50 border-l-4 border-blue-400' : '';
                var statusIcon = '‚è≥';
                if (m.perf) {
                    statusIcon = m.perf >= 100 ? '‚úÖ' : '‚ùå';
                }
                rowsHtml += '<tr class="border-b border-gray-100 ' + rowClass + '">' +
                    '<td class="py-3 px-2 font-semibold text-gray-800">' + m.name + '</td>' +
                    '<td class="py-3 px-2 text-right text-gray-700">' + m.soll.toFixed(1) + '</td>' +
                    '<td class="py-3 px-2 text-right text-green-600 font-semibold">' + (m.ist || '‚Äî') + '</td>' +
                    '<td class="py-3 px-2 text-right text-purple-600">' + (m.termin_cost ? m.termin_cost + ' ‚Ç¨' : '‚Äî') + '</td>' +
                    '<td class="py-3 px-2 text-right text-blue-600">' + (m.sv025 || '‚Äî') + '</td>' +
                    '<td class="py-3 px-2 text-right text-orange-600">' + (m.sv_roh || '‚Äî') + '</td>' +
                    '<td class="py-3 px-2 text-right font-bold text-gray-800">' + (m.gesamt ? m.gesamt.toFixed(1) : '‚Äî') + '</td>' +
                    '<td class="py-3 px-2 text-right ' + (m.diff > 0 ? 'text-green-600' : m.diff < 0 ? 'text-red-600' : 'text-gray-400') + ' font-semibold">' + (m.diff ? (m.diff > 0 ? '+' : '') + m.diff.toFixed(1) : '‚Äî') + '</td>' +
                    '<td class="py-3 px-2 text-right font-bold ' + (m.perf >= 100 ? 'text-green-600' : m.perf ? 'text-red-600' : 'text-gray-400') + '">' + (m.perf ? m.perf + '%' : '‚Äî') + '</td>' +
                    '<td class="py-3 px-2 text-center">' + statusIcon + '</td>' +
                    '</tr>';
            });
            tbody.innerHTML = rowsHtml;
        }

        // Render on load
        renderLeadDashboard();

        // === WISSEN MODULE ===
        function showWissenTab(tabName) {
            document.querySelectorAll('.wissen-tab-content').forEach(function(c){ c.style.display='none'; });
            document.querySelectorAll('.wissen-tab-btn').forEach(function(b){
                b.className='wissen-tab-btn whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-semibold text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300';
            });
            var tabMap = {akademie:'Akademie',handbuecher:'Handbuecher',bestpractices:'Bestpractices',faq:'Faq'};
            var el = document.getElementById('wissenTab' + (tabMap[tabName]||''));
            if(el) el.style.display='block';
            var btn = document.querySelector('.wissen-tab-btn[data-tab="'+tabName+'"]');
            if(btn) btn.className='wissen-tab-btn whitespace-nowrap py-4 px-1 border-b-2 border-vit-orange font-semibold text-sm text-vit-orange';
        }

        // --- AKADEMIE DATA ---
        var akademieKurse = [
            {id:1, title:'Verkaufsgespraech E-Bike', desc:'Bedarfsermittlung, Einwandbehandlung, Abschluss-Techniken fuer E-Bike Beratung', cat:'verkauf', pflicht:true, dauer:'45 Min.', progress:100, zertifikat:true, format:'üé¨ Video'},
            {id:2, title:'Ergonomie-Beratung im Laden', desc:'Koerperanalyse, Sitzposition, Rahmengroesse bestimmen ‚Äì mit SQlab Methodik', cat:'verkauf', pflicht:true, dauer:'60 Min.', progress:100, zertifikat:true, format:'üé¨ Video'},
            {id:3, title:'Leasing richtig erklaeren', desc:'JobRad, Dienstrad, Bikeleasing ‚Äì Unterschiede, Rechenbeispiele, Einwaende', cat:'verkauf', pflicht:true, dauer:'30 Min.', progress:75, zertifikat:false, format:'üé¨ Video'},
            {id:4, title:'Bosch Diagnose-Tool', desc:'Smart System, Fehlercode-Auslesen, Software-Updates, Kundenkommunikation', cat:'allgemein', pflicht:true, dauer:'90 Min.', progress:100, zertifikat:true, format:'üõ† Workshop'},
            {id:5, title:'Shimano Steps Technik', desc:'Di2, EP8 Motor, Fehlerdiagnose, Firmware-Updates', cat:'allgemein', pflicht:false, dauer:'60 Min.', progress:50, zertifikat:false, format:'üõ† Workshop'},
            {id:6, title:'vit:bikes Kassensystem Schulung', desc:'Tagesabschluss, Retouren, Gutscheine, Lagerbuchungen im POS', cat:'allgemein', pflicht:true, dauer:'40 Min.', progress:100, zertifikat:false, format:'üìÑ Anleitung'},
            {id:7, title:'Social Media fuer Partner', desc:'Reels erstellen, Story-Formate, Hashtag-Strategie, Content-Kalender', cat:'marketing', pflicht:false, dauer:'35 Min.', progress:30, zertifikat:false, format:'üé¨ Video'},
            {id:8, title:'Google My Business optimieren', desc:'Fotos, Beitraege, Rezensionen beantworten, Insights nutzen', cat:'marketing', pflicht:false, dauer:'25 Min.', progress:100, zertifikat:false, format:'üìÑ Anleitung'},
            {id:9, title:'Event-Planung &amp; Durchfuehrung', desc:'Testivals, Grillvents, Schluesselaktionen ‚Äì von der Idee bis zur Nachbereitung', cat:'marketing', pflicht:false, dauer:'50 Min.', progress:0, zertifikat:false, format:'üé¨ Video'},
            {id:10, title:'Vororder richtig planen', desc:'Bedarfsanalyse, Saisonplanung, Verhandlung mit Lieferanten, Blockorder-Strategie', cat:'einkauf', pflicht:true, dauer:'55 Min.', progress:100, zertifikat:true, format:'üé¨ Video'},
            {id:11, title:'Rohertrag optimieren', desc:'Rabatt-Strategie, Dreingaben statt Nachlass, Marken-Mix fuer maximalen DB', cat:'einkauf', pflicht:false, dauer:'30 Min.', progress:60, zertifikat:false, format:'üìä Case Study'},
            {id:12, title:'Lagermanagement &amp; Umschlag', desc:'Bestandsoptimierung, Slow-Mover erkennen, Abverkaufsstrategien', cat:'einkauf', pflicht:false, dauer:'40 Min.', progress:0, zertifikat:false, format:'üé¨ Video'},
            {id:13, title:'BWA lesen &amp; verstehen', desc:'Umsatzerloese, Rohertrag, Kostenarten, Betriebsergebnis ‚Äì Praxis fuer Nicht-Kaufleute', cat:'controlling', pflicht:true, dauer:'45 Min.', progress:100, zertifikat:false, format:'üé¨ Video'},
            {id:14, title:'Plan/Ist-Analyse durchfuehren', desc:'Monatliche Abweichungen erkennen, Massnahmen ableiten, Benchmarks nutzen', cat:'controlling', pflicht:false, dauer:'35 Min.', progress:0, zertifikat:false, format:'üìÑ Anleitung'},
            {id:15, title:'Liquiditaetsplanung Basics', desc:'Cashflow verstehen, Zahlungsziele nutzen, saisonale Engpaesse vorbeugen', cat:'controlling', pflicht:false, dauer:'30 Min.', progress:0, zertifikat:false, format:'üé¨ Video'},
            {id:16, title:'Pipeline-Management im Portal', desc:'Leads erfassen, Kanban nutzen, Wiedervorlage, Conversion-Tracking', cat:'verkauf', pflicht:false, dauer:'20 Min.', progress:0, zertifikat:false, format:'üìÑ Anleitung'},
            {id:17, title:'Reklamation &amp; Garantie', desc:'Ablauf Garantiefall, Hersteller-Kontakt, Dokumentation, Kulanz-Regeln', cat:'allgemein', pflicht:false, dauer:'35 Min.', progress:0, zertifikat:false, format:'üìÑ Anleitung'},
            {id:18, title:'Personalfuehrung im Fachhandel', desc:'Teamgespraeche, Zielvereinbarungen, Motivation, Feedback-Kultur', cat:'allgemein', pflicht:false, dauer:'50 Min.', progress:0, zertifikat:false, format:'üé¨ Video'}
        ];
        var akdFilterCat = 'all';
        function filterAkademie(cat) {
            akdFilterCat = cat;
            document.querySelectorAll('.akd-filter-btn').forEach(function(b){ b.className='akd-filter-btn px-4 py-2 rounded-full text-xs font-semibold bg-gray-100 text-gray-600'; });
            var ab = document.querySelector('.akd-filter-btn[data-cat="'+cat+'"]');
            if(ab) ab.className='akd-filter-btn px-4 py-2 rounded-full text-xs font-semibold bg-vit-orange text-white';
            renderAkademie();
        }
        function renderAkademie() {
            var g = document.getElementById('akademieGrid'); if(!g) return;
            var filtered = akademieKurse.filter(function(k){ return akdFilterCat==='all' || k.cat===akdFilterCat; });
            var catColors = {allgemein:'bg-gray-100 text-gray-700',verkauf:'bg-blue-100 text-blue-700',marketing:'bg-orange-100 text-orange-700',einkauf:'bg-cyan-100 text-cyan-700',controlling:'bg-green-100 text-green-700'};
            var catLabels = {allgemein:'Allgemein',verkauf:'Verkauf',marketing:'Marketing',einkauf:'Einkauf',controlling:'Controlling'};
            var h = '';
            filtered.forEach(function(k){
                var pColor = k.progress>=100?'bg-green-500':k.progress>=50?'bg-vit-orange':'bg-gray-300';
                var statusText = k.progress>=100?'<span class="text-green-600 text-xs font-bold">‚úì Abgeschlossen</span>':k.progress>0?'<span class="text-vit-orange text-xs font-bold">In Bearbeitung</span>':'<span class="text-gray-400 text-xs">Nicht gestartet</span>';
                h += '<div class="vit-card p-5">' +
                    '<div class="flex items-start justify-between mb-2">' +
                        '<div class="flex items-center space-x-2">' +
                            '<span class="px-2 py-0.5 rounded text-xs font-semibold '+catColors[k.cat]+'">'+catLabels[k.cat]+'</span>' +
                            (k.pflicht?'<span class="px-2 py-0.5 rounded text-xs font-semibold bg-red-100 text-red-700">Pflicht</span>':'') +
                            '<span class="text-xs text-gray-400">'+k.format+'</span>' +
                        '</div>' +
                        (k.zertifikat?'<span class="text-xs bg-purple-100 text-purple-700 px-2 py-0.5 rounded font-semibold">üèÜ Zertifikat</span>':'') +
                    '</div>' +
                    '<h4 class="font-semibold text-gray-800 mb-1">'+k.title+'</h4>' +
                    '<p class="text-xs text-gray-500 mb-3">'+k.desc+'</p>' +
                    '<div class="flex items-center justify-between">' +
                        '<div class="flex-1 mr-4"><div class="w-full bg-gray-200 rounded-full h-2"><div class="'+pColor+' h-2 rounded-full" style="width:'+k.progress+'%"></div></div></div>' +
                        '<span class="text-xs text-gray-500 mr-3">'+k.progress+'%</span>' +
                        '<span class="text-xs text-gray-400">'+k.dauer+'</span>' +
                    '</div>' +
                    '<div class="mt-2">'+statusText+'</div>' +
                '</div>';
            });
            g.innerHTML = h || '<p class="text-gray-400 text-sm py-8 text-center">Keine Kurse in dieser Kategorie.</p>';
        }
        renderAkademie();

        // --- HANDBUECHER DATA ---
        var handbuecher = [
            {title:'Bosch Smart System ‚Äì Einrichtung &amp; Diagnose', cat:'allgemein', marke:'Bosch', typ:'PDF', seiten:42, aktualisiert:'01/2026'},
            {title:'Shimano Steps EP8 ‚Äì Fehlercodes &amp; Loesungen', cat:'allgemein', marke:'Shimano', typ:'PDF', seiten:28, aktualisiert:'11/2025'},
            {title:'Shimano Di2 ‚Äì Einstellungen &amp; Updates', cat:'allgemein', marke:'Shimano', typ:'PDF', seiten:35, aktualisiert:'09/2025'},
            {title:'Kalkhoff Garantieabwicklung ‚Äì Prozesshandbuch', cat:'einkauf', marke:'Kalkhoff', typ:'PDF', seiten:18, aktualisiert:'03/2025'},
            {title:'Haibike Modellkatalog 2026', cat:'einkauf', marke:'Haibike', typ:'Katalog', seiten:64, aktualisiert:'10/2025'},
            {title:'Orbea MyO Konfigurator ‚Äì Haendler-Guide', cat:'verkauf', marke:'Orbea', typ:'PDF', seiten:12, aktualisiert:'06/2025'},
            {title:'Simplon Bestellprozess B2B-Portal', cat:'einkauf', marke:'Simplon', typ:'PDF', seiten:8, aktualisiert:'08/2025'},
            {title:'vit:bikes Kassensystem ‚Äì Benutzerhandbuch', cat:'allgemein', marke:'vit:bikes', typ:'PDF', seiten:55, aktualisiert:'01/2026'},
            {title:'vit:bikes CI-Guide ‚Äì Logo, Farben, Vorlagen', cat:'marketing', marke:'vit:bikes', typ:'PDF', seiten:24, aktualisiert:'04/2025'},
            {title:'Meta Business Suite ‚Äì Anleitung fuer Partner', cat:'marketing', marke:'Meta', typ:'PDF', seiten:32, aktualisiert:'02/2026'},
            {title:'Google Ads ‚Äì Kampagnen-Setup Leitfaden', cat:'marketing', marke:'Google', typ:'PDF', seiten:20, aktualisiert:'12/2025'},
            {title:'JobRad Haendler-Handbuch', cat:'verkauf', marke:'JobRad', typ:'PDF', seiten:38, aktualisiert:'01/2026'},
            {title:'Bikeleasing ‚Äì Vertragsprozess A-Z', cat:'verkauf', marke:'Bikeleasing', typ:'PDF', seiten:15, aktualisiert:'11/2025'},
            {title:'DATEV-Schnittstelle ‚Äì BWA-Export Anleitung', cat:'controlling', marke:'DATEV', typ:'PDF', seiten:10, aktualisiert:'01/2026'},
            {title:'Liquiditaetsplanung ‚Äì Excel-Vorlage &amp; Erklaerung', cat:'controlling', marke:'vit:bikes', typ:'Excel', seiten:5, aktualisiert:'09/2025'},
            {title:'SQlab Ergonomie-Messung ‚Äì Leitfaden', cat:'verkauf', marke:'SQlab', typ:'PDF', seiten:22, aktualisiert:'07/2025'},
            {title:'Velo de Ville ‚Äì Konfigurator &amp; Bestellprozess', cat:'einkauf', marke:'Velo de Ville', typ:'PDF', seiten:14, aktualisiert:'10/2025'},
            {title:'etermin ‚Äì Terminbuchung Setup', cat:'allgemein', marke:'etermin', typ:'PDF', seiten:9, aktualisiert:'05/2025'}
        ];
        var hbFilterCat = 'all';
        function filterHbCat(cat) {
            hbFilterCat = cat;
            document.querySelectorAll('.hb-cat-btn').forEach(function(b){ b.className='hb-cat-btn px-4 py-2 rounded-full text-xs font-semibold bg-gray-100 text-gray-600'; });
            var ab = document.querySelector('.hb-cat-btn[data-cat="'+cat+'"]');
            if(ab) ab.className='hb-cat-btn px-4 py-2 rounded-full text-xs font-semibold bg-vit-orange text-white';
            renderHandbuecher();
        }
        function filterHandbuecher() { renderHandbuecher(); }
        function renderHandbuecher() {
            var g = document.getElementById('handbuchGrid'); if(!g) return;
            var q = (document.getElementById('hbSearch')||{}).value||'';
            q = q.toLowerCase();
            var catColors = {allgemein:'bg-gray-100 text-gray-700',verkauf:'bg-blue-100 text-blue-700',marketing:'bg-orange-100 text-orange-700',einkauf:'bg-cyan-100 text-cyan-700',controlling:'bg-green-100 text-green-700'};
            var catLabels = {allgemein:'Allgemein',verkauf:'Verkauf',marketing:'Marketing',einkauf:'Einkauf',controlling:'Controlling'};
            var typIcons = {PDF:'üìÑ',Katalog:'üìï',Excel:'üìä'};
            var filtered = handbuecher.filter(function(h){
                var catOk = hbFilterCat==='all' || h.cat===hbFilterCat;
                var searchOk = !q || h.title.toLowerCase().indexOf(q)>-1 || h.marke.toLowerCase().indexOf(q)>-1 || h.cat.indexOf(q)>-1;
                return catOk && searchOk;
            });
            var html = '';
            filtered.forEach(function(h){
                html += '<div class="vit-card p-4 flex items-center justify-between">' +
                    '<div class="flex items-center space-x-4">' +
                        '<span class="text-2xl">'+(typIcons[h.typ]||'üìÑ')+'</span>' +
                        '<div>' +
                            '<p class="font-semibold text-sm text-gray-800">'+h.title+'</p>' +
                            '<div class="flex items-center space-x-2 mt-1">' +
                                '<span class="px-2 py-0.5 rounded text-xs font-semibold '+catColors[h.cat]+'">'+catLabels[h.cat]+'</span>' +
                                '<span class="text-xs text-gray-400">'+h.marke+'</span>' +
                                '<span class="text-xs text-gray-400">¬∑</span>' +
                                '<span class="text-xs text-gray-400">'+h.seiten+' Seiten</span>' +
                                '<span class="text-xs text-gray-400">¬∑</span>' +
                                '<span class="text-xs text-gray-400">Aktualisiert: '+h.aktualisiert+'</span>' +
                            '</div>' +
                        '</div>' +
                    '</div>' +
                    '<button class="px-3 py-1.5 bg-vit-orange text-white rounded-lg text-xs font-semibold hover:bg-orange-600">Oeffnen</button>' +
                '</div>';
            });
            g.innerHTML = html || '<p class="text-gray-400 text-sm py-8 text-center">Keine Handbuecher gefunden.</p>';
        }
        renderHandbuecher();

        // --- BEST PRACTICES DATA ---
        var bestPractices = [
            {title:'So hat Hamburg seinen Rohertrag um 4 Pp gesteigert', cat:'einkauf', standort:'Hamburg', datum:'01/2026', desc:'Durch konsequentes Anbieten von Orbea und Simplon statt Kalkhoff-Einstiegsmodellen konnte Hamburg den durchschnittlichen DB1 von 31% auf 35% steigern.', likes:24, typ:'üìà Erfolgsgeschichte'},
            {title:'Werkstatt-Auslastung auf 92% optimiert', cat:'allgemein', standort:'Muenchen-Thal.', datum:'11/2025', desc:'Durch Einfuehrung fester Werkstatt-Slots via etermin und Vorab-Diagnose am Telefon konnte die Durchlaufzeit pro Rad um 25% gesenkt werden.', likes:31, typ:'‚öôÔ∏è Prozess'},
            {title:'Erfolgreiche Event-Formate: Testival + Grillevent', cat:'marketing', standort:'Grafrath', datum:'05/2025', desc:'Kombination aus Probefahrten und lockerer Atmosphaere mit Waffeln und Getraenken. 108 Store Visits, 40 Terminbuchungen. Benefit statt Rabatt in den Vordergrund stellen.', likes:18, typ:'üé™ Event'},
            {title:'Sqlab-Sattel statt Rabatt: 50% weniger Rohertragsverlust', cat:'verkauf', standort:'Zentrale', datum:'09/2025', desc:'100‚Ç¨ Sqlab Sattel als Dreingabe statt 100‚Ç¨ Rabatt: Kunde erhaelt gefuehlt gleichen Vorteil, Rohertragsverlust nur 50‚Ç¨ netto statt 100‚Ç¨.', likes:42, typ:'üí∞ Tipp'},
            {title:'Leasing-Anteil auf 38% gesteigert', cat:'verkauf', standort:'Wesel', datum:'12/2025', desc:'Durch aktive Ansprache und eine Leasing-Vergleichstabelle am Beratungsplatz konnten wir den Leasing-Anteil von 22% auf 38% steigern. Hoehere Durchschnittspreise als Effekt.', likes:27, typ:'üìà Erfolgsgeschichte'},
            {title:'Google My Business: Von 4.2 auf 4.8 Sterne', cat:'marketing', standort:'Reutlingen', datum:'10/2025', desc:'Systematisches Ansprechen zufriedener Kunden bei Raduebergabe. QR-Code auf Kassenbon. Jede Rezension innerhalb 24h beantworten ‚Äì auch negative.', likes:35, typ:'‚≠ê Tipp'},
            {title:'BWA monatlich im Team besprechen', cat:'controlling', standort:'Holzkirchen', datum:'02/2026', desc:'Jeden 10. des Monats 30-Min-Meeting mit allen Verkaeufern. Umsatz, Rohertrag, Nachlass-Quote transparent machen. Bewusstsein fuer Kosten schaerfen.', likes:19, typ:'üìä Prozess'},
            {title:'Vororder-Planung mit Verkaufsdaten', cat:'einkauf', standort:'Karlsdorf-Neuth.', datum:'08/2025', desc:'Statt nach Bauchgefuehl zu ordern: Top-10-Modelle des Vorjahres als Basis, +10% Puffer fuer Wachstumsmarken, -20% fuer ruecklaeufige Kategorien.', likes:22, typ:'üì¶ Prozess'},
            {title:'Personalgespraeche alle 6 Wochen', cat:'allgemein', standort:'Muenster', datum:'01/2026', desc:'Kurze 20-Min-Check-ins mit jedem Mitarbeiter. Keine grossen Ueberraschungen bei Jahresgespraechen. Motivation und Bindung deutlich gestiegen.', likes:15, typ:'üë• Fuehrung'},
            {title:'Plan/Ist-Abgleich als Fruehwarnsystem', cat:'controlling', standort:'Weilheim', datum:'11/2025', desc:'Wenn Umsatz in KW4 unter 80% des Plans liegt, sofort Gegenmassnahmen einleiten: Aktionen, Kundenkontakt, Social Media Push. Nicht bis Monatsende warten.', likes:28, typ:'üö® Tipp'}
        ];
        var bpFilterCat = 'all';
        function filterBP(cat) {
            bpFilterCat = cat;
            document.querySelectorAll('.bp-cat-btn').forEach(function(b){ b.className='bp-cat-btn px-4 py-2 rounded-full text-xs font-semibold bg-gray-100 text-gray-600'; });
            var ab = document.querySelector('.bp-cat-btn[data-cat="'+cat+'"]');
            if(ab) ab.className='bp-cat-btn px-4 py-2 rounded-full text-xs font-semibold bg-vit-orange text-white';
            renderBP();
        }
        function renderBP() {
            var g = document.getElementById('bpGrid'); if(!g) return;
            var catColors = {allgemein:'bg-gray-100 text-gray-700',verkauf:'bg-blue-100 text-blue-700',marketing:'bg-orange-100 text-orange-700',einkauf:'bg-cyan-100 text-cyan-700',controlling:'bg-green-100 text-green-700'};
            var catLabels = {allgemein:'Allgemein',verkauf:'Verkauf',marketing:'Marketing',einkauf:'Einkauf',controlling:'Controlling'};
            var filtered = bestPractices.filter(function(b){ return bpFilterCat==='all' || b.cat===bpFilterCat; });
            var html = '';
            filtered.forEach(function(b){
                html += '<div class="vit-card p-5">' +
                    '<div class="flex items-center justify-between mb-2">' +
                        '<div class="flex items-center space-x-2">' +
                            '<span class="px-2 py-0.5 rounded text-xs font-semibold '+catColors[b.cat]+'">'+catLabels[b.cat]+'</span>' +
                            '<span class="text-xs text-gray-400">'+b.typ+'</span>' +
                        '</div>' +
                        '<span class="text-xs text-gray-400">'+b.standort+' ¬∑ '+b.datum+'</span>' +
                    '</div>' +
                    '<h4 class="font-semibold text-gray-800 mb-2">'+b.title+'</h4>' +
                    '<p class="text-sm text-gray-600 mb-3">'+b.desc+'</p>' +
                    '<div class="flex items-center justify-between">' +
                        '<span class="text-xs text-gray-400">üëç '+b.likes+' Partner fanden das hilfreich</span>' +
                        '<button class="text-xs text-vit-orange font-semibold hover:text-orange-600">Hilfreich üëç</button>' +
                    '</div>' +
                '</div>';
            });
            g.innerHTML = html || '<p class="text-gray-400 text-sm py-8 text-center">Keine Best Practices in dieser Kategorie.</p>';
        }
        renderBP();

        // --- FAQ DATA ---
        var faqItems = [
            {q:'Wie funktioniert die Garantieabwicklung bei Kalkhoff?', a:'Defektes Teil fotografieren, im Kalkhoff B2B-Portal Garantieantrag stellen (unter Service > Garantie). Bearbeitungszeit ca. 5-7 Werktage. Bei Rahmenbruch immer zuerst vit:bikes Einkauf kontaktieren.', cat:'einkauf'},
            {q:'Welche Leasing-Anbieter sind zugelassen?', a:'JobRad, Deutsche Dienstrad, Bikeleasing, Businessbike und Lease-a-Bike. Alle Anbieter sind im Kassensystem hinterlegt. Fuer neue Anbieter bitte Support-Ticket erstellen.', cat:'verkauf'},
            {q:'Wie erstelle ich eine Retoure im Kassensystem?', a:'Verkauf > Retoure > Originalbeleg scannen oder Belegnummer eingeben. Grund auswaehlen. Bei Retouren ueber 500‚Ç¨ ist eine Freigabe durch den Inhaber erforderlich.', cat:'allgemein'},
            {q:'Wann bekomme ich meine monatliche BWA?', a:'Die BWA wird jeweils bis zum 15. des Folgemonats vom Steuerberater bereitgestellt und ist dann im Controlling-Modul unter BWAs abrufbar.', cat:'controlling'},
            {q:'Wie aendere ich mein Marketing-Budget?', a:'Das Marketing-Budget kann jederzeit nach Absprache mit dem vit:bikes Marketing-Team angepasst werden. Aenderungen sind jeweils zum Monatsanfang des Folgemonats wirksam. Kontakt: Michael Stenzel.', cat:'marketing'},
            {q:'Was tun bei Bosch-Fehlermeldung am Display?', a:'Fehlercode notieren, im Bosch Diagnose-Tool auslesen (siehe Handbuch). Bei Codes 5xx: Software-Update durchfuehren. Bei Hardware-Fehlern (Codes 6xx/7xx): Bosch Service-Ticket im B2B-Portal.', cat:'allgemein'},
            {q:'Wie funktioniert die Vororder?', a:'Die Vororder fuer das Folgejahr wird zwischen Juli und Oktober platziert. Konditionen werden vorab mit vit:bikes Einkauf abgestimmt. Bestellungen laufen ueber die jeweiligen B2B-Portale der Hersteller.', cat:'einkauf'},
            {q:'Wie kann ich Rabatte im Kassensystem dokumentieren?', a:'Bei jedem Verkauf mit Rabatt das Feld Nachlass-Grund ausfuellen. Woechentlich die Nachlass-Auswertung pruefen. Ziel: unter 5% durchschnittlicher Nachlass.', cat:'verkauf'},
            {q:'Welche Kosten traegt vit:bikes beim Marketing?', a:'vit:bikes steuert die zentrale Kampagnenplanung, Content-Erstellung und Kanal-Optimierung bei. Das Mediabudget (z.B. 1.500‚Ç¨/Monat) wird vom Partner getragen.', cat:'marketing'},
            {q:'Wie buche ich einen Werkstatt-Termin ueber etermin?', a:'Kunden koennen direkt ueber die Standortseite auf vitbikes.de buchen. Intern: etermin-Backend > Neuer Termin > Kategorie Werkstatt. Zeiten sind in 30-Min-Slots konfiguriert.', cat:'allgemein'},
            {q:'Was ist der Unterschied zwischen Plan und Forecast?', a:'Der Plan wird einmal jaehrlich im Voraus erstellt (Planung_2026). Der Forecast wird monatlich angepasst basierend auf der aktuellen Entwicklung. Beide sind im Controlling-Modul sichtbar.', cat:'controlling'},
            {q:'Wie melde ich einen IT-Fehler?', a:'Im Support-Bereich ein Ticket mit Kategorie "IT" erstellen. Screenshot beifuegen. Kritische Ausfaelle (Kasse, Internet): direkt IT-Hotline anrufen unter 089/123456-99.', cat:'allgemein'},
            {q:'Wie funktioniert der Skonto bei Kalkhoff?', a:'3% Skonto bei Zahlung innerhalb von 14 Tagen. Bei Vororder-Bikes gilt das Skonto ab Rechnungsdatum, nicht ab Lieferdatum. Achtung: Skonto verfaellt bei verspaeteter Zahlung komplett.', cat:'einkauf'},
            {q:'Kann ich eigene Social-Media-Posts machen?', a:'Ja, ausdruecklich erwuenscht! Bitte den vit:bikes CI-Guide beachten (Logo-Verwendung, Farben). Organische Posts werden vom Content-Team gerne auf den zentralen Kanaelen geteilt.', cat:'marketing'},
            {q:'Wie interpretiere ich die Rohertragsmarge?', a:'Rohertrag = VK netto minus EK netto. Rohertragsmarge = Rohertrag / VK netto √ó 100. Zielwert bei E-Bikes: 35-42%. Unter 30% sollte Ursachenanalyse erfolgen (zu viel Rabatt? falsche Modelle?).', cat:'controlling'}
        ];
        var faqFilterCat = 'all';
        function filterFaqCat(cat) {
            faqFilterCat = cat;
            document.querySelectorAll('.faq-cat-btn').forEach(function(b){ b.className='faq-cat-btn px-4 py-2 rounded-full text-xs font-semibold bg-gray-100 text-gray-600'; });
            var ab = document.querySelector('.faq-cat-btn[data-cat="'+cat+'"]');
            if(ab) ab.className='faq-cat-btn px-4 py-2 rounded-full text-xs font-semibold bg-vit-orange text-white';
            renderFAQ();
        }
        function filterFAQ() { renderFAQ(); }
        function renderFAQ() {
            var g = document.getElementById('faqGrid'); if(!g) return;
            var q = (document.getElementById('faqSearch')||{}).value||'';
            q = q.toLowerCase();
            var catColors = {allgemein:'bg-gray-100 text-gray-700',verkauf:'bg-blue-100 text-blue-700',marketing:'bg-orange-100 text-orange-700',einkauf:'bg-cyan-100 text-cyan-700',controlling:'bg-green-100 text-green-700'};
            var catLabels = {allgemein:'Allgemein',verkauf:'Verkauf',marketing:'Marketing',einkauf:'Einkauf',controlling:'Controlling'};
            var filtered = faqItems.filter(function(f){
                var catOk = faqFilterCat==='all' || f.cat===faqFilterCat;
                var searchOk = !q || f.q.toLowerCase().indexOf(q)>-1 || f.a.toLowerCase().indexOf(q)>-1;
                return catOk && searchOk;
            });
            var html = '';
            filtered.forEach(function(f, idx){
                var faqId = 'faq_'+faqFilterCat+'_'+idx;
                html += '<div class="vit-card overflow-hidden">' +
                    '<button onclick="toggleFaq(\''+faqId+'\')" class="w-full p-4 flex items-center justify-between text-left hover:bg-gray-50">' +
                        '<div class="flex items-center space-x-3">' +
                            '<span class="px-2 py-0.5 rounded text-xs font-semibold '+catColors[f.cat]+'">'+catLabels[f.cat]+'</span>' +
                            '<span class="font-semibold text-sm text-gray-800">'+f.q+'</span>' +
                        '</div>' +
                        '<svg class="w-5 h-5 text-gray-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>' +
                    '</button>' +
                    '<div id="'+faqId+'" style="display:none" class="px-4 pb-4 border-t border-gray-100">' +
                        '<p class="text-sm text-gray-600 pt-3">'+f.a+'</p>' +
                    '</div>' +
                '</div>';
            });
            g.innerHTML = html || '<p class="text-gray-400 text-sm py-8 text-center">Keine FAQ-Eintraege gefunden.</p>';
        }
        function toggleFaq(id) {
            var el = document.getElementById(id);
            if(el) el.style.display = el.style.display==='none'?'block':'none';
        }
        renderFAQ();

        // === Dashboards Tabs ===
        var dashTabInited = false;
        function initDashboardTabs() {
            if(dashTabInited) return;
            dashTabInited = true;
            // Move contents from old separate views into tab containers
            var finSrc = document.getElementById('financesView');
            var leadSrc = document.getElementById('leadReportingView');
            var teamSrc = document.getElementById('teamView');
            var finDest = document.getElementById('dashTabFinanzen');
            var leadDest = document.getElementById('dashTabLeadreporting');
            var teamDest = document.getElementById('dashTabTeam');
            if(finSrc && finDest) { while(finSrc.firstChild) finDest.appendChild(finSrc.firstChild); }
            if(leadSrc && leadDest) { while(leadSrc.firstChild) leadDest.appendChild(leadSrc.firstChild); }
            if(teamSrc && teamDest) { while(teamSrc.firstChild) teamDest.appendChild(teamSrc.firstChild); }
        }
        function showDashboardTab(tabName) {
            initDashboardTabs();
            document.querySelectorAll('.dash-tab-content').forEach(function(c){ c.style.display='none'; });
            document.querySelectorAll('.dash-tab-btn').forEach(function(b){
                b.className='dash-tab-btn whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-semibold text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300';
            });
            var tabMap = {finanzen:'Finanzen',leadreporting:'Leadreporting',team:'Team'};
            var el = document.getElementById('dashTab' + (tabMap[tabName]||''));
            if(el) el.style.display='block';
            var btn = document.querySelector('.dash-tab-btn[data-tab="'+tabName+'"]');
            if(btn) btn.className='dash-tab-btn whitespace-nowrap py-4 px-1 border-b-2 border-vit-orange font-semibold text-sm text-vit-orange';
        }

        // === WISSEN TABS (kontextuell pro Modul) ===
        var wissenData = {
            allgemein: {
                akademie: [
                    {title:'Onboarding: vit:bikes Partner werden',dauer:'45 min',typ:'pflicht',progress:100,desc:'Einfuehrung in Systeme, Prozesse und Ansprechpartner'},
                    {title:'Kassensystem & Warenwirtschaft',dauer:'30 min',typ:'pflicht',progress:75,desc:'Tagesabschluss, Retouren, Gutscheine, Inventur'},
                    {title:'Datenschutz & DSGVO im Handel',dauer:'20 min',typ:'pflicht',progress:0,desc:'Kundendaten, Einwilligungen, Loeschfristen'},
                    {title:'Arbeitsschutz & Ladensicherheit',dauer:'15 min',typ:'wahl',progress:0,desc:'Brandschutz, Erste Hilfe, Diebstahlpraevention'}
                ],
                handbuecher: [
                    {title:'vit:bikes Partner-Handbuch 2026',marke:'vit:bikes',typ:'PDF',seiten:64},
                    {title:'CI-Guide: Logo, Farben, Schriften',marke:'vit:bikes',typ:'PDF',seiten:12},
                    {title:'Leasing-Leitfaden (JobRad, Dienstrad, Bikeleasing)',marke:'Uebergreifend',typ:'PDF',seiten:28},
                    {title:'Garantie- & Reklamationshandbuch',marke:'vit:bikes',typ:'PDF',seiten:35}
                ],
                bestpractices: [
                    {title:'So hat Hamburg seinen Rohertrag um 4 Pp gesteigert',standort:'Hamburg',datum:'Jan 2026',tags:['Rohertrag','Rabatte']},
                    {title:'Werkstatt-Auslastung optimieren: 5 Hebel',standort:'Zentrale',datum:'Dez 2025',tags:['Werkstatt','Effizienz']},
                    {title:'Erfolgreiche Event-Formate fuer Standorte',standort:'Weilheim',datum:'Nov 2025',tags:['Events','Marketing']}
                ],
                faq: [
                    {frage:'Wie melde ich einen Garantiefall?',kat:'Prozesse'},
                    {frage:'Welche Leasing-Anbieter sind freigeschaltet?',kat:'Leasing'},
                    {frage:'Wie funktioniert die Upway-Abwicklung?',kat:'Einkauf'},
                    {frage:'Wer ist mein Ansprechpartner bei IT-Problemen?',kat:'IT/Support'},
                    {frage:'Wie laeuft die Monatsabrechnung?',kat:'Buchhaltung'}
                ]
            },
            marketing: {
                akademie: [
                    {title:'Social Media fuer Fahrradhaendler',dauer:'60 min',typ:'pflicht',progress:50,desc:'Instagram, Facebook, TikTok: Content-Strategie fuer lokale Reichweite'},
                    {title:'Google My Business optimieren',dauer:'25 min',typ:'pflicht',progress:100,desc:'Profil pflegen, Rezensionen beantworten, Beitraege posten'},
                    {title:'Individuelle Ads erstellen (Meta)',dauer:'40 min',typ:'wahl',progress:30,desc:'Reels drehen, Texte schreiben, Zielgruppen definieren'},
                    {title:'Event-Marketing: Testival planen',dauer:'35 min',typ:'wahl',progress:0,desc:'Checkliste, Zeitplan, Bewerbung, Nachbereitung'}
                ],
                handbuecher: [
                    {title:'vit:bikes Content-Styleguide',marke:'vit:bikes',typ:'PDF',seiten:18},
                    {title:'Meta Ads Manager ‚Äì Schritt fuer Schritt',marke:'Meta',typ:'PDF',seiten:24},
                    {title:'Google Ads fuer lokale Haendler',marke:'Google',typ:'PDF',seiten:20},
                    {title:'Etermin: Terminbuchung einrichten',marke:'Etermin',typ:'PDF',seiten:8}
                ],
                bestpractices: [
                    {title:'Individuelle Ads: 3x bessere CTR als generische',standort:'Zentrale',datum:'Feb 2026',tags:['Ads','Performance']},
                    {title:'Wie Weilheim 91% Storevisit-Ziel erreicht',standort:'Weilheim',datum:'Jan 2026',tags:['Storevisits','Meta']},
                    {title:'Influencer-Kooperation: So funktioniert es',standort:'Muenchen Ost',datum:'Dez 2025',tags:['Influencer','Content']}
                ],
                faq: [
                    {frage:'Wie kann ich mein Marketing-Budget aendern?',kat:'Budget'},
                    {frage:'Wann werden neue Ads geschaltet?',kat:'Ads'},
                    {frage:'Kann ich eigene Stories auf dem vit:bikes Kanal posten?',kat:'Content'},
                    {frage:'Wie messe ich den Erfolg meiner Kampagnen?',kat:'Analytics'},
                    {frage:'Was kostet ein lokales Event?',kat:'Events'}
                ]
            },
            einkauf: {
                akademie: [
                    {title:'Einkaufsstrategie verstehen & umsetzen',dauer:'45 min',typ:'pflicht',progress:60,desc:'Vororder, Blockorder, Konditionen, Rabattsteuerung'},
                    {title:'Rohertrag optimieren: Praxis-Workshop',dauer:'50 min',typ:'pflicht',progress:25,desc:'DB1 berechnen, Dreingaben vs. Rabatte, Nachlass-Tracking'},
                    {title:'B2B-Portale der Lieferanten nutzen',dauer:'30 min',typ:'wahl',progress:0,desc:'Kalkhoff, Shimano, Orbea: Bestellprozesse und Retouren'},
                    {title:'Lagerbestand & Umschlag steuern',dauer:'25 min',typ:'wahl',progress:0,desc:'Ladenhuter erkennen, Saisonplanung, Abverkaufsstrategien'}
                ],
                handbuecher: [
                    {title:'Kalkhoff/Derby Cycle ‚Äì Haendlerportal Guide',marke:'Kalkhoff',typ:'PDF',seiten:16},
                    {title:'Shimano Steps ‚Äì Fehlercodes & Diagnose',marke:'Shimano',typ:'PDF',seiten:42},
                    {title:'Bosch Smart System ‚Äì Einrichtung & Updates',marke:'Bosch',typ:'PDF',seiten:38},
                    {title:'Haibike Modellueberblick 2026',marke:'Haibike',typ:'PDF',seiten:22},
                    {title:'Orbea MyO Konfigurator ‚Äì Haendler-Anleitung',marke:'Orbea',typ:'PDF',seiten:14}
                ],
                bestpractices: [
                    {title:'Sqlab-Sattel statt Rabatt: 50% weniger DB-Verlust',standort:'Zentrale',datum:'Sep 2025',tags:['Rohertrag','Dreingaben']},
                    {title:'Kalkhoff 7er-Modelle ueber Upway: So gehts',standort:'Grafrath',datum:'Okt 2025',tags:['Upway','Abverkauf']},
                    {title:'Haibike Blockorder: Verhandlungstipps',standort:'Zentrale',datum:'Aug 2025',tags:['Haibike','Konditionen']}
                ],
                faq: [
                    {frage:'Wie platziere ich eine Nachbestellung?',kat:'Bestellung'},
                    {frage:'Was tun bei Lieferverzoegerung?',kat:'Logistik'},
                    {frage:'Wie funktioniert die Garantieabwicklung pro Marke?',kat:'Garantie'},
                    {frage:'Kann ich Konditionen individuell verhandeln?',kat:'Konditionen'},
                    {frage:'Wie melde ich defekte Ware / Transportschaden?',kat:'Reklamation'}
                ]
            },
            controlling: {
                akademie: [
                    {title:'BWA lesen & verstehen',dauer:'40 min',typ:'pflicht',progress:80,desc:'Umsatzerloese, Wareneinsatz, Rohertrag, Betriebsergebnis'},
                    {title:'Plan/Ist-Vergleich nutzen',dauer:'30 min',typ:'pflicht',progress:40,desc:'Abweichungen erkennen, Massnahmen ableiten, Prognosen'},
                    {title:'Liquiditaetsplanung Basics',dauer:'25 min',typ:'wahl',progress:0,desc:'Cashflow verstehen, Engpaesse vermeiden, Vorausplanung'},
                    {title:'Benchmarking im vit:bikes Netzwerk',dauer:'20 min',typ:'wahl',progress:10,desc:'Eigene Kennzahlen vs. Netzwerk, Potentiale erkennen'}
                ],
                handbuecher: [
                    {title:'BWA-Positionen: Was steckt hinter jeder Zeile',marke:'vit:bikes',typ:'PDF',seiten:20},
                    {title:'Steuerliche Grundlagen fuer Fahrradhaendler',marke:'Uebergreifend',typ:'PDF',seiten:32},
                    {title:'DATEV-Schnittstelle: Belege digital einreichen',marke:'DATEV',typ:'PDF',seiten:12},
                    {title:'Investitionsplanung & AfA im Fahrradhandel',marke:'vit:bikes',typ:'PDF',seiten:16}
                ],
                bestpractices: [
                    {title:'Werbekosten im Griff: 5% vom Umsatz als Faustregel',standort:'Zentrale',datum:'Jan 2026',tags:['Marketing-Budget','Planung']},
                    {title:'Personalkosten-Quote senken ohne Kuerzungen',standort:'Hamburg',datum:'Nov 2025',tags:['Personal','Effizienz']},
                    {title:'Saisonale Liquiditaetsplanung: Vorsaison richtig finanzieren',standort:'Zentrale',datum:'Okt 2025',tags:['Liquiditaet','Cashflow']}
                ],
                faq: [
                    {frage:'Wann erhalte ich meine monatliche BWA?',kat:'BWA'},
                    {frage:'Wie ist die Ziel-Rohertragsmarge?',kat:'Kennzahlen'},
                    {frage:'Wer ist fuer die Buchhaltung zustaendig?',kat:'Prozesse'},
                    {frage:'Wie beantrage ich eine Investition?',kat:'Investition'},
                    {frage:'Was bedeuten die Benchmark-Ampelfarben?',kat:'Benchmark'}
                ]
            },
            verkauf: {
                akademie: [
                    {title:'Verkaufsgespraech E-Bike: Beratungsleitfaden',dauer:'60 min',typ:'pflicht',progress:65,desc:'Bedarfsanalyse, Probefahrt, Abschluss, Finanzierung'},
                    {title:'Ergonomie-Beratung: Sitzposition & Rahmengroesse',dauer:'45 min',typ:'pflicht',progress:90,desc:'Vermessung, Sattel, Lenker, Vorbau ‚Äì der Unterschied'},
                    {title:'Leasing richtig erklaeren (JobRad & Co.)',dauer:'30 min',typ:'pflicht',progress:40,desc:'Steuervorteile, Ablauf, Arbeitgeber-Ansprache, Rechner'},
                    {title:'Einwaende souveraen behandeln',dauer:'35 min',typ:'wahl',progress:15,desc:'Preis, Online-Vergleich, Lieferzeit ‚Äì die Top-5 Einwaende'},
                    {title:'Zusatzverkauf: Zubehoer & Service-Pakete',dauer:'20 min',typ:'wahl',progress:0,desc:'Helme, Schloesser, Sqlab, Versicherung, Inspektion'}
                ],
                handbuecher: [
                    {title:'Beratungsbogen / Setting-Tool Anleitung',marke:'vit:bikes',typ:'PDF',seiten:8},
                    {title:'Finanzierungsrechner: So nutzt du den Kalkulator',marke:'vit:bikes',typ:'PDF',seiten:6},
                    {title:'Probefahrt-Protokoll & Haftung',marke:'vit:bikes',typ:'PDF',seiten:4},
                    {title:'E-Bike Kategorie-Guide: Trekking vs. MTB vs. City',marke:'Uebergreifend',typ:'PDF',seiten:18}
                ],
                bestpractices: [
                    {title:'Pipeline-Management: Kein Lead geht verloren',standort:'Karlsdorf-Neuth.',datum:'Feb 2026',tags:['Pipeline','Follow-up']},
                    {title:'Orbea & Simplon aktiv verkaufen: Verkaeufermotivation',standort:'Grafrath',datum:'Sep 2025',tags:['Beratung','Rohertrag']},
                    {title:'Testival als Verkaufs-Booster: 23 Abschluesse an einem Tag',standort:'Weilheim',datum:'Mai 2025',tags:['Events','Abschluss']}
                ],
                faq: [
                    {frage:'Wie viel Rabatt darf ich maximal geben?',kat:'Konditionen'},
                    {frage:'Wie trage ich einen Verkauf in die Pipeline ein?',kat:'Pipeline'},
                    {frage:'Was mache ich bei einer Stornierung?',kat:'Prozesse'},
                    {frage:'Wie funktioniert die Uebergabe an den Kunden?',kat:'Uebergabe'},
                    {frage:'Wann wird die Wochenauswertung aktualisiert?',kat:'Reporting'}
                ]
            }
        };

        function renderWissenTab(bereich, containerId) {
            var d = wissenData[bereich];
            if(!d) return;
            var el = document.getElementById(containerId);
            if(!el || el.dataset.rendered) return;
            el.dataset.rendered = 'true';
            var h = '';

            // Sub-Tab Navigation
            h += '<div class="flex space-x-1 mb-6 bg-gray-100 rounded-lg p-1">';
            h += '<button onclick="switchWissenSub(\''+containerId+'\',\'akademie\')" class="wissen-sub-'+containerId+' flex-1 px-3 py-2 text-xs font-semibold rounded-md bg-white shadow text-vit-orange" data-sub="akademie">üéì Akademie</button>';
            h += '<button onclick="switchWissenSub(\''+containerId+'\',\'handbuecher\')" class="wissen-sub-'+containerId+' flex-1 px-3 py-2 text-xs font-semibold rounded-md text-gray-500 hover:bg-white" data-sub="handbuecher">üìñ Handbuecher</button>';
            h += '<button onclick="switchWissenSub(\''+containerId+'\',\'bestpractices\')" class="wissen-sub-'+containerId+' flex-1 px-3 py-2 text-xs font-semibold rounded-md text-gray-500 hover:bg-white" data-sub="bestpractices">üí° Best Practices</button>';
            h += '<button onclick="switchWissenSub(\''+containerId+'\',\'faq\')" class="wissen-sub-'+containerId+' flex-1 px-3 py-2 text-xs font-semibold rounded-md text-gray-500 hover:bg-white" data-sub="faq">‚ùì FAQ</button>';
            h += '</div>';

            // Akademie
            h += '<div id="'+containerId+'_akademie" class="wissen-section-'+containerId+'">';
            h += '<div class="flex items-center justify-between mb-4"><h3 class="font-semibold text-gray-800">üéì Schulungen & Kurse</h3><span class="text-xs text-gray-400">'+d.akademie.filter(function(k){return k.progress===100;}).length+' / '+d.akademie.length+' abgeschlossen</span></div>';
            d.akademie.forEach(function(k) {
                var pColor = k.progress===100?'bg-green-500':k.progress>0?'bg-vit-orange':'bg-gray-300';
                var badge = k.typ==='pflicht'?'<span class="text-[10px] px-2 py-0.5 bg-red-100 text-red-600 rounded-full font-bold">Pflicht</span>':'<span class="text-[10px] px-2 py-0.5 bg-gray-100 text-gray-500 rounded-full font-bold">Wahl</span>';
                h += '<div class="vit-card p-4 mb-3 hover:shadow-md transition">';
                h += '<div class="flex items-center justify-between mb-2"><div class="flex items-center space-x-2"><span class="font-semibold text-sm">'+k.title+'</span>'+badge+'</div><span class="text-xs text-gray-400">'+k.dauer+'</span></div>';
                h += '<p class="text-xs text-gray-500 mb-2">'+k.desc+'</p>';
                h += '<div class="flex items-center space-x-3"><div class="flex-1 bg-gray-200 rounded-full h-2"><div class="'+pColor+' h-2 rounded-full" style="width:'+k.progress+'%"></div></div><span class="text-xs font-bold '+(k.progress===100?'text-green-600':'text-gray-500')+'">'+k.progress+'%</span></div>';
                h += '</div>';
            });
            h += '</div>';

            // Handbuecher
            h += '<div id="'+containerId+'_handbuecher" class="wissen-section-'+containerId+'" style="display:none;">';
            h += '<h3 class="font-semibold text-gray-800 mb-4">üìñ Technische Dokus & Marken-Guides</h3>';
            h += '<div class="space-y-2">';
            d.handbuecher.forEach(function(doc) {
                h += '<div class="vit-card p-4 flex items-center justify-between hover:shadow-md transition cursor-pointer">';
                h += '<div class="flex items-center space-x-3"><div class="w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center text-red-600 text-xs font-bold">PDF</div>';
                h += '<div><p class="text-sm font-semibold">'+doc.title+'</p><p class="text-xs text-gray-400">'+doc.marke+' ¬∑ '+doc.seiten+' Seiten</p></div></div>';
                h += '<button class="px-3 py-1.5 text-xs font-semibold border border-gray-300 rounded-lg hover:bg-gray-50">Oeffnen</button>';
                h += '</div>';
            });
            h += '</div></div>';

            // Best Practices
            h += '<div id="'+containerId+'_bestpractices" class="wissen-section-'+containerId+'" style="display:none;">';
            h += '<h3 class="font-semibold text-gray-800 mb-4">üí° Best Practices aus dem Netzwerk</h3>';
            d.bestpractices.forEach(function(bp) {
                h += '<div class="vit-card p-5 mb-3 hover:shadow-md transition">';
                h += '<div class="flex items-center justify-between mb-2"><span class="font-semibold text-sm">'+bp.title+'</span><span class="text-xs text-gray-400">'+bp.datum+'</span></div>';
                h += '<div class="flex items-center space-x-2"><span class="text-xs text-gray-500">üìç '+bp.standort+'</span>';
                bp.tags.forEach(function(t){ h += '<span class="text-[10px] px-2 py-0.5 bg-blue-50 text-blue-600 rounded-full">'+t+'</span>'; });
                h += '</div></div>';
            });
            h += '</div>';

            // FAQ
            h += '<div id="'+containerId+'_faq" class="wissen-section-'+containerId+'" style="display:none;">';
            h += '<h3 class="font-semibold text-gray-800 mb-4">‚ùì Haeufige Fragen</h3>';
            h += '<div class="space-y-2">';
            d.faq.forEach(function(f,i) {
                h += '<div class="vit-card p-4 hover:shadow-md transition cursor-pointer" onclick="this.querySelector(\'.faq-answer\').style.display=this.querySelector(\'.faq-answer\').style.display===\'none\'?\'block\':\'none\'">';
                h += '<div class="flex items-center justify-between"><span class="text-sm font-semibold">'+f.frage+'</span><span class="text-[10px] px-2 py-0.5 bg-gray-100 text-gray-500 rounded-full">'+f.kat+'</span></div>';
                h += '<div class="faq-answer text-xs text-gray-500 mt-2" style="display:none;">Antwort wird geladen... (Im echten Produkt: vollstaendige Antwort aus der Wissensdatenbank)</div>';
                h += '</div>';
            });
            h += '</div></div>';

            el.innerHTML = h;
        }

        function switchWissenSub(containerId, sub) {
            document.querySelectorAll('.wissen-section-'+containerId).forEach(function(s){ s.style.display='none'; });
            var target = document.getElementById(containerId+'_'+sub);
            if(target) target.style.display='block';
            document.querySelectorAll('.wissen-sub-'+containerId).forEach(function(b){
                b.className='wissen-sub-'+containerId+' flex-1 px-3 py-2 text-xs font-semibold rounded-md text-gray-500 hover:bg-white';
            });
            var btn = document.querySelector('.wissen-sub-'+containerId+'[data-sub="'+sub+'"]');
            if(btn) btn.className='wissen-sub-'+containerId+' flex-1 px-3 py-2 text-xs font-semibold rounded-md bg-white shadow text-vit-orange';
        }

        // === GLOBAL WISSEN VIEW ===
        var currentWissenBereich = 'all';
        var currentWissenTyp = 'akademie';

        function renderWissenGlobal() {
            var bereiche = ['allgemein','verkauf','einkauf','marketing','controlling'];
            var bereichLabels = {allgemein:'Allgemein',verkauf:'Verkauf',einkauf:'Einkauf',marketing:'Marketing',controlling:'Controlling'};
            var bereichIcons = {allgemein:'üè¢',verkauf:'üí∞',einkauf:'üõí',marketing:'üì£',controlling:'üìä'};

            // Aggregate all items
            var allAkademie=[],allHandbuecher=[],allBp=[],allFaq=[];
            bereiche.forEach(function(b){
                var d=wissenData[b]; if(!d)return;
                (d.akademie||[]).forEach(function(i){i._bereich=b;allAkademie.push(i);});
                (d.handbuecher||[]).forEach(function(i){i._bereich=b;allHandbuecher.push(i);});
                (d.bestPractices||[]).forEach(function(i){i._bereich=b;allBp.push(i);});
                (d.faq||[]).forEach(function(i){i._bereich=b;allFaq.push(i);});
            });

            // KPIs
            var totalKurse=allAkademie.length;
            var doneKurse=allAkademie.filter(function(k){return k.progress===100;}).length;
            var pflichtOffen=allAkademie.filter(function(k){return k.typ==='pflicht'&&k.progress<100;}).length;
            var kpi=document.getElementById('wissenKpis');
            if(kpi) kpi.innerHTML=
                '<div class="vit-card p-4 text-center"><p class="text-2xl font-bold text-gray-800">'+totalKurse+'</p><p class="text-xs text-gray-500">Schulungen</p></div>'
                +'<div class="vit-card p-4 text-center"><p class="text-2xl font-bold text-green-600">'+doneKurse+'</p><p class="text-xs text-gray-500">Abgeschlossen</p></div>'
                +'<div class="vit-card p-4 text-center"><p class="text-2xl font-bold '+(pflichtOffen>0?'text-red-500':'text-green-600')+'">'+pflichtOffen+'</p><p class="text-xs text-gray-500">Pflicht offen</p></div>'
                +'<div class="vit-card p-4 text-center"><p class="text-2xl font-bold text-blue-600">'+allHandbuecher.length+'</p><p class="text-xs text-gray-500">Handbuecher</p></div>'
                +'<div class="vit-card p-4 text-center"><p class="text-2xl font-bold text-vit-orange">'+allFaq.length+'</p><p class="text-xs text-gray-500">FAQs</p></div>';

            // Determine which list to show
            var items=[];
            if(currentWissenTyp==='akademie') items=allAkademie;
            else if(currentWissenTyp==='handbuecher') items=allHandbuecher;
            else if(currentWissenTyp==='bestpractices') items=allBp;
            else if(currentWissenTyp==='faq') items=allFaq;

            // Filter by bereich
            if(currentWissenBereich!=='all') items=items.filter(function(i){return i._bereich===currentWissenBereich;});

            // Search
            var search=(document.getElementById('wissenSearch')||{}).value||'';
            if(search) {
                var s=search.toLowerCase();
                items=items.filter(function(i){return (i.title||i.frage||'').toLowerCase().indexOf(s)>-1 || (i.desc||i.antwort||'').toLowerCase().indexOf(s)>-1;});
            }

            var el=document.getElementById('wissenGlobalContent');
            if(!el) return;
            var h='';

            if(currentWissenTyp==='akademie'){
                items.forEach(function(k){
                    var pColor=k.progress===100?'bg-green-500':k.progress>0?'bg-vit-orange':'bg-gray-300';
                    var badge=k.typ==='pflicht'?'<span class="text-[10px] px-2 py-0.5 bg-red-100 text-red-600 rounded-full font-bold">Pflicht</span>':'<span class="text-[10px] px-2 py-0.5 bg-gray-100 text-gray-500 rounded-full font-bold">Wahl</span>';
                    h+='<div class="vit-card p-4 hover:shadow-md transition"><div class="flex items-center justify-between mb-2"><div class="flex items-center space-x-2"><span class="text-xs px-2 py-0.5 bg-gray-100 rounded-full">'+bereichIcons[k._bereich]+' '+bereichLabels[k._bereich]+'</span><span class="font-semibold text-sm">'+k.title+'</span>'+badge+'</div><span class="text-xs text-gray-400">'+k.dauer+'</span></div><p class="text-xs text-gray-500 mb-2">'+k.desc+'</p><div class="flex items-center space-x-3"><div class="flex-1 bg-gray-200 rounded-full h-2"><div class="'+pColor+' h-2 rounded-full" style="width:'+k.progress+'%"></div></div><span class="text-xs font-bold '+(k.progress===100?'text-green-600':'text-gray-500')+'">'+k.progress+'%</span></div></div>';
                });
            } else if(currentWissenTyp==='handbuecher'){
                items.forEach(function(b){
                    h+='<div class="vit-card p-4 hover:shadow-md transition flex items-center space-x-4"><div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center text-blue-600 font-bold text-xs">PDF</div><div class="flex-1"><div class="flex items-center space-x-2"><span class="text-xs px-2 py-0.5 bg-gray-100 rounded-full">'+bereichIcons[b._bereich]+' '+bereichLabels[b._bereich]+'</span><span class="font-semibold text-sm">'+b.title+'</span></div><p class="text-xs text-gray-400 mt-1">'+(b.pages||'‚Äî')+' ¬∑ '+(b.updated||'')+'</p></div><button class="text-vit-orange hover:text-orange-600"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg></button></div>';
                });
            } else if(currentWissenTyp==='bestpractices'){
                items.forEach(function(bp){
                    h+='<div class="vit-card p-4 hover:shadow-md transition"><div class="flex items-center space-x-2 mb-2"><span class="text-xs px-2 py-0.5 bg-gray-100 rounded-full">'+bereichIcons[bp._bereich]+' '+bereichLabels[bp._bereich]+'</span><span class="font-semibold text-sm">'+bp.title+'</span></div><p class="text-xs text-gray-500">'+(bp.desc||bp.content||'')+'</p></div>';
                });
            } else if(currentWissenTyp==='faq'){
                items.forEach(function(fq,i){
                    h+='<div class="vit-card p-4 hover:shadow-md transition cursor-pointer" onclick="var fa=this.querySelector(\'.faq-a\');fa.style.display=fa.style.display===\'none\'?\'block\':\'none\'"><div class="flex items-center space-x-2 mb-1"><span class="text-xs px-2 py-0.5 bg-gray-100 rounded-full">'+bereichIcons[fq._bereich]+'</span><span class="font-semibold text-sm">'+fq.frage+'</span></div><div class="faq-a text-xs text-gray-500 mt-2" style="display:none;">'+fq.antwort+'</div></div>';
                });
            }

            if(!h) h='<div class="text-center text-gray-400 py-8"><p class="text-lg mb-2">üîç</p><p class="text-sm">Keine Eintraege gefunden.</p></div>';
            el.innerHTML=h;
        }

        function filterWissenBereich(b){
            currentWissenBereich=b;
            document.querySelectorAll('.wissen-bereich-filter').forEach(function(btn){btn.className='wissen-bereich-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-gray-100 text-gray-600';});
            var btn=document.querySelector('.wissen-bereich-filter[data-wbf="'+b+'"]');
            if(btn) btn.className='wissen-bereich-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-vit-orange text-white';
            renderWissenGlobal();
        }
        function switchWissenTyp(t){
            currentWissenTyp=t;
            document.querySelectorAll('.wissen-typ-btn').forEach(function(btn){btn.className='wissen-typ-btn whitespace-nowrap py-3 px-1 border-b-2 border-transparent font-semibold text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300';});
            var btn=document.querySelector('.wissen-typ-btn[data-wtt="'+t+'"]');
            if(btn) btn.className='wissen-typ-btn whitespace-nowrap py-3 px-1 border-b-2 border-vit-orange font-semibold text-sm text-vit-orange';
            renderWissenGlobal();
        }
        function filterWissenGlobal(){ renderWissenGlobal(); }

        // Hook wissen rendering into tab switches
        var origShowAllgemeinTab = showAllgemeinTab;
        showAllgemeinTab = function(t) { origShowAllgemeinTab(t); if(t==='wissen') renderWissenTab('allgemein','allgTabWissen'); };

        var origShowMarketingTab = showMarketingTab;
        showMarketingTab = function(t) { origShowMarketingTab(t); if(t==='mktWissen') renderWissenTab('marketing','marketingTabMktWissen'); };

        var origShowEinkaufTab = showEinkaufTab;
        showEinkaufTab = function(t) { origShowEinkaufTab(t); if(t==='ekWissen') renderWissenTab('einkauf','ekTabEkWissen'); };

        var origShowControllingTab = showControllingTab;
        showControllingTab = function(t) { origShowControllingTab(t); if(t==='ctrlWissen') renderWissenTab('controlling','ctrlTabCtrlWissen'); };

        var origShowVerkaufTab = showVerkaufTab;
        showVerkaufTab = function(t) { origShowVerkaufTab(t); if(t==='vkWissen') renderWissenTab('verkauf','vkTabVkWissen'); };

        // === SUPPORT MODULE ===
        async function renderTickets(filter) {
            var container = document.getElementById('ticketList');
            if(!container) return;
            try {
                var query = sb.from('support_tickets').select('*, users(name)').order('created_at', {ascending:false});
                if(filter==='offen') query = query.in('status', ['offen','in_bearbeitung']);
                if(filter==='geloest') query = query.eq('status', 'geloest');
                var resp = await query;
                if(resp.error) throw resp.error;
                var tickets = resp.data || [];
                var html = '';
                var statusColors = {offen:'bg-yellow-100 text-yellow-700',in_bearbeitung:'bg-blue-100 text-blue-700',warten:'bg-gray-100 text-gray-700',geloest:'bg-green-100 text-green-700'};
                var statusLabels = {offen:'Offen',in_bearbeitung:'In Bearbeitung',warten:'Wartend',geloest:'Gel√∂st'};
                var prioIcons = {dringend:'üî¥',hoch:'üü†',mittel:'üü°',niedrig:'‚ö™'};
                tickets.forEach(function(t) {
                    var d = new Date(t.created_at);
                    html += '<div class="vit-card p-4 hover:shadow-md transition">';
                    html += '<div class="flex items-start justify-between">';
                    html += '<div class="flex-1"><div class="flex items-center space-x-2 mb-1">';
                    html += '<span class="text-xs font-semibold rounded px-2 py-0.5 ' + (statusColors[t.status]||'') + '">' + (statusLabels[t.status]||t.status) + '</span>';
                    html += '<span>' + (prioIcons[t.prioritaet]||'') + '</span>';
                    html += '<span class="text-xs text-gray-400">#' + t.id.substring(0,8) + '</span></div>';
                    html += '<h4 class="font-bold text-gray-800 text-sm">' + t.titel + '</h4>';
                    html += '<p class="text-xs text-gray-500 mt-1">' + t.beschreibung.substring(0,120) + '</p>';
                    html += '<div class="flex items-center space-x-3 mt-2 text-xs text-gray-400">';
                    html += '<span>' + d.toLocaleDateString('de-DE') + '</span>';
                    html += '<span>' + (t.kategorie||'') + '</span>';
                    html += '</div></div></div></div>';
                });
                if(tickets.length===0) html = '<div class="text-center py-8 text-gray-400">Keine Tickets.</div>';
                container.innerHTML = html;
            } catch(err) { console.error('Support:', err); }
        }

        function filterTickets(filter) {
            document.querySelectorAll('.ticket-filter').forEach(function(b){b.className='ticket-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-gray-100 text-gray-600';});
            var btn=document.querySelector('.ticket-filter[data-f="'+filter+'"]');
            if(btn) btn.className='ticket-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-vit-orange text-white';
            renderTickets(filter);
        }

        async function sendTicket() {
            var title = document.getElementById('ticketTitle');
            var desc = document.getElementById('ticketDesc');
            var cat = document.getElementById('ticketCat');
            if(!title || !title.value.trim()) return;
            try {
                await sb.from('support_tickets').insert({standort_id: sbStandort?sbStandort.id:null, erstellt_von:sbUser.id, titel:title.value.trim(), beschreibung:(desc?desc.value:''), kategorie:(cat?cat.value:'allgemein'), prioritaet:'mittel'});
                if(title) title.value=''; if(desc) desc.value='';
                var form=document.getElementById('newTicketForm'); if(form) form.classList.add('hidden');
                renderTickets('all');
            } catch(err) { alert('Fehler: '+err.message); }
        }

        var zentraleKontakte = [
            {name:'Sascha Matthies',rolle:'Geschaeftsfuehrung',bereich:'GF',tel:'+49 170 1234567',email:'sascha@vitbikes.de',verfuegbar:true,zeiten:'Mo-Fr 9-18 Uhr',schwerpunkt:'Strategie, Partnerschaften, Finanzen'},
            {name:'Florian Meier',rolle:'Einkauf & Sortiment',bereich:'Einkauf',tel:'+49 170 2345678',email:'florian@vitbikes.de',verfuegbar:true,zeiten:'Mo-Fr 8-17 Uhr',schwerpunkt:'Vororder, Konditionen, Lieferanten, Sortiment'},
            {name:'Michael Stenzel',rolle:'Marketing & Performance',bereich:'Marketing',tel:'+49 170 3456789',email:'michael@vitbikes.de',verfuegbar:true,zeiten:'Mo-Fr 9-18 Uhr',schwerpunkt:'Ads, Content, Events, Jahresgespraeche'},
            {name:'Tim Schaefer',rolle:'IT & Systeme',bereich:'IT',tel:'+49 170 4567890',email:'tim@vitbikes.de',verfuegbar:false,zeiten:'Mo-Fr 8-16 Uhr',schwerpunkt:'Kassensystem, B2B-Portale, Etermin, Netzwerk'},
            {name:'Laura Hofmann',rolle:'Buchhaltung & Controlling',bereich:'Buchhaltung',tel:'+49 170 5678901',email:'laura@vitbikes.de',verfuegbar:true,zeiten:'Mo-Do 8-16, Fr 8-14 Uhr',schwerpunkt:'BWA, Monatsabschluss, Rechnungen, DATEV'},
            {name:'Jonas Becker',rolle:'Werkstatt-Support & Schulung',bereich:'Werkstatt',tel:'+49 170 6789012',email:'jonas@vitbikes.de',verfuegbar:true,zeiten:'Mo-Fr 7-16 Uhr',schwerpunkt:'Shimano, Bosch, Diagnose, Technik-Schulungen'}
        ];

        function showSupportTab(tabName) {
            document.querySelectorAll('.sup-tab-content').forEach(function(c){ c.style.display='none'; });
            document.querySelectorAll('.sup-tab-btn').forEach(function(b){
                b.className='sup-tab-btn whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-semibold text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300';
            });
            var tabMap = {tickets:'Tickets',kontakte:'Kontakte'};
            var el = document.getElementById('supTab'+(tabMap[tabName]||''));
            if(el) el.style.display='block';
            var btn = document.querySelector('.sup-tab-btn[data-tab="'+tabName+'"]');
            if(btn) btn.className='sup-tab-btn whitespace-nowrap py-4 px-1 border-b-2 border-vit-orange font-semibold text-sm text-vit-orange';
            if(tabName==='tickets') renderTickets('all');
            if(tabName==='kontakte') renderKontakte();
        }

        function renderTickets(filter) {
            var list = document.getElementById('ticketList');
            if(!list) return;
            var filtered = filter==='all' ? supportTickets : supportTickets.filter(function(t){ return t.status===filter; });
            var h = '';
            filtered.forEach(function(t) {
                var statusBadge = '', prioIcon = '', statusColor = '';
                if(t.status==='offen') { statusBadge='Offen'; statusColor='bg-red-100 text-red-700'; }
                else if(t.status==='bearbeitung') { statusBadge='In Bearbeitung'; statusColor='bg-yellow-100 text-yellow-700'; }
                else { statusBadge='Geloest'; statusColor='bg-green-100 text-green-700'; }
                if(t.prio==='hoch') prioIcon='üî¥';
                else if(t.prio==='mittel') prioIcon='üü°';
                else prioIcon='üü¢';

                h += '<div class="vit-card p-4 hover:shadow-md transition '+(t.status==='geloest'?'opacity-60':'')+'">';
                h += '<div class="flex items-start justify-between">';
                h += '<div class="flex-1">';
                h += '<div class="flex items-center space-x-2 mb-1">';
                h += '<span class="text-xs font-mono text-gray-400">'+t.id+'</span>';
                h += '<span class="'+statusColor+' text-[10px] px-2 py-0.5 rounded-full font-bold">'+statusBadge+'</span>';
                h += '<span class="text-xs">'+prioIcon+'</span>';
                h += '<span class="text-[10px] px-2 py-0.5 bg-gray-100 text-gray-500 rounded-full">'+t.kat+'</span>';
                h += '</div>';
                h += '<p class="text-sm font-semibold text-gray-800">'+t.betreff+'</p>';
                h += '<div class="flex items-center space-x-4 mt-2 text-xs text-gray-400">';
                h += '<span>Erstellt: '+t.erstellt+'</span>';
                h += '<span>Letzte Aktualisierung: '+t.aktualisiert+'</span>';
                if(t.bearbeiter) h += '<span>üë§ '+t.bearbeiter+'</span>';
                h += '<span>üí¨ '+t.antworten+' Antworten</span>';
                h += '</div>';
                h += '</div>';
                h += '<button class="px-3 py-1.5 text-xs font-semibold border border-gray-300 rounded-lg hover:bg-gray-50 whitespace-nowrap ml-3">Details ‚Üí</button>';
                h += '</div>';
                h += '</div>';
            });
            if(filtered.length===0) h = '<div class="text-center py-12 text-gray-400"><p class="text-4xl mb-2">‚úÖ</p><p class="text-sm">Keine Tickets in dieser Kategorie</p></div>';
            list.innerHTML = h;
        }

        function filterTickets(filter) {
            document.querySelectorAll('.ticket-filter-btn').forEach(function(b){
                b.className='ticket-filter-btn px-3 py-1.5 rounded-full text-xs font-semibold bg-gray-100 text-gray-600';
            });
            var btn = document.querySelector('.ticket-filter-btn[data-tf="'+filter+'"]');
            if(btn) btn.className='ticket-filter-btn px-3 py-1.5 rounded-full text-xs font-semibold bg-vit-orange text-white';
            renderTickets(filter);
        }

        function renderKontakte() {
            var grid = document.getElementById('kontakteGrid');
            if(!grid || grid.dataset.rendered) return;
            grid.dataset.rendered = 'true';
            var bereichColors = {'GF':'bg-purple-500','Einkauf':'bg-blue-500','Marketing':'bg-orange-500','IT':'bg-gray-600','Buchhaltung':'bg-green-600','Werkstatt':'bg-red-500'};
            var h = '';
            zentraleKontakte.forEach(function(k) {
                var col = bereichColors[k.bereich]||'bg-gray-500';
                var initials = k.name.split(' ').map(function(w){return w[0];}).join('');
                h += '<div class="vit-card p-5 hover:shadow-md transition">';
                h += '<div class="flex items-center space-x-3 mb-4">';
                h += '<div class="w-14 h-14 '+col+' rounded-full flex items-center justify-center text-white font-bold text-lg">'+initials+'</div>';
                h += '<div>';
                h += '<p class="font-semibold text-gray-800">'+k.name+'</p>';
                h += '<p class="text-xs text-gray-500">'+k.rolle+'</p>';
                h += '<span class="inline-flex items-center mt-1 '+(k.verfuegbar?'text-green-600':'text-gray-400')+' text-xs">';
                h += '<span class="w-2 h-2 rounded-full '+(k.verfuegbar?'bg-green-500':'bg-gray-300')+' mr-1"></span>';
                h += (k.verfuegbar?'Verfuegbar':'Nicht verfuegbar');
                h += '</span>';
                h += '</div></div>';
                h += '<div class="space-y-2 mb-4">';
                h += '<div class="flex items-center space-x-2 text-sm"><span class="text-gray-400 w-5">üìû</span><a href="tel:'+k.tel+'" class="text-gray-700 hover:text-vit-orange">'+k.tel+'</a></div>';
                h += '<div class="flex items-center space-x-2 text-sm"><span class="text-gray-400 w-5">‚úâÔ∏è</span><a href="mailto:'+k.email+'" class="text-gray-700 hover:text-vit-orange">'+k.email+'</a></div>';
                h += '<div class="flex items-center space-x-2 text-sm"><span class="text-gray-400 w-5">üïê</span><span class="text-gray-600">'+k.zeiten+'</span></div>';
                h += '</div>';
                h += '<div class="pt-3 border-t border-gray-100">';
                h += '<p class="text-xs text-gray-400 mb-1">Schwerpunkte</p>';
                h += '<p class="text-xs text-gray-600">'+k.schwerpunkt+'</p>';
                h += '</div>';
                h += '<div class="flex space-x-2 mt-3">';
                h += '<button class="flex-1 px-3 py-2 text-xs font-semibold border border-gray-300 rounded-lg hover:bg-gray-50">‚úâÔ∏è E-Mail</button>';
                h += '<button class="flex-1 px-3 py-2 text-xs font-semibold bg-vit-orange text-white rounded-lg hover:opacity-90">üìû Anrufen</button>';
                h += '</div>';
                h += '</div>';
            });
            grid.innerHTML = h;
        }

        // Init support on view
        var origShowView = showView;
        showView = function(v) {
            origShowView(v);
            if(v==='support') { renderTickets('all'); renderKontakte(); }
            if(v==='ideenboard') { renderIdeen('all'); }
            if(v==='wissen') { renderWissenGlobal(); }
            if(v==='shop') { renderShop(); }
        };

        // === IDEENBOARD ===
        async function renderIdeen(filter) {
            var container = document.getElementById('ideenList');
            if(!container) return;
            try {
                var query = sb.from('ideen').select('*, users(name)').order('votes', {ascending:false});
                if(filter && filter!=='all') query = query.eq('status', filter);
                var resp = await query;
                if(resp.error) throw resp.error;
                var ideas = resp.data || [];
                var html = '';
                var statusColors = {neu:'bg-blue-100 text-blue-700',wird_geprueft:'bg-yellow-100 text-yellow-700',umgesetzt:'bg-green-100 text-green-700',abgelehnt:'bg-red-100 text-red-700'};
                var statusLabels = {neu:'Neu',wird_geprueft:'Wird gepr√ºft',umgesetzt:'Umgesetzt',abgelehnt:'Abgelehnt'};
                ideas.forEach(function(i) {
                    var authorName = i.users ? i.users.name : 'Unbekannt';
                    html += '<div class="vit-card p-5 hover:shadow-md transition">';
                    html += '<div class="flex items-start space-x-4">';
                    html += '<div class="text-center flex-shrink-0"><button onclick="voteIdee(\x27'+i.id+'\x27)" class="w-12 h-12 rounded-xl bg-gray-100 hover:bg-vit-orange hover:text-white flex items-center justify-center text-lg font-bold text-gray-600 transition">‚ñ≤</button><span class="text-sm font-bold text-gray-800 block mt-1">' + (i.votes||0) + '</span></div>';
                    html += '<div class="flex-1">';
                    html += '<div class="flex items-center space-x-2 mb-1"><span class="text-xs font-semibold rounded px-2 py-0.5 ' + (statusColors[i.status]||'') + '">' + (statusLabels[i.status]||i.status) + '</span></div>';
                    html += '<h3 class="font-bold text-gray-800 mb-1">' + i.titel + '</h3>';
                    if(i.beschreibung) html += '<p class="text-sm text-gray-600 mb-2">' + i.beschreibung + '</p>';
                    html += '<span class="text-xs text-gray-400">' + authorName + '</span>';
                    html += '</div></div></div>';
                });
                if(ideas.length===0) html = '<div class="text-center py-8 text-gray-400">Keine Ideen.</div>';
                container.innerHTML = html;
            } catch(err) { console.error('Ideen:', err); }
        }

        function filterIdeen(filter) {
            document.querySelectorAll('.ideen-filter').forEach(function(b){b.className='ideen-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-gray-100 text-gray-600';});
            var btn=document.querySelector('.ideen-filter[data-f="'+filter+'"]');
            if(btn) btn.className='ideen-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-vit-orange text-white';
            renderIdeen(filter);
        }

        async function voteIdee(id) {
            try {
                await sb.from('ideen_votes').insert({idee_id:id, user_id:sbUser.id});
                await sb.rpc('increment_votes', {idee_id_param:id}).catch(function(){});
                // Simple increment fallback
                var resp = await sb.from('ideen').select('votes').eq('id',id).single();
                if(resp.data) await sb.from('ideen').update({votes:(resp.data.votes||0)+1}).eq('id',id);
                renderIdeen('all');
            } catch(err) { if(err.code==='23505') alert('Du hast bereits abgestimmt!'); else console.error('Vote:', err); }
        }

        async function submitIdee() {
            var titleEl = document.getElementById('ideeTitle');
            var descEl = document.getElementById('ideeDesc');
            if(!titleEl || !titleEl.value.trim()) return;
            try {
                await sb.from('ideen').insert({user_id:sbUser.id, standort_id:sbStandort?sbStandort.id:null, titel:titleEl.value.trim(), beschreibung:descEl?descEl.value:'', status:'neu'});
                if(titleEl) titleEl.value=''; if(descEl) descEl.value='';
                var form=document.getElementById('newIdeeForm'); if(form) form.classList.add('hidden');
                renderIdeen('all');
            } catch(err) { alert('Fehler: '+err.message); }
        }

        // === HQ STANDORT-DATEN (Netzwerk-weite Kennzahlen) ===
        var hqStandorte = [
            {name:'Grafrath',inhaber:'Sandra & Thomas Engelmann',umsatzPlan:30770,umsatzIst:54938,rohertrag:38.9,leadPerf:102,leads:22,cpt:206,budget:1500,vororderStatus:'done',vororderBikes:103,rabattQuote:8.7,verkauftKW:5,beratungenKW:12,offeneTickets:2,strategieStatus:'done',bwaAuffaellig:'Werbekosten 321% ueber Plan',region:'Sued'},
            {name:'Hamburg',inhaber:'Jan & Petra Schulz',umsatzPlan:52000,umsatzIst:58200,rohertrag:42.1,leadPerf:111,leads:34,cpt:158,budget:2000,vororderStatus:'done',vororderBikes:145,rabattQuote:4.2,verkauftKW:8,beratungenKW:18,offeneTickets:0,strategieStatus:'done',bwaAuffaellig:null,region:'Nord'},
            {name:'Karlsdorf-Neuth.',inhaber:'Marco Weber',umsatzPlan:28000,umsatzIst:38640,rohertrag:44.2,leadPerf:138,leads:29,cpt:134,budget:1500,vororderStatus:'done',vororderBikes:88,rabattQuote:3.1,verkauftKW:7,beratungenKW:14,offeneTickets:0,strategieStatus:'done',bwaAuffaellig:null,region:'Sued'},
            {name:'Weilheim',inhaber:'Stefan Gruber',umsatzPlan:35000,umsatzIst:32900,rohertrag:40.5,leadPerf:91,leads:18,cpt:172,budget:1500,vororderStatus:'done',vororderBikes:95,rabattQuote:5.8,verkauftKW:4,beratungenKW:9,offeneTickets:1,strategieStatus:'done',bwaAuffaellig:null,region:'Sued'},
            {name:'Muenchen-Thal.',inhaber:'Lisa & Tom Berger',umsatzPlan:48000,umsatzIst:44640,rohertrag:37.8,leadPerf:93,leads:28,cpt:189,budget:1800,vororderStatus:'done',vororderBikes:120,rabattQuote:6.2,verkauftKW:6,beratungenKW:15,offeneTickets:1,strategieStatus:'done',bwaAuffaellig:null,region:'Sued'},
            {name:'Holzkirchen',inhaber:'Anna Maier',umsatzPlan:32000,umsatzIst:31680,rohertrag:39.2,leadPerf:99,leads:16,cpt:195,budget:1200,vororderStatus:'done',vororderBikes:78,rabattQuote:5.5,verkauftKW:3,beratungenKW:8,offeneTickets:0,strategieStatus:'done',bwaAuffaellig:null,region:'Sued'},
            {name:'Teisendorf',inhaber:'Robert Eder',umsatzPlan:22000,umsatzIst:19580,rohertrag:41.3,leadPerf:89,leads:11,cpt:210,budget:1000,vororderStatus:'done',vororderBikes:55,rabattQuote:4.8,verkauftKW:2,beratungenKW:6,offeneTickets:0,strategieStatus:'done',bwaAuffaellig:null,region:'Sued'},
            {name:'Wesel',inhaber:'Klaus & Maria Brandt',umsatzPlan:30000,umsatzIst:25500,rohertrag:36.8,leadPerf:85,leads:14,cpt:220,budget:1200,vororderStatus:'done',vororderBikes:72,rabattQuote:7.1,verkauftKW:3,beratungenKW:7,offeneTickets:1,strategieStatus:'done',bwaAuffaellig:'Personalkosten 28% vom Umsatz',region:'West'},
            {name:'Reutlingen',inhaber:'Jens Fischer',umsatzPlan:38000,umsatzIst:31920,rohertrag:38.1,leadPerf:84,leads:19,cpt:185,budget:1500,vororderStatus:'done',vororderBikes:92,rabattQuote:6.0,verkauftKW:4,beratungenKW:10,offeneTickets:0,strategieStatus:'done',bwaAuffaellig:null,region:'Sued'},
            {name:'Muenster',inhaber:'Birgit Lange',umsatzPlan:42000,umsatzIst:34440,rohertrag:35.4,leadPerf:82,leads:21,cpt:198,budget:1500,vororderStatus:'partial',vororderBikes:85,rabattQuote:8.3,verkauftKW:4,beratungenKW:11,offeneTickets:2,strategieStatus:'done',bwaAuffaellig:'Rohertrag unter 36%',region:'West'},
            {name:'Rottweil',inhaber:'Frank Mueller',umsatzPlan:25000,umsatzIst:18000,rohertrag:37.5,leadPerf:72,leads:9,cpt:245,budget:1000,vororderStatus:'done',vororderBikes:60,rabattQuote:6.5,verkauftKW:2,beratungenKW:5,offeneTickets:0,strategieStatus:'pending',bwaAuffaellig:null,region:'Sued'},
            {name:'Berlin-Brand.',inhaber:'Sven & Katja Richter',umsatzPlan:55000,umsatzIst:38500,rohertrag:34.2,leadPerf:70,leads:25,cpt:232,budget:2000,vororderStatus:'partial',vororderBikes:110,rabattQuote:9.8,verkauftKW:5,beratungenKW:13,offeneTickets:3,strategieStatus:'pending',bwaAuffaellig:'Rabattquote 9.8% ‚Äì Ziel unter 5%',region:'Ost'},
            {name:'Witten',inhaber:'Dirk Hoffmann',umsatzPlan:28000,umsatzIst:19320,rohertrag:33.8,leadPerf:69,leads:10,cpt:260,budget:1000,vororderStatus:'done',vororderBikes:62,rabattQuote:7.9,verkauftKW:2,beratungenKW:6,offeneTickets:1,strategieStatus:'done',bwaAuffaellig:'Rohertrag unter 34%',region:'West'},
            {name:'Warendorf',inhaber:'Michael Braun',umsatzPlan:26000,umsatzIst:17680,rohertrag:35.1,leadPerf:68,leads:8,cpt:275,budget:1000,vororderStatus:'done',vororderBikes:58,rabattQuote:6.8,verkauftKW:2,beratungenKW:5,offeneTickets:0,strategieStatus:'done',bwaAuffaellig:null,region:'West'},
            {name:'Muenchen-Berg',inhaber:'Christian Wolf',umsatzPlan:35000,umsatzIst:18200,rohertrag:36.5,leadPerf:52,leads:12,cpt:310,budget:1200,vororderStatus:'partial',vororderBikes:70,rabattQuote:8.5,verkauftKW:2,beratungenKW:7,offeneTickets:2,strategieStatus:'pending',bwaAuffaellig:'Umsatz 48% unter Plan',region:'Sued'},
            {name:'Pfaffenhofen',inhaber:'Eva Schneider',umsatzPlan:30000,umsatzIst:13800,rohertrag:32.4,leadPerf:46,leads:7,cpt:320,budget:1000,vororderStatus:'open',vororderBikes:0,rabattQuote:10.2,verkauftKW:1,beratungenKW:4,offeneTickets:3,strategieStatus:'pending',bwaAuffaellig:'Rabattquote 10.2%, Rohertrag 32.4%',region:'Sued'},
            {name:'Zell',inhaber:'Markus Koenig',umsatzPlan:20000,umsatzIst:7600,rohertrag:31.0,leadPerf:38,leads:4,cpt:380,budget:800,vororderStatus:'open',vororderBikes:0,rabattQuote:11.5,verkauftKW:1,beratungenKW:3,offeneTickets:2,strategieStatus:'missing',bwaAuffaellig:'Strategie nicht vereinbart, Rohertrag 31%',region:'Sued'},
            {name:'Lohmar',inhaber:'Thomas Klein',umsatzPlan:25000,umsatzIst:9000,rohertrag:29.8,leadPerf:36,leads:5,cpt:350,budget:800,vororderStatus:'open',vororderBikes:0,rabattQuote:12.1,verkauftKW:1,beratungenKW:3,offeneTickets:4,strategieStatus:'missing',bwaAuffaellig:'Rohertrag 29.8% ‚Äì kritisch',region:'West'},
            {name:'Garching',inhaber:'Peter Bauer',umsatzPlan:32000,umsatzIst:10240,rohertrag:30.5,leadPerf:32,leads:6,cpt:400,budget:1000,vororderStatus:'open',vororderBikes:0,rabattQuote:13.0,verkauftKW:1,beratungenKW:4,offeneTickets:3,strategieStatus:'missing',bwaAuffaellig:'Rohertrag 30.5%, keine Vororder',region:'Sued'},
            {name:'Hann. Muenden',inhaber:'Andreas Hartmann',umsatzPlan:18000,umsatzIst:2880,rohertrag:25.3,leadPerf:16,leads:2,cpt:450,budget:600,vororderStatus:'open',vororderBikes:0,rabattQuote:14.5,verkauftKW:0,beratungenKW:1,offeneTickets:5,strategieStatus:'missing',bwaAuffaellig:'Extremer Umsatzrueckgang, Strategie fehlt',region:'Nord'},
            {name:'Hanau',inhaber:'(vakant)',umsatzPlan:22000,umsatzIst:0,rohertrag:0,leadPerf:0,leads:0,cpt:0,budget:0,vororderStatus:'open',vororderBikes:0,rabattQuote:0,verkauftKW:0,beratungenKW:0,offeneTickets:0,strategieStatus:'missing',bwaAuffaellig:'Standort inaktiv / Nachfolger gesucht',region:'West'}
        ];

        function perfColor(p) { return p>=100?'text-green-600':p>=75?'text-green-500':p>=50?'text-yellow-600':'text-red-600'; }
        function perfBg(p) { return p>=100?'bg-green-100 text-green-700':p>=75?'bg-green-50 text-green-600':p>=50?'bg-yellow-100 text-yellow-700':'bg-red-100 text-red-700'; }
        function perfDot(p) { return p>=100?'#FBBF24':p>=75?'#22C55E':p>=50?'#F97316':'#EF4444'; }
        function fmt(n) { return n>=1000 ? Math.round(n/1000)+'k' : n.toLocaleString('de-DE'); }
        function stratBadge(s) { var m={done:'‚úÖ Vereinbart',pending:'‚è≥ Ausstehend',missing:'‚ùå Fehlt',partial:'üî∂ Teilweise'}; var c={done:'bg-green-100 text-green-700',pending:'bg-yellow-100 text-yellow-700',missing:'bg-red-100 text-red-700',partial:'bg-orange-100 text-orange-700'}; return '<span class="text-[10px] px-2 py-0.5 rounded-full font-bold '+(c[s]||c.missing)+'">'+(m[s]||'?')+'</span>'; }

        // === HQ COCKPIT ===
        function renderHqCockpit() {
            var active = hqStandorte.filter(function(s){return s.umsatzIst>0;});
            var totalUmsatz = hqStandorte.reduce(function(a,s){return a+s.umsatzIst;},0);
            var totalPlan = hqStandorte.reduce(function(a,s){return a+s.umsatzPlan;},0);
            var avgRohertrag = active.length ? (active.reduce(function(a,s){return a+s.rohertrag;},0)/active.length).toFixed(1) : 0;
            var totalLeads = hqStandorte.reduce(function(a,s){return a+s.leads;},0);
            var kritisch = hqStandorte.filter(function(s){return s.leadPerf<50;}).length;
            var tickets = hqStandorte.reduce(function(a,s){return a+s.offeneTickets;},0);

            // KPIs
            var el = document.getElementById('hqKpiCards');
            if(el) el.innerHTML = '<div class="vit-card p-5"><p class="text-xs text-gray-400 uppercase">Netzwerk-Umsatz YTD</p><p class="text-2xl font-bold text-gray-800">'+fmt(totalUmsatz)+' ‚Ç¨</p><p class="text-xs '+(totalUmsatz>=totalPlan?'text-green-600':'text-red-500')+'">Plan: '+fmt(totalPlan)+' ‚Ç¨</p></div>'
                +'<div class="vit-card p-5"><p class="text-xs text-gray-400 uppercase">√ò Rohertrag</p><p class="text-2xl font-bold text-gray-800">'+avgRohertrag+'%</p><p class="text-xs text-gray-500">Ziel: ‚â• 38%</p></div>'
                +'<div class="vit-card p-5"><p class="text-xs text-gray-400 uppercase">Leads gesamt</p><p class="text-2xl font-bold text-gray-800">'+totalLeads+'</p><p class="text-xs text-gray-500">'+active.length+' aktive Standorte</p></div>'
                +'<div class="vit-card p-5"><p class="text-xs text-gray-400 uppercase">Standorte kritisch</p><p class="text-2xl font-bold '+(kritisch>3?'text-red-600':'text-yellow-600')+'">'+kritisch+' / '+hqStandorte.length+'</p><p class="text-xs text-gray-500">Lead-Performance &lt; 50%</p></div>'
                +'<div class="vit-card p-5"><p class="text-xs text-gray-400 uppercase">Offene Tickets</p><p class="text-2xl font-bold '+(tickets>10?'text-red-600':'text-gray-800')+'">'+tickets+'</p><p class="text-xs text-gray-500">Netzwerk-weit</p></div>';

            // Alert box
            var alerts = hqStandorte.filter(function(s){return s.bwaAuffaellig;});
            var ab = document.getElementById('hqAlertBox');
            if(ab) {
                var ah = '<div class="flex items-center space-x-2 mb-2"><span class="text-lg">üö®</span><span class="font-bold text-red-700">'+alerts.length+' Standorte mit Handlungsbedarf</span></div>';
                ah += '<div class="flex flex-wrap gap-2">';
                alerts.forEach(function(s){ ah += '<span class="text-xs px-2 py-1 bg-red-50 text-red-600 rounded-lg"><strong>'+s.name+':</strong> '+s.bwaAuffaellig+'</span>'; });
                ah += '</div>';
                ab.innerHTML = ah;
            }

            // Top 5
            var sorted = hqStandorte.slice().sort(function(a,b){return b.leadPerf-a.leadPerf;});
            var t5 = document.getElementById('hqTop5');
            if(t5) {
                var th = '';
                sorted.slice(0,5).forEach(function(s,i){
                    th += '<div class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg"><span class="text-lg font-bold text-gray-300 w-6">'+(i+1)+'</span><div class="flex-1"><p class="text-sm font-semibold">'+s.name+'</p><p class="text-xs text-gray-400">'+s.inhaber+'</p></div><div class="text-right"><p class="font-bold '+perfColor(s.leadPerf)+'">'+s.leadPerf+'%</p><p class="text-xs text-gray-400">'+fmt(s.umsatzIst)+' ‚Ç¨ Umsatz</p></div></div>';
                });
                t5.innerHTML = th;
            }

            // Bottom 5
            var b5 = document.getElementById('hqBottom5');
            if(b5) {
                var bh = '';
                sorted.slice(-5).reverse().forEach(function(s){
                    bh += '<div class="flex items-center space-x-3 p-3 bg-red-50 rounded-lg"><span class="text-lg">‚ö†Ô∏è</span><div class="flex-1"><p class="text-sm font-semibold text-red-700">'+s.name+'</p><p class="text-xs text-red-500">'+(s.bwaAuffaellig||'Lead-Performance kritisch')+'</p></div><div class="text-right"><p class="font-bold text-red-600">'+s.leadPerf+'%</p><button class="text-[10px] px-2 py-1 bg-red-600 text-white rounded mt-1" onclick="alert(\'Standort '+s.name+' wird geoeffnet\')">Details ‚Üí</button></div></div>';
                });
                b5.innerHTML = bh;
            }

            // Grid
            var grid = document.getElementById('hqStandortGrid');
            if(grid) {
                var gh = '';
                sorted.forEach(function(s){
                    gh += '<div class="bg-gray-50 border border-gray-200 rounded-lg p-3 text-center cursor-pointer hover:shadow-md transition" onclick="alert(\'Standort '+s.name+' oeffnen\')">'
                        +'<div class="flex items-center justify-center space-x-1 mb-1"><span style="width:10px;height:10px;border-radius:50%;background:'+perfDot(s.leadPerf)+';display:inline-block;"></span><span class="text-xs font-semibold text-gray-700 truncate">'+s.name+'</span></div>'
                        +'<span class="text-sm font-bold text-gray-800">'+s.leadPerf+'%</span>'
                        +'</div>';
                });
                grid.innerHTML = gh;
            }

            // === HOME WIDGETS (rechte Spalte) ===
            // Aktive Kampagnen kompakt
            var hkEl = document.getElementById('hqHomeKampagnen');
            if(hkEl && typeof hqKampagnen !== 'undefined') {
                var hkh = '';
                hqKampagnen.filter(function(k){return k.status==='aktiv';}).forEach(function(k){
                    var pct = k.standorte ? Math.round(k.umgesetzt/k.standorte*100) : 0;
                    hkh += '<div class="flex items-center space-x-3 p-2 bg-gray-50 rounded-lg">';
                    hkh += '<div class="flex-1 min-w-0"><p class="text-xs font-semibold text-gray-800 truncate">'+k.name+'</p>';
                    hkh += '<div class="w-full bg-gray-200 rounded-full h-1.5 mt-1"><div class="h-1.5 rounded-full '+(pct>=80?'bg-green-500':pct>=50?'bg-yellow-500':'bg-red-400')+'" style="width:'+pct+'%"></div></div></div>';
                    hkh += '<span class="text-xs font-bold '+(pct>=80?'text-green-600':'text-orange-500')+'">'+pct+'%</span>';
                    hkh += '</div>';
                });
                if(!hkh) hkh = '<p class="text-xs text-gray-400">Keine aktiven Kampagnen</p>';
                hkEl.innerHTML = hkh;
            }

            // Offene Aufgaben kompakt
            var haEl = document.getElementById('hqHomeAufgaben');
            if(haEl && typeof hqTasks !== 'undefined') {
                var hah = '';
                var prioIcons = {hoch:'üî¥',mittel:'üü°',niedrig:'üü¢'};
                hqTasks.filter(function(t){return t.status!=='done';}).sort(function(a,b){var po={hoch:0,mittel:1,niedrig:2};return (po[a.prio]||1)-(po[b.prio]||1);}).slice(0,5).forEach(function(t){
                    var pct = Math.round(t.done/t.total*100);
                    hah += '<div class="flex items-center space-x-2 p-2 bg-gray-50 rounded-lg">';
                    hah += '<span class="text-xs">'+(prioIcons[t.prio]||'')+'</span>';
                    hah += '<div class="flex-1 min-w-0"><p class="text-[11px] font-semibold text-gray-800 truncate">'+t.title+'</p>';
                    hah += '<p class="text-[9px] text-gray-400">Frist: '+t.deadline+' ¬∑ '+pct+'% erledigt</p></div>';
                    hah += '</div>';
                });
                if(!hah) hah = '<p class="text-xs text-gray-400 text-center">Alles erledigt! ‚úÖ</p>';
                haEl.innerHTML = hah;
            }

            // Naechste Termine kompakt
            var htEl = document.getElementById('hqHomeTermine');
            if(htEl && typeof hqKalTermine !== 'undefined') {
                var hth = '';
                var typeIcons = {schulung:'üéì',event:'üé™',deadline:'‚è∞',meeting:'ü§ù'};
                hqKalTermine.filter(function(t){return t.date>='2026-02-14';}).sort(function(a,b){return a.date>b.date?1:-1;}).slice(0,5).forEach(function(t){
                    hth += '<div class="flex items-center space-x-2 p-2 bg-gray-50 rounded-lg">';
                    hth += '<span class="text-sm">'+(typeIcons[t.type]||'üìÖ')+'</span>';
                    hth += '<div class="flex-1 min-w-0"><p class="text-[11px] font-semibold text-gray-800 truncate">'+t.title+'</p>';
                    hth += '<p class="text-[9px] text-gray-400">'+t.date+' ¬∑ '+t.time+' Uhr'+(t.pflicht?' ¬∑ <span class="text-red-500">PFLICHT</span>':'')+'</p></div>';
                    hth += '</div>';
                });
                if(!hth) hth = '<p class="text-xs text-gray-400 text-center">Keine Termine</p>';
                htEl.innerHTML = hth;
            }

            // Letzte Ankuendigungen kompakt
            var aaEl = document.getElementById('hqHomeAnnounce');
            if(aaEl && typeof hqAnnouncements !== 'undefined') {
                var aah = '';
                hqAnnouncements.slice(0,3).forEach(function(a){
                    var readPct = Math.round(a.read/a.total*100);
                    aah += '<div class="p-2 bg-gray-50 rounded-lg">';
                    aah += '<p class="text-[11px] font-semibold text-gray-800 truncate">'+a.title+'</p>';
                    aah += '<div class="flex items-center justify-between mt-1"><p class="text-[9px] text-gray-400">'+a.date+' ¬∑ '+a.author+'</p>';
                    aah += '<span class="text-[9px] font-bold '+(readPct>=90?'text-green-600':'text-orange-500')+'">'+a.read+'/'+a.total+' gelesen</span></div>';
                    aah += '</div>';
                });
                aaEl.innerHTML = aah;
            }
        }

        // === HQ STANDORTE (Detailliste) ===
        function renderHqStandorte() {
            var search = (document.getElementById('hqStandortSearch')||{}).value||'';
            var filter = (document.getElementById('hqStandortFilter')||{}).value||'all';
            var list = hqStandorte.filter(function(s){
                if(search && s.name.toLowerCase().indexOf(search.toLowerCase())===-1) return false;
                if(filter==='kritisch' && s.leadPerf>=50) return false;
                if(filter==='achtung' && (s.leadPerf<50||s.leadPerf>=75)) return false;
                if(filter==='gut' && (s.leadPerf<75||s.leadPerf>=100)) return false;
                if(filter==='top' && s.leadPerf<100) return false;
                return true;
            });
            list.sort(function(a,b){return b.leadPerf-a.leadPerf;});
            var el = document.getElementById('hqStandorteList');
            if(!el) return;
            var h = '';
            list.forEach(function(s) {
                h += '<div class="vit-card p-5 hover:shadow-md transition">';
                h += '<div class="flex items-center justify-between mb-3">';
                h += '<div><h3 class="font-bold text-gray-800">'+s.name+'</h3><p class="text-xs text-gray-400">'+s.inhaber+' ¬∑ Region: '+s.region+'</p></div>';
                h += '<div class="flex items-center space-x-3">';
                h += stratBadge(s.strategieStatus);
                h += '<span class="'+perfBg(s.leadPerf)+' text-xs px-3 py-1 rounded-full font-bold">'+s.leadPerf+'% Lead-Perf.</span>';
                h += '</div></div>';
                h += '<div class="grid grid-cols-3 md:grid-cols-6 gap-3">';
                h += '<div class="text-center p-2 bg-gray-50 rounded"><p class="text-xs text-gray-400">Umsatz</p><p class="text-sm font-bold">'+fmt(s.umsatzIst)+' ‚Ç¨</p><p class="text-[10px] '+(s.umsatzIst>=s.umsatzPlan?'text-green-500':'text-red-500')+'">Plan: '+fmt(s.umsatzPlan)+'</p></div>';
                h += '<div class="text-center p-2 bg-gray-50 rounded"><p class="text-xs text-gray-400">Rohertrag</p><p class="text-sm font-bold '+(s.rohertrag>=38?'text-green-600':'text-red-500')+'">'+s.rohertrag+'%</p></div>';
                h += '<div class="text-center p-2 bg-gray-50 rounded"><p class="text-xs text-gray-400">Leads</p><p class="text-sm font-bold">'+s.leads+'</p><p class="text-[10px] text-gray-400">CPT: '+s.cpt+' ‚Ç¨</p></div>';
                h += '<div class="text-center p-2 bg-gray-50 rounded"><p class="text-xs text-gray-400">Rabattquote</p><p class="text-sm font-bold '+(s.rabattQuote<=5?'text-green-600':s.rabattQuote<=8?'text-yellow-600':'text-red-500')+'">'+s.rabattQuote+'%</p></div>';
                h += '<div class="text-center p-2 bg-gray-50 rounded"><p class="text-xs text-gray-400">Vororder</p><p class="text-sm font-bold">'+(s.vororderBikes||'‚Äî')+' Bikes</p></div>';
                h += '<div class="text-center p-2 bg-gray-50 rounded"><p class="text-xs text-gray-400">Tickets</p><p class="text-sm font-bold '+(s.offeneTickets>2?'text-red-500':'text-gray-700')+'">'+s.offeneTickets+'</p></div>';
                h += '</div>';
                if(s.bwaAuffaellig) h += '<div class="mt-3 p-2 bg-red-50 rounded text-xs text-red-600">‚ö†Ô∏è '+s.bwaAuffaellig+'</div>';
                h += '<div class="mt-3 pt-3 border-t border-gray-100 flex justify-end"><button onclick="hqDrillDown(\''+s.name.toLowerCase().replace(/[^a-z]/g,'').substring(0,8)+'\')" class="text-xs text-vit-orange hover:text-orange-600 font-semibold flex items-center space-x-1"><span>Standort oeffnen</span><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg></button></div>';
                h += '</div>';
            });
            if(!list.length) h = '<div class="text-center py-12 text-gray-400">Keine Standorte gefunden</div>';
            el.innerHTML = h;
        }

        // === HQ FINANZEN ===
        function renderHqFinanzen() {
            var active = hqStandorte.filter(function(s){return s.umsatzIst>0;});
            var totalU = hqStandorte.reduce(function(a,s){return a+s.umsatzIst;},0);
            var totalP = hqStandorte.reduce(function(a,s){return a+s.umsatzPlan;},0);
            var avgRoh = active.length?(active.reduce(function(a,s){return a+s.rohertrag;},0)/active.length).toFixed(1):0;
            var avgRab = active.length?(active.reduce(function(a,s){return a+s.rabattQuote;},0)/active.length).toFixed(1):0;

            var kpi = document.getElementById('hqFinKpis');
            if(kpi) kpi.innerHTML = '<div class="vit-card p-5"><p class="text-xs text-gray-400 uppercase">Netzwerk-Umsatz</p><p class="text-2xl font-bold">'+fmt(totalU)+' ‚Ç¨</p><p class="text-xs '+(totalU>=totalP?'text-green-500':'text-red-500')+'">Plan: '+fmt(totalP)+' ‚Ç¨</p></div>'
                +'<div class="vit-card p-5"><p class="text-xs text-gray-400 uppercase">√ò Rohertrag</p><p class="text-2xl font-bold '+(avgRoh>=38?'text-green-600':'text-red-500')+'">'+avgRoh+'%</p></div>'
                +'<div class="vit-card p-5"><p class="text-xs text-gray-400 uppercase">√ò Rabattquote</p><p class="text-2xl font-bold '+(avgRab<=5?'text-green-600':'text-red-500')+'">'+avgRab+'%</p><p class="text-xs text-gray-500">Ziel: unter 5%</p></div>'
                +'<div class="vit-card p-5"><p class="text-xs text-gray-400 uppercase">BWA-Auffaelligkeiten</p><p class="text-2xl font-bold text-red-600">'+hqStandorte.filter(function(s){return s.bwaAuffaellig;}).length+'</p></div>';

            // Table
            var t = document.getElementById('hqFinTable');
            if(t) {
                var th = '<thead><tr class="border-b-2 border-gray-200"><th class="text-left py-2 px-2 text-xs text-gray-500">Standort</th><th class="text-right py-2 px-2 text-xs text-gray-500">Umsatz Plan</th><th class="text-right py-2 px-2 text-xs text-gray-500">Umsatz Ist</th><th class="text-right py-2 px-2 text-xs text-gray-500">Abw.</th><th class="text-right py-2 px-2 text-xs text-gray-500">Rohertrag</th><th class="text-right py-2 px-2 text-xs text-gray-500">Rabatt %</th><th class="text-center py-2 px-2 text-xs text-gray-500">BWA</th></tr></thead><tbody>';
                hqStandorte.slice().sort(function(a,b){return b.umsatzIst-a.umsatzIst;}).forEach(function(s){
                    var abw = s.umsatzPlan?Math.round((s.umsatzIst/s.umsatzPlan-1)*100):0;
                    th += '<tr class="border-b border-gray-100 hover:bg-gray-50"><td class="py-2 px-2 text-sm font-semibold">'+s.name+'</td><td class="py-2 px-2 text-sm text-right text-gray-500">'+fmt(s.umsatzPlan)+'</td><td class="py-2 px-2 text-sm text-right font-semibold">'+fmt(s.umsatzIst)+'</td><td class="py-2 px-2 text-sm text-right font-bold '+(abw>=0?'text-green-600':'text-red-500')+'">'+(abw>=0?'+':'')+abw+'%</td><td class="py-2 px-2 text-sm text-right '+(s.rohertrag>=38?'text-green-600':'text-red-500')+'">'+s.rohertrag+'%</td><td class="py-2 px-2 text-sm text-right '+(s.rabattQuote<=5?'text-green-600':s.rabattQuote<=8?'text-yellow-600':'text-red-500')+'">'+s.rabattQuote+'%</td><td class="py-2 px-2 text-center">'+(s.bwaAuffaellig?'<span class="text-xs text-red-500">‚ö†Ô∏è</span>':'<span class="text-xs text-green-500">‚úì</span>')+'</td></tr>';
                });
                th += '</tbody>';
                t.innerHTML = th;
            }

            // Alerts
            var al = document.getElementById('hqFinAlerts');
            if(al) {
                var alh = '';
                hqStandorte.filter(function(s){return s.bwaAuffaellig;}).sort(function(a,b){return a.rohertrag-b.rohertrag;}).forEach(function(s){
                    alh += '<div class="p-3 bg-red-50 rounded-lg flex items-center justify-between"><div><p class="text-sm font-semibold text-red-700">'+s.name+'</p><p class="text-xs text-red-500">'+s.bwaAuffaellig+'</p></div><span class="text-xs text-gray-400">Rohertrag: '+s.rohertrag+'%</span></div>';
                });
                al.innerHTML = alh || '<p class="text-sm text-green-600">‚úÖ Keine Auffaelligkeiten</p>';
            }

            // Rohertrag Ranking
            var rr = document.getElementById('hqFinRohertrag');
            if(rr) {
                var rrh = '';
                hqStandorte.filter(function(s){return s.umsatzIst>0;}).sort(function(a,b){return b.rohertrag-a.rohertrag;}).forEach(function(s){
                    var w = Math.max(5, s.rohertrag * 2);
                    rrh += '<div class="flex items-center space-x-2"><span class="text-xs w-28 truncate">'+s.name+'</span><div class="flex-1 bg-gray-100 rounded-full h-4"><div class="h-4 rounded-full '+(s.rohertrag>=38?'bg-green-500':s.rohertrag>=34?'bg-yellow-500':'bg-red-500')+'" style="width:'+w+'%"></div></div><span class="text-xs font-bold w-12 text-right">'+s.rohertrag+'%</span></div>';
                });
                rr.innerHTML = rrh;
            }
        }

        // === HQ MARKETING ===
        function renderHqMarketing() {
            var active = hqStandorte.filter(function(s){return s.leads>0;});
            var totalLeads = hqStandorte.reduce(function(a,s){return a+s.leads;},0);
            var totalBudget = hqStandorte.reduce(function(a,s){return a+s.budget;},0);
            var avgCpt = active.length?Math.round(active.reduce(function(a,s){return a+s.cpt;},0)/active.length):0;
            var avgPerf = active.length?Math.round(active.reduce(function(a,s){return a+s.leadPerf;},0)/active.length):0;
            var stratDone = hqStandorte.filter(function(s){return s.strategieStatus==='done';}).length;

            var kpi = document.getElementById('hqMktKpis');
            if(kpi) kpi.innerHTML = '<div class="vit-card p-4"><p class="text-xs text-gray-400">Leads gesamt</p><p class="text-xl font-bold">'+totalLeads+'</p></div>'
                +'<div class="vit-card p-4"><p class="text-xs text-gray-400">Budget/Monat</p><p class="text-xl font-bold">'+fmt(totalBudget)+' ‚Ç¨</p></div>'
                +'<div class="vit-card p-4"><p class="text-xs text-gray-400">√ò CPT</p><p class="text-xl font-bold">'+avgCpt+' ‚Ç¨</p><p class="text-[10px] text-gray-400">Ziel: &lt;163 ‚Ç¨</p></div>'
                +'<div class="vit-card p-4"><p class="text-xs text-gray-400">√ò Lead-Perf.</p><p class="text-xl font-bold '+perfColor(avgPerf)+'">'+avgPerf+'%</p></div>'
                +'<div class="vit-card p-4"><p class="text-xs text-gray-400">Strategie vereinbart</p><p class="text-xl font-bold">'+stratDone+' / '+hqStandorte.length+'</p></div>';

            // Lead Performance
            var lp = document.getElementById('hqMktLeads');
            if(lp) {
                var lph = '';
                hqStandorte.slice().sort(function(a,b){return b.leadPerf-a.leadPerf;}).forEach(function(s){
                    var w = Math.min(100, s.leadPerf);
                    lph += '<div class="flex items-center space-x-2"><span class="text-xs w-28 truncate">'+s.name+'</span><div class="flex-1 bg-gray-100 rounded-full h-3"><div class="h-3 rounded-full" style="width:'+w+'%;background:'+perfDot(s.leadPerf)+'"></div></div><span class="text-xs font-bold w-10 text-right">'+s.leadPerf+'%</span></div>';
                });
                lp.innerHTML = lph;
            }

            // Strategie Status
            var ms = document.getElementById('hqMktStrategie');
            if(ms) {
                var msh = '';
                hqStandorte.forEach(function(s){
                    msh += '<div class="flex items-center justify-between py-1"><span class="text-xs">'+s.name+'</span>'+stratBadge(s.strategieStatus)+'</div>';
                });
                ms.innerHTML = msh;
            }

            // Alerts
            var ma = document.getElementById('hqMktAlerts');
            if(ma) {
                var mah = '';
                hqStandorte.filter(function(s){return s.leadPerf<50;}).sort(function(a,b){return a.leadPerf-b.leadPerf;}).forEach(function(s){
                    mah += '<div class="p-3 bg-red-50 rounded-lg"><div class="flex justify-between"><span class="text-sm font-semibold text-red-700">'+s.name+' ‚Äì '+s.leadPerf+'% Lead-Performance</span><span class="text-xs text-gray-400">CPT: '+s.cpt+' ‚Ç¨</span></div><p class="text-xs text-red-500 mt-1">Budget: '+s.budget+' ‚Ç¨/Monat ¬∑ '+s.leads+' Leads ¬∑ '+(s.strategieStatus==='missing'?'‚ùå Keine Strategie vereinbart':'Strategie: '+s.strategieStatus)+'</p></div>';
                });
                hqStandorte.filter(function(s){return s.strategieStatus==='missing';}).forEach(function(s){
                    if(s.leadPerf>=50) mah += '<div class="p-3 bg-yellow-50 rounded-lg"><span class="text-sm font-semibold text-yellow-700">'+s.name+' ‚Äì Marketing-Strategie fehlt</span></div>';
                });
                ma.innerHTML = mah || '<p class="text-sm text-green-600">‚úÖ Alle Standorte im gruenen Bereich</p>';
            }
        }

        // === HQ EINKAUF ===
        function renderHqEinkauf() {
            var totalVO = hqStandorte.reduce(function(a,s){return a+s.vororderBikes;},0);
            var voDone = hqStandorte.filter(function(s){return s.vororderStatus==='done';}).length;
            var voOpen = hqStandorte.filter(function(s){return s.vororderStatus==='open';}).length;
            var avgRab = (hqStandorte.filter(function(s){return s.rabattQuote>0;}).reduce(function(a,s){return a+s.rabattQuote;},0)/hqStandorte.filter(function(s){return s.rabattQuote>0;}).length).toFixed(1);

            var kpi = document.getElementById('hqEkKpis');
            if(kpi) kpi.innerHTML = '<div class="vit-card p-5"><p class="text-xs text-gray-400 uppercase">Vororder Bikes gesamt</p><p class="text-2xl font-bold">'+totalVO+'</p></div>'
                +'<div class="vit-card p-5"><p class="text-xs text-gray-400 uppercase">Vororder abgeschlossen</p><p class="text-2xl font-bold text-green-600">'+voDone+' / '+hqStandorte.length+'</p></div>'
                +'<div class="vit-card p-5"><p class="text-xs text-gray-400 uppercase">Vororder offen</p><p class="text-2xl font-bold '+(voOpen>3?'text-red-600':'text-yellow-600')+'">'+voOpen+'</p></div>'
                +'<div class="vit-card p-5"><p class="text-xs text-gray-400 uppercase">√ò Rabattquote</p><p class="text-2xl font-bold '+(avgRab<=5?'text-green-600':'text-red-500')+'">'+avgRab+'%</p><p class="text-xs text-gray-500">Ziel: unter 5%</p></div>';

            // Vororder
            var vo = document.getElementById('hqEkVororder');
            if(vo) {
                var voh = '';
                hqStandorte.forEach(function(s){
                    var vc = {done:'bg-green-100 text-green-700',partial:'bg-yellow-100 text-yellow-700',open:'bg-red-100 text-red-700'};
                    var vl = {done:'‚úÖ Abgeschlossen',partial:'üî∂ Teilweise',open:'‚ùå Offen'};
                    voh += '<div class="flex items-center justify-between py-1.5 border-b border-gray-50"><span class="text-xs w-28 truncate font-semibold">'+s.name+'</span><span class="text-xs">'+(s.vororderBikes||'‚Äî')+' Bikes</span><span class="text-[10px] px-2 py-0.5 rounded-full '+(vc[s.vororderStatus]||vc.open)+'">'+(vl[s.vororderStatus]||'?')+'</span></div>';
                });
                vo.innerHTML = voh;
            }

            // Rohertrag
            var rr = document.getElementById('hqEkRohertrag');
            if(rr) {
                var rrh = '';
                hqStandorte.filter(function(s){return s.rohertrag>0;}).sort(function(a,b){return b.rohertrag-a.rohertrag;}).forEach(function(s){
                    rrh += '<div class="flex items-center space-x-2"><span class="text-xs w-28 truncate">'+s.name+'</span><div class="flex-1 bg-gray-100 rounded-full h-3"><div class="h-3 rounded-full '+(s.rohertrag>=38?'bg-green-500':s.rohertrag>=34?'bg-yellow-500':'bg-red-500')+'" style="width:'+Math.max(5,s.rohertrag*2)+'%"></div></div><span class="text-xs font-bold w-12 text-right">'+s.rohertrag+'%</span></div>';
                });
                rr.innerHTML = rrh;
            }

            // Alerts
            var al = document.getElementById('hqEkAlerts');
            if(al) {
                var alh = '';
                hqStandorte.filter(function(s){return s.vororderStatus==='open';}).forEach(function(s){
                    alh += '<div class="p-3 bg-red-50 rounded-lg mb-2"><span class="text-sm font-semibold text-red-700">‚ùå '+s.name+' ‚Äì Keine Vororder platziert</span><p class="text-xs text-red-500">Dringend Gespraech mit Inhaber fuehren</p></div>';
                });
                hqStandorte.filter(function(s){return s.rabattQuote>8;}).forEach(function(s){
                    alh += '<div class="p-3 bg-yellow-50 rounded-lg mb-2"><span class="text-sm font-semibold text-yellow-700">‚ö†Ô∏è '+s.name+' ‚Äì Rabattquote '+s.rabattQuote+'%</span><p class="text-xs text-yellow-600">Ziel unter 5%. Schulung Dreingaben vs. Rabatte empfohlen.</p></div>';
                });
                al.innerHTML = alh || '<p class="text-sm text-green-600">‚úÖ Alle Standorte im gruenen Bereich</p>';
            }
        }

        // === HQ VERKAUF ===
        function renderHqVerkauf() {
            var totalVK = hqStandorte.reduce(function(a,s){return a+s.verkauftKW;},0);
            var totalBer = hqStandorte.reduce(function(a,s){return a+s.beratungenKW;},0);
            var conversion = totalBer ? Math.round(totalVK/totalBer*100) : 0;
            var active = hqStandorte.filter(function(s){return s.verkauftKW>0;}).length;

            var kpi = document.getElementById('hqVkKpis');
            if(kpi) kpi.innerHTML = '<div class="vit-card p-5"><p class="text-xs text-gray-400 uppercase">Verkaeufe KW 7</p><p class="text-2xl font-bold">'+totalVK+'</p><p class="text-xs text-gray-500">Netzwerk-weit</p></div>'
                +'<div class="vit-card p-5"><p class="text-xs text-gray-400 uppercase">Beratungen KW 7</p><p class="text-2xl font-bold">'+totalBer+'</p></div>'
                +'<div class="vit-card p-5"><p class="text-xs text-gray-400 uppercase">Conversion</p><p class="text-2xl font-bold '+(conversion>=40?'text-green-600':'text-yellow-600')+'">'+conversion+'%</p></div>'
                +'<div class="vit-card p-5"><p class="text-xs text-gray-400 uppercase">Aktive Standorte</p><p class="text-2xl font-bold">'+active+' / '+hqStandorte.length+'</p></div>';

            var t = document.getElementById('hqVkTable');
            if(t) {
                var th = '<thead><tr class="border-b-2 border-gray-200"><th class="text-left py-2 px-2 text-xs text-gray-500">Standort</th><th class="text-right py-2 px-2 text-xs text-gray-500">Beratungen</th><th class="text-right py-2 px-2 text-xs text-gray-500">Verkauft</th><th class="text-right py-2 px-2 text-xs text-gray-500">Conversion</th><th class="text-right py-2 px-2 text-xs text-gray-500">Umsatz YTD</th></tr></thead><tbody>';
                hqStandorte.slice().sort(function(a,b){return b.verkauftKW-a.verkauftKW;}).forEach(function(s){
                    var conv = s.beratungenKW ? Math.round(s.verkauftKW/s.beratungenKW*100) : 0;
                    th += '<tr class="border-b border-gray-100 hover:bg-gray-50"><td class="py-2 px-2 text-sm font-semibold">'+s.name+'</td><td class="py-2 px-2 text-sm text-right">'+s.beratungenKW+'</td><td class="py-2 px-2 text-sm text-right font-bold">'+s.verkauftKW+'</td><td class="py-2 px-2 text-sm text-right '+(conv>=40?'text-green-600':conv>=25?'text-yellow-600':'text-red-500')+'">'+conv+'%</td><td class="py-2 px-2 text-sm text-right">'+fmt(s.umsatzIst)+' ‚Ç¨</td></tr>';
                });
                th += '</tbody>';
                t.innerHTML = th;
            }

            var al = document.getElementById('hqVkAlerts');
            if(al) {
                var alh = '';
                hqStandorte.filter(function(s){return s.verkauftKW===0;}).forEach(function(s){
                    alh += '<div class="p-3 bg-red-50 rounded-lg mb-2"><span class="text-sm font-semibold text-red-700">üî¥ '+s.name+' ‚Äì 0 Verkaeufe in KW 7</span></div>';
                });
                hqStandorte.filter(function(s){return s.beratungenKW>0 && s.verkauftKW>0 && (s.verkauftKW/s.beratungenKW)<0.2;}).forEach(function(s){
                    alh += '<div class="p-3 bg-yellow-50 rounded-lg mb-2"><span class="text-sm font-semibold text-yellow-700">‚ö†Ô∏è '+s.name+' ‚Äì Conversion unter 20%</span><p class="text-xs text-yellow-600">'+s.beratungenKW+' Beratungen, nur '+s.verkauftKW+' Abschluesse. Verkaufsschulung empfohlen.</p></div>';
                });
                al.innerHTML = alh || '<p class="text-sm text-green-600">‚úÖ Alle Standorte verkaufen aktiv</p>';
            }
        }

        // === HQ HANDLUNGSBEDARF (konsolidiert) ===
        function renderHqAktionen() {
            var aktionen = [];
            hqStandorte.forEach(function(s) {
                if(s.leadPerf===0) aktionen.push({prio:1,bereich:'Standort',standort:s.name,text:'Standort inaktiv ‚Äì Nachfolger/Reaktivierung noetig',color:'bg-gray-800 text-white'});
                if(s.strategieStatus==='missing' && s.umsatzIst>0) aktionen.push({prio:1,bereich:'Strategie',standort:s.name,text:'Marketing- & Einkaufsstrategie fehlt ‚Äì Termin vereinbaren',color:'bg-red-600 text-white'});
                if(s.vororderStatus==='open' && s.umsatzIst>0) aktionen.push({prio:2,bereich:'Einkauf',standort:s.name,text:'Keine Vororder 2026 platziert ‚Äì dringend Gespraech fuehren',color:'bg-red-500 text-white'});
                if(s.rohertrag>0 && s.rohertrag<32) aktionen.push({prio:2,bereich:'Controlling',standort:s.name,text:'Rohertrag kritisch ('+s.rohertrag+'%) ‚Äì Massnahmenplan erstellen',color:'bg-red-500 text-white'});
                if(s.rabattQuote>10) aktionen.push({prio:2,bereich:'Verkauf',standort:s.name,text:'Rabattquote '+s.rabattQuote+'% ‚Äì Schulung Dreingaben vs. Rabatte',color:'bg-red-400 text-white'});
                if(s.leadPerf>0 && s.leadPerf<50) aktionen.push({prio:3,bereich:'Marketing',standort:s.name,text:'Lead-Performance '+s.leadPerf+'% ‚Äì Budget/Strategie pruefen',color:'bg-orange-500 text-white'});
                if(s.offeneTickets>=4) aktionen.push({prio:3,bereich:'Support',standort:s.name,text:s.offeneTickets+' offene Tickets ‚Äì Abarbeitung priorisieren',color:'bg-yellow-500 text-gray-800'});
                if(s.bwaAuffaellig && s.rohertrag>=32) aktionen.push({prio:4,bereich:'Controlling',standort:s.name,text:s.bwaAuffaellig,color:'bg-yellow-400 text-gray-800'});
                if(s.strategieStatus==='pending') aktionen.push({prio:4,bereich:'Strategie',standort:s.name,text:'Strategie-Vereinbarung noch ausstehend ‚Äì nachfassen',color:'bg-yellow-300 text-gray-800'});
            });
            aktionen.sort(function(a,b){return a.prio-b.prio;});

            var kpi = document.getElementById('hqAktKpis');
            if(kpi) {
                var p1 = aktionen.filter(function(a){return a.prio<=2;}).length;
                var p2 = aktionen.filter(function(a){return a.prio===3;}).length;
                var p3 = aktionen.filter(function(a){return a.prio>=4;}).length;
                kpi.innerHTML = '<div class="vit-card p-5"><p class="text-xs text-gray-400 uppercase">Aktionen gesamt</p><p class="text-2xl font-bold text-gray-800">'+aktionen.length+'</p></div>'
                    +'<div class="vit-card p-5 border-l-4 border-red-500"><p class="text-xs text-gray-400 uppercase">üî¥ Kritisch</p><p class="text-2xl font-bold text-red-600">'+p1+'</p></div>'
                    +'<div class="vit-card p-5 border-l-4 border-orange-500"><p class="text-xs text-gray-400 uppercase">üü† Wichtig</p><p class="text-2xl font-bold text-orange-600">'+p2+'</p></div>'
                    +'<div class="vit-card p-5 border-l-4 border-yellow-400"><p class="text-xs text-gray-400 uppercase">üü° Beobachten</p><p class="text-2xl font-bold text-yellow-600">'+p3+'</p></div>';
            }

            var list = document.getElementById('hqAktionenList');
            if(list) {
                var lh = '';
                aktionen.forEach(function(a) {
                    lh += '<div class="vit-card p-4 flex items-center space-x-4 hover:shadow-md transition">';
                    lh += '<span class="'+a.color+' text-[10px] px-2.5 py-1 rounded-full font-bold whitespace-nowrap">'+a.bereich+'</span>';
                    lh += '<div class="flex-1"><p class="text-sm font-semibold text-gray-800">'+a.standort+'</p><p class="text-xs text-gray-500">'+a.text+'</p></div>';
                    lh += '<span class="text-xs text-gray-400 whitespace-nowrap">Prio '+(a.prio<=2?'üî¥':a.prio===3?'üü†':'üü°')+'</span>';
                    lh += '</div>';
                });
                list.innerHTML = lh || '<div class="text-center py-12 text-gray-400"><p class="text-4xl mb-2">‚úÖ</p><p>Kein Handlungsbedarf ‚Äì alles laeuft!</p></div>';
            }
        }

        // Hook HQ views into showView
        var origShowView2 = showView;
        showView = function(v) {
            // Rechtepr√ºfung
            if(!hasAccess(v)) {
                alert('Kein Zugriff auf diesen Bereich mit Ihrer aktuellen Rolle.');
                return;
            }
            // Redirect 'home' to HQ Cockpit when in HQ mode
            if(v==='home' && currentRole==='hq') { v='hqCockpit'; }
            origShowView2(v);
            if(v==='hqCockpit') renderHqCockpit();
            if(v==='hqStandorte') renderHqStandorte();
            if(v==='hqFinanzen') renderHqFinanzen();
            if(v==='hqMarketing') renderHqMarketing();
            if(v==='hqEinkauf') renderHqEinkauf();
            if(v==='hqVerkauf') renderHqVerkauf();
            if(v==='hqAktionen') renderHqAktionen();
            if(v==='hqKomm'){showView('hqKommando');showKommandoTab('kommunikation');return;}
            if(v==='hqKampagnen'){showView('hqKommando');showKommandoTab('kampagnen');return;}
            if(v==='hqDokumente'){showView('hqKommando');showKommandoTab('dokumente');return;}
            if(v==='hqKalender'){showView('hqKommando');showKommandoTab('kalender');return;}
            if(v==='hqAufgaben'){showView('hqKommando');showKommandoTab('aufgaben');return;}
            if(v==='hqAuswertung') renderHqAuswertung();
            if(v==='hqWissen') renderHqWissen();
            if(v==='hqSupport') renderHqSupport();
            if(v==='hqIdeen') renderHqIdeen();
            if(v==='hqShop') renderHqShop();
            if(v==='hqEinstellungen') renderHqEinstellungen();
            if(v==='mitarbeiter') renderPartnerMitarbeiter();
            if(v==='hqKommando') renderKommandozentrale();
            if(v==='kalender') renderKalender();
            if(v==='todo') renderTodos();
            if(v==='notifications') renderNotifications('all');
        };

        // === MOBILE SIDEBAR ===
        function toggleMobileSidebar() {
            var sidebar = document.getElementById('sidebarNav');
            var overlay = document.getElementById('sidebarOverlay');
            if(sidebar.classList.contains('mobile-open')) {
                sidebar.classList.remove('mobile-open');
                overlay.classList.remove('active');
            } else {
                sidebar.classList.add('mobile-open');
                overlay.classList.add('active');
            }
        }
        function closeMobileSidebar() {
            var sidebar = document.getElementById('sidebarNav');
            var overlay = document.getElementById('sidebarOverlay');
            if(sidebar) sidebar.classList.remove('mobile-open');
            if(overlay) overlay.classList.remove('active');
        }
        // Auto-close sidebar on navigation (mobile)
        var origShowViewMobile = showView;
        showView = function(v) {
            closeMobileSidebar();
            origShowViewMobile(v);
        };

        // === VIEW MODE SWITCHER (Partner vs HQ) ===
        function switchViewMode(mode) {
            var isHQ = mode === 'hq';

            if(isHQ) {
                currentRole = 'hq';
                // Keep original roles but add hq
                if(currentRoles.indexOf('hq') < 0) currentRoles.push('hq');
            } else {
                // Remove hq from roles, restore original
                currentRoles = currentRoles.filter(function(r){ return r !== 'hq'; });
                if(currentRoles.length === 0) currentRoles = ['inhaber'];
                currentRole = currentRoles[0];
            }

            try { updateUIForRole(); } catch(e) { console.warn(e); }
            try { applyModulStatus(); } catch(e) { console.warn(e); }

            if(isHQ) {
                showView('hqCockpit');
            } else {
                showView('home');
            }
        }

        // Init: show partner mode by default
        switchViewMode('partner_grafrath');

        // === SOCIAL MEDIA LOCAL HERO ===
        var smThemen = [
            {id:'c001',thema:'Eure Kundenstories',kat:'Story',schwierig:'leicht',done:false,
                beispiel:null,
                hook:['‚ÄûWas hat euch am meisten ueberrascht nach dem Kauf?"','‚ÄûUnser Kunde faehrt jetzt jeden Tag mit dem Rad zur Arbeit ‚Äì und hat uns das geschrieben:"'],
                hauptteil:'Kunden vor oder im Laden nach ihrer Erfahrung fragen. Was hat sich veraendert, seit sie das Rad haben? Wie fuehlt sich der Alltag an? Einfach authentisch erzaehlen lassen.',
                cta:'Komm vorbei und werde Teil der vit:bikes Community. Wir freuen uns auf deine Geschichte!',
                hqTipp:'Kurzes, ehrliches Statement vom Kunden ist Gold wert. Handy aufs Stativ, Kunde davor ‚Äì 30 Sekunden reichen.'
            },
            {id:'c002',thema:'Vario-Sattelstuetze: Lifehack fuer die Ampel',kat:'Technik',schwierig:'leicht',done:false,
                beispiel:'https://www.instagram.com/reel/example_c002/',
                hook:['‚ÄûDu stehst an der Ampel und kommst kaum vom Sattel?"','‚ÄûDieser eine Hebel veraendert alles beim Stadtradeln."'],
                hauptteil:'Zeige die Vario-Sattelstuetze in Aktion: Hebel druecken, Sattel runter, bequem stehen. Erklaere kurz: Nicht nur fuers Gelaende, auch in der Stadt mega praktisch. Verschiedene Modelle erwaehnen.',
                cta:'Vario-Sattelstuetze nachruestbar ‚Äì komm vorbei, wir zeigen dir welche an dein Rad passt.',
                hqTipp:'Am besten direkt vor dem Laden an der Strasse drehen. Reale Ampel-Situation wirkt authentisch.'
            },
            {id:'c003',thema:'Erzaehl was Schoenes! Positive Kundenerfahrung',kat:'Story',schwierig:'leicht',done:false,
                beispiel:null,
                hook:['‚ÄûWas war euer schoenster Moment mit einem Kunden?"','‚ÄûManchmal passieren im Laden Dinge, die kann man nicht planen."'],
                hauptteil:'Erzaehle eine persoenliche, positive Erfahrung mit einem Kunden. Was hat dich beruehrt, ueberrascht, gluecklich gemacht? Authentisch und emotional.',
                cta:'Bei uns geht es nicht nur ums Rad ‚Äì sondern um euch. Kommt vorbei!',
                hqTipp:'Kamera auf Stativ, direkt in die Kamera sprechen. Persoenlich und ehrlich ‚Äì das kommt am besten an.'
            },
            {id:'c008',thema:'Warum das Systemgewicht beim Radfahren zaehlt',kat:'Beratung',schwierig:'mittel',done:false,
                beispiel:null,
                hook:['‚ÄûAlle reden ueber Radgewicht ‚Äì aber was wirklich zaehlt, ist das Systemgewicht."','‚Äû15 kg Rad oder 18 kg? Warum der Unterschied kleiner ist als du denkst."'],
                hauptteil:'Erklaere Systemgewicht = Fahrer + Gepaeck + Rad. Zeige: 3 kg Unterschied am Rad machen bei 100 kg Systemgewicht nur 3% aus. Viel wichtiger: Ergonomie, Komfort, Antrieb. Beim E-Bike relativiert der Motor das Gewicht zusaetzlich.',
                cta:'Wir beraten dich ganzheitlich ‚Äì nicht nur nach Gewicht. Komm zur Probefahrt!',
                hqTipp:'Mit einer Waage im Laden visualisieren. Rad draufstellen, dann Rucksack dazu ‚Äì der Aha-Effekt kommt von selbst.'
            },
            {id:'c015',thema:'Unsere Bedarfsanalyse',kat:'Beratung',schwierig:'leicht',done:true,
                beispiel:null,
                hook:['‚ÄûBevor wir dir ein Rad zeigen, stellen wir erstmal Fragen."','‚ÄûDie wichtigste Phase beim Radkauf? Bevor du ueberhaupt aufsteigst."'],
                hauptteil:'Zeige den Beratungsbogen, erklaere die Fragen: Wie oft faehrst du? Welche Strecken? Welcher Untergrund? Koerpergroesse? Beschwerden? Zeige wie du mit dem Kunden zusammen die Beduerfnisse herausarbeitest.',
                cta:'Individuelle Beratung statt Massenware. Vereinbare deinen Beratungstermin!',
                hqTipp:'Beratungssituation nachstellen mit Kollege als Kunde. Natuerlich und locker.'
            },
            {id:'c018',thema:'Aufgeschobener Service wird teuer',kat:'Werkstatt',schwierig:'leicht',done:false,
                beispiel:null,
                hook:['‚ÄûDiesen Fehler machen 80% aller Radfahrer."','‚ÄûKleine Wartung jetzt oder grosse Reparatur spaeter ‚Äì du hast die Wahl."'],
                hauptteil:'Zeige Beispiele: Verschlissene Kette zerstoert Ritzel (30‚Ç¨ vs. 150‚Ç¨). Abgefahrene Bremsbelaege beschaedigen Scheibe. Platter Reifen durch kaputten Mantel. Immer die guenstige Wartung vs. die teure Folge-Reparatur gegenueberstellen.',
                cta:'Mach einen Termin zur Inspektion ‚Äì bevor es teuer wird. Link in Bio!',
                hqTipp:'Verschleissteile nebeneinander legen: alt vs. neu. Der visuelle Vergleich wirkt sofort.'
            },
            {id:'c019',thema:'Wie eine Vermessung bei uns ablaeuft',kat:'Beratung',schwierig:'mittel',done:true,
                beispiel:null,
                hook:['‚ÄûIn 15 Minuten weisst du mehr ueber deinen Koerper als in 15 Jahren Radfahren."','‚ÄûRadfahren tut weh? Dann stimmt die Vermessung nicht."'],
                hauptteil:'Zeige den Ablauf Schritt fuer Schritt: Beinlaenge messen, Sitzknochenvermessung, Oberkoerper-Flexibilitaet, Ergebnis erklaeren, Rad einstellen. Zeige die Messgeraete und was sie aussagen.',
                cta:'Deine persoenliche Vermessung wartet. Buch deinen Termin ‚Äì kostenlos beim Neukauf!',
                hqTipp:'Am besten eine echte Vermessung mitfilmen (mit Einverstaendnis des Kunden natuerlich).'
            },
            {id:'c021',thema:'Entspannt bergauf fahren',kat:'Tipps',schwierig:'leicht',done:false,
                beispiel:null,
                hook:['‚ÄûBergauf fahren und dabei laecheln? Geht!"','‚ÄûDie meisten schalten zu spaet ‚Äì deswegen wird es anstrengend."'],
                hauptteil:'Tipps: Frueh genug runterschalten, gleichmaessige Trittfrequenz 70-80, Oberkoerper locker, Gewicht nach vorne. Beim E-Bike: Richtige Unterstuetzungsstufe waehlen, nicht im hoechsten Modus dauerhaft fahren.',
                cta:'Komm zur Probefahrt und erlebe wie entspannt E-Biken bergauf sein kann!',
                hqTipp:'Am besten draussen an einem kleinen Huegel drehen. Vorher-Nachher mit richtigem vs. falschem Gang.'
            },
            {id:'C024',thema:'Vorstellung vit:Fahrspassgarantie',kat:'USP',schwierig:'leicht',done:false,
                beispiel:null,
                hook:['‚ÄûWann faehrt man gerne Fahrrad?"','‚ÄûWenn alles passt."'],
                hauptteil:'Beim Neuradkauf gibt es unsere Fahrspassgarantie kostenlos dazu: 3D-Vermessung, Rad perfekt eingestellt, 4 Wochen Rueckgaberecht. Werkstatt max. 48 Stunden ‚Äì sonst Leihrad. Kleine Nachjustierungen 3 Monate gratis. Zubehoer montieren wir auch spaeter kostenlos.',
                cta:'Am Ende gehts nur darum: Dass Radfahren Spass macht. Komm vorbei!',
                hqTipp:'Elementarer USP! Jeder Standort sollte das drehen. Einfach die 5 Punkte durchgehen, laechelnd.'
            },
            {id:'c022',thema:'Akku im Winter richtig nutzen',kat:'Technik',schwierig:'mittel',done:true,
                beispiel:null,
                hook:['‚ÄûDein E-Bike-Akku leidet im Winter ‚Äì wenn du diesen Fehler machst."','‚ÄûWeniger Reichweite bei Kaelte? So holst du das Maximum raus."'],
                hauptteil:'Akku bei Zimmertemperatur lagern und erst kurz vor Fahrt einsetzen. Nicht unter 0¬∞C laden. Eco-Modus nutzt bei Kaelte mehr als Turbo. Akku nie komplett leer fahren im Winter. Kontakte sauber halten.',
                cta:'Fragen zum Akku? Komm vorbei oder ruf an ‚Äì wir helfen gerne!',
                hqTipp:'Kann man gut im Laden drehen mit Akku in der Hand. Thermometer daneben stellen als Effekt.'
            },
            {id:'c025',thema:'Sicher anfahren im Winter',kat:'Tipps',schwierig:'leicht',done:false,
                beispiel:null,
                hook:['‚ÄûDer gefaehrlichste Moment im Winter? Die ersten 3 Meter."','‚ÄûSo faehrst du sicher los wenn es glatt ist."'],
                hauptteil:'Niedrige Unterstuetzungsstufe beim Anfahren. Sanft in die Pedale, nicht ruckartig. Sattel etwas tiefer fuer bessere Standsicherheit. Reifendruck leicht reduzieren fuer mehr Grip. Immer beide Bremsen gleichmaessig.',
                cta:'Komm zum Winter-Check ‚Äì wir pruefen Bremsen, Reifen und Licht!',
                hqTipp:'Draussen bei echtem Winterwetter drehen ‚Äì Authentizitaet schlaegt Studioluft.'
            },
            {id:'c027',thema:'Einfach Bremsbelaege selber tauschen',kat:'Werkstatt',schwierig:'mittel',done:false,
                beispiel:'https://www.instagram.com/reel/DTKkhQjjVoT/',
                hook:['‚ÄûBremsbelaege wechseln ist kein Hexenwerk ‚Äì wenn man einen wichtigen Schritt kennt."','‚ÄûViele scheitern beim Bremsbelagwechsel an einem Detail: den Bremskolben."'],
                hauptteil:'Bremsbelaege sind Verschleissteile. Abgefahren = schlechtere Bremsleistung. Neue sind dicker, Kolben stehen weiter draussen ‚Üí muessen zurueckgedrueckt werden. Ablauf: Rad sicher abstellen, Vorderrad ausbauen, alte Belaege raus, Kolben vorsichtig zurueckdruecken (Kunststoff-Montierhebel), neue Belaege rein, Sicherung montieren, Vorderrad einsetzen, Bremse mehrfach ziehen.',
                cta:'Bei Unsicherheit lieber kurz stoppen und bei uns vorbeikommen. Bremsen sind sicherheitsrelevant!',
                hqTipp:'Super einfaches und erfolgreiches Video mit viel Mehrwert. Das kann jeder aus der Werkstatt nachmachen! üí™'
            },
            {id:'c028',thema:'Schwalbe Click Valve Ventil',kat:'Technik',schwierig:'leicht',done:false,
                beispiel:null,
                hook:['‚ÄûReifen aufpumpen nervt? Dieses Ventil aendert alles."','‚ÄûKlick ‚Äì und die Pumpe sitzt perfekt. Kein Fummelei mehr."'],
                hauptteil:'Zeige das Click-Valve in Aktion: Aufstecken, Klick, pumpen, fertig. Vergleiche mit herkoemmlichem Ventil (Fummelei, Luft entweicht). Erwaehne: Kompatibel mit allen Schwalbe-Schlaeuchen, einfach nachzuruesten.',
                cta:'Click Valve nachruessten? Haben wir da ‚Äì komm vorbei oder bestell im Shop!',
                hqTipp:'Kurzes Vergleichsvideo: Alt vs. Neu. Der Unterschied verkauft sich von selbst.'
            },
            {id:'c033',thema:'Warum die richtige Rahmengroesse entscheidend ist',kat:'Beratung',schwierig:'mittel',done:false,
                beispiel:null,
                hook:['‚ÄûDas falsche Rad in der richtigen Groesse ist besser als das richtige Rad in der falschen."','‚ÄûKnieschmerzen, Rueckenschmerzen, Nackenschmerzen ‚Äì eine Ursache."'],
                hauptteil:'Zeige zwei gleiche Raeder in verschiedenen Groessen. Erklaere was passiert bei zu gross (Ueberstreckung, Nacken) und zu klein (Knie, Ruecken). Zeige wie ihr die richtige Groesse ermittelt (nicht nur nach Koerpergroesse!).',
                cta:'Sichere Groessenberatung bei uns ‚Äì kostenlos und unverbindlich.',
                hqTipp:'Am besten mit zwei Raedern nebeneinander und einer Person die beide testet.'
            },
            {id:'c038',thema:'Das ist mein Lieblingsprodukt',kat:'Story',schwierig:'leicht',done:false,
                beispiel:null,
                hook:['‚ÄûWenn ich nur ein Produkt aus dem Laden mitnehmen duerfte..."','‚ÄûJeder im Team hat einen Favoriten ‚Äì das ist meiner:"'],
                hauptteil:'Zeig dein persoenliches Lieblingsprodukt (muss kein Rad sein ‚Äì kann Helm, Schloss, Licht, Tasche sein). Erklaere WARUM es dein Favorit ist. Was macht es besonders? Persoenliche Geschichte dazu.',
                cta:'Was ist dein Must-Have? Komm vorbei und lass dich inspirieren!',
                hqTipp:'Super einfach zu drehen, sehr persoenlich. Ideal fuer Mitarbeiter die zum ersten Mal vor der Kamera stehen.'
            },
            {id:'c060',thema:'So vielseitig ist das vit:bikes Sortiment',kat:'USP',schwierig:'leicht',done:false,
                beispiel:null,
                hook:['‚ÄûVon Stadtrad bis Mountainbike ‚Äì alles unter einem Dach."','‚ÄûWir haben nicht nur E-Bikes. Lass mich dir zeigen was noch geht."'],
                hauptteil:'Schneller Walk-Through durch den Laden. Zeige verschiedene Kategorien: City, Trekking, E-MTB, Cargo, Kinder. Betone die Markenvielfalt und dass fuer jeden was dabei ist.',
                cta:'Egal was du suchst ‚Äì bei uns findest du es. Oder wir bestellen es fuer dich!',
                hqTipp:'Dynamisch durch den Laden laufen, Kamera auf Gimbal oder einfach in der Hand. Schnelle Schnitte machen wir.'
            },
            {id:'c061',thema:'Knacken am Tretlager ‚Äì was steckt dahinter?',kat:'Werkstatt',schwierig:'mittel',done:false,
                beispiel:null,
                hook:['‚ÄûDein Rad knackt beim Treten? Das kann 5 verschiedene Ursachen haben."','‚ÄûKnackgeraeuesche sind nervig ‚Äì aber meistens einfach zu beheben."'],
                hauptteil:'Haeufigste Ursachen: Lose Pedalgewinde, Tretlager nachziehen, Sattelklemme, Kettenblattschrauben, Schnellspanner. Zeige wie man systematisch die Ursache eingrenz. Einfache Loesungen vs. wann zum Profi.',
                cta:'Knacken nervt ‚Äì wir finden die Ursache. Termin vereinbaren!',
                hqTipp:'In der Werkstatt drehen, dabei die verschiedenen Stellen am Rad zeigen und abklopfen.'
            },
            {id:'c063',thema:'Software-Update ‚Äì wie fuehlt sich das an?',kat:'Technik',schwierig:'leicht',done:false,
                beispiel:null,
                hook:['‚ÄûDein E-Bike bekommt Updates wie dein Handy."','‚ÄûNach dem Update fuehlt sich mein Rad an wie neu ‚Äì kein Witz."'],
                hauptteil:'Zeige den Update-Prozess: Rad anschliessen, Software pruefen, Update starten. Erklaere was sich aendert: Neue Fahrmodi, bessere Motorsteuerung, Fehlerbehebung. Vergleiche vorher/nachher wenn moeglich.',
                cta:'Kostenloses Software-Update bei uns ‚Äì einfach Termin machen!',
                hqTipp:'Am besten den Bildschirm zeigen waehrend das Update laeuft. Vorher/Nachher Fahreindruck waere top.'
            },
            {id:'c064',thema:'Der Aha-Moment bei der Probefahrt',kat:'Beratung',schwierig:'leicht',done:false,
                beispiel:null,
                hook:['‚ÄûDieser eine Moment auf der Probefahrt ‚Äì danach will jeder ein E-Bike."','‚ÄûIch sehe es jedes Mal: Dieses Grinsen nach den ersten 50 Metern."'],
                hauptteil:'Beschreibe den typischen Ablauf: Kunde steigt auf, erste Pedalumdrehung, Motor schiebt an, das Laecheln kommt. Erklaere warum die Probefahrt so wichtig ist ‚Äì Zahlen und Daten ersetzen nicht das Gefuehl.',
                cta:'Erleb es selbst ‚Äì kostenlose Probefahrt jederzeit bei uns!',
                hqTipp:'Ideal: Filmst den Kunden (mit Erlaubnis!) beim ersten Moment auf dem E-Bike. Das Laecheln sagt alles.'
            },
            {id:'c065',thema:'Bremsen-Check in der Werkstatt',kat:'Werkstatt',schwierig:'leicht',done:false,
                beispiel:null,
                hook:['‚ÄûWann hast du zuletzt deine Bremsen checken lassen?"','‚Äû2 Minuten Check ‚Äì koennen Leben retten."'],
                hauptteil:'Zeige den schnellen Bremsen-Check: Belagstaerke pruefen, Scheibe auf Verschleiss kontrollieren, Bremsfl√ºssigkeit checken, Zugseil spannen. Was sind Warnzeichen? Quietschen, langer Bremsweg, Hebel geht bis zum Lenker.',
                cta:'Bremsen-Check bei uns ‚Äì schnell, gruendlich, fuer deine Sicherheit.',
                hqTipp:'Werkstatt-Setting, Nahaufnahme der Bremsbelaege. Vergleich: Neu vs. Verschlissen.'
            },
            {id:'c068',thema:'Warum wir Kunden auch mal vom Kauf abraten',kat:'USP',schwierig:'mittel',done:false,
                beispiel:null,
                hook:['‚ÄûJa, manchmal sagen wir: Kauf das Rad nicht."','‚ÄûEin guter Berater verkaeuft dir nicht das teuerste ‚Äì sondern das richtige."'],
                hauptteil:'Erklaere wann ihr abratet: Rad passt nicht zur Nutzung, Kunde braucht eigentlich eine andere Kategorie, Budget stimmt nicht (lieber gut gebraucht als schlecht neu). Das schafft Vertrauen und kommt langfristig zurueck.',
                cta:'Ehrliche Beratung statt Verkaufsdruck. Das ist vit:bikes.',
                hqTipp:'Sehr starkes Thema fuer Vertrauensaufbau. Persoenlich in die Kamera, ruhig und ehrlich.'
            },
            {id:'c069',thema:'Akku richtig laden: die 5 groessten Fehler',kat:'Technik',schwierig:'mittel',done:false,
                beispiel:null,
                hook:['‚ÄûDu laedt deinen E-Bike-Akku falsch ‚Äì und merkst es nicht."','‚Äû5 Fehler die deinen Akku schneller altern lassen."'],
                hauptteil:'Fehler: 1) Immer auf 100% laden (besser 80%). 2) Komplett leer fahren. 3) Bei Hitze/Kaelte laden. 4) Billig-Ladegeraet nutzen. 5) Akku monatelang voll/leer lagern. Zu jedem Fehler die Loesung.',
                cta:'Fragen zum Akku? Wir beraten dich gerne ‚Äì auch nach dem Kauf!',
                hqTipp:'5 Punkte = 5 kurze Cuts. Kann man gut nummeriert darstellen (Finger zeigen oder Zahlen einblenden).'
            },
            {id:'c073',thema:'So laeuft ein professioneller Werkstatt-Check ab',kat:'Werkstatt',schwierig:'leicht',done:true,
                beispiel:null,
                hook:['‚Äû30 Punkte in 45 Minuten ‚Äì so gruendlich ist unser Check."','‚ÄûDein Rad bekommt bei uns die volle Behandlung."'],
                hauptteil:'Zeige die einzelnen Pruefpunkte: Bremsen, Schaltung, Reifendruck, Speichenspannung, Tretlager, Steuersatz, Beleuchtung, Akku-Check (E-Bike). Erklaere was geprueft wird und warum.',
                cta:'Dein Rad verdient den besten Service. Termin zur Inspektion jetzt buchen!',
                hqTipp:'Top-Content! Einmal die Werkstatt-Arbeit filmen, verschiedene Stationen zeigen.'
            },
            {id:'c074',thema:'Danke zu 10.000 Follower',kat:'Story',schwierig:'leicht',done:false,
                beispiel:null,
                hook:['‚Äû10.000! Danke an jeden einzelnen von euch."','‚ÄûWas als kleiner Kanal angefangen hat..."'],
                hauptteil:'Persoenliches Danke-Video. Rueckblick: Wie alles angefangen hat, Lieblingsmomente, Community-Highlights. Was kommt als naechstes?',
                cta:'Feiert mit uns ‚Äì kommt im Laden vorbei, es gibt eine kleine Ueberraschung!',
                hqTipp:'Meilenstein-Videos performen super. Team zusammen vor die Kamera, Konfetti optional üéâ'
            },
            {id:'c080',thema:'Leasing vs. Kauf ‚Äì was ist besser?',kat:'Beratung',schwierig:'mittel',done:false,
                beispiel:null,
                hook:['‚ÄûJobRad, Bikeleasing, oder doch bar zahlen?"','‚ÄûSo viel sparst du wirklich beim Leasing ‚Äì Klartext."'],
                hauptteil:'Vergleiche: Steuerersparnis beim Leasing (bis 40%), dafuer gebunden. Barkauf: Sofort deins, verhandelbar. Finanzierung: Flexibel, aber Zinsen. Fuer wen lohnt sich was? Rechenbeispiel mit konkreten Zahlen.',
                cta:'Wir rechnen es mit dir durch ‚Äì kostenlos und unverbindlich. Komm vorbei!',
                hqTipp:'Mit Taschenrechner oder Whiteboard. Zahlen sichtbar machen ueberzeugt.'
            },
            {id:'c081',thema:'Rueckenschmerzen auf dem E-Bike',kat:'Ergonomie',schwierig:'leicht',done:false,
                beispiel:null,
                hook:['‚ÄûRueckenschmerzen nach jeder Fahrt? Das muss nicht sein."','‚Äû3 Einstellungen die deinen Ruecken sofort entlasten."'],
                hauptteil:'Haeufigste Ursachen: Sattel zu niedrig/hoch, Lenker zu weit weg, falsche Rahmengroesse. Schnelle Fixes: Sattelhoehe anpassen, Vorbau kuerzer/hoeher, ergonomische Griffe. Wann professionelle Vermessung noetig.',
                cta:'Schmerzfrei Radfahren ist moeglich. Komm zur Ergonomie-Beratung!',
                hqTipp:'Person zeigt falsche vs. richtige Sitzposition. Der Unterschied ist sofort sichtbar.'
            },
            {id:'c085',thema:'Probefahren reicht nicht',kat:'USP',schwierig:'leicht',done:false,
                beispiel:null,
                hook:['‚ÄûDu warst Probefahren und denkst: Passt? Vielleicht nicht."','‚ÄûWarum 10 Minuten Probefahrt nicht reichen fuer die richtige Entscheidung."'],
                hauptteil:'Probefahrt gibt ersten Eindruck, aber: Sitzposition zeigt Probleme erst nach 30+ Minuten. Deshalb machen wir vorab Vermessung. Rueckgaberecht nach 4 Wochen als Sicherheitsnetz. Erst im Alltag zeigt sich ob das Rad passt.',
                cta:'Bei uns hast du 4 Wochen zum Testen. Fahrspassgarantie inklusive!',
                hqTipp:'Starkes USP-Video. Kurz und knackig die Fahrspassgarantie erwaehnen.'
            },
            {id:'c088',thema:'Erklaere die MyO-Konfiguration von Orbea',kat:'Technik',schwierig:'schwer',done:false,
                beispiel:null,
                hook:['‚ÄûDein Rad, deine Farbe, deine Ausstattung ‚Äì so geht Individualisierung."','‚ÄûOrbea MyO: Wie du dein Traumrad selbst zusammenstellst."'],
                hauptteil:'Zeige den MyO-Konfigurator am Bildschirm oder Tablet. Schritt fuer Schritt: Modell waehlen, Farbe anpassen, Komponenten auswaehlen. Lieferzeit erwaehnen. Vorteil: Einzigartiges Rad, kein Aufpreis fuer Farbwahl.',
                cta:'Lust auf dein individuelles Orbea? Wir konfigurieren es gemeinsam mit dir!',
                hqTipp:'Bildschirmaufnahme vom Konfigurator + Reaktion des Beraters. Oder Kunde konfiguriert live.'
            },
            {id:'c089',thema:'Die Raduebergabe bei vit:bikes',kat:'USP',schwierig:'leicht',done:false,
                beispiel:null,
                hook:['‚ÄûDie Uebergabe ist der schoenste Moment ‚Äì fuer uns und fuer euch."','‚ÄûDein neues Rad wartet. So uebergeben wir es dir."'],
                hauptteil:'Zeige den Ablauf: Rad nochmal komplett gecheckt, alles eingestellt, Funktionen erklaert (E-Bike: Display, Modi, Akku). Erste gemeinsame Runde. Fotos fuer Social Media (mit Erlaubnis). Serviceplan erklaeren.',
                cta:'Bald ist dein Rad dran. Wir freuen uns darauf!',
                hqTipp:'Die strahlenden Gesichter bei der Uebergabe sind unbezahlbar. Authentische Freude filmen.'
            },
            {id:'c091',thema:'Sitzknochenvermessung',kat:'Ergonomie',schwierig:'mittel',done:false,
                beispiel:null,
                hook:['‚ÄûDein Po schmerzt beim Radfahren? Dein Sattel ist nicht schuld ‚Äì du sitzt falsch."','‚ÄûDie wichtigste Zahl beim Sattelkauf: Dein Sitzknochenabstand."'],
                hauptteil:'Erklaere: Jeder hat andere Sitzknochen. Breite messen (Gel-Pad oder Wellpappe). Richtige Sattelbreite ableiten. Zeige verschiedene Saettel fuer verschiedene Breiten. Sitzposition sportlich vs. aufrecht macht auch einen Unterschied.',
                cta:'Kostenlose Sitzknochenvermessung bei uns ‚Äì in 5 Minuten zum perfekten Sattel!',
                hqTipp:'Vermessungs-Prozess filmen. Der Moment wenn der Kunde die Zahl erfaehrt ist immer spannend.'
            },
            {id:'c095',thema:'Kette reinigen ‚Äì auch im Winter',kat:'Werkstatt',schwierig:'leicht',done:false,
                beispiel:null,
                hook:['‚ÄûIm Winter rostet deine Kette 3x so schnell."','‚Äû5 Minuten Pflege sparen dir 80 Euro Kettenwechsel."'],
                hauptteil:'Zeige: Kette mit Kettenreiniger reinigen, trocknen lassen, frisches Kettenoel auftragen. Im Winter oefter noetig wegen Salz und Naesse. Warnung: Zu viel Oel zieht Schmutz an!',
                cta:'Kettenreiniger und -oel bei uns im Shop. Oder wir machen das fuer dich!',
                hqTipp:'Nahaufnahme der Kette: Schmutzig ‚Üí Sauber. Vorher/Nachher ist super Content.'
            },
            {id:'c096',thema:'Riese & Mueller Vorstellung',kat:'Technik',schwierig:'mittel',done:false,
                beispiel:null,
                hook:['‚ÄûMade in Germany, und das merkt man."','‚ÄûWarum Riese & Mueller Premium ist ‚Äì und es sich lohnt."'],
                hauptteil:'Markenvorstellung: Darmstadt, Handmontage, Qualitaet. Zeige 2-3 Modelle im Laden. Was macht R&M besonders? DualBattery, Vollfederung, Cargo-Loesungen. Fuer wen ideal?',
                cta:'Riese & Mueller Probefahrt bei uns ‚Äì erlebe den Unterschied!',
                hqTipp:'Wenn R&M im Laden steht, direkt dort filmen. Qualitaet zeigen, Details hervorheben.'
            },
            {id:'c099',thema:'Was ist das Smartphone Grip?',kat:'Technik',schwierig:'leicht',done:false,
                beispiel:null,
                hook:['‚ÄûDein Handy am Lenker ‚Äì aber sicher."','‚ÄûNavigation, Musik, Fitness ‚Äì alles auf dem Rad. So befestigst du es richtig."'],
                hauptteil:'Zeige verschiedene Smartphone-Halterungen: Quad Lock, SP Connect, universelle Loesungen. Vor- und Nachteile. Wichtig: Vibrationen koennen Kamera beschaedigen! Anti-Vibrations-Modul erwaehnen.',
                cta:'Smartphone-Halterung nachruestbar ‚Äì wir beraten dich welche passt!',
                hqTipp:'Zeige die Montage und das Einrasten des Handys. Der Klick-Moment ist befriedigend.'
            },
            {id:'c101',thema:'Helmberatung',kat:'Beratung',schwierig:'leicht',done:false,
                beispiel:null,
                hook:['‚ÄûDer beste Helm ist der, den du auch wirklich aufsetzt."','‚Äû95% tragen ihren Helm falsch. Gehoerst du dazu?"'],
                hauptteil:'Richtigen Sitz zeigen: 2 Finger ueber Augenbrauen, Riemen bilden V unter den Ohren, ein Finger zwischen Kinn und Riemen. Verschiedene Typen: City, MTB, Speed-Pedelec. MIPS erklaeren. Wann Helm tauschen (nach Sturz, nach 5 Jahren).',
                cta:'Helmberatung bei uns ‚Äì finde den perfekten Helm fuer dich.',
                hqTipp:'Helm falsch aufsetzen, dann richtig. Der Unterschied ist deutlich und lehrreich.'
            },
            {id:'c103',thema:'Was faehrt vit:bikes? Team stellt ihre Raeder vor',kat:'Story',schwierig:'leicht',done:false,
                beispiel:null,
                hook:['‚ÄûWas fahren eigentlich die, die den ganzen Tag Raeder verkaufen?"','‚ÄûUnser Team zeigt: Das sind unsere persoenlichen Raeder."'],
                hauptteil:'Jedes Teammitglied stellt kurz sein eigenes Rad vor: Was ist es, warum genau das, was ist das Besondere daran? Persoenlich und authentisch.',
                cta:'Welches Rad passt zu dir? Wir helfen dir ‚Äì aus eigener Erfahrung!',
                hqTipp:'Jeder Mitarbeiter 15-20 Sekunden mit seinem Rad. Zusammenschneiden wir. Super Team-Content!'
            }
        ];

        var smRankingData = [
            {name:'Pfaffenhofen',count:7},{name:'Witten',count:6},{name:'Berlin',count:6},
            {name:'Weilheim',count:4},{name:'Grafrath',count:4},{name:'Wachtendonk',count:3},
            {name:'Teisendorf',count:1},{name:'Warendorf',count:1},{name:'Muenster',count:1},{name:'Lohmar',count:1},
            {name:'Karlsdorf',count:0},{name:'Garching',count:0},{name:'Reutlingen',count:0},
            {name:'Holzkirchen',count:0},{name:'Hann. Muenden',count:0},{name:'Zell',count:0},
            {name:'Wesel',count:0},{name:'Rottweil',count:0},{name:'Hamburg',count:0},
            {name:'M-Thalkirchen',count:0},{name:'Muenchen BAL',count:0}
        ];

        // === I18N TRANSLATION SYSTEM ===

        // === NOTIFICATIONS DATA & LOGIC ===
        var notifications = [
            {id:1,type:'hq',icon:'üì¢',title:'Neue Kampagne: Fruehjahrs-Aktion 2026',desc:'Das HQ hat eine neue Kampagne gestartet. Materialien stehen bereit.',time:'vor 15 Min.',read:false,action:'showView(\'marketing\')'},
            {id:2,type:'system',icon:'‚ö†Ô∏è',title:'Ticket #1042 eskaliert',desc:'Kunde Huber wartet seit 5 Tagen auf Rueckmeldung.',time:'vor 1 Std.',read:false,action:'showView(\'support\')'},
            {id:3,type:'hq',icon:'üé¨',title:'Neues Content-Thema verfuegbar',desc:'Thema C035: "Helmberatung" wurde im Local Hero Katalog ergaenzt.',time:'vor 3 Std.',read:false,action:'showView(\'marketing\');showMarketingTab(\'social\')'},
            {id:4,type:'system',icon:'üìä',title:'BWA Januar 2026 verfuegbar',desc:'Die BWA fuer Januar wurde hochgeladen und kann eingesehen werden.',time:'Gestern',read:true,action:'showView(\'controlling\')'},
            {id:5,type:'hq',icon:'üìã',title:'Neue Einkaufsrichtlinie',desc:'Aktualisierte Margen-Empfehlung fuer Q1 2026 verfuegbar.',time:'Gestern',read:true,action:'showView(\'einkauf\')'},
            {id:6,type:'system',icon:'‚úÖ',title:'Onboarding: 70% abgeschlossen',desc:'Du hast 7 von 10 Onboarding-Schritten erledigt.',time:'vor 2 Tagen',read:true,action:'showView(\'onboarding\')'},
            {id:7,type:'hq',icon:'üèÜ',title:'Verkaufs-Ranking: Platz 3!',desc:'Euer Standort ist im Netzwerk-Ranking auf Platz 3 geklettert.',time:'vor 3 Tagen',read:true,action:'showView(\'verkauf\')'},
            {id:8,type:'system',icon:'üîî',title:'Termin morgen: Probefahrt Hr. Mueller',desc:'Morgen um 10:00 Uhr ‚Äì Probefahrt E-MTB geplant.',time:'vor 3 Tagen',read:true,action:'showView(\'kalender\')'}
        ];

        function filterNotif(f) {
            document.querySelectorAll('.notif-filter').forEach(function(b){b.className='notif-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-gray-100 text-gray-600';});
            var btn=document.querySelector('.notif-filter[data-nf="'+f+'"]');
            if(btn)btn.className='notif-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-vit-orange text-white';
            renderNotifications(f);
        }
        function renderNotifications(filter) {
            filter=filter||'all';
            var list=notifications.filter(function(n){
                if(filter==='unread') return !n.read;
                if(filter==='system') return n.type==='system';
                if(filter==='hq') return n.type==='hq';
                return true;
            });
            var el=document.getElementById('notifList'); if(!el)return;
            var h='';
            list.forEach(function(n){
                h+='<div class="vit-card p-4 flex items-start space-x-3 cursor-pointer hover:shadow-md transition '+(n.read?'opacity-70':'')+'" onclick="'+n.action+'">';
                h+='<span class="text-2xl flex-shrink-0">'+n.icon+'</span>';
                h+='<div class="flex-1 min-w-0">';
                h+='<div class="flex items-center space-x-2"><p class="font-semibold text-gray-800 text-sm truncate">'+n.title+'</p>';
                if(!n.read) h+='<span class="notif-dot w-2 h-2 bg-vit-orange rounded-full flex-shrink-0"></span>';
                h+='</div>';
                h+='<p class="text-xs text-gray-500 mt-0.5">'+n.desc+'</p>';
                h+='<p class="text-[10px] text-gray-400 mt-1">'+n.time+'</p>';
                h+='</div>';
                h+='<span class="text-xs px-2 py-0.5 rounded-full '+(n.type==='hq'?'bg-vit-orange text-white':'bg-gray-100 text-gray-500')+'">'+n.type.toUpperCase()+'</span>';
                h+='</div>';
            });
            if(!list.length) h='<div class="text-center py-8 text-gray-400"><p class="text-3xl mb-2">üîî</p><p class="text-sm">Keine Benachrichtigungen</p></div>';
            el.innerHTML=h;
        }

        // === KALENDER DATA & LOGIC ===
        var kalMonth=1; var kalYear=2026; // Feb 2026
        var kalTermine = [
            {id:1,title:'Probefahrt E-MTB Hr. Mueller',date:'2026-02-15',time:'10:00',type:'probefahrt',user:'Max Mustermann',notes:'Orbea Rise im Fokus'},
            {id:2,title:'Team-Meeting Woche',date:'2026-02-17',time:'08:30',type:'meeting',user:'all',notes:'Wochenbesprechung'},
            {id:3,title:'Beratung Fr. Schmidt ‚Äì Pendler-Rad',date:'2026-02-17',time:'14:00',type:'beratung',user:'Laura Schmidt',notes:'Budget ca. 2.000‚Ç¨'},
            {id:4,title:'Werkstatt-Abholung Rennrad',date:'2026-02-18',time:'11:00',type:'werkstatt',user:'Tim Wagner',notes:'Komplettservice fertig'},
            {id:5,title:'Probefahrt Gravel Hr. Becker',date:'2026-02-19',time:'15:00',type:'probefahrt',user:'Max Mustermann',notes:''},
            {id:6,title:'Beratung E-Bike Familie Klein',date:'2026-02-20',time:'10:30',type:'beratung',user:'Laura Schmidt',notes:'2 Raeder, Kinderanhanger'},
            {id:7,title:'Lieferung Orbea Q1-Charge',date:'2026-02-21',time:'07:00',type:'sonstig',user:'all',notes:'12 Raeder, Annahme vorbereiten'},
            {id:8,title:'Team-Meeting Woche',date:'2026-02-24',time:'08:30',type:'meeting',user:'all',notes:''},
            {id:9,title:'Schulung: Bosch Smart System',date:'2026-02-25',time:'09:00',type:'sonstig',user:'all',notes:'Online via Teams, Link im Wissen-Bereich'},
            {id:10,title:'Beratung Hr. Meier ‚Äì E-MTB',date:'2026-02-26',time:'16:00',type:'beratung',user:'Max Mustermann',notes:'Wiederkehrender Kunde'},
            {id:11,title:'Werkstatt-Abholung Tourenrad',date:'2026-02-28',time:'13:00',type:'werkstatt',user:'Tim Wagner',notes:''},
            {id:12,title:'Inventur Q1',date:'2026-03-01',time:'07:00',type:'sonstig',user:'all',notes:'Ganzer Tag eingeplant'},
            {id:13,title:'Beratung Firma TechCorp ‚Äì 5 Bikes',date:'2026-03-03',time:'10:00',type:'beratung',user:'Max Mustermann',notes:'Jobrad-Leasing'}
        ];

        var typeColors = {beratung:'bg-blue-100 text-blue-700 border-blue-300',probefahrt:'bg-green-100 text-green-700 border-green-300',werkstatt:'bg-gray-200 text-gray-700 border-gray-300',meeting:'bg-purple-100 text-purple-700 border-purple-300',sonstig:'bg-orange-100 text-orange-700 border-orange-300'};
        var typeLabels = {beratung:'Beratung',probefahrt:'Probefahrt',werkstatt:'Werkstatt',meeting:'Meeting',sonstig:'Sonstiges'};

        function kalNavMonth(d){kalMonth+=d;if(kalMonth>11){kalMonth=0;kalYear++;}if(kalMonth<0){kalMonth=11;kalYear--;}renderKalender();}

        function renderKalender(){
            var months=['Januar','Februar','M√§rz','April','Mai','Juni','Juli','August','September','Oktober','November','Dezember'];
            document.getElementById('kalMonthTitle').textContent=months[kalMonth]+' '+kalYear;
            var userFilter=(document.getElementById('kalFilterUser')||{}).value||'all';
            var filtered=kalTermine.filter(function(t){
                if(userFilter==='me') return t.user==='Max Mustermann'||t.user==='all';
                return true;
            });

            // Build calendar grid
            var firstDay=new Date(kalYear,kalMonth,1).getDay(); // 0=Sun
            firstDay=firstDay===0?6:firstDay-1; // Convert to Mon=0
            var daysInMonth=new Date(kalYear,kalMonth+1,0).getDate();
            var today=new Date(); var todayStr=today.toISOString().slice(0,10);
            var grid=document.getElementById('kalGrid'); var h='';

            // Empty cells before first day
            for(var i=0;i<firstDay;i++) h+='<div class="min-h-[80px] border-b border-r border-gray-100 p-1 bg-gray-50"></div>';

            for(var d=1;d<=daysInMonth;d++){
                var dateStr=kalYear+'-'+String(kalMonth+1).padStart(2,'0')+'-'+String(d).padStart(2,'0');
                var isToday=dateStr===todayStr;
                var dayTermine=filtered.filter(function(t){return t.date===dateStr;});
                h+='<div class="min-h-[80px] border-b border-r border-gray-100 p-1 '+(isToday?'bg-orange-50':'')+'">';
                h+='<p class="text-xs font-bold '+(isToday?'text-vit-orange':'text-gray-600')+'">'+d+'</p>';
                dayTermine.forEach(function(t){
                    var cls=typeColors[t.type]||'bg-gray-100 text-gray-600';
                    h+='<div class="mt-0.5 px-1 py-0.5 rounded text-[9px] font-semibold truncate border '+cls+'" title="'+t.time+' '+t.title+'">'+t.time.slice(0,5)+' '+t.title.slice(0,15)+'</div>';
                });
                h+='</div>';
            }
            grid.innerHTML=h;

            // Upcoming list
            var upcoming=filtered.filter(function(t){return t.date>=todayStr;}).sort(function(a,b){return a.date>b.date?1:-1;}).slice(0,8);
            var uEl=document.getElementById('kalUpcoming'); var uh='';
            upcoming.forEach(function(t){
                var cls=typeColors[t.type]||'bg-gray-100 text-gray-600';
                var dayNames=['So','Mo','Di','Mi','Do','Fr','Sa'];
                var dd=new Date(t.date); var dayName=dayNames[dd.getDay()];
                uh+='<div class="vit-card p-3 flex items-center space-x-3">';
                uh+='<div class="text-center flex-shrink-0 w-12"><p class="text-xs text-gray-500">'+dayName+'</p><p class="text-lg font-bold text-gray-800">'+parseInt(t.date.slice(8))+'</p><p class="text-[10px] text-gray-400">'+t.date.slice(5,7)+'</p></div>';
                uh+='<div class="flex-1 min-w-0"><p class="font-semibold text-gray-800 text-sm truncate">'+t.title+'</p><p class="text-xs text-gray-500">'+t.time+' Uhr'+(t.user!=='all'?' ¬∑ '+t.user:'')+'</p></div>';
                uh+='<span class="text-[10px] px-2 py-0.5 rounded-full font-semibold '+cls+'">'+typeLabels[t.type]+'</span>';
                uh+='</div>';
            });
            uEl.innerHTML=uh;
        }

        function addKalTermin(){
            var title=document.getElementById('kalNewTitle').value;
            var date=document.getElementById('kalNewDate').value;
            var time=document.getElementById('kalNewTime').value;
            var type=document.getElementById('kalNewType').value;
            if(!title||!date){alert('Bitte Titel und Datum angeben.');return;}
            kalTermine.push({id:kalTermine.length+1,title:title,date:date,time:time||'09:00',type:type,user:'Max Mustermann',notes:document.getElementById('kalNewNotes').value});
            document.getElementById('kalNewModal').classList.add('hidden');
            document.getElementById('kalNewTitle').value='';
            renderKalender();
        }

        // === TODO DATA & LOGIC ===
        var todos = [
            {id:1,title:'Angebot fuer Hr. Mueller fertigstellen',date:'2026-02-14',prio:'hoch',kat:'verkauf',done:false},
            {id:2,title:'Werkstatt-Auftrag #4521 abschliessen',date:'2026-02-14',prio:'normal',kat:'werkstatt',done:false},
            {id:3,title:'Fruehjahrs-Deko im Laden aufbauen',date:'2026-02-13',prio:'niedrig',kat:'marketing',done:false},
            {id:4,title:'Orbea-Bestellung Q2 vorbereiten',date:'2026-02-17',prio:'hoch',kat:'admin',done:false},
            {id:5,title:'Local Hero Video drehen: Bremsbelaege',date:'2026-02-20',prio:'normal',kat:'marketing',done:false},
            {id:6,title:'Kunden-Follow-up: Fr. Schmidt',date:'2026-02-10',prio:'hoch',kat:'verkauf',done:false},
            {id:7,title:'Lieferung Shimano-Teile pruefen',date:'2026-02-12',prio:'normal',kat:'werkstatt',done:true},
            {id:8,title:'BWA Januar mit Steuerberater besprechen',date:'2026-02-11',prio:'normal',kat:'admin',done:true},
            {id:9,title:'Newsletter-Texte ans HQ senden',date:'2026-02-09',prio:'niedrig',kat:'marketing',done:true},
            {id:10,title:'Teammeeting Protokoll schreiben',date:'2026-02-10',prio:'niedrig',kat:'admin',done:true}
        ];
        var currentTodoFilter='all';

        function filterTodos(f){
            currentTodoFilter=f;
            document.querySelectorAll('.todo-filter').forEach(function(b){b.className='todo-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-gray-100 text-gray-600';});
            var btn=document.querySelector('.todo-filter[data-tf="'+f+'"]');
            if(btn)btn.className='todo-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-vit-orange text-white';
            renderTodos();
        }

        function renderTodos(){
            var today='2026-02-14';
            var list=todos.filter(function(t){
                if(currentTodoFilter==='all') return !t.done;
                if(currentTodoFilter==='heute') return !t.done && t.date===today;
                if(currentTodoFilter==='ueberfaellig') return !t.done && t.date<today;
                if(currentTodoFilter==='done') return t.done;
                return true;
            });
            // Update KPIs
            var offen=todos.filter(function(t){return !t.done;}).length;
            var heute=todos.filter(function(t){return !t.done && t.date===today;}).length;
            var ueber=todos.filter(function(t){return !t.done && t.date<today;}).length;
            var done=todos.filter(function(t){return t.done;}).length;
            var kO=document.getElementById('todoKpiOffen');if(kO)kO.textContent=offen;
            var kH=document.getElementById('todoKpiHeute');if(kH)kH.textContent=heute;
            var kU=document.getElementById('todoKpiUeber');if(kU)kU.textContent=ueber;
            var kD=document.getElementById('todoKpiDone');if(kD)kD.textContent=done;
            var badge=document.getElementById('todoSidebarBadge');if(badge)badge.textContent=offen;

            var el=document.getElementById('todoList');if(!el)return;
            var h='';
            var prioIcons={hoch:'üî¥',normal:'üü°',niedrig:'üü¢'};
            var katIcons={verkauf:'üí∞',werkstatt:'üîß',marketing:'üì£',admin:'üìã',sonstig:'üìå'};
            list.sort(function(a,b){var po={hoch:0,normal:1,niedrig:2};return (po[a.prio]||1)-(po[b.prio]||1);});
            list.forEach(function(td){
                var isOver=!td.done && td.date<today;
                h+='<div class="vit-card p-3 flex items-center space-x-3 '+(td.done?'opacity-50':'')+'">';
                    html += '<button onclick="toggleTodo(\x27'+t.id+'\x27)" class="mt-0.5 w-5 h-5 rounded-full border-2 flex items-center justify-center flex-shrink-0 ' + (isErledigt ? 'border-green-500 bg-green-500 text-white' : 'border-gray-300 hover:border-vit-orange') + '"><span class="text-xs">' + (isErledigt ? '‚úì' : '') + '</span></button>';
                if(td.done) h+='<svg class="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/></svg>';
                h+='</button>';
                h+='<div class="flex-1 min-w-0">';
                h+='<p class="font-semibold text-sm '+(td.done?'line-through text-gray-400':'text-gray-800')+'">'+td.title+'</p>';
                h+='<p class="text-[10px] text-gray-500 mt-0.5">'+(katIcons[td.kat]||'')+' '+td.kat+' ¬∑ F√§llig: '+td.date.slice(8)+'.'+td.date.slice(5,7)+'.'+(isOver?' <span class="text-red-500 font-bold">√úBERF√ÑLLIG</span>':'')+'</p>';
                h+='</div>';
                h+='<span class="text-xs">'+prioIcons[td.prio]+'</span>';
                h+='</div>';
            });
            if(!list.length) h='<div class="text-center py-8 text-gray-400"><p class="text-3xl mb-2">‚úÖ</p><p class="text-sm">Keine Aufgaben</p></div>';
            el.innerHTML=h;
        }

        function toggleTodo(id){
            todos.forEach(function(t){if(t.id===id)t.done=!t.done;});
            renderTodos();
        }

        function addTodo(){
            var title=document.getElementById('todoNewTitle').value;
            if(!title){alert('Bitte Aufgabe eingeben.');return;}
            todos.push({id:todos.length+1,title:title,date:document.getElementById('todoNewDate').value||'2026-02-14',prio:document.getElementById('todoNewPrio').value,kat:document.getElementById('todoNewKat').value,done:false});
            document.getElementById('todoNewModal').classList.add('hidden');
            document.getElementById('todoNewTitle').value='';
            renderTodos();
        }

        // === HQ KOMMUNIKATION ===
        var hqAnnouncements = [
            {id:1,title:'Fruehjahrs-Aktion 2026 ‚Äì Materialien verfuegbar',date:'2026-02-12',author:'Lisa Zentrale',priority:'hoch',target:'alle',body:'Liebe Partner, die Materialien fuer die Fruehjahrs-Aktion stehen ab sofort im Content-Bereich bereit. Bitte bis 01.03. im Laden platzieren.',read:18,total:21},
            {id:2,title:'Neue Einkaufsrichtlinie Q1/2026',date:'2026-02-10',author:'Thomas HQ',priority:'hoch',target:'alle',body:'Aktualisierte Margen-Empfehlung und Vororder-Deadlines fuer Q1 2026.',read:15,total:21},
            {id:3,title:'Schulung: Bosch Smart System ‚Äì 25.02.',date:'2026-02-08',author:'Lisa Zentrale',priority:'mittel',target:'alle',body:'Online-Schulung via Teams. Link wird per Mail versendet. Teilnahme empfohlen fuer alle Werkstatt-MA.',read:12,total:21},
            {id:4,title:'Osteraktion: Fruehbucher-Rabatt auf E-MTBs',date:'2026-02-05',author:'Marketing HQ',priority:'mittel',target:'alle',body:'10% Fruehbucher-Rabatt auf alle Orbea Rise und Wild. Gilt 01.03.‚Äì15.04.',read:21,total:21},
            {id:5,title:'Region Sued: Lagerbestand-Inventur bis 01.03.',date:'2026-02-03',author:'Thomas HQ',priority:'niedrig',target:'Region S√ºd',body:'Bitte Inventur durchfuehren und Ergebnisse in den Aktenschrank hochladen.',read:6,total:8}
        ];
        var hqForumTopics = [
            {id:1,title:'Best Practices: E-Bike Probefahrten organisieren',author:'Max Mustermann, Grafrath',date:'2026-02-13',replies:8,pinned:true},
            {id:2,title:'Erfahrungen mit Shimano EP6 Antrieb?',author:'Peter Hansen, Hamburg',date:'2026-02-12',replies:5,pinned:false},
            {id:3,title:'Werkstatt-Auslastung im Fruehjahr managen',author:'Jan Schulze, Berlin',date:'2026-02-11',replies:12,pinned:false},
            {id:4,title:'Jobrad-Leasing: Tipps fuer B2B-Kunden',author:'Miriam Deichmann, Hamburg',date:'2026-02-09',replies:3,pinned:true},
            {id:5,title:'Social Media: Welche Themen laufen bei euch?',author:'Laura Schmidt, Grafrath',date:'2026-02-07',replies:15,pinned:false}
        ];
        var currentHqKommTab='announce';
        function showHqKommTab(tab){
            currentHqKommTab=tab;
            document.querySelectorAll('.hqkomm-tab-btn').forEach(function(b){b.className='hqkomm-tab-btn whitespace-nowrap py-3 px-1 border-b-2 border-transparent font-semibold text-sm text-gray-500 hover:text-gray-700';});
            var btn=document.querySelector('.hqkomm-tab-btn[data-hkt="'+tab+'"]');
            if(btn)btn.className='hqkomm-tab-btn whitespace-nowrap py-3 px-1 border-b-2 border-vit-orange font-semibold text-sm text-vit-orange';
            renderHqKomm();
        }
        function renderHqKomm(){
            var el=document.getElementById('hqKommContent');if(!el)return;
            var h='';
            if(currentHqKommTab==='announce'){
                h+='<div class="flex justify-end mb-4"><button onclick="alert(\'Neue Ankuendigung erstellen (Demo)\')" class="px-4 py-2 bg-vit-orange text-white rounded-lg text-sm font-semibold hover:opacity-90">+ Neue Ankuendigung</button></div>';
                hqAnnouncements.forEach(function(a){
                    var prioBg=a.priority==='hoch'?'border-l-4 border-red-500':a.priority==='mittel'?'border-l-4 border-yellow-400':'border-l-4 border-gray-300';
                    var readPct=Math.round(a.read/a.total*100);
                    h+='<div class="vit-card p-4 mb-3 '+prioBg+'">';
                    h+='<div class="flex items-start justify-between"><div class="flex-1">';
                    h+='<div class="flex items-center space-x-2"><p class="font-bold text-gray-800">'+a.title+'</p>';
                    if(a.priority==='hoch') h+='<span class="text-[10px] px-2 py-0.5 rounded-full bg-red-100 text-red-600 font-bold">WICHTIG</span>';
                    h+='</div>';
                    h+='<p class="text-xs text-gray-500 mt-1">'+a.author+' ¬∑ '+a.date+' ¬∑ Ziel: '+a.target+'</p>';
                    h+='<p class="text-sm text-gray-600 mt-2">'+a.body+'</p>';
                    h+='</div>';
                    h+='<div class="text-right flex-shrink-0 ml-4"><p class="text-xs text-gray-400">Gelesen</p>';
                    h+='<p class="text-lg font-bold '+(readPct>=90?'text-green-600':readPct>=50?'text-yellow-600':'text-red-500')+'">'+a.read+'/'+a.total+'</p>';
                    h+='<div class="w-16 bg-gray-100 rounded-full h-1.5 mt-1"><div class="h-1.5 rounded-full '+(readPct>=90?'bg-green-500':'bg-yellow-500')+'" style="width:'+readPct+'%"></div></div>';
                    h+='</div></div></div>';
                });
            } else if(currentHqKommTab==='rundmail'){
                h+='<div class="vit-card p-6"><h3 class="font-bold text-gray-800 mb-4">‚úâÔ∏è Rundmail an Standorte senden</h3>';
                h+='<div class="space-y-3">';
                h+='<select class="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm"><option>Alle Standorte (21)</option><option>Region Sued (8)</option><option>Region Nord (5)</option><option>Region West (5)</option><option>Region Ost (3)</option><option>Nur Inhaber</option></select>';
                h+='<input type="text" placeholder="Betreff" class="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm">';
                h+='<textarea rows="6" placeholder="Nachricht an das Netzwerk..." class="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm"></textarea>';
                h+='<div class="flex items-center space-x-3"><label class="flex items-center text-sm text-gray-600"><input type="checkbox" class="mr-2"> Als Ankuendigung im Portal anzeigen</label></div>';
                h+='<button onclick="this.textContent=\'‚úÖ Gesendet!\';this.disabled=true;setTimeout(function(){this.textContent=\'üì® Senden\';this.disabled=false;}.bind(this),2000)" class="px-6 py-2 bg-vit-orange text-white rounded-lg text-sm font-semibold hover:opacity-90">üì® Senden</button>';
                h+='</div></div>';
                h+='<h3 class="font-bold text-gray-800 mt-6 mb-3">Letzte Rundmails</h3>';
                var mails=[{subj:'Fruehjahrs-Aktion Materialien',date:'12.02.2026',to:'Alle',opened:'18/21'},{subj:'Einkaufsrichtlinie Q1',date:'10.02.2026',to:'Alle',opened:'15/21'},{subj:'Inventur-Erinnerung',date:'03.02.2026',to:'Region Sued',opened:'6/8'}];
                mails.forEach(function(m){
                    h+='<div class="vit-card p-3 flex items-center justify-between mb-2"><div><p class="text-sm font-semibold text-gray-800">'+m.subj+'</p><p class="text-xs text-gray-500">'+m.date+' ¬∑ An: '+m.to+'</p></div><span class="text-xs font-semibold text-gray-500">Geoeffnet: '+m.opened+'</span></div>';
                });
            } else if(currentHqKommTab==='forum'){
                h+='<p class="text-sm text-gray-500 mb-4">Netzwerk-Forum: Moderieren und Pinnen von Beitraegen aller Standorte.</p>';
                hqForumTopics.forEach(function(f){
                    h+='<div class="vit-card p-4 flex items-center space-x-3 mb-2">';
                    if(f.pinned) h+='<span class="text-vit-orange text-sm">üìå</span>'; else h+='<span class="text-gray-300 text-sm">üí¨</span>';
                    h+='<div class="flex-1 min-w-0"><p class="font-semibold text-sm text-gray-800 truncate">'+f.title+'</p><p class="text-xs text-gray-500">'+f.author+' ¬∑ '+f.date+'</p></div>';
                    h+='<div class="text-right flex-shrink-0"><span class="text-xs font-bold text-gray-600">'+f.replies+' Antworten</span></div>';
                    h+='<button onclick="alert(\'Beitrag '+(f.pinned?'loesen':'pinnen')+' (Demo)\')" class="text-xs px-2 py-1 rounded border border-gray-200 text-gray-500 hover:bg-gray-50">'+(f.pinned?'Loesen':'Pinnen')+'</button>';
                    h+='</div>';
                });
            }
            el.innerHTML=h;
        }

        // === HQ KAMPAGNEN ===
        var hqKampagnen = [
            {id:1,name:'Fruehjahrs-Aktion 2026',type:'saisonal',start:'2026-03-01',end:'2026-04-15',status:'aktiv',standorte:21,umgesetzt:14,budget:25000,desc:'Fokus auf E-Bikes und Zubehoer. POS-Material + Online-Banner.'},
            {id:2,name:'Orbea Rise Launch Event',type:'produkt',start:'2026-02-20',end:'2026-03-10',status:'aktiv',standorte:21,umgesetzt:8,budget:15000,desc:'Produktlaunch neues Orbea Rise 2026. Probefahrt-Events an allen Standorten.'},
            {id:3,name:'Jobrad-Fruehjahr B2B',type:'event',start:'2026-03-15',end:'2026-05-31',status:'geplant',standorte:12,umgesetzt:0,budget:10000,desc:'B2B-Kampagne fuer Firmenkunden. Flyer + Akquise-Toolbox.'},
            {id:4,name:'Social Media Push #BikeLife',type:'social',start:'2026-02-01',end:'2026-02-28',status:'aktiv',standorte:21,umgesetzt:16,budget:5000,desc:'Netzwerk-weiter Social Media Push mit Hashtag-Kampagne.'},
            {id:5,name:'Black Friday Bikes',type:'saisonal',start:'2025-11-25',end:'2025-12-01',status:'beendet',standorte:21,umgesetzt:21,budget:20000,desc:'Abgeschlossene Saisonkampagne.'},
            {id:6,name:'Weihnachts-Zubehoer',type:'saisonal',start:'2025-12-01',end:'2025-12-24',status:'beendet',standorte:21,umgesetzt:19,budget:8000,desc:'Zubehoer-Fokus im Weihnachtsgeschaeft.'}
        ];
        function renderHqKampagnen(){
            var aktiv=hqKampagnen.filter(function(k){return k.status==='aktiv';}).length;
            var geplant=hqKampagnen.filter(function(k){return k.status==='geplant';}).length;
            var beendet=hqKampagnen.filter(function(k){return k.status==='beendet';}).length;
            var totalBudget=hqKampagnen.reduce(function(a,k){return a+k.budget;},0);
            var avgUmsetzung=Math.round(hqKampagnen.filter(function(k){return k.status==='aktiv';}).reduce(function(a,k){return a+Math.round(k.umgesetzt/k.standorte*100);},0)/(aktiv||1));
            var kpi=document.getElementById('hqKampKpis');
            if(kpi) kpi.innerHTML='<div class="vit-card p-4 text-center"><p class="text-2xl font-bold text-gray-800">'+hqKampagnen.length+'</p><p class="text-xs text-gray-500">Kampagnen total</p></div>'
                +'<div class="vit-card p-4 text-center"><p class="text-2xl font-bold text-green-600">'+aktiv+'</p><p class="text-xs text-gray-500">Aktiv</p></div>'
                +'<div class="vit-card p-4 text-center"><p class="text-2xl font-bold text-blue-600">'+geplant+'</p><p class="text-xs text-gray-500">Geplant</p></div>'
                +'<div class="vit-card p-4 text-center"><p class="text-2xl font-bold text-gray-400">'+beendet+'</p><p class="text-xs text-gray-500">Beendet</p></div>'
                +'<div class="vit-card p-4 text-center"><p class="text-2xl font-bold text-vit-orange">'+avgUmsetzung+'%</p><p class="text-xs text-gray-500">√ò Umsetzung (aktiv)</p></div>';

            var el=document.getElementById('hqKampList');if(!el)return;
            var h='';
            var statusCls={aktiv:'bg-green-100 text-green-700',geplant:'bg-blue-100 text-blue-700',beendet:'bg-gray-100 text-gray-500'};
            var statusLabel={aktiv:'üü¢ Aktiv',geplant:'üîµ Geplant',beendet:'‚ö™ Beendet'};
            var typLabel={saisonal:'üå∏ Saison',produkt:'üö≤ Produkt',event:'üé™ Event',social:'üì± Social'};
            hqKampagnen.forEach(function(k){
                var pct=k.standorte?Math.round(k.umgesetzt/k.standorte*100):0;
                h+='<div class="vit-card p-5">';
                h+='<div class="flex items-start justify-between mb-3"><div><h3 class="font-bold text-gray-800">'+k.name+'</h3>';
                h+='<p class="text-xs text-gray-500">'+k.start+' bis '+k.end+' ¬∑ Budget: '+fmt(k.budget)+' EUR</p></div>';
                h+='<div class="flex items-center space-x-2"><span class="text-[10px] px-2 py-0.5 rounded-full bg-gray-100 text-gray-600">'+(typLabel[k.type]||k.type)+'</span>';
                h+='<span class="text-[10px] px-2 py-0.5 rounded-full font-bold '+(statusCls[k.status]||'')+'">'+(statusLabel[k.status]||k.status)+'</span></div></div>';
                h+='<p class="text-sm text-gray-600 mb-3">'+k.desc+'</p>';
                h+='<div class="flex items-center space-x-4">';
                h+='<div class="flex-1"><p class="text-xs text-gray-500 mb-1">Umsetzung: '+k.umgesetzt+'/'+k.standorte+' Standorte ('+pct+'%)</p>';
                h+='<div class="w-full bg-gray-100 rounded-full h-2.5"><div class="h-2.5 rounded-full '+(pct>=80?'bg-green-500':pct>=50?'bg-yellow-500':'bg-red-500')+'" style="width:'+pct+'%"></div></div></div>';
                if(k.status!=='beendet') h+='<button onclick="alert(\'Kampagne bearbeiten (Demo)\')" class="text-xs px-3 py-1.5 bg-gray-100 rounded-lg text-gray-600 hover:bg-gray-200">Bearbeiten</button>';
                h+='</div></div>';
            });
            el.innerHTML=h;
        }
        function addHqKampagne(){
            var n=document.getElementById('hqKampName').value;if(!n){alert('Bitte Name eingeben.');return;}
            hqKampagnen.unshift({id:hqKampagnen.length+1,name:n,type:document.getElementById('hqKampType').value,start:document.getElementById('hqKampStart').value||'2026-03-01',end:document.getElementById('hqKampEnd').value||'2026-04-30',status:'geplant',standorte:21,umgesetzt:0,budget:0,desc:document.getElementById('hqKampDesc').value||''});
            document.getElementById('hqKampModal').classList.add('hidden');document.getElementById('hqKampName').value='';
            renderHqKampagnen();
        }

        // === HQ DOKUMENTE ===
        var hqDokumente = [
            {id:1,name:'Franchise-Handbuch v4.2',kat:'richtlinie',date:'2026-01-15',size:'2.4 MB',type:'PDF',target:'alle',downloads:18},
            {id:2,name:'Einkaufsrichtlinie Q1/2026',kat:'richtlinie',date:'2026-02-10',size:'840 KB',type:'PDF',target:'alle',downloads:15},
            {id:3,name:'Margen-Kalkulation Vorlage',kat:'vorlage',date:'2026-01-20',size:'120 KB',type:'XLSX',target:'alle',downloads:12},
            {id:4,name:'Angebots-Template vit:bikes',kat:'vorlage',date:'2025-11-01',size:'95 KB',type:'DOCX',target:'alle',downloads:21},
            {id:5,name:'BWA-Analyse Checkliste',kat:'vorlage',date:'2026-01-08',size:'65 KB',type:'PDF',target:'Inhaber',downloads:9},
            {id:6,name:'Schulung: Bosch Smart System',kat:'schulung',date:'2026-02-08',size:'15 MB',type:'MP4',target:'alle',downloads:8},
            {id:7,name:'Schulung: Verkaufsgespraeche fuehren',kat:'schulung',date:'2025-12-15',size:'22 MB',type:'MP4',target:'alle',downloads:14},
            {id:8,name:'Schulung: Reklamationsmanagement',kat:'schulung',date:'2025-10-20',size:'18 MB',type:'MP4',target:'alle',downloads:19},
            {id:9,name:'Muster-Arbeitsvertrag Verkaeufer',kat:'vertrag',date:'2025-09-01',size:'180 KB',type:'DOCX',target:'Inhaber',downloads:7},
            {id:10,name:'Muster-Arbeitsvertrag Werkstatt',kat:'vertrag',date:'2025-09-01',size:'175 KB',type:'DOCX',target:'Inhaber',downloads:5},
            {id:11,name:'Social Media Guidelines',kat:'richtlinie',date:'2026-01-25',size:'1.1 MB',type:'PDF',target:'alle',downloads:11},
            {id:12,name:'Ladenbau-Richtlinie CI/CD',kat:'richtlinie',date:'2025-06-01',size:'3.8 MB',type:'PDF',target:'alle',downloads:20}
        ];
        var currentHqDokFilter='all';
        function filterHqDok(f){
            currentHqDokFilter=f;
            document.querySelectorAll('.hqdok-filter').forEach(function(b){b.className='hqdok-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-gray-100 text-gray-600';});
            var btn=document.querySelector('.hqdok-filter[data-hdf="'+f+'"]');
            if(btn)btn.className='hqdok-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-vit-orange text-white';
            renderHqDokumente();
        }
        function renderHqDokumente(){
            var list=currentHqDokFilter==='all'?hqDokumente:hqDokumente.filter(function(d){return d.kat===currentHqDokFilter;});
            var kpi=document.getElementById('hqDokKpis');
            if(kpi) kpi.innerHTML='<div class="vit-card p-4 text-center"><p class="text-2xl font-bold text-gray-800">'+hqDokumente.length+'</p><p class="text-xs text-gray-500">Dokumente</p></div>'
                +'<div class="vit-card p-4 text-center"><p class="text-2xl font-bold text-blue-600">'+hqDokumente.filter(function(d){return d.kat==='richtlinie';}).length+'</p><p class="text-xs text-gray-500">Richtlinien</p></div>'
                +'<div class="vit-card p-4 text-center"><p class="text-2xl font-bold text-green-600">'+hqDokumente.filter(function(d){return d.kat==='vorlage';}).length+'</p><p class="text-xs text-gray-500">Vorlagen</p></div>'
                +'<div class="vit-card p-4 text-center"><p class="text-2xl font-bold text-purple-600">'+hqDokumente.filter(function(d){return d.kat==='schulung';}).length+'</p><p class="text-xs text-gray-500">Schulungen</p></div>';

            var el=document.getElementById('hqDokList');if(!el)return;
            var h='';
            var katIcons={richtlinie:'üìã',vorlage:'üìÑ',schulung:'üéì',vertrag:'üìë'};
            var typeColors={PDF:'bg-red-100 text-red-600',XLSX:'bg-green-100 text-green-700',DOCX:'bg-blue-100 text-blue-700',MP4:'bg-purple-100 text-purple-700'};
            list.forEach(function(d){
                h+='<div class="vit-card p-3 flex items-center space-x-3">';
                h+='<span class="text-2xl">'+(katIcons[d.kat]||'üìÅ')+'</span>';
                h+='<div class="flex-1 min-w-0"><p class="font-semibold text-sm text-gray-800 truncate">'+d.name+'</p>';
                h+='<p class="text-[10px] text-gray-500">'+d.date+' ¬∑ '+d.size+' ¬∑ Ziel: '+d.target+'</p></div>';
                h+='<span class="text-[10px] px-2 py-0.5 rounded-full font-bold '+(typeColors[d.type]||'bg-gray-100 text-gray-600')+'">'+d.type+'</span>';
                h+='<span class="text-xs text-gray-400">'+d.downloads+'x ‚Üì</span>';
                h+='<button onclick="alert(\'Download: '+d.name+' (Demo)\')" class="text-xs px-3 py-1 bg-vit-orange text-white rounded-lg hover:opacity-90">‚Üì</button>';
                h+='</div>';
            });
            el.innerHTML=h;
        }

        // === HQ KALENDER ===
        var hqKalTermine = [
            {id:1,title:'Schulung: Bosch Smart System (Online)',date:'2026-02-25',time:'09:00',type:'schulung',target:'alle',pflicht:true},
            {id:2,title:'Orbea Rise Launch Event ‚Äì Kick-off',date:'2026-02-20',time:'10:00',type:'event',target:'alle',pflicht:false},
            {id:3,title:'Deadline: Vororder Sommer 2026',date:'2026-03-01',time:'23:59',type:'deadline',target:'alle',pflicht:true},
            {id:4,title:'Netzwerk-Meeting Q1 (Online)',date:'2026-03-05',time:'14:00',type:'meeting',target:'alle',pflicht:true},
            {id:5,title:'Schulung: Verkaufsgespraeche Advanced',date:'2026-03-12',time:'09:00',type:'schulung',target:'alle',pflicht:false},
            {id:6,title:'Fruehlings-Aktionstag ‚Äì Probefahrt-Event',date:'2026-03-15',time:'10:00',type:'event',target:'alle',pflicht:false},
            {id:7,title:'Deadline: Social Media Monatsplanung Maerz',date:'2026-02-28',time:'23:59',type:'deadline',target:'alle',pflicht:false},
            {id:8,title:'Region Sued Meeting',date:'2026-03-10',time:'15:00',type:'meeting',target:'Region S√ºd',pflicht:true},
            {id:9,title:'Schulung: Shimano STEPS EP801',date:'2026-03-20',time:'09:00',type:'schulung',target:'alle',pflicht:false},
            {id:10,title:'Deadline: BWA Februar einreichen',date:'2026-03-15',time:'23:59',type:'deadline',target:'Inhaber',pflicht:true},
            {id:11,title:'Messe: VELOBerlin 2026',date:'2026-04-05',time:'09:00',type:'event',target:'Region Ost',pflicht:false},
            {id:12,title:'Netzwerk-Jahresmeeting (Praesenz)',date:'2026-05-10',time:'10:00',type:'meeting',target:'alle',pflicht:true}
        ];
        var currentHqKalFilter='all';
        function filterHqKal(f){
            currentHqKalFilter=f;
            document.querySelectorAll('.hqkal-filter').forEach(function(b){b.className='hqkal-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-gray-100 text-gray-600';});
            var btn=document.querySelector('.hqkal-filter[data-hkf="'+f+'"]');
            if(btn)btn.className='hqkal-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-vit-orange text-white';
            renderHqKalender();
        }
        function renderHqKalender(){
            var today='2026-02-14';
            var list=hqKalTermine.filter(function(t){
                if(currentHqKalFilter!=='all' && t.type!==currentHqKalFilter) return false;
                return true;
            }).sort(function(a,b){return a.date>b.date?1:-1;});

            var upcoming=list.filter(function(t){return t.date>=today;}).length;
            var past=list.filter(function(t){return t.date<today;}).length;
            var pflicht=list.filter(function(t){return t.pflicht && t.date>=today;}).length;
            var kpi=document.getElementById('hqKalKpis');
            if(kpi) kpi.innerHTML='<div class="vit-card p-4 text-center"><p class="text-2xl font-bold text-gray-800">'+hqKalTermine.length+'</p><p class="text-xs text-gray-500">Termine total</p></div>'
                +'<div class="vit-card p-4 text-center"><p class="text-2xl font-bold text-vit-orange">'+upcoming+'</p><p class="text-xs text-gray-500">Anstehend</p></div>'
                +'<div class="vit-card p-4 text-center"><p class="text-2xl font-bold text-red-500">'+pflicht+'</p><p class="text-xs text-gray-500">Pflichttermine</p></div>'
                +'<div class="vit-card p-4 text-center"><p class="text-2xl font-bold text-gray-400">'+past+'</p><p class="text-xs text-gray-500">Vergangen</p></div>';

            var el=document.getElementById('hqKalList');if(!el)return;
            var h='';
            var typeIcons={schulung:'üéì',event:'üé™',deadline:'‚è∞',meeting:'ü§ù'};
            var typeCls={schulung:'bg-purple-100 text-purple-700',event:'bg-green-100 text-green-700',deadline:'bg-red-100 text-red-700',meeting:'bg-blue-100 text-blue-700'};
            var dayNames=['So','Mo','Di','Mi','Do','Fr','Sa'];
            list.forEach(function(t){
                var dd=new Date(t.date);var dayName=dayNames[dd.getDay()];
                var isPast=t.date<today;
                h+='<div class="vit-card p-3 flex items-center space-x-3 '+(isPast?'opacity-50':'')+'">';
                h+='<div class="text-center flex-shrink-0 w-14 '+(isPast?'':'bg-orange-50 rounded-lg p-1')+'"><p class="text-[10px] text-gray-500">'+dayName+'</p><p class="text-lg font-bold text-gray-800">'+parseInt(t.date.slice(8))+'</p><p class="text-[10px] text-gray-400">'+t.date.slice(5,7)+'.'+t.date.slice(0,4)+'</p></div>';
                h+='<span class="text-xl">'+(typeIcons[t.type]||'üìÖ')+'</span>';
                h+='<div class="flex-1 min-w-0"><p class="font-semibold text-sm text-gray-800 truncate">'+t.title+'</p>';
                h+='<p class="text-[10px] text-gray-500">'+t.time+' Uhr ¬∑ Ziel: '+t.target+(t.pflicht?' ¬∑ <span class="text-red-500 font-bold">PFLICHT</span>':'')+'</p></div>';
                h+='<span class="text-[10px] px-2 py-0.5 rounded-full font-bold '+(typeCls[t.type]||'')+'">'+(typeIcons[t.type]||'')+' '+t.type.charAt(0).toUpperCase()+t.type.slice(1)+'</span>';
                h+='</div>';
            });
            el.innerHTML=h;
        }
        function addHqKalTermin(){
            var title=document.getElementById('hqKalTitle').value;if(!title){alert('Bitte Titel eingeben.');return;}
            hqKalTermine.push({id:hqKalTermine.length+1,title:title,date:document.getElementById('hqKalDate').value||'2026-03-01',time:document.getElementById('hqKalTime').value||'09:00',type:document.getElementById('hqKalType').value,target:document.getElementById('hqKalTarget').value==='alle'?'alle':'Region',pflicht:false});
            document.getElementById('hqKalModal').classList.add('hidden');document.getElementById('hqKalTitle').value='';
            renderHqKalender();
        }

        // === HQ AUFGABEN ===
        var hqTasks = [
            {id:1,title:'Fruehjahrs-Deko aufbauen (POS-Material)',deadline:'2026-03-01',prio:'hoch',target:'alle',status:'offen',done:8,total:21,kat:'Marketing'},
            {id:2,title:'Vororder Sommer 2026 platzieren',deadline:'2026-03-01',prio:'hoch',target:'alle',status:'inprogress',done:14,total:21,kat:'Einkauf'},
            {id:3,title:'BWA Januar einreichen',deadline:'2026-02-20',prio:'hoch',target:'Inhaber',status:'inprogress',done:15,total:21,kat:'Controlling'},
            {id:4,title:'Local Hero Video drehen: Fruehjahrsthema',deadline:'2026-02-28',prio:'mittel',target:'alle',status:'offen',done:5,total:21,kat:'Marketing'},
            {id:5,title:'Werkstatt-Inventur durchfuehren',deadline:'2026-03-01',prio:'mittel',target:'Region S√ºd',status:'inprogress',done:4,total:8,kat:'Operations'},
            {id:6,title:'Schulungs-Video Bosch anschauen',deadline:'2026-02-28',prio:'niedrig',target:'alle',status:'offen',done:8,total:21,kat:'Wissen'},
            {id:7,title:'Kundenzufriedenheits-Umfrage ausfuellen',deadline:'2026-02-15',prio:'mittel',target:'alle',status:'inprogress',done:17,total:21,kat:'Support'},
            {id:8,title:'Jobrad-Info im Laden aushangen',deadline:'2026-03-15',prio:'niedrig',target:'alle',status:'offen',done:0,total:21,kat:'Marketing'},
            {id:9,title:'Social Media Profil aktualisieren',deadline:'2026-01-31',prio:'niedrig',target:'alle',status:'done',done:21,total:21,kat:'Marketing'},
            {id:10,title:'Weihnachts-Deko abbauen',deadline:'2026-01-10',prio:'niedrig',target:'alle',status:'done',done:21,total:21,kat:'Operations'}
        ];
        var currentHqTaskFilter='all';
        function filterHqTasks(f){
            currentHqTaskFilter=f;
            document.querySelectorAll('.hqtask-filter').forEach(function(b){b.className='hqtask-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-gray-100 text-gray-600';});
            var btn=document.querySelector('.hqtask-filter[data-htf="'+f+'"]');
            if(btn)btn.className='hqtask-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-vit-orange text-white';
            renderHqAufgaben();
        }
        function renderHqAufgaben(){
            var today='2026-02-14';
            var list=hqTasks.filter(function(t){
                if(currentHqTaskFilter==='all') return true;
                return t.status===currentHqTaskFilter;
            });
            var offen=hqTasks.filter(function(t){return t.status==='offen';}).length;
            var inprog=hqTasks.filter(function(t){return t.status==='inprogress';}).length;
            var done=hqTasks.filter(function(t){return t.status==='done';}).length;
            var overdue=hqTasks.filter(function(t){return t.status!=='done'&&t.deadline<today;}).length;
            var avgCompl=Math.round(hqTasks.filter(function(t){return t.status!=='done';}).reduce(function(a,t){return a+Math.round(t.done/t.total*100);},0)/(hqTasks.filter(function(t){return t.status!=='done';}).length||1));
            var kpi=document.getElementById('hqTaskKpis');
            if(kpi) kpi.innerHTML='<div class="vit-card p-4 text-center"><p class="text-2xl font-bold text-gray-800">'+hqTasks.length+'</p><p class="text-xs text-gray-500">Aufgaben total</p></div>'
                +'<div class="vit-card p-4 text-center"><p class="text-2xl font-bold text-red-500">'+offen+'</p><p class="text-xs text-gray-500">Offen</p></div>'
                +'<div class="vit-card p-4 text-center"><p class="text-2xl font-bold text-blue-600">'+inprog+'</p><p class="text-xs text-gray-500">In Arbeit</p></div>'
                +'<div class="vit-card p-4 text-center"><p class="text-2xl font-bold text-green-600">'+done+'</p><p class="text-xs text-gray-500">Erledigt</p></div>'
                +'<div class="vit-card p-4 text-center"><p class="text-2xl font-bold text-vit-orange">'+avgCompl+'%</p><p class="text-xs text-gray-500">√ò Umsetzung</p></div>';

            var el=document.getElementById('hqTaskList');if(!el)return;
            var h='';
            var prioIcons={hoch:'üî¥',mittel:'üü°',niedrig:'üü¢'};
            var statusCls={offen:'bg-red-100 text-red-700',inprogress:'bg-blue-100 text-blue-700',done:'bg-green-100 text-green-700'};
            var statusLabel={offen:'Offen',inprogress:'In Arbeit',done:'Erledigt'};
            list.sort(function(a,b){var po={hoch:0,mittel:1,niedrig:2};return (po[a.prio]||1)-(po[b.prio]||1);});
            list.forEach(function(t){
                var pct=Math.round(t.done/t.total*100);
                var isOver=t.status!=='done'&&t.deadline<today;
                h+='<div class="vit-card p-4 '+(isOver?'border-l-4 border-red-500':'')+'">';
                h+='<div class="flex items-start justify-between mb-2"><div class="flex-1">';
                h+='<div class="flex items-center space-x-2"><span>'+(prioIcons[t.prio]||'')+'</span><p class="font-bold text-sm text-gray-800">'+t.title+'</p></div>';
                h+='<p class="text-[10px] text-gray-500 mt-0.5">'+t.kat+' ¬∑ Deadline: '+t.deadline+' ¬∑ Ziel: '+t.target+(isOver?' ¬∑ <span class="text-red-500 font-bold">UEBERFAELLIG</span>':'')+'</p>';
                h+='</div>';
                h+='<span class="text-[10px] px-2 py-0.5 rounded-full font-bold '+(statusCls[t.status]||'')+'">'+(statusLabel[t.status]||t.status)+'</span></div>';
                h+='<div class="flex items-center space-x-3"><div class="flex-1">';
                h+='<div class="flex items-center justify-between mb-0.5"><span class="text-[10px] text-gray-500">'+t.done+' / '+t.total+' Standorte ('+pct+'%)</span></div>';
                h+='<div class="w-full bg-gray-100 rounded-full h-2"><div class="h-2 rounded-full '+(pct>=80?'bg-green-500':pct>=50?'bg-yellow-500':'bg-red-400')+'" style="width:'+pct+'%"></div></div>';
                h+='</div></div></div>';
            });
            if(!list.length) h='<div class="text-center py-8 text-gray-400"><p class="text-3xl mb-2">‚úÖ</p><p class="text-sm">Keine Aufgaben in diesem Filter</p></div>';
            el.innerHTML=h;
        }
        function addHqTask(){
            var title=document.getElementById('hqTaskTitle').value;if(!title){alert('Bitte Aufgabe eingeben.');return;}
            var target=document.getElementById('hqTaskTarget').value;
            var total=target==='alle'?21:target==='region_sued'?8:target==='region_nord'?5:target==='region_west'?5:3;
            hqTasks.unshift({id:hqTasks.length+1,title:title,deadline:document.getElementById('hqTaskDeadline').value||'2026-03-31',prio:document.getElementById('hqTaskPrio').value,target:target==='alle'?'alle':target.replace('region_','Region '),status:'offen',done:0,total:total,kat:'HQ'});
            document.getElementById('hqTaskModal').classList.add('hidden');document.getElementById('hqTaskTitle').value='';
            renderHqAufgaben();
        }

        // === HQ AUSWERTUNG: Portal-Nutzung ===
        var portalNutzung = [
            {name:'Grafrath',logins:48,bwaUploaded:true,videosDone:4,aufgabenDone:85,moduleUsed:11,lastLogin:'2026-02-14'},
            {name:'Hamburg',logins:62,bwaUploaded:true,videosDone:6,aufgabenDone:92,moduleUsed:12,lastLogin:'2026-02-14'},
            {name:'Karlsdorf-Neuth.',logins:55,bwaUploaded:true,videosDone:5,aufgabenDone:88,moduleUsed:11,lastLogin:'2026-02-14'},
            {name:'Weilheim',logins:41,bwaUploaded:true,videosDone:3,aufgabenDone:78,moduleUsed:10,lastLogin:'2026-02-13'},
            {name:'Muenchen-Thal.',logins:38,bwaUploaded:true,videosDone:2,aufgabenDone:72,moduleUsed:9,lastLogin:'2026-02-13'},
            {name:'Holzkirchen',logins:35,bwaUploaded:true,videosDone:3,aufgabenDone:80,moduleUsed:10,lastLogin:'2026-02-14'},
            {name:'Teisendorf',logins:29,bwaUploaded:true,videosDone:2,aufgabenDone:65,moduleUsed:8,lastLogin:'2026-02-12'},
            {name:'Wesel',logins:26,bwaUploaded:true,videosDone:1,aufgabenDone:60,moduleUsed:8,lastLogin:'2026-02-12'},
            {name:'Reutlingen',logins:33,bwaUploaded:true,videosDone:2,aufgabenDone:70,moduleUsed:9,lastLogin:'2026-02-13'},
            {name:'Muenster',logins:22,bwaUploaded:false,videosDone:1,aufgabenDone:55,moduleUsed:7,lastLogin:'2026-02-11'},
            {name:'Rottweil',logins:18,bwaUploaded:false,videosDone:0,aufgabenDone:45,moduleUsed:6,lastLogin:'2026-02-10'},
            {name:'Berlin-Brand.',logins:31,bwaUploaded:false,videosDone:1,aufgabenDone:50,moduleUsed:7,lastLogin:'2026-02-11'},
            {name:'Witten',logins:15,bwaUploaded:false,videosDone:0,aufgabenDone:40,moduleUsed:5,lastLogin:'2026-02-09'},
            {name:'Warendorf',logins:12,bwaUploaded:false,videosDone:0,aufgabenDone:35,moduleUsed:5,lastLogin:'2026-02-08'},
            {name:'Muenchen-Berg',logins:20,bwaUploaded:false,videosDone:1,aufgabenDone:42,moduleUsed:6,lastLogin:'2026-02-10'},
            {name:'Pfaffenhofen',logins:8,bwaUploaded:false,videosDone:0,aufgabenDone:25,moduleUsed:4,lastLogin:'2026-02-06'},
            {name:'Zell',logins:5,bwaUploaded:false,videosDone:0,aufgabenDone:15,moduleUsed:3,lastLogin:'2026-02-03'},
            {name:'Lohmar',logins:6,bwaUploaded:false,videosDone:0,aufgabenDone:20,moduleUsed:3,lastLogin:'2026-02-04'},
            {name:'Garching',logins:4,bwaUploaded:false,videosDone:0,aufgabenDone:10,moduleUsed:2,lastLogin:'2026-02-02'},
            {name:'Dresden',logins:0,bwaUploaded:false,videosDone:0,aufgabenDone:0,moduleUsed:0,lastLogin:'‚Äî'},
            {name:'Passau (Onb.)',logins:3,bwaUploaded:false,videosDone:0,aufgabenDone:5,moduleUsed:1,lastLogin:'2026-02-01'}
        ];

        var modulNutzung = [
            {name:'Verkauf',icon:'üí∞',pct:92,users:19},
            {name:'Marketing',icon:'üì£',pct:85,users:18},
            {name:'Einkauf',icon:'üõí',pct:78,users:16},
            {name:'Controlling / BWA',icon:'üìä',pct:71,users:15},
            {name:'Kommunikation',icon:'üí¨',pct:68,users:14},
            {name:'Social Media',icon:'üì±',pct:62,users:13},
            {name:'Aktenschrank',icon:'üìÅ',pct:55,users:12},
            {name:'Kalender',icon:'üìÖ',pct:82,users:17},
            {name:'Aufgaben',icon:'üìã',pct:75,users:16},
            {name:'Ideenboard',icon:'üí°',pct:38,users:8},
            {name:'Support',icon:'üé´',pct:45,users:9},
            {name:'Onboarding',icon:'‚úÖ',pct:95,users:20}
        ];

        function calcScore(p){return Math.round(p.logins*0.3+p.aufgabenDone*0.3+p.moduleUsed*3+p.videosDone*2+(p.bwaUploaded?5:0));}

        function renderHqAuswertung(){
            var sorted=portalNutzung.slice().sort(function(a,b){return calcScore(b)-calcScore(a);});
            var avgLogins=Math.round(portalNutzung.reduce(function(a,p){return a+p.logins;},0)/portalNutzung.length);
            var bwaCount=portalNutzung.filter(function(p){return p.bwaUploaded;}).length;
            var avgScore=Math.round(sorted.reduce(function(a,p){return a+calcScore(p);},0)/sorted.length);
            var inactive=portalNutzung.filter(function(p){return p.logins<5;}).length;
            var avgModules=Math.round(portalNutzung.reduce(function(a,p){return a+p.moduleUsed;},0)/portalNutzung.length*10)/10;

            var kpi=document.getElementById('hqAuswKpis');
            if(kpi) kpi.innerHTML='<div class="vit-card p-4 text-center"><p class="text-2xl font-bold text-gray-800">'+avgScore+'</p><p class="text-xs text-gray-500">√ò Nutzungs-Score</p></div>'
                +'<div class="vit-card p-4 text-center"><p class="text-2xl font-bold text-blue-600">'+avgLogins+'</p><p class="text-xs text-gray-500">√ò Logins/Monat</p></div>'
                +'<div class="vit-card p-4 text-center"><p class="text-2xl font-bold '+(bwaCount>=15?'text-green-600':'text-yellow-600')+'">'+bwaCount+'/21</p><p class="text-xs text-gray-500">BWA hochgeladen</p></div>'
                +'<div class="vit-card p-4 text-center"><p class="text-2xl font-bold text-vit-orange">'+avgModules+'</p><p class="text-xs text-gray-500">√ò Module genutzt</p></div>'
                +'<div class="vit-card p-4 text-center"><p class="text-2xl font-bold '+(inactive>3?'text-red-500':'text-gray-500')+'">'+inactive+'</p><p class="text-xs text-gray-500">Inaktive Standorte</p></div>';

            // Top 5
            var topEl=document.getElementById('hqAuswTop');
            if(topEl){
                var h='';
                sorted.slice(0,5).forEach(function(p,i){
                    var sc=calcScore(p);
                    h+='<div class="flex items-center space-x-3 p-2 bg-gray-50 rounded-lg"><span class="text-sm font-bold text-gray-300 w-5">'+(i+1)+'</span><div class="flex-1"><p class="text-xs font-semibold">'+p.name+'</p><p class="text-[10px] text-gray-400">'+p.logins+' Logins ¬∑ '+p.moduleUsed+' Module ¬∑ '+p.videosDone+' Videos</p></div><span class="text-sm font-bold text-green-600">'+sc+'</span></div>';
                });
                topEl.innerHTML=h;
            }

            // Bottom 5
            var botEl=document.getElementById('hqAuswBottom');
            if(botEl){
                var h='';
                sorted.slice(-5).reverse().forEach(function(p,i){
                    var sc=calcScore(p);
                    h+='<div class="flex items-center space-x-3 p-2 bg-gray-50 rounded-lg"><div class="flex-1"><p class="text-xs font-semibold text-gray-800">'+p.name+'</p><p class="text-[10px] text-gray-400">'+p.logins+' Logins ¬∑ Letzter: '+(p.lastLogin||'nie')+'</p></div><span class="text-sm font-bold '+(sc<10?'text-red-500':'text-yellow-600')+'">'+sc+'</span></div>';
                });
                botEl.innerHTML=h;
            }

            // Module usage
            var modEl=document.getElementById('hqAuswModules');
            if(modEl){
                var h='';
                modulNutzung.sort(function(a,b){return b.pct-a.pct;}).forEach(function(m){
                    h+='<div class="flex items-center space-x-3"><span class="text-sm w-5">'+m.icon+'</span><span class="text-xs w-32 truncate font-semibold">'+m.name+'</span><div class="flex-1 bg-gray-100 rounded-full h-3"><div class="h-3 rounded-full '+(m.pct>=75?'bg-green-500':m.pct>=50?'bg-yellow-500':'bg-red-400')+'" style="width:'+m.pct+'%"></div></div><span class="text-xs font-bold w-16 text-right">'+m.pct+'% ('+m.users+')</span></div>';
                });
                modEl.innerHTML=h;
            }

            // All locations bar
            var allEl=document.getElementById('hqAuswAll');
            if(allEl){
                var h='';
                sorted.forEach(function(p){
                    var sc=calcScore(p);
                    var maxSc=60;
                    var w=Math.min(100,Math.round(sc/maxSc*100));
                    h+='<div class="flex items-center space-x-2"><span class="text-[10px] w-28 truncate">'+p.name+'</span><div class="flex-1 bg-gray-100 rounded-full h-2.5"><div class="h-2.5 rounded-full '+(sc>=30?'bg-green-500':sc>=15?'bg-yellow-500':'bg-red-400')+'" style="width:'+w+'%"></div></div><span class="text-[10px] font-bold w-8 text-right">'+sc+'</span></div>';
                });
                allEl.innerHTML=h;
            }
        }

        // === HQ WISSEN-VERWALTUNG ===
        var hqWissenItems = [
            {titel:'E-Bike Beratungsleitfaden 2026',kat:'handbuch',bereich:'Verkauf',datum:'12.02.2026',status:'live'},
            {titel:'Werkstatt: Bosch CX Gen5 Service',kat:'akademie',bereich:'Werkstatt',datum:'08.02.2026',status:'live'},
            {titel:'Social Media Best Practices Q1',kat:'bestpractice',bereich:'Marketing',datum:'05.02.2026',status:'live'},
            {titel:'Kassensystem Einrichtung',kat:'handbuch',bereich:'Betrieb',datum:'01.02.2026',status:'live'},
            {titel:'FAQ: Garantie-Abwicklung',kat:'faq',bereich:'Verkauf',datum:'28.01.2026',status:'live'},
            {titel:'Leasing-Angebote richtig kalkulieren',kat:'akademie',bereich:'Verkauf',datum:'25.01.2026',status:'live'},
            {titel:'Ladenbau-Konzept Richtlinien',kat:'handbuch',bereich:'Betrieb',datum:'20.01.2026',status:'live'},
            {titel:'Instagram Reels Anleitung',kat:'bestpractice',bereich:'Marketing',datum:'15.01.2026',status:'live'}
        ];
        function renderHqWissen(){
            var el=document.getElementById('hqWissenList');
            if(!el) return;
            var katIcons={akademie:'üéì',handbuch:'üìñ',bestpractice:'‚≠ê',faq:'‚ùì'};
            var h='';
            hqWissenItems.forEach(function(w,i){
                h+='<div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg"><div class="flex items-center space-x-3"><span class="text-lg">'+katIcons[w.kat]+'</span><div><p class="text-sm font-semibold text-gray-800">'+w.titel+'</p><p class="text-xs text-gray-500">'+w.bereich+' ¬∑ '+w.datum+'</p></div></div><span class="text-xs px-2 py-1 rounded-full bg-green-100 text-green-700 font-semibold">'+w.status+'</span></div>';
            });
            el.innerHTML=h;
        }
        function addHqWissen(){
            var t=document.getElementById('hqWissenTitel');
            var k=document.getElementById('hqWissenKat');
            if(!t||!t.value.trim()){alert('Bitte Titel eingeben');return;}
            hqWissenItems.unshift({titel:t.value.trim(),kat:k.value,bereich:document.getElementById('hqWissenBereich').value,datum:new Date().toLocaleDateString('de-DE'),status:'live'});
            t.value='';document.getElementById('hqWissenInhalt').value='';
            renderHqWissen();
        }

        // === HQ SUPPORT-√úBERSICHT ===
        var hqSupportData = [
            {id:'T-2401',standort:'Grafrath',betreff:'Kassensystem Fehler beim Tagesabschluss',prio:'hoch',status:'offen',datum:'13.02.2026'},
            {id:'T-2402',standort:'Hamburg',betreff:'Schaufenster-Folie loest sich',prio:'mittel',status:'offen',datum:'13.02.2026'},
            {id:'T-2403',standort:'Weilheim',betreff:'Zugang Buchhaltungs-Tool gesperrt',prio:'hoch',status:'in Bearbeitung',datum:'12.02.2026'},
            {id:'T-2404',standort:'Karlsdorf',betreff:'Lieferverzoegerung Shimano Steps',prio:'mittel',status:'offen',datum:'12.02.2026'},
            {id:'T-2405',standort:'Grafrath',betreff:'Portal: BWA-Upload Fehlermeldung',prio:'niedrig',status:'in Bearbeitung',datum:'11.02.2026'},
            {id:'T-2406',standort:'Hamburg',betreff:'Marketing-Material fuer Fruehjahrsaktion',prio:'niedrig',status:'offen',datum:'11.02.2026'},
            {id:'T-2407',standort:'Weilheim',betreff:'Werkstatt-Terminplaner synchronisiert nicht',prio:'hoch',status:'in Bearbeitung',datum:'10.02.2026'}
        ];
        function renderHqSupport(){
            var el=document.getElementById('hqSupportTickets');
            if(!el) return;
            var prioColors={hoch:'bg-red-100 text-red-700',mittel:'bg-yellow-100 text-yellow-700',niedrig:'bg-gray-100 text-gray-600'};
            var statusColors={'offen':'bg-red-50 text-red-600','in Bearbeitung':'bg-blue-50 text-blue-600'};
            var h='';
            hqSupportData.forEach(function(t){
                h+='<div class="p-4 bg-gray-50 rounded-lg"><div class="flex items-center justify-between mb-2"><div class="flex items-center space-x-2"><span class="text-xs font-mono text-gray-400">'+t.id+'</span><span class="text-xs px-2 py-0.5 rounded-full font-semibold '+(prioColors[t.prio]||'')+'">'+t.prio+'</span><span class="text-xs px-2 py-0.5 rounded-full font-semibold '+(statusColors[t.status]||'')+'">'+t.status+'</span></div><span class="text-xs text-gray-400">'+t.datum+'</span></div><p class="text-sm font-semibold text-gray-800">'+t.betreff+'</p><p class="text-xs text-gray-500 mt-1">üìç '+t.standort+'</p></div>';
            });
            el.innerHTML=h;
            // Stats per location
            var stats={};
            hqSupportData.forEach(function(t){stats[t.standort]=(stats[t.standort]||0)+1;});
            var sEl=document.getElementById('hqSupportStats');
            if(sEl){
                var sh='';
                Object.keys(stats).sort(function(a,b){return stats[b]-stats[a];}).forEach(function(s){
                    sh+='<div class="flex items-center justify-between p-2 bg-gray-50 rounded"><span class="text-sm font-semibold">üìç '+s+'</span><span class="text-sm font-bold text-gray-800">'+stats[s]+' Tickets</span></div>';
                });
                sEl.innerHTML=sh;
            }
        }

        // === HQ IDEENBOARD ===
        var hqIdeenData = [
            {titel:'Gemeinsamer Einkaufspool fuer Zubehoer',standort:'Hamburg',stimmen:14,status:'in Pruefung',datum:'10.02.2026'},
            {titel:'Partner-Treffen alle 3 Monate',standort:'Grafrath',stimmen:21,status:'umgesetzt',datum:'08.02.2026'},
            {titel:'Einheitliches CRM-System',standort:'Weilheim',stimmen:18,status:'in Pruefung',datum:'05.02.2026'},
            {titel:'Video-Tutorials fuer Werkstatt',standort:'Karlsdorf',stimmen:9,status:'in Pruefung',datum:'03.02.2026'},
            {titel:'Black Friday Netzwerk-Aktion',standort:'Hamburg',stimmen:25,status:'umgesetzt',datum:'01.02.2026'},
            {titel:'Kundenbindungs-App',standort:'Grafrath',stimmen:7,status:'in Pruefung',datum:'28.01.2026'},
            {titel:'Gemeinsame Google-Ads Kampagne',standort:'Weilheim',stimmen:16,status:'umgesetzt',datum:'25.01.2026'},
            {titel:'Leih-Rad Programm zwischen Standorten',standort:'Karlsdorf',stimmen:4,status:'abgelehnt',datum:'20.01.2026'}
        ];
        function renderHqIdeen(){
            var el=document.getElementById('hqIdeenList');
            if(!el) return;
            var statusC={'in Pruefung':'bg-yellow-100 text-yellow-700','umgesetzt':'bg-green-100 text-green-700','abgelehnt':'bg-red-100 text-red-700'};
            var h='';
            hqIdeenData.sort(function(a,b){return b.stimmen-a.stimmen;}).forEach(function(idee){
                h+='<div class="p-4 bg-gray-50 rounded-lg"><div class="flex items-center justify-between mb-2"><div class="flex items-center space-x-3"><span class="text-lg font-bold text-vit-orange">üëç '+idee.stimmen+'</span><span class="text-xs px-2 py-0.5 rounded-full font-semibold '+(statusC[idee.status]||'')+'">'+idee.status+'</span></div><span class="text-xs text-gray-400">'+idee.datum+'</span></div><p class="text-sm font-semibold text-gray-800">'+idee.titel+'</p><p class="text-xs text-gray-500 mt-1">üí° Eingereicht von: '+idee.standort+'</p></div>';
            });
            el.innerHTML=h;
        }

        // === HQ SHOP-VERWALTUNG ===
        var hqShopOrders = [
            {nr:'B-20260214-001',standort:'Grafrath',produkte:'3x Polo-Shirt, 2x Roll-Up',summe:309.70,datum:'14.02.2026',status:'in Bearbeitung'},
            {nr:'B-20260213-004',standort:'Hamburg',produkte:'100x Visitenkarten, 50x Flyer',summe:138.90,datum:'13.02.2026',status:'versendet'},
            {nr:'B-20260213-002',standort:'Weilheim',produkte:'5x Trinkflasche, 20x Sattelbezug',summe:122.50,datum:'13.02.2026',status:'versendet'},
            {nr:'B-20260212-001',standort:'Karlsdorf',produkte:'1x Kundenstopper, 2x Fensterfolie',summe:239.00,datum:'12.02.2026',status:'geliefert'},
            {nr:'B-20260211-003',standort:'Hamburg',produkte:'10x Softshell-Jacke',summe:799.00,datum:'11.02.2026',status:'geliefert'}
        ];
        function renderHqShop(){
            // Orders
            var oEl=document.getElementById('hqShopOrders');
            if(oEl){
                var h='';
                var statusC={'in Bearbeitung':'bg-yellow-100 text-yellow-700','versendet':'bg-blue-100 text-blue-700','geliefert':'bg-green-100 text-green-700'};
                hqShopOrders.forEach(function(o){
                    h+='<div class="p-3 bg-gray-50 rounded-lg"><div class="flex items-center justify-between mb-1"><div class="flex items-center space-x-2"><span class="text-xs font-mono text-gray-400">'+o.nr+'</span><span class="text-xs px-2 py-0.5 rounded-full font-semibold '+(statusC[o.status]||'')+'">'+o.status+'</span></div><span class="text-sm font-bold text-gray-800">‚Ç¨ '+o.summe.toFixed(2)+'</span></div><p class="text-xs text-gray-600">'+o.produkte+'</p><p class="text-xs text-gray-400">üìç '+o.standort+' ¬∑ '+o.datum+'</p></div>';
                });
                oEl.innerHTML=h;
            }
            // Products from shop data
            var pEl=document.getElementById('hqShopProducts');
            if(pEl && typeof shopProducts!=='undefined'){
                var h='';
                shopProducts.forEach(function(p){
                    h+='<div class="flex items-center justify-between p-2 bg-gray-50 rounded"><div class="flex items-center space-x-2"><span>'+p.icon+'</span><span class="text-sm font-semibold">'+p.name+'</span><span class="text-xs text-gray-400">('+p.kat+')</span></div><span class="text-sm font-bold text-gray-800">'+(p.preis>0?'‚Ç¨ '+p.preis.toFixed(2):'Kostenlos')+'</span></div>';
                });
                pEl.innerHTML=h;
            }
        }
        function addHqShopProduct(){
            var n=document.getElementById('hqShopName');
            var p=document.getElementById('hqShopPreis');
            if(!n||!n.value.trim()){alert('Bitte Produktname eingeben');return;}
            if(typeof shopProducts!=='undefined'){
                shopProducts.push({id:'prod_new_'+Date.now(),name:n.value.trim(),kat:document.getElementById('hqShopKat').value,preis:parseFloat(p.value)||0,icon:'üÜï',beschreibung:document.getElementById('hqShopDesc').value||''});
            }
            n.value='';p.value='';document.getElementById('hqShopDesc').value='';
            renderHqShop();
        }
        var kzStandorte = []; // loaded from Supabase

        var kzMitarbeiter = []; // loaded from Supabase

        var currentKzStdFilter = 'all';
        var currentKzMaFilter = 'all';

        function showKommandoTab(tab) {
            document.querySelectorAll('.kommando-tab-content').forEach(function(el){el.style.display='none';});
            document.querySelectorAll('.kommando-tab-btn').forEach(function(b){
                b.className='kommando-tab-btn whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-semibold text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300';
            });
            var tabEl=document.getElementById('kommandoTab'+tab.charAt(0).toUpperCase()+tab.slice(1));
            if(tabEl)tabEl.style.display='block';
            var btn=document.querySelector('.kommando-tab-btn[data-ktab="'+tab+'"]');
            if(btn)btn.className='kommando-tab-btn whitespace-nowrap py-4 px-1 border-b-2 border-vit-orange font-semibold text-sm text-vit-orange';
            if(tab==='standorte') renderKzStandorte();
            if(tab==='mitarbeiter') renderKzMitarbeiter();
            if(tab==='kommunikation') renderHqKomm();
            if(tab==='kampagnen') renderHqKampagnen();
            if(tab==='dokumente') renderHqDokumente();
            if(tab==='kalender') renderHqKalender();
            if(tab==='aufgaben') renderHqAufgaben();
        }

        function filterKzStandorte(f) {
            currentKzStdFilter=f;
            document.querySelectorAll('.kz-std-filter').forEach(function(b){b.className='kz-std-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-gray-100 text-gray-600';});
            var btn=document.querySelector('.kz-std-filter[data-kzf="'+f+'"]');
            if(btn)btn.className='kz-std-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-vit-orange text-white';
            renderKzStandorte();
        }
        function filterKzMa(f) {
            currentKzMaFilter=f;
            document.querySelectorAll('.kz-ma-filter').forEach(function(b){b.className='kz-ma-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-gray-100 text-gray-600';});
            var btn=document.querySelector('.kz-ma-filter[data-kzmf="'+f+'"]');
            if(btn)btn.className='kz-ma-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-vit-orange text-white';
            renderKzMitarbeiter();
        }

        function statusBadge(s) {
            if(s==='aktiv') return '<span class="px-2 py-1 rounded-full text-[10px] font-semibold bg-green-100 text-green-700">üü¢ Aktiv</span>';
            if(s==='onboarding') return '<span class="px-2 py-1 rounded-full text-[10px] font-semibold bg-blue-100 text-blue-700">üîµ Onboarding</span>';
            if(s==='offboarding') return '<span class="px-2 py-1 rounded-full text-[10px] font-semibold bg-red-100 text-red-700">üî¥ Offboarding</span>';
            return s;
        }
        function rolleBadge(r) {
            var colors = {'inhaber':'bg-vit-orange text-white','verkauf':'bg-blue-100 text-blue-700','werkstatt':'bg-gray-200 text-gray-700','buchhaltung':'bg-purple-100 text-purple-700','hq':'bg-red-100 text-red-700'};
            var labels = {'inhaber':'Gesch√§ftsleitung','verkauf':'Verkauf','werkstatt':'Werkstatt','buchhaltung':'Buchhaltung','hq':'HQ'};
            return '<span class="px-2 py-1 rounded-full text-[10px] font-semibold '+(colors[r]||'bg-gray-100 text-gray-600')+'">'+(labels[r]||r)+'</span>';
        }
        function rollenBadges(rollen) {
            return rollen.map(function(r){ return rolleBadge(r); }).join(' ');
        }

        async function renderKzStandorte() {
            var body=document.getElementById('kzStandorteBody');
            if(!body)return;
            try {
                var resp = await sb.from('standorte').select('*').order('name');
                if(resp.error) throw resp.error;
                var standorte = resp.data || [];
                var countResp = await sb.from('users').select('standort_id');
                var userCounts = {};
                (countResp.data||[]).forEach(function(u){ if(u.standort_id) userCounts[u.standort_id] = (userCounts[u.standort_id]||0)+1; });
                var filter = currentKzStdFilter || 'all';
                var h='';
                standorte.forEach(function(s){
                    var st = s.status || 'aktiv';
                    if(filter!=='all' && st!==filter) return;
                    var d = s.created_at ? new Date(s.created_at) : new Date();
                    var beitritt = String(d.getMonth()+1).padStart(2,'0')+'/'+d.getFullYear();
                    h+='<tr class="border-t border-gray-100 hover:bg-gray-50">';
                    h+='<td class="px-4 py-3 font-semibold text-gray-800">'+s.name+'</td>';
                    h+='<td class="px-4 py-3 text-gray-600">'+(s.adresse||s.region||'')+'</td>';
                    h+='<td class="px-4 py-3"><span class="text-xs px-2 py-0.5 rounded '+(s.is_premium?'bg-vit-orange text-white':'bg-gray-100 text-gray-600')+'">'+(s.is_premium?'Premium':'Standard')+'</span></td>';
                    h+='<td class="px-4 py-3 text-center">'+statusBadge(st)+'</td>';
                    h+='<td class="px-4 py-3 text-center font-semibold">'+(userCounts[s.id]||0)+'</td>';
                    h+='<td class="px-4 py-3 text-center text-gray-500 text-xs">'+beitritt+'</td>';
                    h+='<td class="px-4 py-3 text-center text-xs text-gray-500">'+(s.telefon||'‚Äî')+'</td>';
                    h+='<td class="px-4 py-3 text-center"><button class="text-xs text-vit-orange hover:underline font-semibold" onclick="alert(\''+s.name+'\\nAdresse: '+(s.adresse||'‚Äì')+'\\nTelefon: '+(s.telefon||'‚Äì')+'\\nSlug: '+s.slug+'\')">Details ‚Üí</button></td>';
                    h+='</tr>';
                });
                if(standorte.length===0) h='<tr><td colspan="8" class="text-center py-8 text-gray-400">Keine Standorte.</td></tr>';
                body.innerHTML=h;
                var ge=document.getElementById('kzStandorteGesamt');if(ge)ge.textContent=standorte.length;
                var ak=document.getElementById('kzStandorteAktiv');if(ak)ak.textContent=standorte.filter(function(s){return (s.status||'aktiv')==='aktiv';}).length;
                var ob=document.getElementById('kzStandorteOnb');if(ob)ob.textContent=standorte.filter(function(s){return s.status==='onboarding';}).length;
                var of2=document.getElementById('kzStandorteOff');if(of2)of2.textContent=standorte.filter(function(s){return s.status==='offboarding';}).length;
            } catch(err) { console.error('Standorte:', err); body.innerHTML='<tr><td colspan="8" class="text-center py-4 text-red-400">Fehler: '+err.message+'</td></tr>'; }
        }

        async function renderKzMitarbeiter() {
            var body=document.getElementById('kzMaBody');
            if(!body)return;
            try {
                var resp = await sb.from('users').select('*, standorte(name), user_rollen(rollen(name,label))').order('name');
                if(resp.error) throw resp.error;
                var users = resp.data || [];
                var stdFilter=(document.getElementById('kzMaStandortFilter')||{}).value||'all';
                var filter = currentKzMaFilter || 'all';
                var list = users.filter(function(u){
                    var st = u.status || 'aktiv';
                    if(filter!=='all' && st!==filter) return false;
                    var stdName = u.standorte ? u.standorte.name : 'HQ';
                    if(stdFilter!=='all' && stdName!==stdFilter) return false;
                    return true;
                });
                var h='';
                list.forEach(function(u){
                    var stdName = u.standorte ? u.standorte.name : 'HQ';
                    var rollen = (u.user_rollen||[]).map(function(ur){ return ur.rollen ? ur.rollen.name : ''; }).filter(Boolean);
                    var st = u.status || 'aktiv';
                    var d = u.created_at ? new Date(u.created_at) : new Date();
                    var eintritt = String(d.getMonth()+1).padStart(2,'0')+'/'+d.getFullYear();
                    // Action button: Freigeben for onboarding, Details for others
                    var actionBtn = '';
                    if(st === 'onboarding' && rollen.length === 0) {
                        actionBtn = '<button class="text-xs px-3 py-1 bg-green-500 text-white rounded-lg font-semibold hover:bg-green-600" onclick="approveUser(\''+u.id+'\',\''+u.name.replace(/'/g,"\\'")+'\')">Freigeben</button>';
                    } else {
                        actionBtn = '<button class="text-xs text-vit-orange hover:underline font-semibold" onclick="alert(\''+u.name.replace(/'/g,"\\'")+'\\n'+u.email+'\')">Details</button>';
                    }
                    h+='<tr class="border-t border-gray-100 hover:bg-gray-50'+(st==='onboarding' && rollen.length===0 ? ' bg-yellow-50':'')+'">';
                    h+='<td class="px-4 py-3"><div class="flex items-center space-x-2"><img src="https://ui-avatars.com/api/?name='+encodeURIComponent(u.name)+'&background=EF7D00&color=fff&size=28" class="w-7 h-7 rounded-full"><div><span class="font-semibold text-gray-800">'+u.name+'</span><p class="text-[10px] text-gray-400">'+u.email+'</p></div></div></td>';
                    h+='<td class="px-4 py-3 text-gray-600 text-xs">'+stdName+'</td>';
                    h+='<td class="px-4 py-3 text-center">'+(rollen.length > 0 ? rollenBadges(rollen) : '<span class="text-xs text-yellow-600 font-semibold">Wartet auf Freigabe</span>')+'</td>';
                    h+='<td class="px-4 py-3 text-center">'+statusBadge(st)+'</td>';
                    h+='<td class="px-4 py-3 text-center text-gray-500 text-xs">'+eintritt+'</td>';
                    h+='<td class="px-4 py-3 text-center"><span class="text-xs text-gray-400">'+(u.user_rollen||[]).map(function(ur){return ur.rollen?ur.rollen.label:'';}).filter(Boolean).join(', ')+'</span></td>';
                    h+='<td class="px-4 py-3 text-center">'+actionBtn+'</td>';
                    h+='</tr>';
                });
                if(list.length===0) h='<tr><td colspan="7" class="text-center py-8 text-gray-400">Keine Mitarbeiter gefunden.</td></tr>';
                body.innerHTML=h;
                var ge=document.getElementById('kzMaGesamt');if(ge)ge.textContent=users.length;
                var ak=document.getElementById('kzMaAktiv');if(ak)ak.textContent=users.filter(function(u){return (u.status||'aktiv')==='aktiv';}).length;
                var onbCount = users.filter(function(u){return u.status==='onboarding';}).length;
                var ob=document.getElementById('kzMaOnb');if(ob)ob.textContent=onbCount;
                var of2=document.getElementById('kzMaOff');if(of2)of2.textContent=users.filter(function(u){return u.status==='offboarding';}).length;
                var ro=document.getElementById('kzRollen');if(ro)ro.textContent='4';
                // Standort dropdown
                var sel=document.getElementById('kzMaStandortFilter');
                if(sel && sel.options.length<=1){
                    var standorte=[];
                    users.forEach(function(u){ var sn=u.standorte?u.standorte.name:'HQ'; if(standorte.indexOf(sn)===-1)standorte.push(sn); });
                    standorte.sort().forEach(function(s){sel.innerHTML+='<option value="'+s+'">'+s+'</option>';});
                }
            } catch(err) { console.error('Mitarbeiter:', err); body.innerHTML='<tr><td colspan="7" class="text-center py-4 text-red-400">Fehler: '+err.message+'</td></tr>'; }
        }

        // === USER FREIGABE ===
        async function approveUser(userId, userName) {
            var allRollen = ['hq','inhaber','verkauf','werkstatt','buchhaltung'];
            var labels = {'inhaber':'Gesch√§ftsleitung','verkauf':'Verkauf','werkstatt':'Werkstatt','buchhaltung':'Buchhaltung'};
            
            var html = '<div id="approveOverlay" onclick="closeApproveModal()" style="position:fixed;inset:0;background:rgba(0,0,0,0.5);z-index:9999;display:flex;align-items:center;justify-content:center;">';
            html += '<div onclick="event.stopPropagation()" style="background:white;border-radius:16px;padding:24px;width:420px;max-width:90vw;box-shadow:0 25px 50px rgba(0,0,0,0.25);">';
            html += '<div class="flex items-center justify-between mb-4"><h3 class="text-lg font-bold text-gray-800">User freigeben</h3><button onclick="closeApproveModal()" class="text-gray-400 hover:text-gray-600 text-xl">\u2715</button></div>';
            html += '<p class="text-sm text-gray-600 mb-4"><strong>'+userName+'</strong> hat sich registriert und wartet auf Freigabe.</p>';
            html += '<p class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2">Rollen zuweisen</p>';
            var colors = {'hq':'border-red-300 bg-red-50','inhaber':'border-orange-300 bg-orange-50','verkauf':'border-blue-300 bg-blue-50','werkstatt':'border-gray-300 bg-gray-50','buchhaltung':'border-purple-300 bg-purple-50'};
            allRollen.forEach(function(r){
                html += '<label class="flex items-center space-x-3 p-2.5 rounded-lg border '+colors[r]+' mb-2 cursor-pointer hover:shadow-sm transition">';
                html += '<input type="checkbox" id="approveRole_'+r+'" class="rounded" style="accent-color:#EF7D00;">';
                html += '<span class="text-sm font-semibold text-gray-800">'+labels[r]+'</span>';
                html += '</label>';
            });
            html += '<div class="flex space-x-3 mt-4">';
            html += '<button onclick="confirmApprove(\''+userId+'\')" class="flex-1 py-2.5 bg-green-500 text-white rounded-lg font-semibold text-sm hover:bg-green-600">\u2705 Freigeben</button>';
            html += '<button onclick="rejectUser(\''+userId+'\')" class="flex-1 py-2.5 bg-red-100 text-red-600 rounded-lg font-semibold text-sm hover:bg-red-200">\u274c Ablehnen</button>';
            html += '</div>';
            html += '</div></div>';
            
            var c = document.createElement('div');
            c.id = 'approveContainer';
            c.innerHTML = html;
            document.body.appendChild(c);
        }

        function closeApproveModal() {
            var c = document.getElementById('approveContainer');
            if(c) c.remove();
        }

        async function confirmApprove(userId) {
            var allRollen = ['hq','inhaber','verkauf','werkstatt','buchhaltung'];
            var selected = [];
            allRollen.forEach(function(r){
                var chk = document.getElementById('approveRole_'+r);
                if(chk && chk.checked) selected.push(r);
            });
            if(selected.length === 0) { alert('Bitte mindestens eine Rolle zuweisen.'); return; }
            
            try {
                // 1. Status auf aktiv setzen
                var upd = await sb.from('users').update({status: 'aktiv'}).eq('id', userId);
                if(upd.error) throw upd.error;
                
                // 2. Rollen zuweisen
                for(var i=0; i<selected.length; i++) {
                    var rolleResp = await sb.from('rollen').select('id').eq('name', selected[i]).single();
                    if(rolleResp.data) {
                        await sb.from('user_rollen').insert({user_id: userId, rolle_id: rolleResp.data.id});
                    }
                }
                
                closeApproveModal();
                alert('\u2705 User freigeschaltet! Der Mitarbeiter kann sich jetzt einloggen.');
                renderKzMitarbeiter();
            } catch(err) {
                alert('Fehler: ' + err.message);
            }
        }

        async function rejectUser(userId) {
            if(!confirm('User wirklich ablehnen? Der Account wird deaktiviert.')) return;
            try {
                await sb.from('users').update({status: 'offboarding'}).eq('id', userId);
                closeApproveModal();
                alert('User abgelehnt.');
                renderKzMitarbeiter();
            } catch(err) { alert('Fehler: ' + err.message); }
        }

        // === ROLLEN-MODAL ===
        function openRollenModal(maIdx) {
            var m = kzMitarbeiter[maIdx];
            if(!m) return;
            var allRollen = ['hq','inhaber','verkauf','werkstatt','buchhaltung'];
            var labels = {'inhaber':'Gesch√§ftsleitung','verkauf':'Verkauf','werkstatt':'Werkstatt','buchhaltung':'Buchhaltung'};
            var desc = {'inhaber':'Vollzugriff auf alle Module, Dashboards, Shop, Onboarding','verkauf':'Verkauf, Marketing, Wissen, Support, Ideenboard','werkstatt':'Einkauf, Wissen, Support, Ideenboard','buchhaltung':'Allgemein, Verkauf, Einkauf, Controlling, Aktenschrank'};

            var html = '<div id="rollenModalOverlay" onclick="closeRollenModal()" style="position:fixed;inset:0;background:rgba(0,0,0,0.5);z-index:9999;display:flex;align-items:center;justify-content:center;">';
            html += '<div onclick="event.stopPropagation()" style="background:white;border-radius:16px;padding:24px;width:420px;max-width:90vw;box-shadow:0 25px 50px rgba(0,0,0,0.25);">';
            html += '<div class="flex items-center justify-between mb-4"><h3 class="text-lg font-bold text-gray-800">Rollen bearbeiten</h3><button onclick="closeRollenModal()" class="text-gray-400 hover:text-gray-600 text-xl">‚úï</button></div>';
            html += '<div class="flex items-center space-x-3 mb-5 pb-4 border-b"><img src="https://ui-avatars.com/api/?name='+encodeURIComponent(m.name)+'&background=EF7D00&color=fff&size=40" class="w-10 h-10 rounded-full"><div><p class="font-semibold text-gray-800">'+m.name+'</p><p class="text-xs text-gray-500">'+m.standort+' ¬∑ '+m.email+'</p></div></div>';
            html += '<p class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-3">Rollen zuweisen (Mehrfachauswahl)</p>';
            allRollen.forEach(function(r){
                var checked = m.rollen.indexOf(r)>=0 ? 'checked' : '';
                var colors = {'hq':'border-red-300 bg-red-50','inhaber':'border-orange-300 bg-orange-50','verkauf':'border-blue-300 bg-blue-50','werkstatt':'border-gray-300 bg-gray-50','buchhaltung':'border-purple-300 bg-purple-50'};
                html += '<label class="flex items-start space-x-3 p-3 rounded-lg border '+colors[r]+' mb-2 cursor-pointer hover:shadow-sm transition">';
                html += '<input type="checkbox" id="roleChk_'+r+'" '+checked+' class="mt-1 rounded" style="accent-color:#EF7D00;">';
                html += '<div><p class="font-semibold text-sm text-gray-800">'+labels[r]+'</p><p class="text-[11px] text-gray-500">'+desc[r]+'</p></div>';
                html += '</label>';
            });
            html += '<div class="flex space-x-3 mt-5"><button onclick="saveRollen('+maIdx+')" class="flex-1 py-2.5 bg-vit-orange text-white rounded-lg font-semibold text-sm hover:opacity-90">Speichern</button>';
            html += '<button onclick="closeRollenModal()" class="flex-1 py-2.5 bg-gray-100 text-gray-600 rounded-lg font-semibold text-sm hover:bg-gray-200">Abbrechen</button></div>';
            html += '</div></div>';

            var container = document.createElement('div');
            container.id = 'rollenModalContainer';
            container.innerHTML = html;
            document.body.appendChild(container);
        }
        function closeRollenModal() {
            var c = document.getElementById('rollenModalContainer');
            if(c) c.remove();
        }
        function saveRollen(maIdx) {
            var allRollen = ['hq','inhaber','verkauf','werkstatt','buchhaltung'];
            var selected = [];
            allRollen.forEach(function(r){
                var chk = document.getElementById('roleChk_'+r);
                if(chk && chk.checked) selected.push(r);
            });
            if(selected.length===0) { alert('Mindestens eine Rolle muss zugewiesen werden.'); return; }
            kzMitarbeiter[maIdx].rollen = selected;
            closeRollenModal();
            renderKzMitarbeiter();

            var labels = {'inhaber':'Gesch√§ftsleitung','verkauf':'Verkauf','werkstatt':'Werkstatt','buchhaltung':'Buchhaltung'};
            var names = selected.map(function(r){return labels[r];}).join(', ');
            alert('‚úÖ Rollen f√ºr '+kzMitarbeiter[maIdx].name+' gespeichert:\n'+names);
        }

        // === PARTNER MITARBEITER-VERWALTUNG (GF-Ebene) ===
        var currentPartnerMaFilter = 'all';

        function getStandortName() {
            if(currentLocation && locations[currentLocation]) return locations[currentLocation].name;
            return 'Grafrath';
        }

        function getPartnerMitarbeiter() {
            var sName = getStandortName();
            return kzMitarbeiter.filter(function(m){ return m.standort === sName; });
        }

        function filterPartnerMa(f) {
            currentPartnerMaFilter = f;
            document.querySelectorAll('.p-ma-filter').forEach(function(b){
                b.className='p-ma-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-gray-100 text-gray-600';
            });
            var btn=document.querySelector('.p-ma-filter[data-pmf="'+f+'"]');
            if(btn) btn.className='p-ma-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-vit-orange text-white';
            renderPartnerMitarbeiter();
        }

        function renderPartnerMitarbeiter() {
            var list = getPartnerMitarbeiter().filter(function(m){
                if(currentPartnerMaFilter!=='all' && m.status!==currentPartnerMaFilter) return false;
                return true;
            });
            var allLocal = getPartnerMitarbeiter();

            // KPIs
            var ge=document.getElementById('pMaGesamt');if(ge)ge.textContent=allLocal.length;
            var ak=document.getElementById('pMaAktiv');if(ak)ak.textContent=allLocal.filter(function(m){return m.status==='aktiv';}).length;
            var ob=document.getElementById('pMaOnb');if(ob)ob.textContent=allLocal.filter(function(m){return m.status==='onboarding';}).length;

            var body=document.getElementById('partnerMaBody');
            if(!body) return;
            var h='';
            list.forEach(function(m){
                var origIdx = kzMitarbeiter.indexOf(m);
                h+='<tr class="border-t border-gray-100 hover:bg-gray-50">';
                h+='<td class="px-4 py-3"><div class="flex items-center space-x-2"><img src="https://ui-avatars.com/api/?name='+encodeURIComponent(m.name)+'&background=EF7D00&color=fff&size=28" class="w-7 h-7 rounded-full"><span class="font-semibold text-gray-800">'+m.name+'</span></div></td>';
                h+='<td class="px-4 py-3 text-gray-500 text-xs">'+m.email+'</td>';
                h+='<td class="px-4 py-3 text-center">'+rollenBadges(m.rollen)+'</td>';
                h+='<td class="px-4 py-3 text-center">'+statusBadge(m.status)+'</td>';
                h+='<td class="px-4 py-3 text-center text-gray-500 text-xs">'+m.eintritt+'</td>';
                h+='<td class="px-4 py-3 text-center"><div class="flex justify-center space-x-2">';
                h+='<button class="text-xs text-vit-orange hover:underline font-semibold" onclick="openRollenModal('+origIdx+')">Rollen ‚úèÔ∏è</button>';
                h+='<button class="text-xs text-red-400 hover:underline font-semibold" onclick="deactivateMa('+origIdx+')">Deaktivieren</button>';
                h+='</div></td>';
                h+='</tr>';
            });
            if(list.length===0) {
                h='<tr><td colspan="6" class="px-4 py-8 text-center text-gray-400">Keine Mitarbeiter gefunden.</td></tr>';
            }
            body.innerHTML=h;
        }

        function deactivateMa(idx) {
            var m=kzMitarbeiter[idx];
            if(!m) return;
            if(!confirm('Mitarbeiter "'+m.name+'" wirklich deaktivieren?')) return;
            m.status='offboarding';
            renderPartnerMitarbeiter();
        }

        // Neuer Mitarbeiter Modal
        function openNeuerMaModal() {
            var allRollen = ['hq','inhaber','verkauf','werkstatt','buchhaltung'];
            var labels = {'inhaber':'Gesch√§ftsleitung','verkauf':'Verkauf','werkstatt':'Werkstatt','buchhaltung':'Buchhaltung'};

            var html = '<div id="neuerMaOverlay" onclick="closeNeuerMaModal()" style="position:fixed;inset:0;background:rgba(0,0,0,0.5);z-index:9999;display:flex;align-items:center;justify-content:center;">';
            html += '<div onclick="event.stopPropagation()" style="background:white;border-radius:16px;padding:24px;width:460px;max-width:90vw;box-shadow:0 25px 50px rgba(0,0,0,0.25);">';
            html += '<div class="flex items-center justify-between mb-5"><h3 class="text-lg font-bold text-gray-800">Neuen Mitarbeiter anlegen</h3><button onclick="closeNeuerMaModal()" class="text-gray-400 hover:text-gray-600 text-xl">‚úï</button></div>';

            html += '<div class="space-y-3 mb-5">';
            html += '<div><label class="block text-xs font-semibold text-gray-600 mb-1">Name *</label><input id="newMaName" type="text" class="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500" placeholder="Vor- und Nachname"></div>';
            html += '<div><label class="block text-xs font-semibold text-gray-600 mb-1">E-Mail *</label><input id="newMaEmail" type="email" class="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500" placeholder="name@vitbikes-standort.de"></div>';
            html += '<div><label class="block text-xs font-semibold text-gray-600 mb-1">Passwort *</label><input id="newMaPassword" type="text" class="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500" placeholder="Mindestens 6 Zeichen" value="VitBikes2026!"></div>';
            html += '<div><label class="block text-xs font-semibold text-gray-600 mb-1">Standort *</label><select id="newMaStandort" class="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500"><option value="">Wird geladen...</option></select></div>';
            html += '</div>';
            // Load standorte into dropdown after rendering
            setTimeout(async function(){
                try {
                    var stdResp = await sb.from('standorte').select('id,name').order('name');
                    var sel = document.getElementById('newMaStandort');
                    if(sel && stdResp.data) {
                        sel.innerHTML = '<option value="hq">HQ (kein Standort)</option>';
                        stdResp.data.forEach(function(s){ sel.innerHTML += '<option value="'+s.id+'">'+s.name+'</option>'; });
                    }
                } catch(e){}
            }, 100);

            html += '<p class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2">Rollen zuweisen (Mehrfachauswahl)</p>';
            var colors = {'hq':'border-red-300 bg-red-50','inhaber':'border-orange-300 bg-orange-50','verkauf':'border-blue-300 bg-blue-50','werkstatt':'border-gray-300 bg-gray-50','buchhaltung':'border-purple-300 bg-purple-50'};
            allRollen.forEach(function(r){
                html += '<label class="flex items-center space-x-3 p-2.5 rounded-lg border '+colors[r]+' mb-2 cursor-pointer hover:shadow-sm transition">';
                html += '<input type="checkbox" id="newMaRole_'+r+'" class="rounded" style="accent-color:#EF7D00;">';
                html += '<span class="text-sm font-semibold text-gray-800">'+labels[r]+'</span>';
                html += '</label>';
            });

            html += '<div class="flex space-x-3 mt-5"><button onclick="saveNeuerMa()" class="flex-1 py-2.5 bg-vit-orange text-white rounded-lg font-semibold text-sm hover:opacity-90">Anlegen</button>';
            html += '<button onclick="closeNeuerMaModal()" class="flex-1 py-2.5 bg-gray-100 text-gray-600 rounded-lg font-semibold text-sm hover:bg-gray-200">Abbrechen</button></div>';
            html += '</div></div>';

            var c = document.createElement('div');
            c.id = 'neuerMaContainer';
            c.innerHTML = html;
            document.body.appendChild(c);
        }

        function closeNeuerMaModal() {
            var c = document.getElementById('neuerMaContainer');
            if(c) c.remove();
        }

        function saveNeuerMa() {
            var name = (document.getElementById('newMaName')||{}).value||'';
            var email = (document.getElementById('newMaEmail')||{}).value||'';
            if(!name.trim() || !email.trim()) { alert('Bitte Name und E-Mail ausf√ºllen.'); return; }

            var allRollen = ['hq','inhaber','verkauf','werkstatt','buchhaltung'];
            var selected = [];
            allRollen.forEach(function(r){
                var chk = document.getElementById('newMaRole_'+r);
                if(chk && chk.checked) selected.push(r);
            });
            if(selected.length===0) { alert('Bitte mindestens eine Rolle zuweisen.'); return; }

            var now = new Date();
            var monat = ('0'+(now.getMonth()+1)).slice(-2)+'/'+now.getFullYear();

            kzMitarbeiter.push({
                name: name.trim(),
                standort: getStandortName(),
                rollen: selected,
                status: 'onboarding',
                eintritt: monat,
                onbProgress: 0,
                email: email.trim().toLowerCase()
            });

            closeNeuerMaModal();
            renderPartnerMitarbeiter();

            var rollenLabels = {'inhaber':'Gesch√§ftsleitung','verkauf':'Verkauf','werkstatt':'Werkstatt','buchhaltung':'Buchhaltung'};
            var rollenStr = selected.map(function(r){return rollenLabels[r];}).join(', ');
            alert('‚úÖ Mitarbeiter angelegt:\n'+name.trim()+'\nRollen: '+rollenStr+'\nStatus: Onboarding');
        }


        // === NEUER STANDORT MODAL ===
        function openNeuerStandortModal() {
            var html = '<div id="neuerStdOverlay" onclick="closeNeuerStdModal()" style="position:fixed;inset:0;background:rgba(0,0,0,0.5);z-index:9999;display:flex;align-items:center;justify-content:center;">';
            html += '<div onclick="event.stopPropagation()" style="background:white;border-radius:16px;padding:24px;width:460px;max-width:90vw;box-shadow:0 25px 50px rgba(0,0,0,0.25);">';
            html += '<div class="flex items-center justify-between mb-5"><h3 class="text-lg font-bold text-gray-800">Neuen Standort anlegen</h3><button onclick="closeNeuerStdModal()" class="text-gray-400 hover:text-gray-600 text-xl">\u2715</button></div>';
            html += '<div class="space-y-3 mb-5">';
            html += '<div><label class="block text-xs font-semibold text-gray-600 mb-1">Name *</label><input id="newStdName" type="text" class="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500" placeholder="z.B. vit:bikes M√ºnchen"></div>';
            html += '<div><label class="block text-xs font-semibold text-gray-600 mb-1">Slug * (URL-Key, nur Kleinbuchstaben)</label><input id="newStdSlug" type="text" class="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500" placeholder="z.B. muenchen"></div>';
            html += '<div class="grid grid-cols-2 gap-3">';
            html += '<div><label class="block text-xs font-semibold text-gray-600 mb-1">Region</label><select id="newStdRegion" class="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm"><option>S√ºd</option><option>Nord</option><option>West</option><option>Ost</option><option>Mitte</option></select></div>';
            html += '<div><label class="block text-xs font-semibold text-gray-600 mb-1">Status</label><select id="newStdStatus" class="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm"><option value="onboarding">Onboarding</option><option value="aktiv">Aktiv</option></select></div>';
            html += '</div>';
            html += '<div><label class="block text-xs font-semibold text-gray-600 mb-1">Adresse</label><input id="newStdAdresse" type="text" class="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm" placeholder="Stra√üe, PLZ Ort"></div>';
            html += '<div><label class="block text-xs font-semibold text-gray-600 mb-1">Telefon</label><input id="newStdTelefon" type="text" class="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm" placeholder="+49 ..."></div>';
            html += '<div><label class="flex items-center space-x-2 cursor-pointer"><input type="checkbox" id="newStdPremium" style="accent-color:#EF7D00;"><span class="text-sm text-gray-700">Premium-Partner</span></label></div>';
            html += '</div>';
            html += '<div class="flex space-x-3"><button onclick="saveNeuerStandort()" class="flex-1 py-2.5 bg-vit-orange text-white rounded-lg font-semibold text-sm hover:opacity-90">Anlegen</button>';
            html += '<button onclick="closeNeuerStdModal()" class="flex-1 py-2.5 bg-gray-100 text-gray-600 rounded-lg font-semibold text-sm hover:bg-gray-200">Abbrechen</button></div>';
            html += '</div></div>';
            var container = document.createElement('div');
            container.id = 'neuerStdContainer';
            container.innerHTML = html;
            document.body.appendChild(container);
            // Auto-generate slug from name
            var nameInput = document.getElementById('newStdName');
            if(nameInput) nameInput.addEventListener('input', function(){
                var slug = this.value.toLowerCase().replace(/vit:bikes\s*/i,'').replace(/[^a-z0-9]/g,'-').replace(/-+/g,'-').replace(/^-|-$/g,'');
                var slugInput = document.getElementById('newStdSlug');
                if(slugInput) slugInput.value = slug;
            });
        }

        function closeNeuerStdModal() {
            var c = document.getElementById('neuerStdContainer');
            if(c) c.remove();
        }

        async function saveNeuerStandort() {
            var name = (document.getElementById('newStdName')||{}).value||'';
            var slug = (document.getElementById('newStdSlug')||{}).value||'';
            var region = (document.getElementById('newStdRegion')||{}).value||'S√ºd';
            var status = (document.getElementById('newStdStatus')||{}).value||'onboarding';
            var adresse = (document.getElementById('newStdAdresse')||{}).value||'';
            var telefon = (document.getElementById('newStdTelefon')||{}).value||'';
            var premium = (document.getElementById('newStdPremium')||{}).checked||false;

            if(!name.trim() || !slug.trim()) { alert('Bitte Name und Slug ausf√ºllen.'); return; }
            slug = slug.toLowerCase().replace(/[^a-z0-9-]/g,'');

            var btn = document.querySelector('#neuerStdContainer .bg-vit-orange');
            if(btn) { btn.disabled=true; btn.textContent='Wird angelegt...'; }

            try {
                var resp = await sb.from('standorte').insert({
                    name: name.trim(),
                    slug: slug,
                    region: region,
                    status: status,
                    is_premium: premium,
                    adresse: adresse.trim() || null,
                    telefon: telefon.trim() || null
                }).select().single();
                if(resp.error) throw resp.error;

                closeNeuerStdModal();
                alert('\u2705 Standort angelegt!\n'+name.trim()+'\nSlug: '+slug+'\nStatus: '+status);
                renderKzStandorte();
            } catch(err) {
                alert('Fehler: ' + err.message);
                if(btn) { btn.disabled=false; btn.textContent='Anlegen'; }
            }
        }

        // === HQ EINSTELLUNGEN - RECHTE-MATRIX ===
        function showSettingsTab(tab) {
            document.querySelectorAll('.settings-tab').forEach(function(b){
                b.className = 'settings-tab px-4 py-2.5 text-sm font-semibold border-b-2 border-transparent text-gray-500 hover:text-gray-700';
            });
            var btn = document.querySelector('.settings-tab[data-tab="'+tab+'"]');
            if(btn) btn.className = 'settings-tab px-4 py-2.5 text-sm font-semibold border-b-2 border-vit-orange text-vit-orange';
            document.querySelectorAll('.settings-tab-content').forEach(function(c){ c.style.display = 'none'; });
            var content = document.getElementById('settingsTab' + tab.charAt(0).toUpperCase() + tab.slice(1));
            if(content) content.style.display = '';
        }

        async function renderModulStatusList() {
            var container = document.getElementById('modulStatusList');
            if(!container) return;
            try {
                var resp = await sb.from('modul_status').select('*').order('reihenfolge');
                if(resp.error) throw resp.error;
                var modules = resp.data || [];
                var html = '';
                var katLabels = {basis:'Basis',dashboards:'Dashboards',fachbereiche:'Fachbereiche',tools:'Tools'};
                var lastKat = '';
                var counts = {aktiv:0, in_bearbeitung:0, deaktiviert:0};

                modules.forEach(function(m) {
                    counts[m.status] = (counts[m.status]||0) + 1;
                    if(m.kategorie !== lastKat) {
                        lastKat = m.kategorie;
                        html += '<div class="px-5 py-2 bg-gray-50 text-xs font-bold text-gray-500 uppercase tracking-wider">' + (katLabels[m.kategorie]||m.kategorie) + '</div>';
                    }
                    var icons = {startseite:'üè†',kalender:'üìÖ',aufgaben:'üìã',kommunikation:'üí¨',dashboards:'üìä',allgemein:'üè¢',verkauf:'üìà',einkauf:'üõí',marketing:'üì£',controlling:'üìä',wissen:'üìö',support:'üé´',ideenboard:'üí°',shop:'üõçÔ∏è',onboarding:'üéØ',mitarbeiter:'üë•'};
                    html += '<div class="px-5 py-3 flex items-center justify-between hover:bg-gray-50 transition">';
                    html += '<div class="flex items-center space-x-3">';
                    html += '<span class="text-xl">' + (icons[m.modul_key]||'üì¶') + '</span>';
                    html += '<div><span class="font-semibold text-gray-800 text-sm">' + m.modul_name + '</span>';
                    html += '<span class="text-xs text-gray-400 ml-2">' + m.modul_key + '</span></div>';
                    html += '</div>';
                    html += '<div class="flex items-center space-x-1 bg-gray-100 rounded-lg p-0.5">';
                    // 3 Toggle Buttons
                    var btnBase = 'px-3 py-1.5 rounded-md text-xs font-semibold transition cursor-pointer';
                    html += '<button onclick="setModulStatus(\'' + m.id + '\',\'aktiv\')" class="' + btnBase + ' ' + (m.status==='aktiv' ? 'bg-green-500 text-white shadow-sm' : 'text-gray-500 hover:bg-gray-200') + '">‚úì Aktiv</button>';
                    html += '<button onclick="setModulStatus(\'' + m.id + '\',\'in_bearbeitung\')" class="' + btnBase + ' ' + (m.status==='in_bearbeitung' ? 'bg-yellow-500 text-white shadow-sm' : 'text-gray-500 hover:bg-gray-200') + '">üîß In Bearbeitung</button>';
                    html += '<button onclick="setModulStatus(\'' + m.id + '\',\'deaktiviert\')" class="' + btnBase + ' ' + (m.status==='deaktiviert' ? 'bg-gray-500 text-white shadow-sm' : 'text-gray-500 hover:bg-gray-200') + '">‚úï Deaktiviert</button>';
                    html += '</div></div>';
                });
                container.innerHTML = html;

                // Update counters
                var el1 = document.getElementById('countAktiv'); if(el1) el1.textContent = counts.aktiv||0;
                var el2 = document.getElementById('countWip'); if(el2) el2.textContent = counts.in_bearbeitung||0;
                var el3 = document.getElementById('countDeaktiviert'); if(el3) el3.textContent = counts.deaktiviert||0;
            } catch(err) { console.error('ModulStatusList:', err); container.innerHTML = '<div class="p-4 text-center text-red-400">Fehler beim Laden</div>'; }
        }

        async function setModulStatus(id, newStatus) {
            try {
                var resp = await sb.from('modul_status').update({status: newStatus, updated_by: sbUser ? sbUser.id : null}).eq('id', id);
                if(resp.error) throw resp.error;
                // Reload both the list and the sidebar
                await loadModulStatus();
                renderModulStatusList();
            } catch(err) { alert('Fehler: ' + err.message); }
        }

        function renderHqEinstellungen() {
            // Modul-Status Tab rendern
            renderModulStatusList();

            // Rechte-Matrix rendern
            var modules = [
                {key:'home',label:'Startseite',icon:'üè†',core:true},
                {key:'kalender',label:'Kalender',icon:'üìÖ',core:true},
                {key:'todo',label:'Aufgaben',icon:'üìã',core:true},
                {key:'kommunikation',label:'Kommunikation',icon:'üí¨',core:true},
                {key:'dashboards',label:'Dashboards',icon:'üìä',core:false},
                {key:'allgemein',label:'Allgemein',icon:'üè¢',core:false},
                {key:'verkauf',label:'Verkauf',icon:'üìà',core:false},
                {key:'einkauf',label:'Einkauf',icon:'üõí',core:false},
                {key:'marketing',label:'Marketing',icon:'üì£',core:false},
                {key:'controlling',label:'Controlling',icon:'üìä',core:false},
                {key:'wissen',label:'Wissen',icon:'üìö',core:false},
                {key:'support',label:'Support',icon:'üé´',core:false},
                {key:'aktenschrank',label:'Aktenschrank',icon:'üìÅ',core:false},
                {key:'ideenboard',label:'Ideenboard',icon:'üí°',core:false},
                {key:'shop',label:'Werbemittel-Shop',icon:'üõçÔ∏è',core:false},
                {key:'onboarding',label:'Onboarding',icon:'üéØ',core:false}
            ];
            var rollen = ['inhaber','verkauf','werkstatt','buchhaltung'];

            var body = document.getElementById('rechteMatrixBody');
            if(!body) return;
            var h = '';
            modules.forEach(function(mod){
                var perms = rolePermissions[mod.key] || ['alle'];
                var isCore = mod.core;
                h += '<tr class="border-t border-gray-100 '+(isCore?'bg-green-50':'hover:bg-gray-50')+'">';
                h += '<td class="px-4 py-2.5 font-semibold text-gray-700 text-xs">'+mod.icon+' '+mod.label;
                if(isCore) h += ' <span class="text-[9px] text-green-600 font-normal">(Basis)</span>';
                h += '</td>';
                rollen.forEach(function(r){
                    var isAllowed = perms.indexOf('alle')>=0 || perms.indexOf(r)>=0;
                    if(isCore) {
                        h += '<td class="px-4 py-2.5 text-center"><span class="text-green-500 text-lg cursor-not-allowed" title="Basis-Modul ‚Äì immer aktiv">‚úÖ</span></td>';
                    } else {
                        h += '<td class="px-4 py-2.5 text-center"><button onclick="togglePermission(\''+mod.key+'\',\''+r+'\')" class="text-lg transition hover:scale-125" title="Klicken zum Umschalten">'+(isAllowed?'‚úÖ':'‚ùå')+'</button></td>';
                    }
                });
                h += '</tr>';
            });
            body.innerHTML = h;

            // Update MA count
            var cnt = document.getElementById('settingsMaCount');
            if(cnt) cnt.textContent = kzMitarbeiter.length;
        }

        function togglePermission(modKey, rolle) {
            var perms = rolePermissions[modKey];
            if(!perms) { rolePermissions[modKey] = [rolle]; renderHqEinstellungen(); return; }

            // If currently 'alle', convert to explicit list minus this role
            if(perms.indexOf('alle')>=0) {
                rolePermissions[modKey] = ['inhaber','verkauf','werkstatt','buchhaltung'].filter(function(r){return r!==rolle;});
                renderHqEinstellungen();
                return;
            }

            var idx = perms.indexOf(rolle);
            if(idx>=0) {
                perms.splice(idx,1);
                if(perms.length===0) perms.push('inhaber'); // mindestens Inhaber
            } else {
                perms.push(rolle);
            }
            // If all 4 roles selected, simplify to 'alle'
            if(perms.length===4) rolePermissions[modKey] = ['alle'];
            renderHqEinstellungen();
            // Also update sidebar immediately if user is logged in
            try { updateUIForRole(); } catch(e){}
        }

        function renderKommandozentrale() {
            renderKzStandorte();
            renderKzMitarbeiter();
        }
        var currentLang = 'de';
        var i18n = {
            de: {
                // Navigation
                nav_home:'Startseite', nav_dashboards:'Dashboards', nav_mainmenu:'Hauptmen√º',
                nav_general:'Allgemein', nav_marketing:'Marketing', nav_purchasing:'Einkauf',
                nav_controlling:'Controlling', nav_sales:'Verkauf', nav_filingcab:'Aktenschrank',
                nav_support:'Support', nav_communication:'Kommunikation', nav_knowledge:'Wissen', nav_shop:'Werbemittel-Shop', h_purchasing:'EINKAUF', h_controlling:'CONTROLLING', h_filingcab:'AKTENSCHRANK', h_support:'SUPPORT', h_ideaboard:'IDEENBOARD', h_communication:'KOMMUNIKATION', h_forum:'FORUM', h_chat:'CHAT', h_calendar:'TERMINE', h_todos:'AUFGABEN', h_onboarding:'ONBOARDING', nav_ideaboard:'Ideenboard',
                nav_onboarding:'Onboarding', nav_hq_control:'HQ Steuerung',
                nav_hq_cockpit:'Netzwerk-Cockpit', nav_hq_locations:'Standorte',
                nav_hq_finance:'Finanzen', nav_hq_actions:'Handlungsbedarf', nav_hq_command:'Kommandozentrale', nav_hq_comm:'Kommunikation', nav_hq_campaigns:'Kampagnen', nav_hq_docs:'Dokumente', nav_hq_calendar:'Kalender', nav_hq_tasks:'Aufgaben', nav_hq_analytics:'Nutzung Portal', nav_calendar:'Kalender', nav_todo:'Aufgaben',
                // Headlines
                h_marketing:'MARKETING', h_sales:'VERKAUF', h_dashboards:'DASHBOARDS',
                h_leadreporting:'LEAD REPORTING',
                welcome:'Willkommen zur√ºck, Max!',
                // Dashboard
                dash_consultations:'Beratungen heute', dash_openoffers:'Offene Angebote',
                dash_opentickets:'Tickets offen',
                // Marketing tabs
                tab_campaigns:'Kampagnen', tab_socialmedia:'Social Media',
                tab_contentlib:'Content Library', tab_analytics:'Analytics',
                tab_strategy:'üìã Strategie', tab_knowledge:'üìö Wissen',
                // Social Media
                sm_channels:'üì± Unsere Kan√§le', sm_topics:'üé¨ Themen-Auftr√§ge',
                sm_upload:'üì§ Video hochladen', sm_ranking:'üìä Netzwerk-Ranking',
                sm_howto:"‚ÑπÔ∏è So funktioniert's",
                filter_all:'Alle', filter_new:'üÜï Neu f√ºr dich', filter_done:'‚úÖ Erledigt',
                search_topic:'Thema suchen...',
                // Role
                role_seller:'Verkauf',
                // Buttons & Labels
                btn_shoot:'üì§ Drehen', btn_upload_now:'üì§ Dieses Thema jetzt drehen & hochladen',
                btn_submit:'üöÄ Video einreichen', btn_to_channel:'Zum Kanal ‚Üí',
                btn_follow:'Folgen', btn_subscribe:'Abonnieren',
                lbl_videos_shot:'Videos gedreht', lbl_topics:'Themen',
                lbl_streak:'üî• Streak: 2 Wochen', lbl_rank:'üèÜ Rang 5 von 21',
                lbl_next_badge:'‚≠ê N√§chstes Badge: 5 Videos',
                lbl_hook:'üé£ Hook / Intro (erste 3 Sekunden)',
                lbl_main:'üìã Hauptteil ‚Äì Was zeigen/erz√§hlen',
                lbl_outro:'üì£ Outro / Call-to-Action',
                lbl_hqtip:'üí° Tipp vom HQ-Marketing',
                lbl_example_video:'Beispielvideo ansehen',
                lbl_example_desc:'Schau dir an wie andere das gemacht haben ‚Äì dann nachmachen!',
                lbl_watch:'Ansehen ‚Üí', lbl_done_video:'‚úÖ Du hast dieses Video bereits eingereicht!',
                lbl_difficulty:'Schwierigkeit',
                // Upload form
                upl_title:'Video hochladen', upl_desc:'W√§hle ein Thema, lade dein Video hoch ‚Äì fertig! Wir k√ºmmern uns um Schnitt, Untertitel und Posting.',
                upl_select:'Thema w√§hlen...', upl_own:'0000 ‚Äì Eigener Vorschlag',
                upl_your_video:'Dein Video', upl_drag:'Video hierhin ziehen',
                upl_click:'oder klicken zum Ausw√§hlen', upl_comment:'Kurzer Kommentar',
                upl_comment_ph:"z.B. 'Haben das im Laden gedreht, Lichtsituation war schwierig'",
                upl_footer:'Das HQ schneidet euer Video, packt Untertitel drauf und postet es als Collab-Post auf eurem Profil.',
                // Ranking
                rank_title:'üèÜ Content-Ranking ‚Äì Wer dreht am meisten?',
                rank_badges:'üéñÔ∏è Badges', rank_stats:'üìä Netzwerk-Statistik',
                rank_total_vids:'Videos gesamt', rank_topics_covered:'Themen abgedeckt',
                rank_active:'Aktive Standorte', rank_no_video:'Noch ohne Video',
                // Howto
                howto_title:'So funktioniert Local Hero ‚Äì in 3 Schritten',
                howto_step1:'1. Inspiration', howto_step1d:'Wir stellen Thema + Beispielvideo bereit',
                howto_step2:'2. Drehen & Upload', howto_step2d:'1-3 Min. Video mit dem Handy drehen und hier hochladen',
                howto_step3:'3. Schnitt & Posting', howto_step3d:'Wir schneiden, packen Untertitel drauf und posten als Collab',
                howto_tips:'üí° Tipps f√ºr gute Videos', howto_links:'üîó Hilfreiche Links',
                // Local Hero header
                lh_title:'üé¨ Local Hero ‚Äì Content Strategie',
                lh_desc:'Dreh ein kurzes Video, lade es hoch ‚Äì wir machen den Rest! Schnitt, Untertitel & Posting √ºbernimmt das HQ.',
                // Channel cards
                ch_followers:'Follower', ch_posts:'Beitr√§ge', ch_engagement:'Engagement',
                ch_subscribers:'Abonnenten', ch_videos:'Videos', ch_views:'Aufrufe',
                ch_likes:'Likes',
                // Badges
                badge_first:'Erster Upload', badge_3:'3 Videos', badge_5:'5 Videos',
                badge_10:'10 Videos', badge_25:'25 Videos', badge_50:'50 Videos',
                badge_reached:'‚úÖ Erreicht', badge_almost:'Noch 1!', badge_locked:'Gesperrt',
                // Content themes
                lbl_content_theme:'Content-Thema w√§hlen',
                // Generic
                optional:'(optional)'
            },
            en: {
                nav_home:'Home', nav_dashboards:'Dashboards', nav_mainmenu:'Main Menu',
                nav_general:'General', nav_marketing:'Marketing', nav_purchasing:'Purchasing',
                nav_controlling:'Controlling', nav_sales:'Sales', nav_filingcab:'Filing Cabinet',
                nav_support:'Support', nav_communication:'Communication', nav_knowledge:'Knowledge', nav_shop:'Merchandise Shop', h_purchasing:'PURCHASING', h_controlling:'CONTROLLING', h_filingcab:'FILE CABINET', h_support:'SUPPORT', h_ideaboard:'IDEA BOARD', h_communication:'COMMUNICATION', h_forum:'FORUM', h_chat:'CHAT', h_calendar:'CALENDAR', h_todos:'TASKS', h_onboarding:'ONBOARDING', nav_ideaboard:'Idea Board',
                nav_onboarding:'Onboarding', nav_hq_control:'HQ Control',
                nav_hq_cockpit:'Network Cockpit', nav_hq_locations:'Locations',
                nav_hq_finance:'Finance', nav_hq_actions:'Action Required', nav_hq_command:'Command Center', nav_hq_comm:'Communication', nav_hq_campaigns:'Campaigns', nav_hq_docs:'Documents', nav_hq_calendar:'Calendar', nav_hq_tasks:'Tasks', nav_hq_analytics:'Portal Usage', nav_calendar:'Calendar', nav_todo:'Tasks',
                h_marketing:'MARKETING', h_sales:'SALES', h_dashboards:'DASHBOARDS',
                h_leadreporting:'LEAD REPORTING',
                welcome:'Welcome back, Max!',
                dash_consultations:'Consultations today', dash_openoffers:'Open offers',
                dash_opentickets:'Open tickets',
                tab_campaigns:'Campaigns', tab_socialmedia:'Social Media',
                tab_contentlib:'Content Library', tab_analytics:'Analytics',
                tab_strategy:'üìã Strategy', tab_knowledge:'üìö Knowledge',
                sm_channels:'üì± Our Channels', sm_topics:'üé¨ Content Briefs',
                sm_upload:'üì§ Upload Video', sm_ranking:'üìä Network Ranking',
                sm_howto:'‚ÑπÔ∏è How it works',
                filter_all:'All', filter_new:'üÜï New for you', filter_done:'‚úÖ Completed',
                search_topic:'Search topic...',
                role_seller:'Sales Associate',
                btn_shoot:'üì§ Shoot', btn_upload_now:'üì§ Shoot & upload this topic now',
                btn_submit:'üöÄ Submit video', btn_to_channel:'Go to channel ‚Üí',
                btn_follow:'Follow', btn_subscribe:'Subscribe',
                lbl_videos_shot:'Videos recorded', lbl_topics:'Topics',
                lbl_streak:'üî• Streak: 2 weeks', lbl_rank:'üèÜ Rank 5 of 21',
                lbl_next_badge:'‚≠ê Next badge: 5 Videos',
                lbl_hook:'üé£ Hook / Intro (first 3 seconds)',
                lbl_main:'üìã Main Part ‚Äì What to show/say',
                lbl_outro:'üì£ Outro / Call-to-Action',
                lbl_hqtip:'üí° Tip from HQ Marketing',
                lbl_example_video:'Watch example video',
                lbl_example_desc:'See how others did it ‚Äì then recreate it!',
                lbl_watch:'Watch ‚Üí', lbl_done_video:'‚úÖ You have already submitted this video!',
                lbl_difficulty:'Difficulty',
                upl_title:'Upload Video', upl_desc:'Choose a topic, upload your video ‚Äì done! We handle editing, subtitles and posting.',
                upl_select:'Choose topic...', upl_own:'0000 ‚Äì Own suggestion',
                upl_your_video:'Your Video', upl_drag:'Drag video here',
                upl_click:'or click to browse', upl_comment:'Short comment',
                upl_comment_ph:"e.g. 'Shot in the store, lighting was tricky'",
                upl_footer:'HQ edits your video, adds subtitles and posts it as a collab post on your profile.',
                rank_title:'üèÜ Content Ranking ‚Äì Who shoots the most?',
                rank_badges:'üéñÔ∏è Badges', rank_stats:'üìä Network Statistics',
                rank_total_vids:'Total videos', rank_topics_covered:'Topics covered',
                rank_active:'Active locations', rank_no_video:'No video yet',
                howto_title:'How Local Hero works ‚Äì 3 simple steps',
                howto_step1:'1. Inspiration', howto_step1d:'We provide the topic + example video',
                howto_step2:'2. Shoot & Upload', howto_step2d:'Shoot 1-3 min. video with your phone and upload here',
                howto_step3:'3. Edit & Post', howto_step3d:'We edit, add subtitles and post as a collab',
                howto_tips:'üí° Tips for great videos', howto_links:'üîó Helpful links',
                lh_title:'üé¨ Local Hero ‚Äì Content Strategy',
                lh_desc:'Shoot a quick video, upload it ‚Äì we do the rest! Editing, subtitles & posting is handled by HQ.',
                ch_followers:'Followers', ch_posts:'Posts', ch_engagement:'Engagement',
                ch_subscribers:'Subscribers', ch_videos:'Videos', ch_views:'Views',
                ch_likes:'Likes',
                badge_first:'First Upload', badge_3:'3 Videos', badge_5:'5 Videos',
                badge_10:'10 Videos', badge_25:'25 Videos', badge_50:'50 Videos',
                badge_reached:'‚úÖ Achieved', badge_almost:'1 more!', badge_locked:'Locked',
                lbl_content_theme:'Choose content topic',
                optional:'(optional)'
            },
            nl: {
                nav_home:'Startpagina', nav_dashboards:'Dashboards', nav_mainmenu:'Hoofdmenu',
                nav_general:'Algemeen', nav_marketing:'Marketing', nav_purchasing:'Inkoop',
                nav_controlling:'Controlling', nav_sales:'Verkoop', nav_filingcab:'Documentenarchief',
                nav_support:'Ondersteuning', nav_communication:'Communicatie', nav_ideaboard:'Idee√´nbord',
                nav_onboarding:'Onboarding', nav_hq_control:'HQ Beheer',
                nav_hq_cockpit:'Netwerk-Cockpit', nav_hq_locations:'Locaties',
                nav_hq_finance:'Financi√´n', nav_hq_actions:'Actie vereist', nav_hq_command:'Commandocentrum', nav_hq_comm:'Communicatie', nav_hq_campaigns:'Campagnes', nav_hq_docs:'Documenten', nav_hq_calendar:'Agenda', nav_hq_tasks:'Taken', nav_hq_analytics:'Portaalgebruik', nav_calendar:'Agenda', nav_todo:'Taken',
                h_marketing:'MARKETING', h_sales:'VERKOOP', h_dashboards:'DASHBOARDS',
                h_leadreporting:'LEAD RAPPORTAGE',
                welcome:'Welkom terug, Max!',
                dash_consultations:'Adviezen vandaag', dash_openoffers:'Openstaande offertes',
                dash_opentickets:'Open tickets',
                tab_campaigns:'Campagnes', tab_socialmedia:'Social Media',
                tab_contentlib:'Content Bibliotheek', tab_analytics:'Analytics',
                tab_strategy:'üìã Strategie', tab_knowledge:'üìö Kennis',
                sm_channels:'üì± Onze kanalen', sm_topics:'üé¨ Content-opdrachten',
                sm_upload:'üì§ Video uploaden', sm_ranking:'üìä Netwerk-ranking',
                sm_howto:'‚ÑπÔ∏è Zo werkt het',
                filter_all:'Alle', filter_new:'üÜï Nieuw voor jou', filter_done:'‚úÖ Afgerond',
                search_topic:'Onderwerp zoeken...',
                role_seller:'Verkoper',
                btn_shoot:'üì§ Filmen', btn_upload_now:'üì§ Dit onderwerp nu filmen & uploaden',
                btn_submit:'üöÄ Video indienen', btn_to_channel:'Naar kanaal ‚Üí',
                btn_follow:'Volgen', btn_subscribe:'Abonneren',
                lbl_videos_shot:'Videos gemaakt', lbl_topics:'Onderwerpen',
                lbl_streak:'üî• Reeks: 2 weken', lbl_rank:'üèÜ Rang 5 van 21',
                lbl_next_badge:'‚≠ê Volgende badge: 5 Videos',
                lbl_hook:'üé£ Hook / Intro (eerste 3 seconden)',
                lbl_main:'üìã Hoofddeel ‚Äì Wat laten zien/vertellen',
                lbl_outro:'üì£ Outro / Call-to-Action',
                lbl_hqtip:'üí° Tip van HQ Marketing',
                lbl_example_video:'Voorbeeldvideo bekijken',
                lbl_example_desc:'Bekijk hoe anderen het deden ‚Äì en doe het na!',
                lbl_watch:'Bekijken ‚Üí', lbl_done_video:'‚úÖ Je hebt deze video al ingediend!',
                lbl_difficulty:'Moeilijkheid',
                upl_title:'Video uploaden', upl_desc:'Kies een onderwerp, upload je video ‚Äì klaar! Wij zorgen voor montage, ondertiteling en publicatie.',
                upl_select:'Onderwerp kiezen...', upl_own:'0000 ‚Äì Eigen voorstel',
                upl_your_video:'Jouw video', upl_drag:'Sleep video hierheen',
                upl_click:'of klik om te selecteren', upl_comment:'Kort commentaar',
                upl_comment_ph:"bijv. 'In de winkel gefilmd, belichting was lastig'",
                upl_footer:'HQ monteert je video, voegt ondertiteling toe en plaatst het als collab-post op je profiel.',
                rank_title:'üèÜ Content-ranking ‚Äì Wie filmt het meest?',
                rank_badges:'üéñÔ∏è Badges', rank_stats:'üìä Netwerkstatistieken',
                rank_total_vids:'Totaal videos', rank_topics_covered:'Onderwerpen behandeld',
                rank_active:'Actieve locaties', rank_no_video:'Nog geen video',
                howto_title:'Zo werkt Local Hero ‚Äì in 3 stappen',
                howto_step1:'1. Inspiratie', howto_step1d:'Wij leveren het onderwerp + voorbeeldvideo',
                howto_step2:'2. Filmen & Upload', howto_step2d:'Film 1-3 min. video met je telefoon en upload hier',
                howto_step3:'3. Montage & Publicatie', howto_step3d:'Wij monteren, voegen ondertiteling toe en publiceren als collab',
                howto_tips:'üí° Tips voor goede videos', howto_links:'üîó Handige links',
                lh_title:'üé¨ Local Hero ‚Äì Content Strategie',
                lh_desc:'Film een korte video, upload het ‚Äì wij doen de rest! Montage, ondertiteling & publicatie doet het HQ.',
                ch_followers:'Volgers', ch_posts:'Berichten', ch_engagement:'Betrokkenheid',
                ch_subscribers:'Abonnees', ch_videos:'Videos', ch_views:'Weergaven',
                ch_likes:'Likes',
                badge_first:'Eerste upload', badge_3:'3 Videos', badge_5:'5 Videos',
                badge_10:'10 Videos', badge_25:'25 Videos', badge_50:'50 Videos',
                badge_reached:'‚úÖ Behaald', badge_almost:'Nog 1!', badge_locked:'Vergrendeld',
                lbl_content_theme:'Content-onderwerp kiezen',
                optional:'(optioneel)'
            }
        };

        // ========== WERBEMITTEL-SHOP ==========
        var shopCart = [];

        async function renderShop() {
            var container = document.getElementById('shopGrid');
            if(!container) return;
            try {
                var resp = await sb.from('shop_produkte').select('*').eq('verfuegbar', true).order('kategorie');
                if(resp.error) throw resp.error;
                var products = resp.data || [];
                var html = '';
                products.forEach(function(p) {
                    var inCart = shopCart.find(function(c){return c.id===p.id});
                    html += '<div class="vit-card p-5 hover:shadow-md transition">';
                    html += '<div class="w-full h-32 bg-gray-100 rounded-lg mb-3 flex items-center justify-center text-4xl">üõçÔ∏è</div>';
                    html += '<span class="text-xs font-semibold text-vit-orange uppercase">' + (p.kategorie||'') + '</span>';
                    html += '<h3 class="font-bold text-gray-800 text-sm mt-1">' + p.name + '</h3>';
                    if(p.beschreibung) html += '<p class="text-xs text-gray-500 mt-1">' + p.beschreibung + '</p>';
                    html += '<div class="flex items-center justify-between mt-3">';
                    html += '<span class="font-bold text-gray-800">' + (p.preis > 0 ? p.preis.toFixed(2) + ' \u20ac' : 'Kostenlos') + '</span>';
                    html += '<button onclick="addToCart(\x27'+p.id+'\x27,\x27'+(p.name||'').replace(/\x27/g,'')+'\x27,'+p.preis+')" class="px-3 py-1.5 text-xs font-semibold rounded-lg ' + (inCart ? 'bg-green-500 text-white' : 'bg-vit-orange text-white hover:opacity-90') + '">' + (inCart ? '\u2713 Im Warenkorb' : '+ Bestellen') + '</button>';
                    html += '</div></div>';
                });
                if(products.length===0) html = '<div class="col-span-3 text-center py-8 text-gray-400">Keine Produkte.</div>';
                container.innerHTML = html;
                renderShopCart();
            } catch(err) { console.error('Shop:', err); }
        }

        function addToCart(id, name, preis) {
            var existing = shopCart.find(function(c){return c.id===id});
            if(existing) { existing.menge++; } else { shopCart.push({id:id, name:name, preis:preis, menge:1}); }
            renderShop();
        }

        function renderShopCart() {
            var container = document.getElementById('shopCartItems');
            if(!container) return;
            if(shopCart.length===0) { container.innerHTML = '<p class="text-gray-400 text-sm text-center py-4">Warenkorb leer</p>'; return; }
            var html = ''; var total = 0;
            shopCart.forEach(function(c) { total += c.preis * c.menge; html += '<div class="flex justify-between py-2 border-b border-gray-100"><span class="text-sm">' + c.name + ' x' + c.menge + '</span><span class="font-bold text-sm">' + (c.preis*c.menge).toFixed(2) + ' \u20ac</span></div>'; });
            html += '<div class="flex justify-between pt-3 font-bold"><span>Gesamt</span><span>' + total.toFixed(2) + ' \u20ac</span></div>';
            container.innerHTML = html;
            var totalEl = document.getElementById('shopCartTotal'); if(totalEl) totalEl.textContent = total.toFixed(2);
            var countEl = document.getElementById('shopCartCount'); if(countEl) countEl.textContent = shopCart.length;
        }

        function filterShop(kat) {
            document.querySelectorAll('.shop-filter-btn').forEach(function(b){b.className='shop-filter-btn text-xs px-3 py-1.5 rounded-full font-semibold bg-gray-100 text-gray-600';});
            var btn=document.querySelector('.shop-filter-btn[data-sf="'+kat+'"]');
            if(btn) btn.className='shop-filter-btn text-xs px-3 py-1.5 rounded-full font-semibold bg-vit-orange text-white';
            renderShop();
        }

        async function submitShopOrder() {
            if(shopCart.length===0 || !sbUser) return;
            try {
                var total = shopCart.reduce(function(a,c){return a+c.preis*c.menge},0);
                var orderResp = await sb.from('shop_bestellungen').insert({standort_id:sbStandort?sbStandort.id:null, user_id:sbUser.id, gesamt_preis:total}).select().single();
                if(orderResp.error) throw orderResp.error;
                var positionen = shopCart.map(function(c){ return {bestellung_id:orderResp.data.id, produkt_id:c.id, menge:c.menge, einzelpreis:c.preis}; });
                await sb.from('shop_positionen').insert(positionen);
                shopCart = [];
                alert('Bestellung erfolgreich! \ud83c\udf89');
                renderShop();
            } catch(err) { alert('Fehler: '+err.message); }
        }

        function renderShopCart() {
            var el = document.getElementById('shopCartItems');
            var countEl = document.getElementById('shopCartCount');
            var totalEl = document.getElementById('shopCartTotal');
            if(!el) return;
            var h = '', total = 0, count = 0;
            shopCart.forEach(function(c) {
                total += c.preis * c.qty;
                count += c.qty;
                h += '<div class="flex items-center justify-between py-2 border-b border-gray-100"><div><span class="text-sm font-semibold">'+c.name+'</span><span class="text-xs text-gray-400 ml-2">x'+c.qty+'</span></div><div class="flex items-center space-x-3"><span class="text-sm font-bold">'+(c.preis*c.qty).toFixed(2).replace('.',',')+' ‚Ç¨</span><button onclick="updateShopCart('+c.id+',-c.qty);shopCart=shopCart.filter(function(x){return x.id!=='+c.id+'});renderShop();" class="text-red-400 hover:text-red-600 text-xs">‚úï</button></div></div>';
            });
            if(!h) h = '<p class="text-sm text-gray-400 text-center py-4">Warenkorb ist leer</p>';
            el.innerHTML = h;
            if(countEl) countEl.textContent = count;
            if(totalEl) totalEl.textContent = total.toFixed(2).replace('.',',');
        }

        function filterShop(kat) {
            shopCurrentFilter = kat;
            document.querySelectorAll('.shop-filter-btn').forEach(function(b){b.className='shop-filter-btn text-xs px-3 py-1.5 rounded-full font-semibold bg-gray-100 text-gray-600';});
            var btn = document.querySelector('.shop-filter-btn[data-sf="'+kat+'"]');
            if(btn) btn.className='shop-filter-btn text-xs px-3 py-1.5 rounded-full font-semibold bg-vit-orange text-white';
            renderShop();
        }

        function submitShopOrder() {
            if(!shopCart.length) { alert('Warenkorb ist leer!'); return; }
            var nr = Math.floor(10000+Math.random()*90000);
            document.getElementById('shopOrderNr').textContent = nr;
            document.getElementById('shopOrderModal').classList.remove('hidden');
            shopCart = [];
            renderShop();
            document.getElementById('shopCart').classList.add('hidden');
        }

        // ========== HQ DRILL-DOWN: Switch to Partner view for a specific location ==========
        function hqDrillDown(locationKey) {
            // Switch to partner mode for that location
            var sel = document.getElementById('viewModeSwitch');
            if(sel) {
                // Find matching option
                var opts = sel.options;
                for(var i=0; i<opts.length; i++) {
                    if(opts[i].value.indexOf(locationKey) > -1) {
                        sel.value = opts[i].value;
                        switchViewMode(opts[i].value);
                        return;
                    }
                }
            }
            // Fallback
            switchViewMode('partner_grafrath');
        }

        function handleFileUpload(input) {
            if(input.files && input.files[0]) {
                var name = input.files[0].name;
                var size = (input.files[0].size/1024).toFixed(1);
                var parent = input.closest('[onclick]') || input.parentElement;
                if(parent) {
                    var origHTML = parent.innerHTML;
                    parent.innerHTML = '<div class="py-4"><p class="text-green-600 font-semibold text-sm">‚úÖ '+name+'</p><p class="text-xs text-gray-400">'+size+' KB hochgeladen</p></div>';
                }
            }
        }

        function switchLang(lang) {
            currentLang = lang;
            document.documentElement.lang = lang;
            // Update flag opacity
            document.querySelectorAll('.lang-flag').forEach(function(f){
                f.classList.toggle('opacity-40', f.getAttribute('data-lang')!==lang);
                f.classList.toggle('opacity-100', f.getAttribute('data-lang')===lang);
            });
            // Translate all data-i18n elements
            document.querySelectorAll('[data-i18n]').forEach(function(el){
                var key = el.getAttribute('data-i18n');
                if(i18n[lang] && i18n[lang][key]) {
                    el.textContent = i18n[lang][key];
                }
            });
            // Translate placeholders
            document.querySelectorAll('[data-i18n-placeholder]').forEach(function(el){
                var key = el.getAttribute('data-i18n-placeholder');
                if(i18n[lang] && i18n[lang][key]) {
                    el.placeholder = i18n[lang][key];
                }
            });
            // Re-render ALL visible dynamic content
            var views = document.querySelectorAll('.view');
            views.forEach(function(v) {
                if(v.style.display !== 'none') {
                    var vid = v.id;
                    if(vid==='homeView') { /* static i18n handles it */ }
                    if(vid==='smThemenList' || document.getElementById('smThemenList')) { try{renderSmThemen();}catch(e){} }
                    if(vid==='smRankingList' || document.getElementById('smRankingList')) { try{renderSmRanking();}catch(e){} }
                    if(vid==='shopView') { try{renderShop();}catch(e){} }
                    if(vid==='wissenView') { try{renderWissenGlobal();}catch(e){} }
                }
            });
            // Force re-render SM if visible
            try{if(document.getElementById('smThemenList') && document.getElementById('smThemenList').innerHTML) renderSmThemen();}catch(e){}
            try{if(document.getElementById('smRankingList') && document.getElementById('smRankingList').innerHTML) renderSmRanking();}catch(e){}
        }

        // Helper: get translated text (for JS-rendered content)
        function t(key) {
            return (i18n[currentLang] && i18n[currentLang][key]) || (i18n.de[key]) || key;
        }

        var currentSmFilter = 'all';

        function switchSmSub(sub) {
            document.querySelectorAll('.sm-sub-content').forEach(function(el){el.style.display='none';});
            document.querySelectorAll('.sm-sub-btn').forEach(function(b){b.className='sm-sub-btn px-4 py-2 rounded-full text-sm font-semibold bg-gray-100 text-gray-600';});
            var target = document.getElementById('smSub'+sub.charAt(0).toUpperCase()+sub.slice(1));
            if(target) target.style.display='block';
            var btn = document.querySelector('.sm-sub-btn[data-smsub="'+sub+'"]');
            if(btn) btn.className='sm-sub-btn px-4 py-2 rounded-full text-sm font-semibold bg-vit-orange text-white';
            if(sub==='themen') renderSmThemen();
            if(sub==='ranking') renderSmRanking();
        }

        function filterSmThemen(filter) {
            currentSmFilter = filter;
            document.querySelectorAll('.sm-thema-filter').forEach(function(b){b.className='sm-thema-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-gray-100 text-gray-600';});
            var btn = document.querySelector('.sm-thema-filter[data-smf="'+filter+'"]');
            if(btn) btn.className='sm-thema-filter text-xs px-3 py-1.5 rounded-full font-semibold bg-vit-orange text-white';
            renderSmThemen();
        }

        function renderSmThemen() {
            var search = (document.getElementById('smThemenSearch')||{}).value||'';
            var list = smThemen.filter(function(t){
                if(currentSmFilter==='neu' && t.done) return false;
                if(currentSmFilter==='done' && !t.done) return false;
                if(search && t.thema.toLowerCase().indexOf(search.toLowerCase())===-1 && t.id.toLowerCase().indexOf(search.toLowerCase())===-1) return false;
                return true;
            });

            var katColors = {Story:'bg-pink-100 text-pink-700',Technik:'bg-blue-100 text-blue-700',Beratung:'bg-green-100 text-green-700',Werkstatt:'bg-gray-200 text-gray-700',USP:'bg-orange-100 text-orange-700',Tipps:'bg-cyan-100 text-cyan-700',Ergonomie:'bg-purple-100 text-purple-700'};
            var schwColors = {leicht:'üü¢',mittel:'üü°',schwer:'üî¥'};

            var el = document.getElementById('smThemenList');
            if(!el) return;
            var h = '';
            list.forEach(function(th,idx){
                var detailId = 'smDetail_'+th.id;
                h += '<div class="vit-card overflow-hidden '+(th.done?'opacity-60 border-l-4 border-green-400':'border-l-4 border-transparent hover:border-l-4 hover:border-vit-orange')+' transition">';

                // Header row (clickable to expand)
                h += '<div class="p-4 flex items-center space-x-4 cursor-pointer" onclick="var d=document.getElementById(\''+detailId+'\');d.style.display=d.style.display===\'none\'?\'block\':\'none\'">';
                // Status icon
                if(th.done) {
                    h += '<div class="w-10 h-10 rounded-full bg-green-500 flex items-center justify-center text-white font-bold text-lg flex-shrink-0">‚úì</div>';
                } else {
                    h += '<div class="w-10 h-10 rounded-full bg-orange-100 flex items-center justify-center text-vit-orange font-bold text-lg flex-shrink-0">‚ñ∂</div>';
                }
                // Title area
                h += '<div class="flex-1 min-w-0">';
                h += '<div class="flex items-center space-x-2 mb-0.5">';
                h += '<span class="text-[10px] font-mono font-bold text-gray-400">'+th.id.toUpperCase()+'</span>';
                h += '<span class="text-[10px] px-1.5 py-0.5 rounded '+(katColors[th.kat]||'bg-gray-100 text-gray-600')+'">'+th.kat+'</span>';
                h += '<span class="text-[10px]">'+schwColors[th.schwierig]+' '+th.schwierig+'</span>';
                if(th.beispiel) h += '<span class="text-[10px] px-1.5 py-0.5 bg-red-50 text-red-600 rounded">üé• Beispielvideo</span>';
                h += '</div>';
                h += '<p class="text-sm font-semibold text-gray-800">'+th.thema+'</p>';
                h += '</div>';
                // Expand arrow + action
                h += '<div class="flex items-center space-x-2 flex-shrink-0">';
                if(!th.done) h += '<button class="px-3 py-1.5 bg-vit-orange text-white rounded-lg text-xs font-semibold hover:opacity-90 whitespace-nowrap" onclick="event.stopPropagation(); switchSmSub(\'upload\')">'+ t('btn_shoot')+'</button>';
                h += '<svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>';
                h += '</div>';
                h += '</div>';

                // Expandable detail (hidden by default)
                h += '<div id="'+detailId+'" style="display:none;" class="px-4 pb-5 border-t border-gray-100 bg-gray-50">';
                h += '<div class="pt-4 space-y-4">';

                // Beispielvideo
                if(th.beispiel) {
                    h += '<div class="p-3 bg-red-50 rounded-lg flex items-center space-x-3">';
                    h += '<span class="text-2xl">üé•</span>';
                    h += '<div class="flex-1"><p class="text-xs font-bold text-gray-700">'+ t('lbl_example_video')+'</p><p class="text-[10px] text-gray-500">'+t('lbl_example_desc')+'</p></div>';
                    h += '<a href="'+th.beispiel+'" target="_blank" class="px-3 py-1.5 bg-red-500 text-white rounded-lg text-xs font-semibold hover:opacity-90">'+ t('lbl_watch')+'</a>';
                    h += '</div>';
                }

                // Hook
                h += '<div>';
                h += '<p class="text-xs font-bold text-vit-orange uppercase mb-1.5">'+ t('lbl_hook')+'</p>';
                th.hook.forEach(function(hk){
                    h += '<p class="text-sm text-gray-700 italic bg-white p-2 rounded mb-1 border-l-3 border-l-2 border-vit-orange">'+hk+'</p>';
                });
                h += '</div>';

                // Hauptteil
                h += '<div>';
                h += '<p class="text-xs font-bold text-blue-600 uppercase mb-1.5">'+ t('lbl_main')+'</p>';
                h += '<p class="text-sm text-gray-700 bg-white p-3 rounded leading-relaxed">'+th.hauptteil+'</p>';
                h += '</div>';

                // CTA
                h += '<div>';
                h += '<p class="text-xs font-bold text-green-600 uppercase mb-1.5">'+ t('lbl_outro')+'</p>';
                h += '<p class="text-sm text-gray-700 bg-white p-2 rounded italic">'+th.cta+'</p>';
                h += '</div>';

                // HQ Tipp
                if(th.hqTipp) {
                    h += '<div class="p-3 bg-orange-50 rounded-lg border border-orange-200">';
                    h += '<p class="text-xs font-bold text-vit-orange mb-1">'+ t('lbl_hqtip')+'</p>';
                    h += '<p class="text-xs text-gray-600">'+th.hqTipp+'</p>';
                    h += '</div>';
                }

                // Upload CTA
                if(!th.done) {
                    h += '<button class="w-full py-3 bg-vit-orange text-white rounded-lg font-bold text-sm hover:opacity-90 transition" onclick="switchSmSub(\'upload\')">'+ t('btn_upload_now')+'</button>';
                } else {
                    h += '<div class="text-center py-2 text-sm text-green-600 font-semibold">'+ t('lbl_done_video')+'</div>';
                }

                h += '</div></div>';
                h += '</div>';
            });
            if(!list.length) h = '<div class="text-center py-8 text-gray-400"><p class="text-3xl mb-2">üé¨</p><p class="text-sm">Keine Themen gefunden</p></div>';
            el.innerHTML = h;

            // Populate upload select
            var sel = document.getElementById('smUploadThema');
            if(sel && sel.options.length<=1) {
                smThemen.filter(function(t){return !t.done;}).forEach(function(t){
                    sel.innerHTML += '<option value="'+t.id+'">'+t.id.toUpperCase()+' ‚Äì '+t.thema+'</option>';
                });
                sel.innerHTML += '<option value="0000">0000 ‚Äì Eigener Vorschlag</option>';
            }
        }

        function renderSmRanking() {
            var el = document.getElementById('smRankingList');
            if(!el) return;
            var sorted = smRankingData.slice().sort(function(a,b){return b.count-a.count;});
            var maxCount = sorted[0]?sorted[0].count:1;
            var h = '';
            sorted.forEach(function(s,i){
                var isMe = s.name==='Grafrath';
                var w = maxCount ? Math.max(5, s.count/maxCount*100) : 5;
                var medal = i===0?'ü•á':i===1?'ü•à':i===2?'ü•â':'';
                h += '<div class="flex items-center space-x-3 p-2 rounded-lg '+(isMe?'bg-orange-50 border border-orange-200':'')+'"><span class="text-xs w-5 text-gray-400 font-bold">'+(i+1)+'</span><span class="text-xs w-28 truncate font-semibold '+(isMe?'text-vit-orange':'text-gray-700')+'">'+medal+' '+s.name+(isMe?' (du)':'')+'</span><div class="flex-1 bg-gray-100 rounded-full h-4"><div class="h-4 rounded-full '+(s.count>0?'bg-gradient-to-r from-vit-orange to-yellow-400':'bg-gray-200')+'" style="width:'+w+'%"></div></div><span class="text-xs font-bold w-8 text-right">'+s.count+'</span></div>';
            });
            el.innerHTML = h;
        }

        function showAllgemeinTab(tabName) {
            document.querySelectorAll('.allg-tab-content').forEach(function(c){ c.style.display='none'; });
            document.querySelectorAll('.allg-tab-btn').forEach(function(b){
                b.className='allg-tab-btn whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-semibold text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300';
            });
            var tabMap = {uebersicht:'Uebersicht',strategie:'Strategie',wissen:'Wissen'};
            var el = document.getElementById('allgTab' + (tabMap[tabName]||''));
            if(el) el.style.display='block';
            var btn = document.querySelector('.allg-tab-btn[data-tab="'+tabName+'"]');
            if(btn) btn.className='allg-tab-btn whitespace-nowrap py-4 px-1 border-b-2 border-vit-orange font-semibold text-sm text-vit-orange';
        }

        function showView(viewName) {
            console.log('showView called with:', viewName);
            
            // Verstecke ALLE Views automatisch (per Klasse statt hardcoded Liste)
            var allViews = document.querySelectorAll('.view');
            console.log('Found', allViews.length, 'views to hide');
            for(var i = 0; i < allViews.length; i++) {
                allViews[i].style.display = 'none';
            }
            
            // Zeige gew√§hlte View
            var viewId = viewName + 'View';
            var viewEl = document.getElementById(viewId);
            if(viewEl) {
                viewEl.style.display = 'block';
                console.log('SUCCESS: Showed', viewId, '- offsetHeight:', viewEl.offsetHeight);
                if(viewName === 'dashboards') initDashboardTabs();
            } else {
                console.error('FAILED: View not found:', viewId);
            }
        }

        // Asana Onboarding Integration
        const ASANA_PROJECT_ID = '1212995737414526'; // Onboarding vit:bikes Partner
        let asanaTasks = [];
        let asanaSections = {};
        
        async function loadAsanaOnboarding() {
            const container = document.getElementById('asanaOnboardingContent');
            if (!container) return;
            
            container.innerHTML = `
                <div class="text-center py-12">
                    <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-vit-orange"></div>
                    <p class="mt-4 text-gray-600 font-semibold">Lade Onboarding-Aufgaben...</p>
                    <p class="mt-2 text-sm text-gray-500">Synchronisiere mit Asana Projekt</p>
                </div>
            `;
            
            // Simuliere kurzes Laden
            setTimeout(() => {
                loadDemoTasks();
                groupTasksBySections();
                renderAsanaTasks();
            }, 800);
        }
        
        
        function loadDemoTasks() {
            // Demo Tasks basierend auf echten Asana Daten
            asanaTasks = [
                // Allgemein - Qualifizierungsphase
                { gid: '1', name: 'Whatsapp-Gruppe beitreten', completed: true, section: 'Allgemein', due_on: null, notes: 'Link zur WhatsApp-Gruppe findest du in der Willkommens-E-Mail', permalink_url: `https://app.asana.com/0/${ASANA_PROJECT_ID}` },
                { gid: '2', name: 'Sharepoint Zugang einrichten', completed: true, section: 'Allgemein', due_on: null, notes: '', permalink_url: `https://app.asana.com/0/${ASANA_PROJECT_ID}` },
                { gid: '3', name: 'Vorstellung Teams im B√ºro', completed: false, section: 'Allgemein', due_on: '2026-02-20', assignee: { name: 'Jens Bader' }, notes: 'Kennenlernen der Kollegen im HQ', permalink_url: `https://app.asana.com/0/${ASANA_PROJECT_ID}` },
                { gid: '4', name: 'Das vit:bikes Portal kennenlernen', completed: false, section: 'Allgemein', due_on: '2026-02-18', assignee: { name: 'Markus Unger' }, notes: 'Einf√ºhrung in alle Features', permalink_url: `https://app.asana.com/0/${ASANA_PROJECT_ID}` },
                { gid: '5', name: 'Lizenzvertrag durchgehen', completed: false, section: 'Allgemein', due_on: '2026-02-19', assignee: { name: 'Markus Unger' }, notes: 'Vertragsdetails kl√§ren', permalink_url: `https://app.asana.com/0/${ASANA_PROJECT_ID}` },
                
                // vit:bikes basic
                { gid: '10', name: 'Akademie App installieren', completed: true, section: 'vit:bikes basic', due_on: null, notes: '', permalink_url: `https://app.asana.com/0/${ASANA_PROJECT_ID}` },
                { gid: '11', name: 'Module durchgehen', completed: true, section: 'vit:bikes basic', due_on: null, notes: '', permalink_url: `https://app.asana.com/0/${ASANA_PROJECT_ID}` },
                { gid: '12', name: 'Social Media Kan√§le folgen', completed: true, section: 'vit:bikes basic', due_on: null, notes: 'Instagram, LinkedIn, Facebook', permalink_url: `https://app.asana.com/0/${ASANA_PROJECT_ID}` },
                { gid: '13', name: 'Die Entwicklung des Fahrradmarktes verstehen', completed: false, section: 'vit:bikes basic', due_on: '2026-02-22', notes: 'Video-Kurs in der Akademie', permalink_url: `https://app.asana.com/0/${ASANA_PROJECT_ID}` },
                { gid: '14', name: 'Zielgruppe definieren', completed: false, section: 'vit:bikes basic', due_on: '2026-02-24', notes: '', permalink_url: `https://app.asana.com/0/${ASANA_PROJECT_ID}` },
                
                // Marketing
                { gid: '20', name: 'Willkommen im Marketing-Modul', completed: true, section: 'Marketing', due_on: null, assignee: { name: 'Mike' }, notes: 'Einf√ºhrung von Mike', permalink_url: `https://app.asana.com/0/${ASANA_PROJECT_ID}` },
                { gid: '21', name: 'Google My Business Profil optimieren', completed: true, section: 'Marketing', due_on: null, notes: 'Schritt-f√ºr-Schritt Anleitung befolgen', permalink_url: `https://app.asana.com/0/${ASANA_PROJECT_ID}` },
                { gid: '22', name: 'Social Media Bestandsaufnahme', completed: true, section: 'Marketing', due_on: null, notes: 'Alle Profile durchgehen und dokumentieren', permalink_url: `https://app.asana.com/0/${ASANA_PROJECT_ID}` },
                { gid: '23', name: 'Youtube Kanal einrichten', completed: false, section: 'Marketing', due_on: '2026-02-25', assignee: { name: 'Basti Schrecker' }, notes: '', permalink_url: `https://app.asana.com/0/${ASANA_PROJECT_ID}` },
                { gid: '24', name: 'Website Check durchf√ºhren', completed: false, section: 'Marketing', due_on: '2026-02-28', notes: 'Performance, SEO, UX pr√ºfen', permalink_url: `https://app.asana.com/0/${ASANA_PROJECT_ID}` },
                { gid: '25', name: 'Strategie-Meeting mit Mike', completed: false, section: 'Marketing', due_on: '2026-03-03', assignee: { name: 'Mike' }, notes: 'Marketingstrategie besprechen', permalink_url: `https://app.asana.com/0/${ASANA_PROJECT_ID}` },
                
                // Verkauf
                { gid: '30', name: 'Was ist Verkauf?', completed: true, section: 'Verkauf', due_on: null, notes: 'Grundlagen-Video ansehen', permalink_url: `https://app.asana.com/0/${ASANA_PROJECT_ID}` },
                { gid: '31', name: 'vit:bikes Verkaufsablauf lernen', completed: true, section: 'Verkauf', due_on: null, notes: '', permalink_url: `https://app.asana.com/0/${ASANA_PROJECT_ID}` },
                { gid: '32', name: 'Die Erfolgstabelle verstehen', completed: true, section: 'Verkauf', due_on: null, notes: 'Tracking-System einf√ºhren', permalink_url: `https://app.asana.com/0/${ASANA_PROJECT_ID}` },
                { gid: '33', name: '3D-Vermessungssystem Training', completed: false, section: 'Verkauf', due_on: '2026-02-21', notes: 'Praktisches Training vor Ort', permalink_url: `https://app.asana.com/0/${ASANA_PROJECT_ID}` },
                { gid: '34', name: 'Fahrspa√ügarantie verstehen', completed: false, section: 'Verkauf', due_on: '2026-02-26', notes: 'USP von vit:bikes', permalink_url: `https://app.asana.com/0/${ASANA_PROJECT_ID}` },
                { gid: '35', name: 'Verkaufstraining f√ºr Mitarbeiter', completed: false, section: 'Verkauf', due_on: '2026-03-01', notes: '', permalink_url: `https://app.asana.com/0/${ASANA_PROJECT_ID}` },
                
                // Einkauf
                { gid: '40', name: 'Willkommen im Einkaufssystem', completed: false, section: 'Einkauf', due_on: '2026-02-19', assignee: { name: 'Florian' }, notes: 'Einf√ºhrung von Florian', permalink_url: `https://app.asana.com/0/${ASANA_PROJECT_ID}` },
                { gid: '41', name: 'Gemeinsam stark Prinzip verstehen', completed: false, section: 'Einkauf', due_on: '2026-02-23', notes: 'Warum Gruppenvolumen Konditionssprung bedeutet', permalink_url: `https://app.asana.com/0/${ASANA_PROJECT_ID}` },
                { gid: '42', name: 'Zentralregulierung erkl√§rt', completed: false, section: 'Einkauf', due_on: '2026-02-27', notes: 'IHT statt Bico Prozess', permalink_url: `https://app.asana.com/0/${ASANA_PROJECT_ID}` },
                { gid: '43', name: 'Kernsortiment: 7-8 Marken Strategie', completed: false, section: 'Einkauf', due_on: '2026-03-02', notes: 'Fokus auf Kernlieferanten', permalink_url: `https://app.asana.com/0/${ASANA_PROJECT_ID}` },
                { gid: '44', name: '4-Marken-Strategie definieren', completed: false, section: 'Einkauf', due_on: '2026-03-05', notes: 'Expertenstatus statt Bauchladen', permalink_url: `https://app.asana.com/0/${ASANA_PROJECT_ID}` },
                
                // Werkstatt
                { gid: '50', name: 'Werkstatt-Prozesse kennenlernen', completed: false, section: 'Werkstatt', due_on: '2026-02-24', notes: '', permalink_url: `https://app.asana.com/0/${ASANA_PROJECT_ID}` },
                { gid: '51', name: 'Service-Standards vit:bikes', completed: false, section: 'Werkstatt', due_on: '2026-03-01', notes: 'Qualit√§tsrichtlinien', permalink_url: `https://app.asana.com/0/${ASANA_PROJECT_ID}` },
                
                // Toolbox
                { gid: '60', name: 'Quiply App installieren', completed: false, section: 'Toolbox', due_on: '2026-02-20', notes: 'Interne Kommunikation', permalink_url: `https://app.asana.com/0/${ASANA_PROJECT_ID}` },
                { gid: '61', name: 'Todoist einrichten', completed: false, section: 'Toolbox', due_on: '2026-02-22', notes: 'Task Management', permalink_url: `https://app.asana.com/0/${ASANA_PROJECT_ID}` },
                { gid: '62', name: 'Outlook konfigurieren', completed: false, section: 'Toolbox', due_on: '2026-02-25', notes: 'E-Mail Setup', permalink_url: `https://app.asana.com/0/${ASANA_PROJECT_ID}` }
            ];
        }
        
        function groupTasksBySections() {
            asanaSections = {};
            
            asanaTasks.forEach(task => {
                if (task.memberships && task.memberships.length > 0) {
                    const sectionName = task.memberships[0].section.name;
                    
                    if (!asanaSections[sectionName]) {
                        asanaSections[sectionName] = [];
                    }
                    
                    asanaSections[sectionName].push(task);
                }
            });
        }
        
        function renderAsanaTasks() {
            const container = document.getElementById('asanaOnboardingContent');
            
            // Berechne Gesamt-Fortschritt
            const totalTasks = asanaTasks.length;
            const completedTasks = asanaTasks.filter(t => t.completed).length;
            const progress = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
            
            let html = `
                <!-- Header mit Fortschritt -->
                <div class="vit-card p-6 mb-6">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="h2-headline text-gray-800">Dein Onboarding-Plan</h2>
                        <a href="https://app.asana.com/0/${ASANA_PROJECT_ID}" target="_blank" class="text-sm text-vit-orange hover:underline font-semibold">
                            In Asana √∂ffnen ‚Üí
                        </a>
                    </div>
                    
                    <p class="text-sm text-gray-600 mb-6">Live synchronisiert mit Asana ‚Ä¢ ${totalTasks} Aufgaben</p>

                    <!-- Gesamt-Fortschritt -->
                    <div class="mb-6">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm font-semibold text-gray-700">Gesamt-Fortschritt</span>
                            <span class="text-sm font-semibold text-vit-orange">${progress}% (${completedTasks}/${totalTasks})</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-3">
                            <div class="bg-vit-orange h-3 rounded-full transition-all duration-500" style="width: ${progress}%"></div>
                        </div>
                    </div>
                </div>
            `;
            
            // Wichtige Sections die wir anzeigen wollen
            const sectionsToShow = [
                'Allgemein',
                'vit:bikes basic',
                'Marketing', 
                'Verkauf',
                'Einkauf',
                'Werkstatt',
                'Toolbox'
            ];
            
            sectionsToShow.forEach(sectionName => {
                if (asanaSections[sectionName]) {
                    html += renderSection(sectionName, asanaSections[sectionName]);
                }
            });
            
            container.innerHTML = html;
        }
        
        function renderSection(sectionName, tasks) {
            const totalTasks = tasks.length;
            const completedTasks = tasks.filter(t => t.completed).length;
            const sectionProgress = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
            
            // Filter out separator tasks (those starting with --)
            const realTasks = tasks.filter(t => !t.name.startsWith('--'));
            
            if (realTasks.length === 0) return '';
            
            return `
                <div class="vit-card p-6 mb-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="font-semibold text-gray-800 flex items-center">
                            ${getSectionIcon(sectionName)}
                            <span class="ml-2">${sectionName}</span>
                            <span class="ml-3 text-sm font-normal text-gray-500">${completedTasks}/${totalTasks}</span>
                        </h3>
                        <div class="text-sm font-semibold ${sectionProgress === 100 ? 'text-green-600' : 'text-vit-orange'}">
                            ${sectionProgress}%
                        </div>
                    </div>
                    
                    <div class="w-full bg-gray-200 rounded-full h-2 mb-4">
                        <div class="bg-vit-orange h-2 rounded-full transition-all duration-500" style="width: ${sectionProgress}%"></div>
                    </div>
                    
                    <div class="space-y-2">
                        ${realTasks.map(task => renderTask(task)).join('')}
                    </div>
                </div>
            `;
        }
        
        function getSectionIcon(sectionName) {
            const icons = {
                'Allgemein': 'üìã',
                'vit:bikes basic': 'üéì',
                'Marketing': 'üì¢',
                'Verkauf': 'üéØ',
                'Einkauf': 'üõí',
                'Werkstatt': 'üîß',
                'Toolbox': 'üõ†Ô∏è',
                'Mitarbeiter/Team': 'üë•'
            };
            return `<span class="text-2xl">${icons[sectionName] || 'üìå'}</span>`;
        }
        
        function renderTask(task) {
            const isCompleted = task.completed;
            const dueDate = task.due_on ? new Date(task.due_on).toLocaleDateString('de-DE') : null;
            const assignee = task.assignee ? task.assignee.name : null;
            
            return `
                <div class="flex items-start space-x-3 p-3 ${isCompleted ? 'bg-green-50' : 'bg-white border border-gray-200'} rounded-lg hover:shadow-sm transition-shadow">
                    <input 
                        type="checkbox" 
                        ${isCompleted ? 'checked' : ''} 
                        onchange="toggleTaskCompletion('${task.gid}', this.checked)"
                        class="w-5 h-5 mt-0.5 text-vit-orange rounded cursor-pointer"
                    >
                    <div class="flex-1">
                        <div class="flex items-start justify-between">
                            <span class="text-sm ${isCompleted ? 'text-gray-500 line-through' : 'text-gray-700 font-medium'}">
                                ${task.name}
                            </span>
                            ${dueDate || assignee ? `
                                <div class="flex items-center space-x-2 ml-2">
                                    ${dueDate ? `<span class="text-xs text-gray-500">üìÖ ${dueDate}</span>` : ''}
                                    ${assignee ? `<span class="text-xs text-gray-500">üë§ ${assignee}</span>` : ''}
                                </div>
                            ` : ''}
                        </div>
                        ${task.notes ? `
                            <p class="text-xs text-gray-500 mt-1 line-clamp-2">${task.notes}</p>
                        ` : ''}
                    </div>
                    <a href="${task.permalink_url}" target="_blank" class="text-gray-400 hover:text-vit-orange">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
                        </svg>
                    </a>
                </div>
            `;
        }
        
        async function toggleTaskCompletion(taskGid, completed) {
            try {
                // Optimistic UI Update
                const task = asanaTasks.find(t => t.gid === taskGid);
                if (task) {
                    task.completed = completed;
                    renderAsanaTasks();
                }
                
                // Update in Asana via MCP
                const response = await fetch('/api/asana/task/update', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        task_id: taskGid,
                        completed: completed
                    })
                });
                
                if (!response.ok) {
                    throw new Error('Failed to update task');
                }
                
                // Show success feedback
                showNotification(completed ? '‚úÖ Aufgabe abgeschlossen!' : '‚Ü©Ô∏è Aufgabe reaktiviert', 'success');
                
            } catch (error) {
                console.error('Error updating task:', error);
                
                // Revert optimistic update
                const task = asanaTasks.find(t => t.gid === taskGid);
                if (task) {
                    task.completed = !completed;
                    renderAsanaTasks();
                }
                
                showNotification('‚ùå Fehler beim Aktualisieren', 'error');
            }
        }
        
        
        // Verkaufserfolg Tracking Functions
        function updateSalesData() {
            const planned = parseInt(document.getElementById('plannedInput').value) || 0;
            const spontaneous = parseInt(document.getElementById('spontaneousInput').value) || 0;
            const online = parseInt(document.getElementById('onlineInput').value) || 0;
            const ergo = parseInt(document.getElementById('ergoInput').value) || 0;
            const sales = parseInt(document.getElementById('salesInput').value) || 0;
            
            // Berechne Gesamt-Beratungen
            const totalConsultations = planned + spontaneous + online;
            
            // Berechne Quote
            const quote = totalConsultations > 0 ? Math.round((sales / totalConsultations) * 100) : 0;
            
            // Update Display
            document.getElementById('totalConsultations').textContent = totalConsultations;
            document.getElementById('quoteDisplay').textContent = quote + '%';
            
            // F√§rbe Quote je nach Performance
            const quoteElement = document.getElementById('quoteDisplay');
            if (quote >= 40) {
                quoteElement.className = 'text-2xl font-bold text-green-600';
            } else if (quote >= 25) {
                quoteElement.className = 'text-2xl font-bold text-blue-600';
            } else {
                quoteElement.className = 'text-2xl font-bold text-orange-600';
            }
        }
        
        function saveSalesData() {
            var salesperson = document.getElementById('salesPersonSelect').value;
            var planned = document.getElementById('plannedInput').value;
            var spontaneous = document.getElementById('spontaneousInput').value;
            var online = document.getElementById('onlineInput').value;
            var ergo = document.getElementById('ergoInput').value;
            
            // Show success feedback
            var btn = event && event.target ? event.target : null;
            if(btn) {
                var orig = btn.innerHTML;
                btn.innerHTML = '‚úÖ Gespeichert!';
                btn.classList.add('bg-green-500');
                btn.classList.remove('bg-vit-orange');
                setTimeout(function(){ btn.innerHTML = orig; btn.classList.remove('bg-green-500'); btn.classList.add('bg-vit-orange'); }, 2000);
            }
        }
    </script>
</body>
</html>